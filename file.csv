ID,Title,Date,Content,Author,Tags,Categories
956,思源派发布文章已经无需审核,Fri Jul 26 2024 23:47:09 GMT+0000 (Coordinated Universal Time),<p>现在，只要正常登录思源派，即可免审核发布自己的文章</p>,HAN,,CSS
954,思源版 Dataview.js 的愿景,Fri Jul 26 2024 21:04:38 GMT+0000 (Coordinated Universal Time),"<p>基于 js query 和弘佬的 Data Query 做二次开发（把 API 调整地更加人性化一点）；可以的话最好加上能降低编写门槛的 GUI 配置界面。</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-47-1024x464.png"" alt=""image"" data-edit-file-id=""953"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-47.png"" /></p><p>以上渲染结果对应以下代码：</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">//!js
const query = async () =&gt; {
let dv = Query.DataView(protyle, item, top);
const doc = await Query.thisDoc(protyle);


let left = dv.markdown(`
## ? 日记
- 创建时间: ==${doc.attr('created')}==
- 更新时间: ==${doc.attr('updated')}==
`);

let updated = await Query.cond(`updated like '20240726%' and type='d' and box='${doc.box}'`);
let links = updated.map(b =&gt; b.aslink);
let list = dv.list(links);
list.style.columns = '2';

let row = dv.rows([
dv.markdown('## ⏰ 今日更新文档'),
list
]);

dv.addColumns([left, row]);

dv.addmd('## 当前文档');
dv.addBlockTable([doc], ['type', 'content', 'hpath', 'box', 'updated', 'memo']);

dv.render();
}

return query();</code></pre><p> </p><p> </p>",tempaccount,插件开发,内测
936,思源 Chart 萌新使用指南,Thu Jul 25 2024 19:32:39 GMT+0000 (Coordinated Universal Time),"<h2>基础教程</h2><p>可参考：<a href=""https://ld246.com/article/1630851751280"">https://ld246.com/article/1630851751280</a></p><p>但由于该教程中的“百度图说”已经下线了，可以使用 <a href=""https://www.lddgo.net/base/class?classID=9"">https://www.lddgo.net/base/class?classID=6</a> 这个网站代替。</p><h2>进阶教程</h2><p>如果 <a href=""https://www.lddgo.net/base/class?classID=9"">https://www.lddgo.net/base/class?classID=6</a> 这个网站的图例无法满足你的需求，也可以参考<a href=""https://echarts.apache.org/examples/zh/index.html"">官网示例</a>。</p><p>官网中，复制js示例代码中的option里的内容即可，可根据自己的实际情况修改数据，如图。</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-46-1024x629.png"" alt=""image"" data-edit-file-id=""950"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-46.png"" /></p><p>如果，有些复杂的示例中有js代码的，可以在最底部添加<code>console.log(option)</code>，然后打开浏览器开发者工具，然后打开控制台（windows: Ctrl+Shift+I；macOS: Cmd+Option+I），复制刚才打印的option对象，然后粘贴到思源chart块中即可。</p><p><img src=""https://b3logfile.com/file/2024/07/image-a5T8MAn.png"" alt=""image.png"" /></p><p>当然，这种方法还是太过麻烦，还有一种更方便的方法，可以在chart块中先写个立即函数，然后返回option变量，然后把echarts官网的代码直接粘贴到立即函数中即可。</p><p>这样，还有个好处，还可以通过思源api动态生成option的数据。可参考：<a href=""https://ld246.com/article/1681651522673"">https://ld246.com/article/1681651522673</a></p><p>立即函数如下：</p><pre><code>(() =&gt; {
    //代码粘贴到这里
    return option;
})()
</code></pre><p>这里还有一些其他的示例可供参考：<a href=""https://juejin.cn/post/7078834647005822983"">https://juejin.cn/post/7078834647005822983</a></p><p>当然，如果想个性化和支持更多功能，还推荐认真看看官方的教程：<a href=""https://echarts.apache.org/handbook/zh/how-to/chart-types/bar/basic-bar"">https://echarts.apache.org/handbook/zh/how-to/chart-types/bar/basic-bar</a></p><h2>源码分析</h2><p>基本上，以上掌握了就能很好的利用echarts了。</p><p>但你可能遇到一些问题，不知道怎么排查，或者你想看看官方的源码是怎么实现的。</p><p>可打开思源控制台（windows: Ctrl+Shift+I；macOS: Cmd+Option+I），然后打开源代码选项卡，然后找到main.js文件，然后搜索，一共出现2个，找到第2个即可，如图。</p><p><img src=""https://b3logfile.com/file/2024/07/image-BKNBb1w.png"" alt=""image.png"" /></p><p>由图可知，chart块里输入的数据来自l变量，而l变量的值来自块元素的data-content属性。</p><p>如果有问题，也可以在这里加断点调试。</p><p>当然，如果想看未压缩的源码可以到这里查看：<a href=""https://github.com/siyuan-note/siyuan/blob/687421fe62beb6bddd46c69a263c485bb1fe6619/app/src/protyle/render/chartRender.ts#L45"">https://github.com/siyuan-note/siyuan/blob/687421fe62beb6bddd46c69a263c485bb1fe6619/app/src/protyle/render/chartRender.ts#L45</a></p>",wilson,"chart,echarts,小白,萌新",教程
926,js 片段实现目录树自动展开,Wed Jul 24 2024 12:46:53 GMT+0000 (Coordinated Universal Time),"<p>看到论坛里有很多人表示希望有这个功能，今天也在看帖子讨论的过程中研究了一番，有一点思路，就试着实现了下。</p><p>由于刚接触思源，插件还不会写，api 也不熟，所以选择用 js 片段实现，基本是纯原生 js 实现。</p><p><strong>主要功能：</strong> 记住上次已展开的目录，下次打开或刷新时自动展开上次已展开的目录。</p><p><strong>实现原理：</strong></p><p>仅记录已展开目录的 data-path, 笔记以 data-url 区分，以 object 嵌套的方式记录展开目录所在的层级关系。</p><p>加载时，会根据记录的目录层级关系，依次展开。</p><p>展开时，会记录目录的层级关系，如果不存在则添加。</p><p>折叠时，会根据目录的层级关系，删除对应的 Object 嵌套层级。</p><p>数据默认存储在/data/storage/tree-auto-extend.json 中，object 嵌套格式可参考这里的数据。</p><p><strong>已知问题：</strong></p><p>目前仅支持 pc 客户端，web 版和手机版理论上也支持，但好像有问题，尚未找到原因，请大佬帮忙进一步优化！</p><p>能力有限，这里仅仅是抛砖引玉，完善和优化还得靠各位大佬的鼎力支持！</p><p><strong>完整代码如下：</strong></p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">// 目录树自动展开
// 功能：记住上次已展开的目录，下次打开或刷新时自动展开上次已展开的目录
// Version 0.0.1
// By Wilson 2024.7.24 晚
// MIT License

// 实现原理：
// 仅记录已展开目录的data-path, 笔记以data-url区分，以object嵌套的方式记录展开目录所在的层级关系
// 加载时，会根据记录的目录层级关系，依次展开
// 展开时，会记录目录的层级关系，如果不存在则添加
// 折叠时，会根据目录的层级关系，删除对应的Object嵌套层级
// 目前仅支持pc客户端，web版和手机版理论上也支持，但好像有问题，尚未找到原因，请大佬进一步优化！

// 配置存储路径（这个存储路径可以根据你自己的需要进行修改）
const storagePath = ""/data/storage/tree-auto-extend.json"";
// 是否启用自动定位当前文件所在的目录
const isShowFilePosition = true;

// 监听笔记列表渲染完成
whenElementExist(""ul.b3-list[data-url]"").then(async myElement =&gt; {
    // 防止更多笔记列表尚未渲染完成（笔记目录只渲染第一级，一般20毫秒足够了）
    await sleep(20);

    // 获取所有展开元素（这里变量命名有点问题，就这样吧）
    let collapsedEls = await getCollapsedEls();

    // 监听折叠事件
    document.querySelectorAll(""ul.b3-list[data-url]"").forEach(async book =&gt; {
        // 当前笔记的 data-url
        const bookDataUrl = book.getAttribute(""data-url"");

        // 自动展开
        autoExpandElements(collapsedEls[bookDataUrl], bookDataUrl);

        // 监听折叠事件
        book.addEventListener(""click"", async event =&gt; {
            //等待箭头按钮渲染完成
            await sleep(40);
            let arrowBtn = event.target;
            if (event.target.tagName == ""SPAN"") {
                arrowBtn = event.target.firstElementChild;
            }
            // 如果是箭头按钮
            if (arrowBtn &amp;&amp; arrowBtn.classList.contains(""b3-list-item__arrow"")) {
                const isOpen = arrowBtn.classList.contains(""b3-list-item__arrow--open"");
                // 存储当前元素的折叠状态
                storeElement(collapsedEls, bookDataUrl, arrowBtn, isOpen);
            }
        });
    });

    // 定位当前打开的文档
    if(isShowFilePosition){
        await sleep(40);
        document.querySelector("".layout-tab-container .block__icons span[data-type=focus]"").click();
    }
});
// 自动展元素
async function autoExpandElements(collapsedEls, bookDataUrl, path = []) {
    if (!collapsedEls) {
        return;
    }
    // 循环所有存储的展开元素并自动展开
    for (let key in collapsedEls) {
        if (key &amp;&amp; collapsedEls.hasOwnProperty(key)) {
            const newPath = [...path, key];
            const joinPath = newPath.join('/');
            // 意外情况跳过
            if (joinPath === """") continue;
            const elPath = joinPath === ""/"" ? ""/"" : `/${joinPath.replace(/^\/+/, '')}.sy`;
            const elArrowBtn = document.querySelector(""ul.b3-list[data-url='"" + bookDataUrl + ""'] li[data-path='"" + elPath + ""'] span.b3-list-item__toggle"");
            if (!elArrowBtn.firstElementChild.classList.contains(""b3-list-item__arrow--open"")) {
                elArrowBtn.click();
                // 等待子元素渲染完毕
                //await sleep(40);
                await whenElementExist(()=&gt;{
                    return elArrowBtn.closest(""li"").nextElementSibling?.tagName === 'UL';
                });
            }
            // 如果当前值也是一个对象，递归遍历
            if (typeof collapsedEls[key] === 'object' &amp;&amp; collapsedEls[key] !== null &amp;&amp; !Array.isArray(collapsedEls[key])) {
                autoExpandElements(collapsedEls[key], bookDataUrl, newPath);
            }
        }
    }
}
// 存储当前展开的元素
function storeElement(collapsedEls, bookDataUrl, arrowBtn, isOpen) {
    const nodePath = arrowBtn.parentElement.parentElement.getAttribute(""data-path"");
    const nodePathArr = nodePath === ""/"" ? [""/""] : nodePath.replace(/.sy$/i, '').split(""/"");
    nodePathArr[0] = nodePathArr[0] === """" ? ""/"" : nodePathArr[0];
    if (!collapsedEls[bookDataUrl]) {
        collapsedEls[bookDataUrl] = {};
    }
    if (isOpen) {
        // 如果是展开，则创建嵌套对象
        createNestedObject(nodePathArr, collapsedEls[bookDataUrl]);
    } else {
        // 如果是折叠，则删除最后一个key
        removeNestedKey(collapsedEls, bookDataUrl, nodePathArr);
    }
    // 存储展开元素的数据
    storeCollapsedEl(collapsedEls);
}
// 获取存储的展开元素（这里函数命名有点问题，就这样吧）
async function getCollapsedEls() {
    let data = await getFileContent(storagePath||""/data/storage/tree-auto-extend.json"") || ""{}"";
    data = JSON.parse(data);
    if(data.code === 404) data = {};
    return data;
}
// 存储展开元素（这里函数命名有点问题，就这样吧）
function storeCollapsedEl(data) {
    putFileContent(storagePath||""/data/storage/tree-auto-extend.json"", JSON.stringify(data))
}
// 创建嵌套对象
function createNestedObject(pathArray, objRef) {
    if (pathArray.length === 0) return; // 如果数组为空，退出递归
    const currentNode = pathArray.shift(); // 取出数组的第一个元素
    if (!objRef[currentNode]) {
        objRef[currentNode] = {}; // 创建一个新的空对象
    }
    if (pathArray.length &gt; 0) {
        createNestedObject(pathArray, objRef[currentNode]); // 递归调用，传入新的路径数组和当前节点的子对象
    }
}
// 删除嵌套对象的最后一个key
function removeNestedKey(obj, urlKey, pathArr) {
    if (!obj || !urlKey || !pathArr || pathArr.length === 0) {
        return;
    }
    let currentLevel = obj[urlKey];
    if (!currentLevel) {
        return;
    }
    // Traverse through the object based on the path array
    for (let i = 0; i &lt; pathArr.length - 1; i++) {
        const key = pathArr[i];
        if (!currentLevel[key]) {
            return;
        }
        currentLevel = currentLevel[key];
    }
    // Delete the last key specified in the path array
    const lastKeyToDelete = pathArr[pathArr.length - 1];
    if (lastKeyToDelete in currentLevel) {
        delete currentLevel[lastKeyToDelete];
    }
}
// 延迟执行
function sleep(ms) {
    return new Promise(resolve =&gt; setTimeout(resolve, ms));
}
// 等待元素渲染完成后执行
function whenElementExist(selector) {
    return new Promise(resolve =&gt; {
        const checkForElement = () =&gt; {
            let isExist = false;
            if (typeof selector === 'function') {
                isExist = selector();
            } else {
                isExist = document.querySelector(selector);
            }
            if (isExist) {
                resolve(true);
            } else {
                requestAnimationFrame(checkForElement);
            }
        };
        checkForElement();
    });
}
// 写入文件内容
async function putFileContent(path, content) {
    const formData = new FormData();
    formData.append(""path"", path);
    formData.append(""file"", new Blob([content]));
    return fetch(""/api/file/putFile"", {
        method: ""POST"",
        body: formData,
    })
    .then((response) =&gt; {
        if (response.ok) {
            //console.log(""File saved successfully"");
        }
        else {
            throw new Error(""Failed to save file"");
        }
    })
    .catch((error) =&gt; {
        console.error(error);
    });
}
// 获取文件内容
async function getFileContent(path) {
    return fetch(""/api/file/getFile"", {
        method: ""POST"",
        headers: {
            ""Content-Type"": ""application/json"",
        },
        body: JSON.stringify({
            path,
        }),
    })
    .then((response) =&gt; {
        if (response.ok) {
            return response.text();
        }
        else {
            throw new Error(""Failed to get file content"");
        }
    })
    .catch((error) =&gt; {
        console.error(error);
    });
}</code></pre><p><strong>使用方法：</strong></p><ol><li><p>设置 -&gt; 外观 -&gt; 代码片段 -&gt; JS 中添加新的 js 代码片段即可。</p></li><li><p>输入上述代码到你新建的代码片段中</p></li><li><p>开启代码片段即可（如果有问题重启思源试试）</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2024/07/image-M30lGps.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></span></p><div class=""fn__flex-inline"">701 x 3091210 x 534</div></li></ol><hr /><p><strong>说明：</strong> 由于今天事情比较多，可能无法及时看到大家的问题，不过在空闲时，会第一时间回复，请大家积极踊跃提出宝贵意见！</p><p> </p><p>原文链接：<a href=""https://ld246.com/article/1721771759337"">https://ld246.com/article/1721771759337</a></p>",wilson,"代码片段,思源,插件",JS
869,常用的思源笔记插件分享（2024）,Mon Jul 22 2024 23:46:29 GMT+0000 (Coordinated Universal Time),"<p>时间过得真快，上一篇分享插件的笔记快一年了。思源笔记这个软件就像是开发商精装交付的商品房，上手可用，但有一些毛病还是有点难受。好在“业主”们各个动手能力强，又有奉献精神，纷纷提供了二改方案，也就是插件，一年时间，思源集市又上线了很多实用的插件。以下是我本人近期常用的几款，推荐给大家，原先推荐的依然好用！</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722221448-a1oqvsk.png"" alt=""image"" />​</p><h3>一、番茄工具箱（sy-tomato-plugin)</h3><p>几乎日更的思源瑞士军刀般的插件，集成了非常多实用小功能，如底部反链、番茄钟等，重点是帮助文档写的也非常详细，十分推荐，用的时候记得去看插件里的说明。</p><blockquote><p>关键词：插件工具箱</p></blockquote><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722221541-wmlngjr.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722221849-7vmxzob.png"" alt=""image"" />​</p><p>‍</p><h3>二、增强思源笔记（sy-plugin-enhance)</h3><p>更优雅的底部反链插件，同时还支持一些特定的输入流，有非常强的个人风格的插件。</p><blockquote><p>关键词：优雅的底部反链插件</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722224015-drnxpvg.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722223240-gjvdrp6.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722223142-7fg0zob.png"" alt=""image"" />​</p><p>‍</p><h3>三、任务列表（siyuan-plugin-task-list）</h3><p>思源里唯一一款汇总原生todo任务的任务插件，交互非常自然直观，无序额外的代码设置，下载即用的典范了。</p><blockquote><p>关键词：任务汇总，日历视图</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722224133-jy8wbwd.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722224326-35tmtxu.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722224517-nvfnmp0.png"" alt=""image"" />​</p><p>‍</p><h3>四、文档流（sy-docs-flow)</h3><p>一款能让思源的文档以瀑布流的形式展示的插件，支持多种获取方式，如直接子文档实现类logseq日记的滚动查看、高级一点的可以自己写一个SQL查询。</p><blockquote><p>关键词：瀑布流视图浏览</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722224736-gjfxoky.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722225120-924tsbj.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722225105-qbrwh0p.png"" alt=""image"" />​</p><p>‍</p><p>插件作者还上架了其他非常实用的插件，如书签+、中间小窗、Callout、今日笔记、文档上下文等，都是可以下载使用的！</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722225828-44rgbm6.png"" alt=""image"" />​</p><p>‍</p><h3>五、文档树自定义（siyuan_doctree_compress）</h3><p>思源提供了原生的文档树功能，但可能很多人对一些UI和布局包括前面的svg图标都不是很满意，想要简约形态，这款插件提供了多达20余项的调整文档树的功能，满足绝大部份需求了。</p><blockquote><p>关键词：文档树自定义</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722230155-uwznuel.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722230358-n4aqees.png"" alt=""image"" />​</p><p>同时作者还开发了双击文档树、移除思源自带按钮等特色插件。感兴趣可以下载使用。</p><p>‍</p><h3>六、文档高亮搜索（siyuan-plugin-hsr-mdzz2048-fork)</h3><p>来自论坛最热心的用户JFChen开发的朴素而有呼声很大的插件，直接在当前页面执行高亮搜索，如传统编辑器那样。</p><blockquote><p>关键词：当前文档高亮搜索</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722230607-9lm6snu.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722230701-8tt9h57.png"" alt=""image"" />​</p><p>‍</p><h3>七、基于文档搜索（syplugin-document-search)</h3><p>以文档为单位进行查询的插件，与官方的区别在于支持代码块、数据库关键字高亮和定位！</p><blockquote><p>关键词：侧栏直接搜的搜索插件</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722231226-dqki6pu.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722231159-xif9olh.png"" alt=""image"" />​</p><p>‍</p><h3>八、memos同步助手（plugin-memos-sync-helper)</h3><p>支持开源类flomo备注软件memos的数据同步，支持新老API！</p><blockquote><p>关键词：同时支持V1、V2</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722231457-hp68nqa.png"" alt=""image"" />​</p><p>‍</p><h3>九、五彩（siyuan-wucai)</h3><p>五彩剪藏网页扩展官方同步插件，支持同步五彩标注的全文、批注等信息到思源。</p><blockquote><p>关键词：添加网页到侧栏、flomo、网页设置为首页</p></blockquote><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722231632-x8q0mg0.png"" alt=""image"" />​</p><p>​<img src=""https://sypai.cc/wp-content/uploads/2024/07/image-20240722231742-wud6w8d.png"" alt=""image"" />​</p><p>‍</p><p>‍</p><h3>最后</h3><p>以上是本人现在常用的插件，因为使用习惯和篇幅问题，还有许多非常好的插件没有写上。同时，上面仅简单介绍了插件的主要功能，具体的使用还得靠大家上手体验。</p>",墨竹,思源笔记/插件使用,教程
867,分享两个好用的代码片段,Mon Jul 22 2024 22:33:36 GMT+0000 (Coordinated Universal Time),"<h2 id=""写在前面"">写在前面</h2><p>这两个片段都是从其他地方抄过来, 改一改的, 如果你是作者, 且比较介意, 请联系我删帖</p><h2 id=""js片段-增加按钮"">js 片段-增加按钮</h2><p>增加三个按钮</p><ol><li>快捷打开 js 代码片段</li><li>快捷打开 css 代码片段</li><li>重新加载页面</li></ol><p>因为我有一个日历图的原因, 所以是在 plugin_Calendar-heatmap_0 后面, 可以放在右箭头的后面: 将 <code>js_btn_str = addBtnJsSnippets(""plugin_Calendar-heatmap_0"");</code> 改为 <code>js_btn_str = addBtnJsSnippets(""barForward"");</code></p><p>添加按钮的所在位置如下:</p><p><img src=""https://b3logfile.com/file/2024/07/image-jkDYzJg.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></p><p> </p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">// js片段
// 通过快捷键(alt + p), 打开配置页面
function openSettingPage() {
  let keyInit = {
    ctrlKey: false,
    altKey: true,
    metaKey: false,
    shiftKey: false,
    key: 'P',
    keyCode: 80
  }
  keyInit[""bubbles""] = true;
  let keydownEvent = new KeyboardEvent('keydown', keyInit);
  document.getElementsByTagName(""body"")[0].dispatchEvent(keydownEvent);
  let keyUpEvent = new KeyboardEvent('keyup', keyInit);
  document.getElementsByTagName(""body"")[0].dispatchEvent(keyUpEvent);
}


// 添加按钮, 并设置点击事件
// 添加 js代码片段
function addBtnJsSnippets(perv_btn) {
  let barMode = document.getElementById(perv_btn);
  barMode.insertAdjacentHTML(
    ""afterend"",
    '&lt;div id=""js_barSnippets_simulate_btn"" class=""toolbar__item ariaLabel"" aria-label=""JS代码片段""&gt;&lt;/div&gt;'
  );
  let settingBtn = document.getElementById(""js_barSnippets_simulate_btn"");
  settingBtn.innerHTML = `&lt;svg&gt;&lt;use xlink:href=""#iconCode""&gt;&lt;/use&gt;&lt;/svg&gt;`;

  settingBtn.addEventListener(
    ""click"",
    function (e) {
      // 打开设置
      openSettingPage();
      // 点击外观
      // 找到包含 data-name=""appearance"" 的 &lt;li&gt; 元素
      var btn = document.querySelector('li[data-name=""appearance""]');
      btn.click();
      // 点击 设置
      // 获取按钮元素
      btn = document.getElementById('codeSnippet');
      btn.click();
      // 点击 js
      // 获取按钮元素
      setTimeout(() =&gt; {
        btn = document.querySelector('[data-type=""js""]');
        btn.click();
      }, 200);
    }
  );
  return ""js_barSnippets_simulate_btn""
}
// 添加按钮, 并设置点击事件
// 添加 css代码片段
function addBtnCssSnippets(perv_btn) {
  let barMode = document.getElementById(perv_btn);
  barMode.insertAdjacentHTML(
    ""afterend"",
    '&lt;div id=""css_barSnippets_simulate_btn"" class=""toolbar__item ariaLabel"" aria-label=""css代码片段""&gt;&lt;/div&gt;'
  );
  let settingBtn = document.getElementById(""css_barSnippets_simulate_btn"");
  settingBtn.innerHTML = `&lt;svg&gt;&lt;use xlink:href=""#iconCode""&gt;&lt;/use&gt;&lt;/svg&gt;`;

  settingBtn.addEventListener(
    ""click"",
    function (e) {
      // 打开设置
      openSettingPage();
      // 点击外观
      // 找到包含 data-name=""appearance"" 的 &lt;li&gt; 元素
      var btn = document.querySelector('li[data-name=""appearance""]');
      btn.click();
      // 点击 设置
      // 获取按钮元素
      btn = document.getElementById('codeSnippet');
      btn.click();
    }
  );
  return ""css_barSnippets_simulate_btn""
}

// 添加按钮, 并设置点击事件
// 添加 重新加载按钮
function addBtnRefresh(perv_btn) {
  let barMode = document.getElementById(perv_btn);
  barMode.insertAdjacentHTML(
    ""afterend"",
    '&lt;div id=""reload_page_btn"" class=""toolbar__item ariaLabel"" aria-label=""重新加载""&gt;&lt;/div&gt;'
  );
  let settingBtn = document.getElementById(""reload_page_btn"");
  settingBtn.innerHTML = `&lt;svg&gt;&lt;use xlink:href=""#iconRefresh""&gt;&lt;/use&gt;&lt;/svg&gt;`;

  settingBtn.addEventListener(
    ""click"",
    function (e) {
      // 打开设置
      openSettingPage();
      // 点击外观
      // 找到包含 data-name=""appearance"" 的 &lt;li&gt; 元素
      var btn = document.querySelector('li[data-name=""keymap""]');
      btn.click();
      // 点击 设置
      // 获取按钮元素
      btn = document.getElementById('keymapRefreshBtn');
      btn.click();
    }
  );
  return ""reload_page_btn""
}
/* 重新加载会有延时, 所以需要等待300ms之后再添加按钮 */
setTimeout(() =&gt; {
  js_btn_str = addBtnJsSnippets(""plugin_Calendar-heatmap_0"");
  addBtnCssSnippets(js_btn_str);
  addBtnRefresh(""barDock"");
}, 300);</code></pre><h2 id=""css片段-多彩显示文档树层级关系"">css 片段 多彩显示文档树层级关系</h2><p>缩进需要按照自己的设置进行微调</p><p>支持 7 层</p><p>与其他的不同的是, 这个代码是通过拼接背景颜色, 来实现缩进的效果, 并不修改按钮的缩进</p><p>可以看到 展开折叠的按钮还是很宽</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2024/07/image-052FYXU.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></span></p><p> </p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">div.layout__dockl ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)));
}
div.layout__dockl ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1)));
}
div.layout__dockl ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)));
}
div.layout__dockl ul&gt;ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)));
}
div.layout__dockl ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4)));
}
div.layout__dockl ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4) + var(--level-spacing-5)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4) + var(--level-spacing-5)));
}
div.layout__dockl ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-0)),
    var(--b3-font-background1) calc(var(--level-spacing-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4) + var(--level-spacing-5)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4) + var(--level-spacing-5)), 
    var(--b3-font-background2) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4) + var(--level-spacing-5) + var(--level-spacing-6)), 
    var(--b3-font-background3) calc(var(--level-spacing-0) + var(--level-spacing-1) + var(--level-spacing-2) + var(--level-spacing-3) + var(--level-spacing-4) + var(--level-spacing-5) + var(--level-spacing-6)));
}</code></pre><h2 id=""css片段-多彩显示大纲层级关系"">css 片段 多彩显示大纲层级关系</h2><p>同 多彩文档树, 支持 6 层</p><pre><code class=""language-css highlight-chroma""></code></pre><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">:root {
    /* 大纲缩进 */
    --level-spacing-outline-0: 10px;
    --level-spacing-outline-1: 9px;
    --level-spacing-outline-2: 9px;
    --level-spacing-outline-3: 8px;
    --level-spacing-outline-4: 8px;
    --level-spacing-outline-5: 8px;
}

/* 多彩层级文档树 CSS片段 */
div.sy__outline ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-outline-0)),
    var(--b3-font-background1) calc(var(--level-spacing-outline-0)));
}
div.sy__outline ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-outline-0)),
    var(--b3-font-background1) calc(var(--level-spacing-outline-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)));
}
div.sy__outline ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-outline-0)),
    var(--b3-font-background1) calc(var(--level-spacing-outline-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)));
}
div.sy__outline ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-outline-0)),
    var(--b3-font-background1) calc(var(--level-spacing-outline-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3)));
}
div.sy__outline ul&gt;ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-outline-0)),
    var(--b3-font-background1) calc(var(--level-spacing-outline-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3) + var(--level-spacing-outline-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3) + var(--level-spacing-outline-4)));
}
div.sy__outline ul&gt;ul&gt;ul&gt;ul&gt;ul&gt;ul {
    background-image: linear-gradient(to right, 
    var(--b3-theme-surface) 0, 
    var(--b3-theme-surface) calc(var(--level-spacing-outline-0)),
    var(--b3-font-background1) calc(var(--level-spacing-outline-0)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2)), 
    var(--b3-font-background3) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3)), 
    var(--b3-font-background4) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3) + var(--level-spacing-outline-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3) + var(--level-spacing-outline-4)), 
    var(--b3-font-background1) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3) + var(--level-spacing-outline-4) + var(--level-spacing-outline-5)), 
    var(--b3-font-background2) calc(var(--level-spacing-outline-0) + var(--level-spacing-outline-1) + var(--level-spacing-outline-2) + var(--level-spacing-outline-3) + var(--level-spacing-outline-4) + var(--level-spacing-outline-5)));
}</code></pre><p> </p>",Ember_Sky,,CSS
860,测试思源派发布 - 使用发布工具,Mon Jul 22 2024 18:11:46 GMT+0000 (Coordinated Universal Time),"<h1>测试思源派发布 - Code block</h1>
<h1>标题1</h1>
<p>? 这是标题 1 下面的内容。</p>
<p>Info</p>
<h2>基本元素</h2>
<p>? 行内的基本样式，包括加粗、高亮、下划线、删除线等。</p>
<p><strong>超文本标记语言</strong>（英语：HyperText Markup Language，简称：HTML）是一种 <strong>用于创建网页的标准标记语言</strong> 。您可以<u>使用 HTML 来建立自己的 WEB 站点</u>，HTML 运行在浏览器上，由<del>浏览器来解析</del>。</p>
<p>超级块：左</p>
<p>超级块：右</p>
<p>? 数学公式</p>
<p>公式：$\alpha + \frac{1}{b}$</p>
$$E = mc^2$$
<h2>列表</h2>
<ul>
<li>
<p>列表</p>
<ul>
<li>
<p>多级列表</p>
<ul>
<li>多级列表</li>
<li>多级列表</li>
</ul>
</li>
</ul>
<p>段落块</p>
</li>
<li>
<p>有序列表</p>
<ol>
<li>AAA</li>
<li>BBB</li>
</ol>
</li>
<li>
<p>任务列表</p>
<ul>
<li class=""vditor-task""><input disabled="""" type=""checkbox"" /> TODO1</li>
<li class=""vditor-task""><input disabled="""" type=""checkbox"" /> TODO2</li>
</ul>
</li>
</ul>
<h2>代码块</h2>
<pre><code class=""language-python"">def f():
  ...
</code></pre>
<p>‍</p>
<pre><code class=""language-js"">console.log('hi');
</code></pre>
<p>‍</p>
<pre><code class=""language-typescript"">const sendPaper = async (title: string, content: string, catergory: TypeValues, tags: string) =&gt; {
    showMessage('正在发布到思源派...', 4000);
    const password = fmisc.getConfig('Misc', 'sypaiToken');
    const url = 'https://api.sypai.cc/submit';
    const post = {
        username: username,
        password: password,
        post_title: title,
        post_content: content,
        post_category: catergory,
        tag: tags
    };
}
</code></pre>
<h2>表格</h2>
<table>
<thead>
<tr>
<th>Col1</th>
<th>Col2</th>
<th>Col3</th>
</tr>
</thead>
<tbody>
<tr>
<td>row11</td>
<td>row12</td>
<td>row13</td>
</tr>
<tr>
<td>row21</td>
<td>row22</td>
<td>row23</td>
</tr>
</tbody>
</table>",frostime,,未分类
851,思源派现在支持全站资讯RSS订阅,Sun Jul 21 2024 20:07:18 GMT+0000 (Coordinated Universal Time),"<p>你可以添加以下RSS链接来订阅思源派</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">https://sypai.cc/feed/</code></pre>",HAN,,新闻
832,思源派现在支持通过插件「发布工具」来一键发布文章,Sun Jul 21 2024 18:05:00 GMT+0000 (Coordinated Universal Time),"<p>需要选择WordPress平台</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-12.png"" alt=""image"" data-edit-file-id=""827"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-12.png"" /></p><p>点击设置配置自己的思源派账号，发布格式务必配置为HTML，否则排版会有问题</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-14-1024x719.png"" alt=""image"" data-edit-file-id=""829"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-14.png"" /></p><p>记得配置图床服务，可以选择当前平台，图片会上传到本服务器上，也建议配置自己的图床来加速或者保护数据</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-15.png"" alt=""image"" data-edit-file-id=""830"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-15.png"" /></p><p>配置好后就可以在思源笔记里面一键发布文章了</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-16.png"" alt=""image"" data-edit-file-id=""831"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-16.png"" /></p>",HAN,,新闻
821,思源插件开发 | 如何确保开发样式在PDF导出中同样生效,Sun Jul 21 2024 16:21:31 GMT+0000 (Coordinated Universal Time),"<h3>基础知识</h3>
<p>思源在导出 PDF 的时候，会将以下的 css 片段加入到导出过程当中：</p>
<ol>
<li>
<p>主题相关的 css 样式</p>
</li>
<li>
<p>​<code>style#pluginStyle</code>​</p>
<ul>
<li>这个标签下的样式把所有的插件的 index.css 合并在一起</li>
<li>所以只要你把样式写在插件的 index.css 当中，就一定可以正常导出</li>
</ul>
</li>
<li>
<p>所有代码片段：id 以 <code>snippetCSS</code>​ 为开头</p>
<ul>
<li>
<p>这是所有的代码片段的样式，比如一个典型的代码片段可能张这个样子：</p>
<pre><code class=""language-css"">&lt;style id=&quot;snippetCSS20240605220248-9c1dihh&quot;&gt;
body {
  font-family: &quot;HarmonyOS Sans SC&quot;, var(--b3-font-family) !important;
}
&lt;/style&gt;
</code></pre>
</li>
</ul>
</li>
</ol>
<h3>那么动态插入的 css 样式呢？</h3>
<p>如果你的插件需要动态引入一些样式，那么保证这些样式能在导出 PDF 的时候生效的最简单的办法是：插入的 style 标签的 id 要以 <code>snippetCSS</code>​ 为开头，来模拟一个代码片段样式。</p>
<p>例如，Callout 插件中，所有动态更改的样式，都会放在一个 <code>style#snippetCSS-BqCallout</code>​ 当中。</p>
",frostime,插件开发,开发
801,UFUID芯片丝印拆解,Sat Jul 20 2024 21:35:34 GMT+0000 (Coordinated Universal Time),"<section id=""articleContent"" class=""vditor-reset"" data-author=""zxkmm""><h1># 总结</h1><p>UFUID是国内某大佬（疑似proxgrind或者dxl发明的新的m1魔术卡）</p><p>目前批次丝印如下</p><h1>芯片</h1><p><img src=""https://b3logfile.com/file/2023/11/siyuan/1670855522693/assets/20231127_213512-20231127213536-wvh9zsb.jpg?imageView2/2/w/1280/format/jpg/interlace/1/q/100"" alt=""20231127_213512"" /></p><p>面板 标识：108 U </p><p><img src=""https://b3logfile.com/file/2023/11/siyuan/1670855522693/assets/20231127_213500-20231127213607-wsj0k5a.jpg?imageView2/2/w/1280/format/jpg/interlace/1/q/100"" alt=""20231127_213500"" /></p><p>焊接面 无标识 </p></section>",zxkmm,,开发
799,aws s3 &amp; cloudflare R2 等等对象存储桶清空数据,Sat Jul 20 2024 21:32:42 GMT+0000 (Coordinated Universal Time),"<p>如果你的S3提供商没有快速清空数据的功能，可以用cf提供的工具这样操作。</p><h2 id=""toc_h2_0"">生成token</h2><p>略</p><h2 id=""toc_h2_1"">配置cli客户端</h2><p>arch/manjaro 包名 aws-cli</p><p>配置api token命令aws configure</p><h2 id=""toc_h2_2"">删除</h2><p>aws s3 rm s3:// --endpoint-url <a href=""https://cloudflare-id.r2.cloudflarestorage.com"" rel=""nofollow"">https://cloudflare-id.r2.cloudflarestorage.com</a> --recursive --dryrun</p><p>以上为演习命令</p><p>aws s3 rm s3:// --endpoint-url <a href=""https://cloudflare-id.r2.cloudflarestorage.com"" rel=""nofollow"">https://cloudflare-id.r2.cloudflarestorage.com</a> --recursive</p><p>去除dryrun,正式操作。</p><p>删除成功与否有输出。</p><h2 id=""toc_h2_3"">ref.</h2><p><a href=""https://developers.cloudflare.com/r2/examples/aws/aws-cli/"" rel=""nofollow"">https://developers.cloudflare.com/r2/examples/aws/aws-cli/</a></p><p><a href=""https://stackoverflow.com/questions/73877728/cloudflare-r2-delete-all-objects-from-bucket"" rel=""nofollow"">https://stackoverflow.com/questions/73877728/cloudflare-r2-delete-all-objects-from-bucket</a></p>",zxkmm,,开发
798,测试思源派发布 API,Sat Jul 20 2024 21:22:52 GMT+0000 (Coordinated Universal Time),"<p>这篇文章是直接从思源发布到思源派的。</p>
<h1>标题1</h1>
<p>? 这是标题 1 下面的内容。</p>
<p>Info</p>
<h2>基本元素</h2>
<p>? 行内的基本样式，包括加粗、高亮、下划线、删除线等。</p>
<p><strong>超文本标记语言</strong>（英语：HyperText Markup Language，简称：HTML）是一种==用于创建网页的标准标记语言==。您可以<u>使用 HTML 来建立自己的 WEB 站点</u>，HTML 运行在浏览器上，由~~浏览器来解析~~。</p>
<p>超级块：左</p>
<p>超级块：右</p>
<p>? 数学公式</p>
<p>公式：<span class=""language-math"">\\alpha + \\frac{1}{b}</span></p>
<div class=""language-math"">E = mc^2</div>
<blockquote>
<p>引述块</p>
<blockquote>
<p>引述块内部的引述块</p>
</blockquote>
<p>段落</p>
</blockquote>
<h2>列表</h2>
<ul>
<li>
<p>列表</p>
<ul>
<li>
<p>多级列表</p>
<ul>
<li>多级列表</li>
<li>多级列表</li>
</ul>
</li>
</ul>
<p>段落块</p>
</li>
<li>
<p>有序列表</p>
<ol>
<li>AAA</li>
<li>BBB</li>
</ol>
</li>
<li>
<p>任务列表</p>
<ul>
<li class=""vditor-task""> TODO1</li>
<li class=""vditor-task""> TODO2</li>
</ul>
</li>
</ul>
<h2>代码块</h2>
<pre><code class=""language-typescript"">const sendPaper = async (title: string, content: string, catergory: TypeValues, tags: string) =&gt; {
    showMessage(\'正在发布到思源派...\', 4000);
    const password = fmisc.getConfig(\'Misc\', \'sypaiToken\');
    const url = \'https://api.sypai.cc/submit\';
    const post = {
        username: username,
        password: password,
        post_title: title,
        post_content: content,
        post_category: catergory,
        tag: tags
    };

    try {
        const response = await fetch(url, {
            method: \'POST\',
            headers: headers,
            body: JSON.stringify(post)
        });

        console.log(response);

        if (response.ok) {
            console.log(\'Post created successfully\');
          
            showMessage(\'发布成功\', 4000);
            return true;
        } else {
            console.log(`Failed to create post: ${response.status}`);
            showMessage(`发布失败: ${response.status}`, 4000, \'error\');
            return false;
        }
    } catch (error) {
        console.error(\'Error:\', error);
        showMessage(`发布失败: 异常情况`, 4000, \'error\')
        return false;
    }
}

const publish = async (e: CustomEvent&lt;{
    menu: EventMenu,
    protyle: IProtyle,
    data: IGetDocInfo,
}&gt;) =&gt; {
    let name = e.detail.data.name;
    let docId = e.detail.data.rootID;
    let { menu } = e.detail;
    menu.addItem({
        icon: \'iconEmoji\',
        label: \'发布到思源派\',
        click: async () =&gt; {
            let {catergory, tags} = await selectType();
            if (catergory === undefined) return;
            console.log(`发布到思源派：${name} --&gt; ${catergory}`);
            let res = await exportMdContent(docId);
            let markdown: string = res.content;
            let html = lute.Md2HTML(markdown);
            sendPaper(name, html, catergory, tags);
        }
    });
}
</code></pre>
<h2>表格</h2>
<table>
<thead>
<tr>
<th>Col1</th>
<th>Col2</th>
<th>Col3</th>
</tr>
</thead>
<tbody>
<tr>
<td>row11</td>
<td>row12</td>
<td>row13</td>
</tr>
<tr>
<td>row21</td>
<td>row22</td>
<td>row23</td>
</tr>
</tbody>
</table>
",frostime,测试,内测
786,DevTools 复制CSS代码需要注意的两个小细节,Sat Jul 20 2024 18:35:15 GMT+0000 (Coordinated Universal Time),"<h2>运算符检查</h2><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-9.png"" alt=""image"" data-edit-file-id=""783"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-9.png"" /></p><p>这个问题是在汐洛文档报告的。直接复制的代码里乘号运算符前置没有空格，但在CSS代码源文件中需要前后均有空格。</p><h2>媒体查询的区别</h2><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-10.png"" alt=""image"" data-edit-file-id=""784"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-10.png"" /></p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-11.png"" alt=""image"" data-edit-file-id=""785"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-11.png"" /></p><p> </p><p>部分内核的 DevTools 复制的媒体查询代码缺少大括号，如果粘贴的地方没有 lint 就需要注意了。</p>",soltus,Sillot,CSS
756,如何一键复制之前自己在链滴中的所有帖子到思源派,Sat Jul 20 2024 02:26:40 GMT+0000 (Coordinated Universal Time),"<p>现在我们提供帮助作者一键复制在<span style=""color: #00ff00;"">链滴</span>的所有帖子到<span style=""color: #ff0000;"">思源派<span style=""color: #ffffff;"">的服务，您只需要先注册思源派，任何在<a href=""https://sypai.cc/user/auth"">认证中心</a>认证您的身份，通过认证后，填写如下申请表单，然后等待回复即可</span></span></p><p>点击此处申请  》》》》》》》 <a href=""https://flowus.cn/form/ac010c93-0d3c-4853-9997-f5b940838211"">链滴文章复制申请表</a></p><p>复制的文章将会统一归类到“链滴优选”中，您可以之后对自己的帖子进行修改。</p>",HAN,,新闻
206,js代码片段：右开tab并同步当前位置,Fri Jul 19 2024 22:17:01 GMT+0000 (Coordinated Universal Time),"<p># js代码片段：右开tab并同步当前位置</p><p>给另一个小伙伴的思路3, [可以做到这样某段和某段做对比的功能 (用分屏的方法) 吗？ - 链滴 (ld246.com)](https://ld246.com/article/1721033602865)</p><p>## 功能</p><p>右开一个tab，并跳转到鼠标所在块。</p><p>‍视频演视参考：<a href=""https://ld246.com/article/1721398187567"">js 代码片段：右开 tab 并同步当前位置 - 链滴 (ld246.com)</a></p><p>‍</p><p>## 操作如下</p><p>### 方法1：</p><p>（这是一次对`sy-run-js`​ 插件的尝试，顺便推荐下这个插件。）</p><p>安装`sy-run-js`​ 插件后，找个专门的文档存该代码，使用块菜单运行代码顶栏就有个按钮可执行了该片段了。 **【注意：不是放在外观的代码片段中】**</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">async function main() {
    let actvie_tab = document.querySelector(""div.layout__wnd--active[data-type='wnd'] li.item.item--focus[data-type='tab-header']"");
    let actvie_tab_id = actvie_tab.getAttribute(""data-id"");
    let active_protyle = document.querySelector(""div.layout__wnd--active[data-type='wnd'] .protyle[data-id='"" + actvie_tab_id +""']"");
    let focus_block_id = active_protyle.querySelector("".block-focus"").getAttribute(""data-node-id"");
    let root_id = active_protyle.querySelector("".protyle-title.protyle-wysiwyg--attr"").getAttribute(""data-node-id"")
    let tempRes = await runJs.siyuan.fetchSyncPost(""/api/filetree/getFullHPathByID"",{id:root_id});
    let aria_label = tempRes[""data""];
    actvie_tab.setAttribute(""aria-label"", aria_label);
    let repeatTabs = document.querySelectorAll(`li[data-type='tab-header'][aria-label='${aria_label}']:not([data-id='${actvie_tab_id}'])`)
    if(repeatTabs.length &gt; 0){
        repeatTabs[0].click();
        window.openFileByURL(`siyuan://blocks/${focus_block_id}`)
    } else {
        let anotherTab = await runJs.siyuan.openTab({
            app:runJs.plugin.app,
            doc: {
                id: focus_block_id, 
                action: [""cb-get-context"",""cb-get-hl"",""cb-get-focus""],
                zoomIn: false
            },
            position:""right"",
            keepCursor:true,
            removeCurrentTab:false
        });
        // console.log(anotherTab)
    }
}
main();

plugin.saveAction(thisBlock.id, ""右开tab"");</code></pre><p> </p><p>### 方法2：</p><p>另外，也可用quicker，我个人是更喜欢这种方式的。也贴个动作给大家参考。 [右开tab - by 刘烟火 - 动作信息 - Quicker](https://getquicker.net/Sharedaction?code=10c6c646-e2d2-45db-95fc-08dca71b147e&amp;fromMyShare=True)</p><p>前提是需先安装另一个插件`siyuan-plugin-jsrunner `​</p><p>‍</p>",烟火,"quicker,sy-run-js,代码片段",JS
198,通过API一键发布文章到思源派,Fri Jul 19 2024 21:13:27 GMT+0000 (Coordinated Universal Time),"<h2>我们现在推荐你直接使用思源笔记集市里面的发布插件来发布文章</h2><h3>使用教程</h3><p><a href=""https://sypai.cc/archives/832/"">https://sypai.cc/archives/832/</a></p><h3>插件详情</h3><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-17.png"" alt=""image"" data-edit-file-id=""835"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-17.png"" /></p><h2>当然我们也提供了单独的API发布，方便用户在其他地方集成自己的工作流</h2><h3>你可以直接来以下网址查看API用法</h3><p><span style=""color: #ff0000;""><a style=""color: #ff0000;"" href=""https://apifox.com/apidoc/shared-48027313-f85d-4bbb-906a-00bb04b32824"">https://apifox.com/apidoc/shared-48027313-f85d-4bbb-906a-00bb04b32824</a></span></p><p>也可以参考下面的程序示例，环境是nodejs</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">(async () =&gt; {
    const data = {
        username: '思源派网站用户名',
        password: '思源派网站密码',
        post_title: 'Sample Title', //纯文本
        post_content: '&lt;h1&gt;Sample Content&lt;/h1&gt;', //应该传入HTML语法
        post_category: 1, //分类ID，见文章末尾
        tag: 'Tag1,Tag2,Tag3' //多个标签用英文逗号隔开
    };

    try {
        const response = await fetch('https://api.sypai.cc/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            const result = await response.text();
            console.log(result);
        } else {
            console.error('Error:', response.status, response.statusText);
        }
    } catch (error) {
        console.error(error);
    }
})();</code></pre><h2>文章分类ID</h2><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-8.png"" alt=""image"" data-edit-file-id=""201"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-8.png"" /></p>",HAN,#思源派,新闻
171,思源派在线编辑器插入行内代码及其他元素,Fri Jul 19 2024 00:57:44 GMT+0000 (Coordinated Universal Time),"<p>如图，点击最右边的剪头，任何点击格式就可以看到更多的元素类型</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-7.png"" alt=""image"" data-edit-file-id=""170"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-7.png"" /></p>",HAN,,开发
161,全局霞鹜文楷CSS片段，无需下载任何文件,Thu Jul 18 2024 23:54:31 GMT+0000 (Coordinated Universal Time),"<pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">@import url('https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css');

* {
  /* Screen version */
  font-family: ""LXGW WenKai Screen"", sans-serif;
}</code></pre><p>插入思源自定义CSS即可</p><p>效果：</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-6.png"" alt=""image"" data-edit-file-id=""162"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-6.png"" /></p><p> </p>",HAN,,CSS
158,数据库视图菜单的小改动,Thu Jul 18 2024 23:24:19 GMT+0000 (Coordinated Universal Time),"<div class=""quote_q quote-mce "" contenteditable=""false""><div contenteditable=""true""><p>链滴原贴：<a href=""https://ld246.com/article/1712750829922"">https://ld246.com/article/1712750829922</a></p></div></div><p>思源使用的是以下的方案 A ：</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-5-1024x476.png"" alt=""image"" data-edit-file-id=""157"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-5.png"" /></p><p>改为方案 B 的 CSS 代码片段如下：</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">/* 将数据库视图菜单中功能相同的「重命名」「设置」合并为「编辑视图」 https://ld246.com/article/1712750829922?r=JeffreyChen */
#commonMenu[data-name=""av-view""] &gt; .b3-menu__items &gt; .b3-menu__item:nth-child(1) &gt; .b3-menu__label {
    position: relative; /* 让父元素相对定位 */
    color: #00000000; /* 原文本颜色变为透明 */
}
#commonMenu[data-name=""av-view""] &gt; .b3-menu__items &gt; .b3-menu__item:nth-child(1) &gt; .b3-menu__label::after {
    content: ""编辑视图"";
    position: absolute; /* 绝对定位 */
    left: 0;
    color: var(--b3-theme-on-background); /* 新文本颜色 */
    z-index: 1; /* 确保伪元素在原始文本之上 */
}
#commonMenu[data-name=""av-view""] &gt; .b3-menu__items &gt; .b3-menu__item:nth-child(2),
#commonMenu[data-name=""av-view""] &gt; .b3-menu__items &gt; .b3-menu__separator {
    display: none; /* 隐藏设置和分隔线 */
}</code></pre>",Jeffrey Chen,菜单,CSS
156,搜索结果显示为多行,Thu Jul 18 2024 23:14:58 GMT+0000 (Coordinated Universal Time),"<div class=""quote_q quote-mce "" contenteditable=""false""><div contenteditable=""true""><p>链滴原贴：<a href=""https://ld246.com/article/1697985662481"">https://ld246.com/article/1697985662481</a></p></div></div><p>效果如下：</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-4.png"" alt=""image"" data-edit-file-id=""153"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-4.png"" /></p><p>CSS 代码片段：</p><div class=""quote_q quote-mce qe_wzk_lan"" contenteditable=""false""><div contenteditable=""true""><p>代码来自 Savor 主题代码仓库：<a href=""https://github.com/royc01/notion-theme/blob/c3f75464be71e222e98c9a08dfb1a2757f2a1f3e/style/custom/ctrlp.css"" target=""_blank"" rel=""nofollow noopener ugc"">ctrlp.css</a></p></div></div><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">/* Savor 主题的多行搜索展示 CSS片段 */
#searchList{
	background-color: var(--b3-theme-background);
}
.search__layout--row {
    border-top: none;
}
.search__layout{
	border-bottom: 1px solid var(--b3-theme-surface-lighter);
}
.fn__flex-column #searchList&gt;.b3-list-item[data-type='search-item']{
	padding-bottom:20px;
	margin: 6px;
}

.fn__flex-column #searchList .b3-list-item[data-type='search-item']&gt;.b3-list-item__meta{
	color:var(--b3-list-item--meta);
	background-color: var(--b3-list-background);
	font-size: .7rem;
	line-height: 20px;
	border-radius:4px;
	padding:0 4px;
	bottom:8px;
	right:8px;
	max-width:34vw;
	position:absolute;
	white-space:nowrap;
	overflow:hidden !important;
	text-overflow: ellipsis;
}
.fn__flex-column #searchList .b3-list-item--focus[data-type='search-item']&gt;.b3-list-item__meta{
	background-color: var(--b3-theme-background);
}
.fn__flex-column #searchList .b3-list-item[data-type='search-item']&gt;.b3-list-item__meta::before{
    font-size: 1em;
    line-height: 1;
	margin-right:2px;
	content: ""?"";
}
.fn__flex-column #searchList&gt;.b3-list-item+div [data-type='search-item'] .b3-list-item__graphic{
	height: 10px;
    width: 10px;
    padding: 4px;
    border-radius: 3px;
    background-color: var(--b3-list-background);
}

.fn__flex-column #searchList&gt;.b3-list-item:not([data-type='search-item']):not([data-type=""search-new""]){
	border-radius: 4px 4px 0 0;
	margin: 6px 6px 0px 6px;
	box-shadow: rgba(15, 15, 15, 0.1) 0px 0px 0px 1px;
	padding-left:0px;
	background-color: var(--b3-dockright-background);
}
.fn__flex-column #searchList&gt;.b3-list-item:not([data-type='search-item']):has(+div.fn__none){
	box-shadow: rgba(15, 15, 15, 0.1) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 2px 4px;
	border-radius: 4px ;
}

.fn__flex-column #searchList&gt;.b3-list-item:not([data-type='search-item'])+div [data-type='search-item']{
	margin: 0 6px;
	border-radius: 0;
	box-shadow: rgba(15, 15, 15, 0.1) 1px 0px 0px 0px , rgba(15, 15, 15, 0.1) -1px 0px 0px 0px;
	padding-left: 30px!important;
	height:32px;
}
.fn__flex-column #searchList&gt;.b3-list-item:not([data-type='search-item'])+div [data-type='search-item']:last-child{
	border-radius: 0 0 4px 4px;
	box-shadow: rgba(15, 15, 15, 0.1) 1px 0px 0px 0px , rgba(15, 15, 15, 0.1) -1px 0px 0px 0px, rgba(15, 15, 15, 0.1) 0px 1px 0px 0px, rgba(15, 15, 15, 0.1) 0px 2px 4px;
}

/*.fn__flex-column #searchList&gt;.b3-list-item:not([data-type='search-item'])+div [data-type='search-item']&gt;.b3-list-item__text{
    margin-left: 20px;
    max-height: 89px ;
    padding:6px 0px 5px 5px;
    overflow-y: auto !important;
    text-overflow: ellipsis !important;
    line-height: 1.3;
    -webkit-box-orient: inherit;
}*/

#searchList&gt;[data-type=""search-item""]{
    display: block;
	padding-right:0px;
}


#searchList&gt;[data-type=""search-item""]&gt;.b3-list-item__graphic{
    position: absolute;
    margin-top: 4px;
}

#searchList&gt;[data-type=""search-item""]&gt;.b3-list-item__graphic+.b3-list-item__graphic{
    position: absolute;
    margin-top: 4px;
	margin-left: 20px;
}
#searchList&gt;[data-type=""search-item""]&gt;.b3-list-item__graphic+.b3-list-item__graphic+.b3-list-item__text{
	margin-left: 40px;
}



#searchList&gt;[data-type=""search-item""]&gt;.b3-list-item__text{
    margin-left: 20px;
    padding:6px 6px 5px 5px;
    overflow-y: auto !important;
    text-overflow: ellipsis !important;
    line-height: 1.3;
    display: inline-block;
}



.search__list{
	padding-top:0;
}



.b3-list-item[data-type=""search-new""]{
	border-radius: 4px;
	height:40px;
	margin: 6px 6px 0px 6px;
	padding:0 16px 0 10px;
	background-color: var(--b3-bq-background13)!important;
    box-shadow: 0 0 0 2px var(--b3-font-background13) inset!important;
}
.b3-list-item[data-type=""search-new""] kbd{
	font-family: sans-serif;
}

#criteria .b3-chips .b3-chip{
	margin-top: 3px;
}

#criteria .b3-button--small{
	padding: 2px 8px;
	font-size: 14px;
}
#criteria+.block__icons{
	padding: 0 4px;
	min-height: 36px;
	margin:0 6px;
	border-radius:6px;
	background-color: var(--b3-list-hover);
}
.b3-dialog__body&gt;.fn__flex-column:not(.switch-doc){
	background-color: var(--b3-theme-background);
}
.search__tip{
	height:30px;
	color:var(-b3-)
}


.protyle-wysiwyg *[custom-f=""dt""] .li[data-subtype=""u""]&gt;.protyle-action svg{
	color:unset;
}

.search__tip{
	color:var(--b3-theme-on-background)
}
.search__tip kbd{
	box-shadow:none;
	border:none;
	padding: 3px 5px;
	background-color: var(--b3-list-background-focus);
}</code></pre><p> </p><p> </p>",Jeffrey Chen,搜索,CSS
152,改一下分割线，拯救你的眼睛（可以改颜色和粗细）,Thu Jul 18 2024 23:06:39 GMT+0000 (Coordinated Universal Time),"<div class=""quote_q quote-mce "" contenteditable=""false""><div contenteditable=""true""><p>链滴原贴：<a href=""https://ld246.com/article/1695131669084"">https://ld246.com/article/1695131669084</a></p></div></div><p>暗黑模式死活看不见分割线，所以自己改一下，效果如下图：</p><p>（可以改颜色、改粗细）</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-3.png"" alt=""image"" data-edit-file-id=""151"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-3.png"" /></p><p>CSS 代码片段：</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">/* 更改分割线样式 CSS片段 */
.hr {
  border: none;
  position: relative;
}

.hr::before {
  content: """";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px; /* 粗细 */
  background-color: yellow; /* 颜色 */
  transform: translateY(-50%);
}</code></pre><p>p.s. 拿 GPT 生成的，目前没发现 BUG</p>",Jeffrey Chen,编辑器,CSS
143,思源插件萌新开发者的部分解答（待更新？）,Thu Jul 18 2024 22:45:08 GMT+0000 (Coordinated Universal Time),"<p id=""20240718224219-7opm81r"">你好呀，很高兴看到有新人愿意为思源的插件开发做贡献，我会尽我所能地回答你的问题。</p><blockquote id=""20240718224219-oo4vxlu""><p id=""20240718224219-lfnfs09"">我实在是找不到相关的信息和文档，难道就只能去读源代码吗?</p></blockquote><p id=""20240718224219-dp92cyl"">首先我是建议你去看一下思源的<a href=""https://github.com/siyuan-note/plugin-sample"" target=""_blank"" rel=""noopener"">插件示例</a>，它基本完整演示了思源官方插件系统所提供的操作。当然，这只是个示例，更完整的接口需要查看 siyuan.d.ts，它的位置在 <a href=""https://www.npmjs.com/package/siyuan"" target=""_blank"" rel=""noopener"">npm</a>，你在 <span data-type=""code"">clone</span>​思源的插件示例并 <span data-type=""code"">pnpm i</span>​之后也能在本地的 <span data-type=""code"">node_modules\siyuan\siyuan.d.ts</span>​ 中见到。</p><p id=""20240718224323-ineabhd"">目前开发者社区正在构建由社区运营的文档，<a href=""https://docs.siyuan-note.club/zh-Hans/"" target=""_blank"" rel=""noopener"">思源开发者文档</a>，它还有很多地方等待填充，不过它会逐渐完善的。</p><p id=""20240718224219-lexer76"">如果你是想使用官方已经文档化的接口的话，那实际上看一下 <a href=""https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md"" target=""_blank"" rel=""noopener"">api_zh.md</a> 就行了。它说的使用 post 方法，实际上就是直接通过 fetch 的方法与思源的内核交互。比如说，假如你的思源工作端口为 6806，然后需要使用 <span data-type=""code"">api/notebook/openNotebook</span>​接口打开 id 为 <span data-type=""code"">20230613223159-kmv7gg0</span>​的笔记本，那么你使用最原始的 fetch 方法如下：</p><pre><code class=""language-js"">fetch(""http://127.0.0.1:6806/api/notebook/openNotebook"", {
  ""headers"": {
    ""accept"": ""*/*"",
    ""accept-language"": ""zh-CN"",
    ""cache-control"": ""no-cache"",
    ""content-type"": ""text/plain;charset=UTF-8"",
    ""pragma"": ""no-cache"",
    ""sec-ch-ua"": ""\""Not.A/Brand\"";v=\""8\"", \""Chromium\"";v=\""114\"""",
    ""sec-ch-ua-mobile"": ""?0"",
    ""sec-ch-ua-platform"": ""\""Windows\"""",
    ""sec-fetch-dest"": ""empty"",
    ""sec-fetch-mode"": ""cors"",
    ""sec-fetch-site"": ""same-origin""
  },
  ""referrerPolicy"": ""strict-origin-when-cross-origin"",
  ""body"": ""{\""notebook\"":\""20230613223159-kmv7gg0\""}"",
  ""method"": ""POST"",
  ""mode"": ""cors"",
  ""credentials"": ""include""
});
</code></pre><p id=""20240718224219-3eq6t3j"">如你所见，这很繁琐，所以我们一般使用 siyuan 插件系统提供的包装后接口，调用的方式如下：</p><pre><code class=""language-js"">import {fetchPost} from ""siyuan"";
 fetchPost(""/api/notebook/openNotebook"", {
  ""notebook"": ""20210831090520-7dvbdv0""
})
</code></pre><p id=""20240718224219-tjmla5k"">思源的插件系统提供了两种包装后的 fetch，一种是异步的 <span data-type=""code"">fetchPost</span>​，一种是同步的 <span data-type=""code"">fetchSyncPost</span>​，<span data-type=""code"">fetchSyncPost</span>​返回的是一个 <span data-type=""code"">Promise</span>​。</p><p id=""20240718224219-9irntd6"">如果你在文档化的接口中找不到想要的功能，打算使用非文档化的接口的话，那就有两种选择：</p><ul id=""20240718224219-ch5wlcr""><li id=""20240718224219-dxyol09"">一种是直接去翻看思源的源码，所有可用的接口都定义在 <span data-type=""code"">siyuan/kernel/api/router.go</span>​。</li><li id=""20240718224219-z7ebei1"">另一种做法是在思源中打开开发者工具，打开 network 选项卡，然后模拟你想进行的操作，通过抓包你就能获取相关操作所需要的全部接口。</li></ul><p id=""20240718224219-klqnh4p"">当然，理论上官方是不建议使用非文档化的接口的，这些接口需要要么抓包、要么直接在源码中搜索的方法才能获取使用方法（比如说你打算使用 <span data-type=""code"">/api/notebook/openNotebook</span>​在源码中直接搜索 <span data-type=""code"">/api/notebook/openNotebook</span>​就能找到官方开发者的使用方法）。另一个就是不保证以后不会进行 api 的调整，比如说改变传入参数和传出数据什么的。但是这个问题不是很大，到时候调整就行，而且这些接口实际上也非常稳定，官方自己也在用。</p><blockquote id=""20240718224219-ijqfl3k""><p id=""20240718224219-2ms1an2"">简单的操作 dom 树的思路/方法是什么？</p></blockquote><p id=""20240718224219-75n58a4"">思源的操作基本围绕块进行，对于如何插入块、删除块、更新块的接口都很齐全。</p><p id=""20240718224219-yhuyckl"">但是，我根据你的描述，我认为你的意思应该是不对块进行操作，而是直接操作 dom。</p><p id=""20240718224219-v44dn8s"">这实际上是一个非常危险的操作，因为思源必须在每次操作后把页面的 dom 转译为储存的内部文件，也就是 sy 后缀名的 json。思源有着良好的接口可以把自身的 BlockDom 翻译回去，但是你新插入的 dom，思源显然是不知道如何操作的，也就是说，这会引发一个未定义行为。</p><p id=""20240718224219-fniex2j"">当然，对于一些不会保存的元素，比如说面包屑，你可以进行这种操作，但是对于思源编辑界面的 dom，我建议还是谨慎起见，不要直接在块上操作，而是插入到其他地方，通过设置 style 到对应的位置。</p><blockquote id=""20240718224219-dzxqh27""><p id=""20240718224219-34o2qw7"">siyuan 的不成熟性体现在哪些方面？</p></blockquote><p id=""20240718224219-k792ob5"">在我看来主要是三方面：</p><ol id=""20240718224219-zky2r5a""><li id=""20240718224219-dmy3hy0""><p id=""20240718224219-ytgw0f3"">文档缺乏</p><p id=""20240718224219-fgrujp1"">我认为这个应该是共识了，无论是使用的文档，还是插件、挂件、主题开发的文档，都不能说让人满意。</p></li><li id=""20240718224219-4cxsioq""><p id=""20240718224219-tvlnmvp"">迭代太快，导致不稳定</p><p id=""20240718224219-ui2135r"">思源本体功能的增加速度和迭代速度绝对是最快的那一档，因此也产生了许多问题，很多新功能未经过充分验证就推向了使用的用户，不仅与用户想象的预期不符，有时候还会影响旧有的功能。</p><p id=""20240718224219-va0cfai"">思源的开发，基本就是 增加新功能 -&gt; 新功能一般，被骂\出现 bug，被骂 -&gt; 迭代，改 bug -&gt; 继续被骂 -&gt; 再迭代，再改 -&gt; 差不多稳定了，继续增加新功能</p><p id=""20240718224219-o403hcf"">所以思源用户基本一直使用的是不稳定版本的思源……</p></li><li id=""20240718224219-5cafaxi""><p id=""20240718224219-o6cv23q"">官方的用户体验相关经验不足，认为的合理很多情况下都不符合用户的认知</p><p id=""20240718224219-dfbrxu8"">这一点建议看看这个 <a href=""https://github.com/siyuan-note/siyuan/issues/8081"" target=""_blank"" rel=""noopener"">issue</a>，会让你对这个问题有更深刻的了解。</p></li></ol><p id=""20240718224219-aq7hmsl"">最后，我真诚地邀请你加入思源爱好者折腾群（1017854502），这是一个基本所有思源开发者（官方开发者、插件、挂件、主题开发者）都在的群，我们欢迎一切对思源感兴趣的用户。</p><p id=""20240718224219-qgm54cx"">假如你想开发插件，你可以求教远比我更有经验的其他开发者；假如你不想但有相关的需求，你也可以提出你的建议，假如吸引了其他开发者的兴趣，也许就不需要你亲自动手了 ?。</p><p id=""20240718224219-622kfnm"">无论你接下来打不打算开发插件，都欢迎你的到来</p>",zxhd86,"FAQ,开发",开发
142,思源笔记第三方同步 S3 手把手教程（七牛云）（2024.4.25）,Thu Jul 18 2024 22:41:53 GMT+0000 (Coordinated Universal Time),"<div class=""quote_q quote-mce "" contenteditable=""false""><div contenteditable=""true""><p>链滴原贴：<a href=""https://ld246.com/article/1692089679062"">https://ld246.com/article/1692089679062</a></p></div></div><h1 id=""20240718225004-l2mmx84"">一、前言</h1><p id=""20240718225004-gcfdjey"">我自己折腾了很久才搞明白，写下这篇教程既是避免自己忘记操作，也是为了帮助后来者节省时间。</p><p id=""20240718225004-jfyx00z"">所以，请你在有以下需求的前提下阅读本教程，否则更应该把折腾工具的时间花在多写一些笔记上。</p><ul id=""20240718225004-sb8ch9f""><li id=""20240718225004-3l4d5he""><p id=""20240718225004-volap19"">多设备同步的需求</p></li><li id=""20240718225004-btn5dhb""><p id=""20240718225004-g3gvqcd"">省钱的需求（仍然需要花钱）</p></li></ul><p id=""20240718225004-4vkrnju"">如果你绝大多数时候只在一台设备上使用思源笔记，更简单的做法是不必执着于同步笔记，更应该定期手动导出Data文件备份。其他时候记笔记可以使用 <span data-type=""strong code"">微信文件传输助手</span>​ 、 <span data-type=""strong code"">手机备忘录</span>​ 等应急 ，过后再整理到思源笔记。</p><p id=""20240718225004-paee76h"">如果比起省一些钱，你更在意少花点时间折腾，请直接 <a href=""https://b3log.org/siyuan/pricing.html?r=JeffreyChen"">年付订阅</a> ，使用官方云同步服务。</p><h1 id=""20240718225004-vevspo2"">二、省钱，但无法免费</h1><ol id=""20240718225004-fxzuovz""><li id=""20240718225004-39200zs""><p id=""20240718225004-qk7wguh"">思源笔记第三方存储功能（功能特性）<a href=""https://b3log.org/siyuan/pricing.html?r=JeffreyChen"">（点此进入定价页面）</a></p><ul id=""20240718225004-bg05vw6""><li id=""20240718225004-1kk4dl3""><p id=""20240718225004-f409eoo"">可接入第三方云端存储（S3/WebDAV）的 <span data-type=""strong"">功能特性已经收费</span>（从2024年1月，v2.12.0版本开始），<span data-type=""strong"">一次付费后终身可用</span>（订阅会员包含了功能特性，在会员有效期内不需要为此单独付费）</p></li><li id=""20240718225004-jwafqmd""><p id=""20240718225004-l21nmb4"">目前打折价 64 元：<a href=""https://b3log.org/siyuan/pricing.html?r=JeffreyChen"">https://b3log.org/siyuan/pricing.html</a></p></li></ul></li><li id=""20240718225004-3qx24ky""><p id=""20240718225004-iqdk2b6"">七牛云 Kodo 对象存储（<span data-type=""strong"">很便宜</span>的，不用担心）</p><ul id=""20240718225004-21tlsxs""><li id=""20240718225004-eghj05s""><p id=""20240718225004-6l9nb9s""><span data-type=""strong"">免费额度</span></p><table id=""20240718225004-mp2tt9g""><thead><tr><th>标准存储每月免费空间</th><th>标准存储每月免费 CDN 回源流量</th><th>标准存储每月免费写请求 PUT/DELETE</th><th>标准存储每月免费读请求 GET</th><th>每月免费上传流量</th></tr></thead><tbody><tr><td>10GB</td><td>10GB</td><td>10万次</td><td>100万次</td><td>无上限</td></tr></tbody></table></li><li id=""20240718225004-q3wwyty""><p id=""20240718225004-lfd1k4t"">按量计费，具体看价格文档：<a href=""https://www.qiniu.com/prices/kodo"">https://www.qiniu.com/prices/kodo</a></p></li></ul></li></ol><h1 id=""20240718225004-gy4o62a"">三、以下是详细教程，但碰到意外情况需要自己想办法</h1><h2 id=""20240718225004-vq9y95d"">1. 确保你可以使用思源笔记的第三方存储功能</h2><p id=""20240718225004-m6957oc"">如果你还没有付费，可以先免费试用订阅，也可以直接升级 <span data-type=""code"">功能特性</span>​ 或 <span data-type=""code"">年付订阅</span>​ ：<a href=""https://b3log.org/siyuan/pricing.html?r=JeffreyChen"">https://b3log.org/siyuan/pricing.html</a></p><p id=""20240718225004-k5rr90g"">当然，如果你已升级 <span data-type=""strong code"">年付订阅</span>​ ，在官方云存储剩余容量足够的前提下，不妨直接使用思源官方云同步服务。</p><p id=""20240718225004-1et4vfo"">页面如下：</p><ol id=""20240718225004-yyj3moa""><li id=""20240718225004-lg87bec""><p id=""20240718225004-ginbhg9"">打开SiYuan <span data-type=""strong code"">设置</span>​ 页面，点击 <span data-type=""strong code"">云端</span>​</p></li><li id=""20240718225004-00q710l""><p id=""20240718225004-7dxg7ik""><span data-type=""strong"">云端存储服务提供商</span> 选择 <span data-type=""strong code"">S3</span>​</p></li></ol><p id=""20240718225004-lvr6f4f"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425011008-4v1labd.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425011008-4v1labd.png"" /></span>​</p><h2 id=""20240718225004-g7lc57c"">2. 注册七牛云</h2><h4 id=""20240718225004-u876i47"">注意，帖子最初写于 2024 年，如果注册流程在之后有变化，请随机应变。</h4><p id=""20240718225004-iqm7cy3""><span data-type=""strong"">点击打开七牛云官网</span> ：<a href=""https://s.qiniu.com/euIjyi"">https://www.qiniu.com/</a></p><p id=""20240718225004-7s4cmn5"">点击页面右上角「立即注册」，按流程注册：</p><p id=""20240718225004-l2yyel9"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240424235441-twdizwd.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240424235441-twdizwd.png"" /></span>​</p><p id=""20240718225004-qly0x5y"">注册成功后，账号类型选择「个人用户」：</p><p id=""20240718225004-hgg2esi"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240424235737-34j69u6.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240424235737-34j69u6.png"" /></span>​</p><p id=""20240718225004-gm7towi"">前往 <a href=""https://portal.qiniu.com/developer/user/security"">https://portal.qiniu.com/developer/user/security</a> 绑定微信，然后可能会退出登录，此时重新登录即可</p><p id=""20240718225004-wxun1wv"">前往 <a href=""https://portal.qiniu.com/developer/user/identity"">https://portal.qiniu.com/developer/user/identity</a> 完成实名认证：</p><p id=""20240718225004-7zp8b5m"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000418-1lcqoh7.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000418-1lcqoh7.png"" /></span>​</p><p id=""20240718225004-hc7d9ow"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000443-639j9su.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000443-639j9su.png"" /></span>​</p><p id=""20240718225004-wx5y6h7"">用手机微信扫码，输入姓名和身份证号，再扫脸验证（扫码之后如果页面打不开，请点击二维码下方的「刷新」后重新扫码）：</p><p id=""20240718225004-ghbpnj5"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000528-pab75o4.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000528-pab75o4.png"" /></span>​</p><p id=""20240718225004-64p9jx9"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000824-y0t5emr.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000824-y0t5emr.png"" /></span>​</p><h2 id=""20240718225004-fexc62e"">3. 创建存储桶（Bucket）并设置</h2><p id=""20240718225004-3vcz8bq"">打开 <a href=""https://www.qiniu.com/products/kodo"">https://www.qiniu.com/products/kodo</a> ，点击「立即使用」：</p><p id=""20240718225004-jwqmfnj"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001014-n6qlxik.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001014-n6qlxik.png"" /></span>​</p><p id=""20240718225004-i8mb69l"">新建空间（也就是 Bucket ）（空间名复制备用）：</p><p id=""20240718225004-ln6lybr"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001212-uc2i1le.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001212-uc2i1le.png"" /></span>​</p><p id=""20240718225004-w58pn4n"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001352-fg984ve.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001352-fg984ve.png"" /></span>​</p><h2 id=""20240718225004-iv9hoep"">4. 配置 SiYuan 云端设置</h2><ol id=""20240718225004-smmp7g9""><li id=""20240718225004-gm4x5v7""><p id=""20240718225004-54b790o"">打开SiYuan <span data-type=""strong code"">设置</span>​ 页面，点击 <span data-type=""strong code"">云端</span>​ ，<span data-type=""strong"">云端存储服务提供商</span> 选择 <span data-type=""strong code"">S3</span>​</p><p id=""20240718225004-m8a32j7"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425011008-4v1labd.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425011008-4v1labd.png"" /></span>​</p></li><li id=""20240718225004-dcgyjoi""><p id=""20240718225004-gdj0rku""><span data-type=""strong"">Endpoint</span> 输入访问地址（格式大致为： <span data-type=""code"">http://s3.【【这里填区域简称 Region ID】】.qiniucs.com/</span>​ ，注意： http 后面没有 s ）</p><p id=""20240718225004-aqpys9a"">获取方法如下：</p><p id=""20240718225004-q4jvr7o"">打开 <a href=""https://developer.qiniu.com/kodo/4088/s3-access-domainname"">https://developer.qiniu.com/kodo/4088/s3-access-domainname</a> ，按照页面说明复制刚刚创建的空间对应的区域 Region ID 字符串，组合成一个链接： <span data-type=""code"">http://s3.【【这里填区域简称 Region ID】】.qiniucs.com/</span>​ ：</p><p id=""20240718225004-x4lw7eo"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425003547-5j93cxl.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425003547-5j93cxl.png"" /></span>​</p></li><li id=""20240718225004-5d5lrmz""><p id=""20240718225004-zbye71i"">输入 <span data-type=""strong"">Acess Key</span> 和 <span data-type=""strong"">Secret Key</span></p><p id=""20240718225004-4nyrusz"">获取方法如下：</p><p id=""20240718225004-sb1vszu"">前往 <a href=""https://portal.qiniu.com/developer/user/key"">https://portal.qiniu.com/developer/user/key</a> 复制 AccessKey (AK) 和 SecretKey (SK) ：</p><p id=""20240718225004-w8az8ph"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425004602-h7zo52g.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425004602-h7zo52g.png"" /></span>​</p></li><li id=""20240718225004-i02a570""><p id=""20240718225004-k6jl0pp""><span data-type=""strong"">Bucket</span> 输入你的存储桶名称，也就是你创建的空间的名称</p></li><li id=""20240718225004-8eicj48""><p id=""20240718225004-qen589k""><span data-type=""strong"">Region</span> 输入区域简称 Region ID ，之前在 <a href=""https://developer.qiniu.com/kodo/4088/s3-access-domainname"">https://developer.qiniu.com/kodo/4088/s3-access-domainname</a> 中查找过</p></li><li id=""20240718225004-451tm36""><p id=""20240718225004-lul6uka""><span data-type=""strong"">Timeout (s)</span> 默认为 30 。这个是超时时间，在数据量大或者网速慢的情况下需要改大一些</p></li><li id=""20240718225004-yp7vpvn""><p id=""20240718225004-2w85wfh""><span data-type=""strong"">Addressing</span> 改为 <span data-type=""strong code"">Path-style</span>​</p></li><li id=""20240718225004-1wchf0j""><p id=""20240718225004-pgj2vzo""><span data-type=""strong"">TLS Verify</span> 默认为 <span data-type=""strong code"">Verify</span>​</p></li><li id=""20240718225004-h06nr1v""><p id=""20240718225004-vlhb89t""><span data-type=""strong"">启用云端同步</span> 在看完教程之后再开启，不着急</p></li><li id=""20240718225004-6dacab8""><p id=""20240718225004-tj83syn""><span data-type=""strong"">同步冲突时生成冲突文档</span> 按需开启</p></li><li id=""20240718225004-eysa4a3""><p id=""20240718225004-kv8dc27""><span data-type=""strong"">云端同步模式</span> 按照需求设置：</p><ul id=""20240718225004-amyr80s""><li id=""20240718225004-fjvl7qs""><p id=""20240718225004-peyad21"">自动同步（数据不再变动后 30 秒进行一次同步）</p></li><li id=""20240718225004-puwr3wa""><p id=""20240718225004-s6a5m84"">手动同步（仅启动和关闭软件时自动同步一次，其他时候需要手动触发同步）</p></li><li id=""20240718225004-c0vb930""><p id=""20240718225004-r9ba341"">完全手动同步（启动和关闭时均不同步，完全手动控制同步时机和同步方向）</p></li></ul></li><li id=""20240718225004-an0i679""><p id=""20240718225004-dlq8i8j"">点击 <span data-type=""strong"">云端同步目录</span> 右侧 <span data-type=""strong code"">设置</span>​ ，应该可见账户下所有 S3 存储桶，点击目标存储桶即可</p></li></ol><h2 id=""20240718225004-an53x0e"">5.尝试同步</h2><h3 id=""20240718225004-pg4l8u3"">※ 注意，在使用同步功能前请认真了解<a href=""https://ld246.com/article/1683395267749?r=JeffreyChen"">《思源笔记同步指南》</a>中的内容，这关乎你的笔记数据安全</h3><h3 id=""20240718225004-8xg1up8"">※ 注意，在使用同步功能前请认真了解<a href=""https://ld246.com/article/1683395267749?r=JeffreyChen"">《思源笔记同步指南》</a>中的内容，这关乎你的笔记数据安全</h3><h3 id=""20240718225004-p32jd2l"">※ 注意，在使用同步功能前请认真了解<a href=""https://ld246.com/article/1683395267749?r=JeffreyChen"">《思源笔记同步指南》</a>中的内容，这关乎你的笔记数据安全</h3><ol id=""20240718225004-72ew8mb""><li id=""20240718225004-vsg176i""><p id=""20240718225004-bfq05c2"">导出 Data 备份好</p><p id=""20240718225004-qp27sg0"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013005-8splqdm.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013005-8splqdm.png"" /></span>​</p></li><li id=""20240718225004-s2wal2v""><p id=""20240718225004-uxlh4bm"">打开 <span data-type=""strong"">启用云端同步</span> 开关，手动点击一次顶栏的同步图标进行同步，如果报错，请自行定位问题。</p><p id=""20240718225004-63ypbdw""><span data-type=""em"">你可以对照教程看看哪一步做错了，也可以在</span> <a href=""https://ld246.com/"">链滴</a>* 上提问…*</p></li><li id=""20240718225004-cf3gyvc""><p id=""20240718225004-uccgbmz"">点击进入空间，查看存储量，判断是否上传成功：</p><p id=""20240718225004-gwn7zmn"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001520-sse6xfa.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001520-sse6xfa.png"" /></span>​</p><p id=""20240718225004-dbnlgd6"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013320-d6qwpn5.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013320-d6qwpn5.png"" /></span>​</p></li><li id=""20240718225004-26i37le""><p id=""20240718225004-pzjfbmy"">在配置好的设备上导出配置文件的压缩包，然后在其他需要同步的设备中导入：</p><p id=""20240718225004-a16w0fw"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013644-ii494sp.png"" alt=""image"" data-src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013644-ii494sp.png"" /></span>​</p></li><li id=""20240718225004-8f5uv8n""><p id=""20240718225004-u8cgzl7"">在其他设备上调整其他选项（不同设备，选项可以不同）：</p><ul id=""20240718225004-d5wavpu""><li id=""20240718225004-t8xhe5v""><p id=""20240718225004-u71efj6""><span data-type=""strong"">启用云端同步</span> 在确认无误之后再开启，不着急</p></li><li id=""20240718225004-ljiib6m""><p id=""20240718225004-1qi274m""><span data-type=""strong"">同步冲突时生成冲突文档</span> 按需开启</p></li><li id=""20240718225004-31exhu0""><p id=""20240718225004-stf8r64""><span data-type=""strong"">云端同步模式</span> 按照需求设置：</p><ul id=""20240718225004-gs50wjw""><li id=""20240718225004-3xeplc8""><p id=""20240718225004-11x5rnp"">自动同步（数据不再变动后 30 秒进行一次同步）</p></li><li id=""20240718225004-fgx8iw3""><p id=""20240718225004-1pytvfs"">手动同步（仅启动和关闭软件时自动同步一次，其他时候需要手动触发同步）</p></li><li id=""20240718225004-lh2sp0o""><p id=""20240718225004-09dtfmm"">完全手动同步（启动和关闭时均不同步，完全手动控制同步时机和同步方向）</p></li></ul></li><li id=""20240718225004-5pp8lek""><p id=""20240718225004-9otdzpq"">建议在使用频次较低的设备上使用 <span data-type=""strong code"">完全手动同步模式</span>​ 并关闭 <span data-type=""strong code"">同步冲突时生成冲突文档</span>​ ，每一次使用时通过 <span data-type=""strong code"">下载云端数据快照</span>​ 同步从另一台设备上传的云端数据，避免数据冲突。需要注意的是：这样做并不代表你可以在多台设备上同时修改笔记，更好的方法是养成习惯：在切换设备前手动点击同步图标，等待数据完全同步至云端后关闭软件，之后再切换设备下载云端数据。</p></li><li id=""20240718225004-pu1y6dv""><p id=""20240718225004-5d8vf01"">建议在第一次尝试使用第三方同步功能时，在所有的设备上都使用 <span data-type=""strong code"">完全手动同步模式</span>​ ，能有效避免误操作覆盖数据，之后再把常用设备改为 <span data-type=""strong code"">自动同步</span>​</p></li><li id=""20240718225004-yseoz2a""><p id=""20240718225004-24v2kvb"">点击 <span data-type=""strong"">云端同步目录</span> 右侧 <span data-type=""strong code"">设置</span>​ ，应该可见账户下所有 S3 存储桶，点击目标存储桶即可</p></li></ul></li></ol><h2 id=""20240718225004-rmo0ehx"">6. 按需充值</h2><p id=""20240718225004-y7f72i1"">可以在财务中心查看费用与充值：<a href=""https://portal.qiniu.com/financial/overview"">https://portal.qiniu.com/financial/overview</a></p><p id=""20240718225004-4ldn7di"">​<span class=""img"" contenteditable=""false"" data-type=""img""><img src=""https://b3logfile.com/file/2024/04/image-Tp71B0v.png"" alt=""image.png"" data-src=""https://b3logfile.com/file/2024/04/image-Tp71B0v.png"" /></span>​</p><h1 id=""20240718225004-moq9fb8""><span data-type=""strong"">END</span></h1><p id=""20240718225004-4ulher4"">p.s.</p><ul id=""20240718225004-n41rely""><li id=""20240718225004-37sxn4v""><p id=""20240718225004-cbjdrkb"">除了七牛云，你也可以选择其他的服务商。关于服务商的选择可以参考这篇文章：<a href=""https://ld246.com/article/1668672970787?r=JeffreyChen"">《第三方同步选择 - S3 服务商对比推荐》</a> ，不过<span data-type=""strong"">具体的数据很可能已经过时</span>，需要留意；各个厂商的配置方法大同小异。</p></li><li id=""20240718225004-q9jzhtt""><p id=""20240718225004-vp56c4n"">使用 S3 同步只会同步工作空间下的 <span data-type=""em strong"">repo</span> 文件夹（里面是经过加密的文件分块，不包含整个工作空间），如需单独同步工作空间目录下的某些文件或文件夹，请在关闭思源笔记后手动复制到其他设备。</p></li></ul><p id=""20240718225004-abyncc4"">如果本篇教程对你有帮助，能否请你点个赞，还可以分享给需要的朋友。你的鼓励与支持就是我创作的最大动力。</p>",Jeffrey Chen,"S3,同步",开发
138,玩具向：思源的CRDT同步实现,Thu Jul 18 2024 22:32:59 GMT+0000 (Coordinated Universal Time),"<ul id=""20231211144711-9bnk8uo""><li id=""20231211144710-rweigq6""><p id=""20231211144710-6o39b67"">今天忽然想看看能不能用最简单的方式搭建一个思源的 crdt 同步来。</p></li><li id=""20231211144738-mvnxo8f""><p id=""20231211144738-0zxj4sl"">思源有一个 api 能返回文档的 json 形式：</p><ul id=""20231211144819-0nmcncc""><li id=""20231211144819-24t283z""><p id=""20231211144819-8gymnah"">​<span data-type=""code"">/api/file/getFile</span>​​​</p></li><li id=""20231211144819-3nmfmbu""><p id=""20231211144819-t9te58z"">参数</p><pre><code class=""language-json"">{
  ""path"": ""/data/20210808180117-6v0mkxr/20200923234011-ieuun1p.sy""
}

</code></pre></li><li id=""20231211144819-j8uycup""><p id=""20231211144819-lt3zwgn"">​<span data-type=""code"">path</span>​​​：工作空间路径下的文件路径</p></li></ul></li><li id=""20231211144825-vny14ok""><p id=""20231211144825-nqpimvg""><a href=""https://syncedstore.org/"" target=""_blank"" rel=""noopener"">syncedstore</a> 提供了一个 yjs 更简单的包装，并且能使用大部分的 object 和 array 操作</p></li><li id=""20231211144923-y98c9wo""><p id=""20231211144923-xuxvv93"">使用 <a href=""https://github.com/benjamine/jsondiffpatch"" target=""_blank"" rel=""noopener"">GitHub - benjamine/jsondiffpatch</a> 直接读取文档内容，并更新 crdt。</p><ul id=""20231211205755-z2h99ln""><li id=""20231211205755-56n0ef8"">jsondiffpatch 源代码要小改，不然会在进行 Array[index]=any 时报错。yjs 的数据结构没有实现这个方法。</li></ul></li><li id=""20231211205349-owczt2q""><p id=""20231211205349-ymt948x"">使用 <span data-type=""code"">y-webrtc</span>​ ​同步，使用 <span data-type=""code"">y-indexeddb</span>​ ​临时储存，保证在刷新重置后还能使用 y.doc</p></li><li id=""20231211205451-y8cduyb""><p id=""20231211205451-kon2eik"">最后居然真的搓出来了……</p><ul id=""20231211205935-b7gyg2i""><li id=""20231211205935-t68xqwk""><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">syncDoc = syncedStore({
    docMap: {}
})
ydoc1 = getYjsDoc(syncDoc)

const roomName = 'siyuanSync'
const persistence = new IndexeddbPersistence(roomName, ydoc1)

let webrtcProvider1
// const link = ()=&gt;{
//     webrtcProvider1 = new WebrtcProvider(roomName,ydoc1,{
//     signaling: ['ws://localhost:4444']
//     });
// }
const link = ()=&gt;{
    webrtcProvider1 = new WebrtcProvider(roomName,ydoc1,{
      signaling: ['wss://0.peerjs.com/peerjs?key=peerjs&amp;id=30ee7173-e40e-45b9-98a4-475f8355fb80&amp;token=pxuc9va99bp&amp;version=1.4.7'],});
}
async function updateCRDT(){
    doc = await openAPI.siyuan.fetchSyncPost('/api/file/getFile', {
    ""path"": ""/data/20230913204133-lqyylid/20231115154028-w0gudws.sy""
    })
  if (!syncDoc.docMap['20231115154028-w0gudws']){
    syncDoc.docMap['20231115154028-w0gudws'] = {}
  }
    temp = jsondiffpatch.diff(syncDoc.docMap['20231115154028-w0gudws'], doc)
    jsondiffpatch.patch(syncDoc.docMap['20231115154028-w0gudws'], temp);
    return JSON.stringify(syncDoc.docMap['20231115154028-w0gudws'])
}

function toJSON(ydoc) {
    const doc = {};
    ydoc.share.forEach((value,key)=&gt;{
        doc[key] = value.toJSON();
    }
    );
    return doc;
}

function writeFile(data, pathString) {
    let file
    if (typeof data === ""object"") {
        file = new File([new Blob([JSON.stringify(data)],{
            type: ""application/json""
        })],pathString.split(""/"").pop());
    } else {
        file = new File([new Blob([data])],pathString.split(""/"").pop());
    }
    const formData = new FormData();
    formData.append(""path"", pathString);
    formData.append(""file"", file);
    formData.append(""isDir"", ""false"");
    openAPI.siyuan.fetchPost('api/file/putFile', formData)
}

async function syncFile(){
    // await updateCRDT()
    writeFile(JSON.stringify(syncDoc.docMap['20231115154028-w0gudws']),'/data/20230913204133-lqyylid/20231115154028-w0gudws.sy')
}

function logYdoc(){
     return JSON.stringify(syncDoc.docMap['20231115154028-w0gudws'])
}</code></pre></li></ul></li><li id=""20231211205948-f1586os""><p id=""20231211205948-ucax3tz"">可惜就是 <span data-type=""code"">y-webrtc</span>​ 提供的信令服务器全是坏的，我尝试用 peerjs 的公共信令服务器代替，没有用……只能在本地用 node 开一个简单的信令服务器。</p></li><li id=""20231211205634-wf36is6""><p id=""20231211205634-c89von6"">还有就是，crdt 更新后，protyle 中不会同样更新，只能手动重载一下页面，如果写成插件的话，那直接只用重载 protyle 就行了。</p></li></ul><p> </p><p> </p>",zxhd86,"代码片段,插件开发",开发
134,思源 Simple Paste 插件与 OnPaste 事件,Thu Jul 18 2024 22:06:53 GMT+0000 (Coordinated Universal Time),"<div class=""quote_q quote-mce qe_wzk_lan"" contenteditable=""false""><div contenteditable=""true""><p>参见：<a href=""https://github.com/frostime/sy-simple-paste"">https://github.com/frostime/sy-simple-paste</a></p></div></div><p>这个项目是一个未上架的迷你插件，主要的功能是覆盖了思源的一些粘贴方法。如果有开发者想要利用思源的 OnPaste 事件做自定义，可以来参考一下。这个插件主要实现了三个功能：</p><ol><li>覆盖对 url 的粘贴，自动转换为 markdown link</li><li>覆盖了对 zotero 标注的黏贴，做了一些更符合我个人需求的格式化</li><li>覆盖了对 B 站分享链接的粘贴，同样会自动转换成 markdown link</li></ol><p>这里需要特别注意的是，此前我在重写 zotero 的粘贴事件的时候，总是无法正常生效。经过测试必须要给 <code>textHTML</code>参数传入一个 <code>&lt;!--StartFragment--&gt;&lt;!--EndFragment--&gt;</code>才行；怀疑可能是思源内部在处理粘贴板的 HTML 数据的时候哪里逻辑写得不太合适导致的。如果后面有人开发插件的时候遇到这个坑，可以参考一下这个解决方案。</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">detail.resolve({
    textPlain: txt, textHTML: ""&lt;!--StartFragment--&gt;&lt;!--EndFragment--&gt;"",
    files: detail.files, siyuanHTML: detail.siyuanHTML
);</code></pre><h3>Misc Code</h3><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">const onPaste = async (event) =&gt; {
    const detail = event.detail;
    //....
}

module.exports = class SimplePastePlugin extends siyuan.Plugin {

    config = {};

    async onload() {
        this.eventBus.on('paste', onPaste);
    }

    onunload() {
        this.eventBus.off('paste', onPaste);
    }

}</code></pre><p>思源的 paste 事件的 detail 的大致类型如下：</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""typescript"">interface ISiyuanEventPaste {
    protyle: IProtyle,
    resolve: &lt;T&gt;(value: T | PromiseLike&lt;T&gt;) =&gt; void,
    textHTML: string,
    textPlain: string,
    siyuanHTML: string,
    files: FileList | DataTransferItemList;
}</code></pre>",frostime,插件开发,内测
132,思源 js 应用程序示例库,Thu Jul 18 2024 20:59:02 GMT+0000 (Coordinated Universal Time),"<blockquote><p>这是一个思源笔记 js 应用示例库，里面有一些基本的 js 应用，你可以根据它们或组合它们来实现你需要的功能，它们也可以帮助你解读一些成品应用的代码片段</p></blockquote><p>开源地址：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmuhanstudio%2Fsiyuan-jsexample"" target=""_blank"" rel=""nofollow noopener ugc"">muhanstudio/siyuan-jsexample: 思源笔记 js 应用示例库 (github.com)</a></p><p>国内访问：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdoc.muhan.studio%2F%23%2Fgithub%2Fsiyuan-jsexample%2F"" target=""_blank"" rel=""nofollow noopener ugc"">https://doc.muhan.studio/#/github/siyuan-jsexample</a></p><p>（PS：目前只是开库，写一些最基本的 js，思源的前端文档，限于本人个人水平，实在是看的有点麻，本来打算删了这个库不写了，但是想了想还是发布一下，说不定以后有时间有精力能写点功能复杂一点的）</p><p>​<span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231021193907-trv1ch2.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>快捷运行方法：</p><p>1.下载本笔记库，导入到你的笔记本中</p><p>2.在集市中安装以下插件</p><p>​<span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231021192418-23w1m8x.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>3.点击运行（如果有控制台输出，需要打开思源开发者工具）</p><p>​​<span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231021192728-2zrl31y.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>​​</p>",HAN,,JS
130,五分钟学会开发自己的挂件,Thu Jul 18 2024 20:42:46 GMT+0000 (Coordinated Universal Time),"<blockquote><p>插件开发上手太难？不如先来开发一个挂件练练手！</p></blockquote><h2 id=""挂件是什么"">挂件是什么</h2><p>挂件是以可调整大小的 html 网页块儿形式展示在笔记正文里面的元素，可以通过快捷指令快速插入到笔记中，实现一些交互，记录，同时可以引入第三方 js，以及调用本地思源的 API 来实现更多功能，例如实现与思源笔记数据的交互。</p><h2 id=""挂件文件内容"">挂件文件内容</h2><h3 id=""语法-HTML"">语法：HTML</h3><p>HTML（HyperText Markup Language）是一种用于创建网页的标记语言。它由一系列的标签（tag）组成，这些标签用于描述网页的结构和内容。HTML 标记语言使用尖括号（&lt;&gt;）将标签包围起来，标签通常成对出现，分为开始标签和结束标签。</p><p>HTML 通过使用不同的标签来定义网页的结构，包括标题、段落、链接、图像、表格等元素。标签可以包含属性，用于提供关于元素的额外信息，如颜色、大小、链接目标等。</p><p>HTML 是构建网页的基础，它与 CSS（层叠样式表）和 JavaScript 等技术一起使用，可以实现丰富的网页交互和样式效果。通过编写 HTML 代码，开发人员可以创建具有文本、图像、链接和多媒体等内容的网页，并将其发布到互联网上供用户访问。<br />当创建网页时，使用 HTML 可以定义页面的结构和内容。下面是一些常用的 HTML 标签和它们的作用：</p><ol><li><code>&lt;html&gt;</code>：定义 HTML 文档的根元素。</li><li><code>&lt;head&gt;</code>：定义文档的头部，包含了一些元数据和链接引用。</li><li><code>&lt;title&gt;</code>：定义网页的标题，显示在浏览器的标题栏或标签页上。</li><li><code>&lt;body&gt;</code>：定义文档的主体部分，包含了网页的实际内容。</li><li><code>&lt;h1&gt;</code> 到 <code>&lt;h6&gt;</code>：定义标题，从大到小依次递减，用于显示不同级别的标题。</li><li><code>&lt;p&gt;</code>：定义段落，用于显示一段文本。</li><li><code>&lt;a&gt;</code>：定义超链接，用于创建指向其他页面或资源的链接。</li><li><code>&lt;img&gt;</code>：定义图像，用于显示图片。</li><li><code>&lt;ul&gt;</code> 和 <code>&lt;li&gt;</code>：定义无序列表，用于显示项目列表。</li><li><code>&lt;ol&gt;</code> 和 <code>&lt;li&gt;</code>：定义有序列表，用于显示按顺序排列的项目列表。</li><li><code>&lt;table&gt;</code>、<code>&lt;tr&gt;</code> 和 <code>&lt;td&gt;</code>：定义表格，用于显示数据表格。</li><li><code>&lt;div&gt;</code>：定义文档中的一个区块，用于组织和样式化内容。</li><li><code>&lt;span&gt;</code>：定义文档中的一个内联元素，用于样式化文本的一部分。</li></ol><p>以下是一个简单的 HTML 示例，展示了如何使用上述标签来创建一个网页：</p><div class=""vditor-copy""><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""xml"">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;我的网页&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;欢迎来到我的网页&lt;/h1&gt;
  &lt;p&gt;这是一个示例网页，用于演示HTML标记语言的基本用法。&lt;/p&gt;
  
  &lt;h2&gt;链接示例&lt;/h2&gt;
  &lt;a href=""https://www.example.com""&gt;点击这里&lt;/a&gt;访问示例网站。
  
  &lt;h2&gt;图像示例&lt;/h2&gt;
  &lt;img src=""image.jpg"" alt=""示例图片""&gt;
  
  &lt;h2&gt;列表示例&lt;/h2&gt;
  &lt;ul&gt;
    &lt;li&gt;项目1&lt;/li&gt;
    &lt;li&gt;项目2&lt;/li&gt;
    &lt;li&gt;项目3&lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;h2&gt;表格示例&lt;/h2&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;td&gt;姓名&lt;/td&gt;
      &lt;td&gt;年龄&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;张三&lt;/td&gt;
      &lt;td&gt;25&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;李四&lt;/td&gt;
      &lt;td&gt;30&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div><p>在上面的示例中，<code>&lt;!DOCTYPE html&gt;</code> 声明了文档类型为 HTML5，<code>&lt;html&gt;</code> 标签是根元素，包含了整个 HTML 文档。<code>&lt;head&gt;</code> 标签内部定义了文档的头部信息，包括标题等。<code>&lt;body&gt;</code> 标签内部是文档的主体部分，包含了网页的实际内容。</p><p>这只是一个简单的示例，HTML 标记语言非常丰富，还有更多的标签和属性可用于创建更复杂和交互性的网页。开发人员可以根据需要使用不同的标签和属性来实现所需的效果。</p><h3 id=""核心文件"">核心文件</h3><h4 id=""index-html"">index.html</h4><p>index.html 是挂件插入时会首先加载的界面，入口文件，通常作为主界面出现。</p><h4 id=""widget-json"">widget.json</h4><p>挂件在集市里的信息，俗称商品描述，不能缺少，否则无法上架（如果你打算上架集市），<br />该文件内容的描述可见。</p><h2 id=""开发步骤"">开发步骤</h2><h3 id=""UI"">UI</h3><p>可以通过不同的框架进行开发，例如 vue 和其他的模板语言，但最后都要编译为 HTML。</p><h3 id=""后端"">后端</h3><p>后端的交互通过 js 实现，引入 js 或者自行编写 js，思源允许在 html 内执行 js。</p><h3 id=""数据的存储"">数据的存储</h3><p>目前挂件没有专属的很好的储存数据的 API，以下是一个储存数据的思路。</p><h4 id=""获取数据唯一性标识"">获取数据唯一性标识</h4><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">// 获取当前挂件的块id 
const id = window.frameElement.parentElement.parentElement.getAttribute(""data-node-id"");</code></pre><p>这里获取到的 <code>id</code> 是当前挂件所在的块 id，可以用来给数据加上唯一性标识，并和它所在的块儿联系起来。<br />示意图：<br /><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204153852-20231204170630-udanr7n.png?imageView2/2/interlace/1/format/webp"" alt="""" /></span></p><p>如图，成功让挂件在自己的界面输出了自己所在的块 id。</p><h4 id=""储存数据"">储存数据</h4><p>获得了可以作为数据唯一键对值的 id，下一步就是想办法储存数据，我们可以借助官方给出的 API 文档中的写入文件的 API 来进行数据存储。<br /><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fblob%2Fmaster%2FAPI_zh_CN.md%23%25E5%2586%2599%25E5%2585%25A5%25E6%2596%2587%25E4%25BB%25B6"" target=""_blank"" rel=""nofollow noopener ugc"">思源后台写入文件 API</a></p><h5 id=""写入文件的API"">写入文件的 API</h5><ul><li><p><code>/api/file/putFile</code></p></li><li><p>参数为 HTTP Multipart 表单</p><ul><li><code>path</code>：工作空间路径下的文件路径</li><li><code>isDir</code>：是否为创建文件夹，为 <code>true</code> 时仅创建文件夹，忽略 <code>file</code></li><li><code>modTime</code>：最近访问和修改时间，Unix time</li><li><code>file</code>：上传的文件</li><li>返回值</li></ul><div class=""vditor-copy""><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""json"">{
  ""code"": 0,
  ""msg"": """",
  ""data"": null
}</code></pre></div></li></ul><h5 id=""将数据写入文件的示例"">将数据写入文件的示例<code class=""language-js highlight-chroma""></code></h5><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">// 写入文件内容
function putFileContent(path, content) {
	const formData = new FormData();
    formData.append(""path"", path);
    formData.append(""file"", new Blob([content]));
	return fetch(""/api/file/putFile"", {
          method: ""POST"",
          body: formData,
    }).then((response) =&gt; {
            if (response.ok) {
              console.log(""File saved successfully"");
            } else {
              throw new Error(""Failed to save file"");
            }
          })
          .catch((error) =&gt; {
            console.error(error);
          });
      }</code></pre><p>这个函数接受两个参数，path 和 content，其中 path 就是数据文件的路径，而 content 则是数据的内容，每次调用这个函数，都会将 content 的内容通过 api 接口追加到指定数据文件里面。</p><h5 id=""数据的储存格式"">数据的储存格式</h5><p>我个人比较推荐 json 的键对值储存方式，下面的这个示例也是用的 json 格式储存数据。</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">function saveIdCityMap(id, city) {
        var idCityMap = getIdCityMap();
        idCityMap[id] = city;
        // 将 idCityMap 写入文件
        putFileContent(
          ""/data/widgets/Simple-weather-forecast/data/data.json"",
          JSON.stringify(idCityMap)
        );
      }</code></pre><p><code class=""language-js highlight-chroma""><br /></code>​</p><p><code>saveIdCityMap</code> 函数接受两个参数：<code>id</code> 和 <code>city</code>，的目的是将 <code>id</code> 和 <code>city</code> 的映射保存到一个文件中。 <code>getIdCityMap</code> 函数用来获取一个名为 <code>idCityMap</code> 的对象，这个对象包含了已经存在的 ID 和城市的映射，具体定义看下面的<a href=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/#执行数据读取后的操作"">实例</a>。将新的 <code>id</code> 和 <code>city</code> 映射添加到 <code>idCityMap</code> 对象中，将更新后的 <code>idCityMap</code> 对象转换成 JSON 格式的字符串，并将其写入名为 <code>data.json</code> 的文件中（假设 <code>putFileContent</code> 函数可以成功执行）。</p><h4 id=""读取数据"">读取数据</h4><p>我们同样可以直接使用后端 API 来获取数据<br /><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fblob%2Fmaster%2FAPI_zh_CN.md%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%2587%25E4%25BB%25B6"" target=""_blank"" rel=""nofollow noopener ugc"">后端获取文件 API</a></p><h5 id=""获取文件"">获取文件</h5><ul><li><p><code>/api/file/getFile</code></p></li><li><p>参数</p></li></ul><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""json"">{
  ""path"": ""/data/20210808180117-6v0mkxr/20200923234011-ieuun1p.sy""
}</code></pre><ul><li style=""list-style-type: none;""><ul><li><code>path</code>：工作空间路径下的文件路径</li></ul></li><li><p>返回值</p><ul><li>响应状态码 <code>200</code>: 文件内容</li><li>响应状态码 <code>202</code>: 异常信息</li></ul></li></ul><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""json"">{
  ""code"": 404,
  ""msg"": """",
  ""data"": null
}</code></pre><h5 id=""获取数据函数实例"">获取数据函数实例</h5><p>通过这个 API 我们来构建读取数据的函数，同样是解析 json 的格式：</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">// 获取文件内容
      function getFileContent(path) {
        return fetch(""/api/file/getFile"", {
          method: ""POST"",
          headers: {
            ""Content-Type"": ""application/json"",
          },
          body: JSON.stringify({
            path: path,
          }),
        })
          .then((response) =&gt; {
            if (response.ok) {
              return response.text();
            } else {
              throw new Error(""Failed to get file content"");
            }
          })
          .catch((error) =&gt; {
            console.error(error);
          });
      }</code></pre><p><code class=""language-js highlight-chroma""><br /></code>​</p><p>这时候我们就可以在其他地方通过调用这个函数，通过判断返回结果，来判断执行我们需要的响应。</p><h5 id=""执行数据读取后的操作"">执行数据读取后的操作</h5><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">getIdCityMap()
        .then(function (idCityMap) {
          var idCityMapJ = {};

          // 使用正则表达式提取键值对中的键和值
          var regex = /""([^""]+)"":""([^""]+)""/g;
          var match;
          while ((match = regex.exec(idCityMap)) !== null) {
            var key = match[1];
            var value = match[2];
            idCityMapJ[key] = value;
          }

          var city = idCityMapJ[id];
          console.log(city); // 检查 city 变量的值是否正确获取到

          if (city) {
          //执行自定义函数
            loadWeatherWidget(city);
          } else {
          //执行自定义函数
            showInputBox();
          }
        })
        .catch(function (error) {
          console.log(""获取 idCityMap 出错:"", error);
        });</code></pre><p>这里通过寻找有没有 id 对应的 city，来返回结果，可以自定义在两种情况下进行什么自定义操作。</p><h3 id=""与插件联通"">与插件联通</h3><p>一些插件提供了可供前台调用的插件 API，我们可以通过调用这些 API 来实现更多功能，例如<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Ffrostime%2Fsy-run-js"" target=""_blank"" rel=""nofollow noopener ugc"">运行 javascript</a> 插件就为我们开放了几乎所有的 api 端口：<br /><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204161953-20231204170630-1ipj0gm.png?imageView2/2/interlace/1/format/webp"" alt="""" /></span></p><p>当然，我们也可以在外部编写 js，通过该插件提供的接口，将代码片段传入，来运行我们的 js 脚本：<br />详情请见<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Ffrostime%2Fsy-run-js%2Fcommit%2Fd002c4a5e70b929cfd19e5113208cc447f5e77df"" target=""_blank"" rel=""nofollow noopener ugc"">添加 run-js-code 的 api</a><br /><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204162145-20231204170630-kmy8e5t.png?imageView2/2/interlace/1/format/webp"" alt="""" /></span></p><h2 id=""发布到集市"">发布到集市</h2><h3 id=""注册github并发布版本"">注册 github 并发布版本</h3><p>集市的挂件系统通过对 github 仓库的发布版本进行定时抓取来更新插件，实际抓取的是 package.zip 这个压缩包，这个压缩包里面应该至少有 index.html，widget.json，README.md（英文说明），README_zh_CN.md（中文说明）这四个文件，如果你的挂件还需要引用外部资源（js，png，svg 等等），可以用相对路径进行引用，然后一块儿压缩到 package.zip 里面，通过 release 来发布这个 package.zip，一定要用版本号作为 tag，否则不予索引，例如下图，版本号是 0.4.0<br /><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204162525-20231204170630-ksti278.png?imageView2/2/interlace/1/format/webp"" alt=""|500"" /></span></p><h3 id=""第一次发布"">第一次发布</h3><p>第一次发布首先要占坑，也就是署名索引，需要到集市仓库地址的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fbazaar%2Fblob%2Fmain%2Fwidgets.json"" target=""_blank"" rel=""nofollow noopener ugc"">挂件索引</a>位置，点击编辑，在最后一行添加你的 <code>github用户名/挂件仓库名</code>，然后可能会提示你需要 fork 本仓库才能编辑，fork 即可，写完直接 commit，然后 creat pull request，等待开发者审核收录即可，可以在 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fbazaar%2Fpulls"" target=""_blank"" rel=""nofollow noopener ugc"">pull request</a> 查看收录情况。<br /><strong>例如</strong><br />将末尾：<br /><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204162655-20231204170630-t6gy0gz.png?imageView2/2/interlace/1/format/webp"" alt=""|500"" /></span></p><p>修改为：<br /><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204163237-20231204170630-2y2ajmf.png?imageView2/2/interlace/1/format/webp"" alt="""" /></span></p><h3 id=""后续版本更新"">后续版本更新</h3><p>后续修改完挂件代码后，只需要更改 widget 里面的 version 为更高的版本，然后打包成 package.zip，在 github 上发布 release，tag 和更新的 version 统一即可，集市会隔一段时间自动收录。</p>",HAN,,开发
111,建议更改思源的默认字重,Thu Jul 18 2024 18:44:49 GMT+0000 (Coordinated Universal Time),"<p>思源的默认字体不知道为什么总是感觉有点发虚。</p><p>所以我一般习惯通过 CSS 把 body 字重调的稍微大一点（500）；至于编辑区，就还是保持原始的不动即可。</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">body {
  font-size: 16px;
  font-weight: 500;
}

div.protyle-wysiwyg {
  font-weight: 400;
}</code></pre>",frostime,,CSS
107,双链被 `[]` 包裹,Thu Jul 18 2024 18:03:37 GMT+0000 (Coordinated Universal Time),"<pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""css"">.protyle-wysiwyg [data-node-id] span[data-type~=""block-ref""]::before {
    content: ""["";
    color: var(--b3-theme-primary);
    display: inline-block;
    text-align: center;
    margin: 0 0 0 0.125em;
    padding: 0;
    position: inherit;
    font-size: 1em;
}

.protyle-wysiwyg [data-node-id] span[data-type~=""block-ref""]::after {
    content: ""]"";
    color: var(--b3-theme-primary);
    display: inline-block;
    text-align: center;
    margin: 0 0.125em 0 0;
    padding: 0;
    position: inherit;
    font-size: 1em;
}</code></pre><p>效果如下：</p><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image-2.png"" alt=""image"" data-edit-file-id=""106"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image-2.png"" /></p><p> </p>",frostime,,CSS
104,(硬核向) 自制思源笔记微信收集箱搭建教程,Thu Jul 18 2024 17:46:44 GMT+0000 (Coordinated Universal Time),"<p>出门在外面不方便笔记？思源笔记和微信重度使用者？免费微信笔记收集箱？敏感消息不想经过别人的手？有很多不同的消息想收集？想完全自定义自己的微信工具箱？有服务器闲置没事干？</p><p>好的，那么你来对地方了！</p><p>本项目可以为你制作一个完全的属于自己的微信收集箱。</p><p>项目开源地址：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmuhanstudio%2Fsiyuan-wxbox"" target=""_blank"" rel=""nofollow noopener ugc"">https://github.com/muhanstudio/siyuan-wxbox</a></p><h2 id=""演示图-"">演示图：</h2><p>文字：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/Screenshot_2023-10-19-00-43-36-692_com.tencent.mm-20231019004425-544y7q5.jpg?imageView2/2/interlace/1/format/webp"" alt=""Screenshot_2023-10-19-00-43-36-692_com.tencent.mm"" /></span></p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019004538-dswegt7.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>图片：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/Screenshot_2023-10-19-00-46-24-498_com.tencent.mm-20231019004644-dd5d11u.jpg?imageView2/2/interlace/1/format/webp"" alt=""Screenshot_2023-10-19-00-46-24-498_com.tencent.mm"" /></span></p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019004743-758i233.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>语音（自动识别成文字）：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/Screenshot_2023-10-19-00-50-29-588_com.tencent.mm-20231019005058-m6xp5tf.jpg?imageView2/2/interlace/1/format/webp"" alt=""Screenshot_2023-10-19-00-50-29-588_com.tencent.mm"" /></span></p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019005051-lux42c4.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>位置信息：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/image-DDlhDdt.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></span></p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/image-iE5rFVR.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></span></p><h3 id=""那么这么方便的微信记笔记怎么才能实现呢-"">那么这么方便的微信记笔记怎么才能实现呢？</h3><h2 id=""拿起发财的小手-开干-"">拿起发财的小手，开干！</h2><h2 id=""详细搭建教程"">详细搭建教程</h2><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018235631-ee8lfsv.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击后会弹出文件管理器，data 后面紧跟着的就是你的笔记本 ID，如图，笔记本 ID 就是：20231018093815-glkj4gy</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018235759-f465r17.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>然后就可以开始我们的搭建了</p><h2 id=""搭建步骤-"">搭建步骤：</h2><h3 id=""1-安装宝塔"">1.安装宝塔</h3><p>（异常简单，省略，可以参考百度）</p><h3 id=""2-安装docker-并用docker部署思源笔记"">2.安装 docker，并用 docker 部署思源笔记</h3><p>（具体教程可以参考<a href=""https://ld246.com/article/1635558111871"">思源笔记 docker 搭建及后续使用优化（小白向） - 链滴 (ld246.com)</a>）</p><p>你也可以直接按照我的 docker 来配置，只需要安装最新版宝塔，然后点击</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018223602-3q24msz.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击后，如果你没有安装 docker，界面发白会提示让你安装 docker-compose up，安装即可。</p><p>安装完成后，把本项目的 docker-compose.yml 放到文件 →/www/SiYuan/下面</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018224057-06ptu8e.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>修改其中的访问密码 123456 为你自己的密码</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019001109-fl66dv9.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>然后进入终端：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018224729-dwo5a4f.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>在终端运行以下命令：</p><div class=""vditor-copy""><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">cd /www/SiYuan
docker-compose up</code></pre></div><p>等待安装完成，思源笔记已经成功部署在 docker 中，工作空间在服务器的/www/SiYuan 中，你可以随时查看笔记的数据。</p><p>后续想要更新思源，进入终端运行以下命令即可更新思源：</p><div class=""vditor-copy""><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">cd /www/SiYuan
docker-compose stop
docker-compose rm siyuan
docker rmi b3log/siyuan
docker-compose up</code></pre></div><h3 id=""3-配置反向代理"">3.配置反向代理</h3><p>宝塔新建网站</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225027-q7rke04.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击设置</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225128-wx62nb7.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击反向代理，点击添加反向代理</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019000839-biqtca0.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>创建如下两个反向代理：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225245-zmnx6a6.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225356-b62d9cu.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><h3 id=""4-获取思源笔记docker客户端的参数-以下操作均在思源笔记docker客户端中进行-不是本地思源-"">4.获取思源笔记 docker 客户端的参数(以下操作均在思源笔记 docker 客户端中进行，不是本地思源)</h3><p>访问 http://你的域名/siyuan，就可以进入到思源笔记 docker 客户端，然后输入密码，进入客户端</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019001530-t15s4eh.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>登录你的账号，把自动同步打开，如果是订阅账号就别管其他的，查看 apitoken 就可以了，如果是非订阅的 S3 储存用户，则还需要配置你的云同步参数，然后打开自动云同步</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019001911-8kboezy.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>然后去设置里面看自己的 apitoken，保存，一会儿要用</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019002035-gs9yh7b.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>之后一定要手动点击一次同步，一定一定要同步完成一次。</p><h3 id=""5-获取微信公众号参数"">5.获取微信公众号参数</h3><p>登录微信公众平台，获取这些参数：token,appid,aeskey</p><p>appid 在这里查看</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018231006-qnkgcl7.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>然后往下翻，有一个服务器配置，没有启用的话点击启用，启用了就点击修改</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018231220-1zkuu7l.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>在这里填写你的收集箱机器人地址，并获取剩余的参数，token 随机填一串数字，建议复杂一点，AESKEY 随机生成，不要点击提交，保留这个页面，如图：</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/image-NdLuppj.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></span></p><h3 id=""6-上传项目"">6.上传项目</h3><p>将本项目的 config.py，robot.py，run.py 拷贝到服务器的某个目录下面，我这里的路径是/www/wwwroot/app/wxsh</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232232-su1pt41.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><h3 id=""7-修改参数"">7.修改参数</h3><p>修改 config.py 为你刚刚得到微信公众号中的参数</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233614-sth69wn.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>修改 robot.py 中的参数为你的思源笔记参数，其中 openid 先不用管，后面我们会回来改</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019000050-x370hif.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><h3 id=""8-运行项目"">8.运行项目</h3><p>进入软件商店，应用搜索 python，安装 python 项目管理器</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232409-wgihmoh.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>安装完成后点击设置</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232537-6iiy2r5.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击版本管理，安装一个你喜欢的版本，建议和我一样</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232627-46euykg.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>然后点击项目管理，选择项目路径，找到你放 py 文件的地方，然后选择</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233009-8fdp1ne.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击启动文件/文件夹，选择 run.py</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233116-p9z2wjq.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>最后应该如下图所示，然后点击确定就可以，我们的微信公众号监控就开始运行了，</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233222-wsdcsad.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>点击然后不管报不报错，都点击模块</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019010252-6lrzabp.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>需要安装两个模块，flask 和 werobot，输入模块名称然后点击添加就可以了，两个都要添加</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019010325-rzm46i5.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>添加完成后，点击重启即可</p><p>此时，这个界面就可以点击提交了</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/image-M8AfaFE.png?imageView2/2/interlace/1/format/webp"" alt=""image.png"" /></span></p><h3 id=""9-获取openid-修改参数-重启项目"">9.获取 openid，修改参数，重启项目</h3><p>然后我们就可以去给公众号发消息了，第一次发消息，会回复你：此用户无权限：xxx，其中 xxx 就是你的 openid，复制下来，打开宝塔面板，找到你放 robot.py 的地方，修改里面的 openid 为你的 openid</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019002611-0twkbb6.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>修改完成保存后，再次进入 python 项目管理器，项目管理，点击重启</p><p><span class=""vditor-reset__preview""><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019002716-7chwjgk.png?imageView2/2/interlace/1/format/webp"" alt=""image"" /></span></p><p>等待重启完成，你就可以自由自在给自己的公众号发语音，图片，文字来达到随时随地记笔记的效果啦！</p><h2 id=""真棒-你居然做完了-你真的很努力也很认真-加油---"">真棒，你居然做完了，你真的很努力也很认真，加油！！！</h2>",HAN,,开发
76,为你的插件添加 ChangeLog 功能,Thu Jul 18 2024 13:36:56 GMT+0000 (Coordinated Universal Time),"<p id=""20240718133137-f2w6p10"">这个包可以可以帮开发者在插件更新的时候展示更新日志。</p><ul id=""20240718133236-bvoyuea""><li id=""20240718133237-bdx2s36""><a href=""https://github.com/frostime/sy-plugin-changelog"">https://github.com/frostime/sy-plugin-changelog</a></li><li id=""20240718133238-qtd323q""><a href=""https://www.npmjs.com/package/sy-plugin-changelog"">https://www.npmjs.com/package/sy-plugin-changelog</a></li></ul><p id=""20240718133236-5u7s6l4"">基本用法如下：</p><ol id=""20240718133207-trnul8y""><li id=""20240718133207-jnq6c77""><p id=""20240718133207-tq4inio"">安装依赖</p><blockquote id=""20240718133207-ja8kse6""><p id=""20240718133207-szr7xm0"">pnpm add -D sy-plugin-changelog</p></blockquote></li><li id=""20240718133207-x800eaj""><p id=""20240718133207-q0a7n3h"">在自己的代码中导入, 并将 <span data-type=""code"">this</span>​ 作为参数传入 <span data-type=""code"">changelog</span>​ 当中</p><pre><code class=""language-typescript"">import { changelog } from ""sy-plugin-changelog"";

export default class PluginSample extends Plugin {
  async onload() {
    //... everything done
    changelog(this);
  }
}
</code></pre></li><li id=""20240718133207-hi8fser""><p id=""20240718133207-lh6qliy"">请在 i18n 目录下新建文件 <span data-type=""code"">CHANGELOG-&lt;lang&gt;-&lt;version&gt;.md</span>​ 文件, 并保证被加入打包当中</p><ul id=""20240718133207-qtabshs""><li id=""20240718133207-ml9kx8t"">例如: i18n/CHANGELOG-zh_CN-0.0.2.md</li><li id=""20240718133207-piq8m1z"">​<span data-type=""code"">&lt;lang&gt;</span>​ 应当和思源 <span data-type=""code"">window.siyuan.config.lang</span>​ 一致, 例如: zh_CN</li><li id=""20240718133207-x8khhpf"">​<span data-type=""code"">&lt;version&gt;</span>​ 应当和 plugin.json 中 version 字段一致, 且格式为 <span data-type=""code"">/\d+\.\d+\.\d+/</span>​, 如 <span data-type=""code"">1.1.2</span>​</li></ul></li></ol><p id=""20240718133225-9uat6zd"">更多详细的用法, 请阅读文档。</p><pre><code class=""language-js"">/**
 *
 * @param plugin
 *      The plugin whose changelog you want to show
 * @param changelogPath
 *      Optional, the path of changelog file, default is `i18n/CHANGELOG-${lang}-${version}.md`\
 *      You can specify a concrete path like `i18n/CHANGELOG-zh_CN-1.0.0.md`\
 *      Or you can use placeholder `${lang}` and `${ver}`, `${version}, the ${lang} will be replaced with current language, and ${ver} will be replaced with the main version of the plugin.
 *
 * @param langFallback
 *      Optional, the fallback language
 *      default is:\
 *      ‍```
 *      {""zh_CN"": ""zh_CN"", ""zh_CHT"": ""zh_CN"", ""en_US"": ""en_US"", ""es_ES"": ""en_US"", ""fr_FR"": ""en_US""}
 *      ‍```
 *      A custom langFallback will be merged with the default one.
 * @returns
 */
export declare function changelog(plugin: Plugin, changelogPath?: string, langFallback?: LangFallback): Promise&lt;ChangelogResult&gt;;
</code></pre>",frostime,,开发
52,【独家首发】汐洛的Github分支发布工作流分享,Thu Jul 18 2024 13:16:20 GMT+0000 (Coordinated Universal Time),"<div class=""quote_q quote-mce qe_wzk_c-red"" contenteditable=""false""><div contenteditable=""true""><span style=""color: #ff6600"">此文内容已过时，等待更新中。可先直达源码学习</span> <span style=""color: #3366ff""><a style=""color: #3366ff"" href=""https://github.com/prototype-validation/dist-repo-use-branch/tree/main/.github"">prototype-validation/dist-repo-use-branch</a></span></div></div><p>汐洛最近正在规划集中仓发布模式，其中通过分支发布的工作流是重点。</p><p>为了验证这一思路是否可行，汐洛通过 IntelliJ 插件 仓库进行原型验证测试。测试结果表明，这一思路基本可行。</p><p>当然，分支发布不是什么新鲜事，大佬们有更好的实现方式，这里仅以汐洛探索的成果进行分享。</p><p>接下来分为主仓库端（上游）和 fork 端（下游）展示其工作流。</p><h2>主仓库端工作流</h2><p>先附上完整的 action yaml 代码</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml""># 有个小缺陷需要解决，fokr端（下游）创建分支时必须同名，否则只有创建时是复制的制定分支，后续目标会被强制改为上游默认分支
name: Test Push Directory to Branch with PR

# 这里通过主分支的 push 触发，也可以自定义其他触发方式
on:
  push:
    branches:
      - main

# ref https://docs.github.com/zh/actions/learn-github-actions/variables
env:
  dist_path: "".github""
  dist_branch: ""main_-_dist_-_test"" # 不能包含 / 等字符
  main_branch: ""main""

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 确保可以获取所有历史记录，以便合并
          token: ${{ secrets.MY_GH_TOKEN_W }} # 使用具有完全写入权限的 TOKEN（必须包含 workflows ）

      - name: Set up Git
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'

      - name: Merge changes from main into dist_branch
        run: |
          git checkout ${{ env.main_branch }}
          cp -r ${{ env.dist_path }} /tmp/
          ls -la /tmp/${{ env.dist_path }}
          git checkout -b ${{ env.dist_branch }}
          find . -mindepth 1 -maxdepth 1 ! -name '.git' -exec rm -rf {} +
          # 移动所有非隐藏文件和目录
          mv /tmp/${{ env.dist_path }}/* .
          # 移动所有隐藏文件和目录，但排除 . 和 ..
          shopt -s dotglob nullglob
          mv /tmp/${{ env.dist_path }}/.[!.]* .
          shopt -u dotglob nullglob
          # shopt -s dotglob 命令将开启shell选项，使得通配符 * 包含以点开头的文件和目录。
          # nullglob 选项确保当没有匹配的文件时，通配符不展开为自身。
          # 之后，我们通过 shopt -u dotglob nullglob 命令关闭这些选项，以恢复默认行为。
          ls -la
          git add .
          git commit -m ""[bot][skip actions] Merge changes into ${{ env.dist_branch }}"" || echo ""No changes to commit""

      - name: Push changes
        id: push_changes
        uses: ad-m/github-push-action@master
        with:
          branch: ${{ env.dist_branch }}
          force: true
          # force_with_lease: true # 仅在远程分支自上次检出以来没有其他提交的情况下成功
        env:
          github_token: ${{ secrets.MY_GH_TOKEN_W }} # 使用具有完全写入权限的 TOKEN（必须包含 workflows ）</code></pre><p>环境变量</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml""># ref https://docs.github.com/zh/actions/learn-github-actions/variables
env:
  dist_path: "".github""
  dist_branch: ""main_-_dist_-_test"" # 不能包含 / 等字符</code></pre><div>dist_path 是需要发布的文件夹路径。</div><div>dist_branch 是发布的分支名，<span style=""color: var(--main-color)""><span style=""color: var(--main-color)"">不能包含 / 等字符。以 </span></span><span style=""color: var(--main-color)"">main_-_dist_-_test 为例，main 是主分支的名字，dist 是 distribution（分发）的简写，test 是分发的名字，符合海文东规范。</span></div><h3><span style=""color: var(--main-color)"">Step 1 检出仓库</span></h3><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml"">- name: Checkout repository
  uses: actions/checkout@v4
  with:
          fetch-depth: 0  # 确保可以获取所有历史记录，以便合并
          token: ${{ secrets.MY_GH_TOKEN_W }} # 使用具有完全写入权限的 TOKEN（必须包含 workflows ）</code></pre><p>使用 <span style=""color: var(--main-color)"">actions/checkout 检出仓库，需要注意的便是设置具有 workflows 权限的 TOKEN。如果发布的文件夹路径不涉及工作流文件，则使用默认的自动生成的 GITHUB_TOKEN 即可。</span></p><h3><span style=""color: var(--main-color)"">Step 2 配置 Git</span></h3><div><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml"">- name: Set up Git
  run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'</code></pre><p>使用机器人即可</p></div><h3>Step 3 合并修改并提交</h3><div><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml"">- name: Merge changes from main into dist_branch
  run: |
          git checkout ${{ env.main_branch }}
          cp -r ${{ env.dist_path }} /tmp/
          ls -la /tmp/${{ env.dist_path }}
          git checkout -b ${{ env.dist_branch }}
          find . -mindepth 1 -maxdepth 1 ! -name '.git' -exec rm -rf {} +
          # 移动所有非隐藏文件和目录
          mv /tmp/${{ env.dist_path }}/* .
          # 移动所有隐藏文件和目录，但排除 . 和 ..
          shopt -s dotglob nullglob
          mv /tmp/${{ env.dist_path }}/.[!.]* .
          shopt -u dotglob nullglob
          # shopt -s dotglob 命令将开启shell选项，使得通配符 * 包含以点开头的文件和目录。
          # nullglob 选项确保当没有匹配的文件时，通配符不展开为自身。
          # 之后，我们通过 shopt -u dotglob nullglob 命令关闭这些选项，以恢复默认行为。
          ls -la
          git add .
          git commit -m ""[bot][skip actions] Merge changes into ${{ env.dist_branch }}"" || echo ""No changes to commit""</code></pre></div><h3>Step 4 推送到远端</h3><div><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml"">- name: Push changes
  id: push_changes
  uses: ad-m/github-push-action@master
  with:
          branch: ${{ env.dist_branch }}
          force: true
          # force_with_lease: true # 仅在远程分支自上次检出以来没有其他提交的情况下成功
  env:
          github_token: ${{ secrets.MY_GH_TOKEN_W }} # 使用具有完全写入权限的 TOKEN（必须包含 workflows ）</code></pre><p>这里使用和检出仓库同样的TOKEN。</p><p>也可以使用 PR action，这里不赘述。</p><hr /></div><h2>fork 端工作流</h2><p>先附上完整的 action yaml 代码</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""yaml""># refusing to allow a GitHub App to create or update workflow .github/workflows/XXXX.yml without workflows permission
# 遇到这个错误，需要检查三点：
# 1. 仓库设置 Workflow permissions 允许写权限
# 2. 使用的 TOKEN 具有 workflows 权限，如果是组织仓库还需要检查 TOKEN 的作用域
# 3. actions/checkout 也需要使用 workflows 权限的 TOKEN
# -------------------------------------------------------------------
# https://github.com/Soltus

name: 'Upstream Sync'

on:
  schedule:
    #        ┌───────────── minute (0 - 59)
    #        │  ┌───────────── hour (0 - 23)
    #        │  │ ┌───────────── day of the month (1 - 31)
    #        │  │ │ ┌───────────── month (1 - 12 or JAN-DEC)
    #        │  │ │ │ ┌───────────── day of the week (0 - 6 or SUN-SAT)
    #        │  │ │ │ │
    #        │  │ │ │ │
    #        │  │ │ │ │
    #        *  * * * *
    - cron: '0 7 * * *'
    # scheduled at 07:00 every day

  workflow_dispatch:  # click the button on Github repo!
    inputs:
      sync_test_mode: # Adds a boolean option that appears during manual workflow run for easy test mode config
        description: 'Fork Sync Test Mode'
        type: boolean
        default: false

env:
    target_sync_branch: ""main""
    upstream_sync_repo: ""Soltus/Sillot-ASP""
    upstream_sync_branch: ""main_-_dist_-_test""

jobs:
  sync_latest_from_upstream:
    runs-on: ubuntu-latest
    name: Sync latest commits from upstream repo

    steps:
    # REQUIRED step
    # Step 1: run a standard checkout action, provided by github
    - name: Checkout target repo
      uses: actions/checkout@v4
      with:
        # optional: set the branch to checkout,
        # sync action checks out your 'target_sync_branch' anyway
        ref:  ${{ env.target_sync_branch }}
        token: ${{ secrets.MY_GH_TOKEN_W }} # 使用具有完全写入权限的 TOKEN（必须包含 workflows ）
        # REQUIRED if your upstream repo is private (see wiki)
        persist-credentials: false

    # REQUIRED step
    # Step 2: run the sync action
    - name: Sync upstream changes
      id: sync
      uses: aormsby/Fork-Sync-With-Upstream-action@v3.4.1
      with:
        target_sync_branch: ${{ env.target_sync_branch }}
        target_repo_token: ${{ secrets.MY_GH_TOKEN_W }} # 可能涉及 workflows 的修改，需要对应权限
        upstream_sync_branch: ${{ env.upstream_sync_branch }}
        upstream_sync_repo: ${{ env.upstream_sync_repo }}
        # Set test_mode true during manual dispatch to run tests instead of the true action!!
        test_mode: ${{ inputs.sync_test_mode }}

    # Step 3: Display a sample message based on the sync output var 'has_new_commits'
    - name: New commits found
      if: steps.sync.outputs.has_new_commits == 'true'
      run: echo ""New commits were found to sync.""

    - name: No new commits
      if: steps.sync.outputs.has_new_commits == 'false'
      run: echo ""There were no new commits.""

    - name: Show value of 'has_new_commits'
      run: echo ${{ steps.sync.outputs.has_new_commits }}</code></pre><p>fork 端工作流是为了应对前文提到的<span style=""color: var(--main-color)"">小缺陷，即 fokr 端非同名分支后续目标会被强制改为上游默认分支的问题。需要注意的便是 fork 端工作流同样需要具有 workflows 权限的 TOKEN，原因见前文。</span></p><p>fork 仓库后，首先将发布的分支名（<span style=""color: var(--main-color)"">main_-_dist_-_test）</span>设为主分支，然后删除原主分支（main），接着执行一次手动工作流触发，生成 <span style=""color: var(--main-color)"">target_sync_branch （main）。</span></p><p>这里 <span style=""color: var(--main-color)"">target_sync_branch （main）作为名义主分支，用于 release 等场景，而发布的分支名（main_-_dist_-_test）为实际主分支，用于同步上游更新的工作流文件。</span></p>",soltus,"Github,Sillot,workflows",开发
691,思源插件开发 | 使用前端框架要小心内存泄漏风险 - 链滴,Thu Jul 18 2024 13:02:50 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>如果你是用 svelte、vue、react 等前端框架来开发思源的插件，那么一定要小心这个问题。</p>
</blockquote>
<p>现代的前端框架中，往往有两个重要的钩子事件（各个框架的具体命名可能有所不同）</p>
<ul>
<li>onMount</li>
<li>onDestroy</li>
</ul>
<p>而如果在开发的时候符合下面的情况：</p>
<ol>
<li>在 Dialog、Tab 中渲染了一个组件</li>
<li>组件中使用了副作用代码（例如监听器、setInverval 等），并且在 onDestroy 中清理副作用</li>
</ol>
<p>那就一定注意了：<strong>一个不留神可能存在内存泄漏的风险</strong>。</p>
<h2 id=""一个简单的案例"">一个简单的案例</h2>
<p>这是一个非常简单的案例，使用 solid 编写（不知道这个的，可以把它当成 react 看，在这里差别不大），组件中使用 setInterval 来更新颜色，然后在 onCleanUp 中清理 timer。</p>
<pre><code class=""language-ts highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">import</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fetchPost</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">Protyle</span><span class=""highlight-p"">,</span> <span class=""highlight-kr"">type</span> <span class=""highlight-nx"">App</span> <span class=""highlight-p"">}</span> <span class=""highlight-kr"">from</span> <span class=""highlight-s2"">\""siyuan\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">import</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">createEffect</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">createSignal</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">onCleanup</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">onMount</span> <span class=""highlight-p"">}</span> <span class=""highlight-kr"">from</span> <span class=""highlight-s2"">\""solid-js\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">randInt</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-nb"">Math</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">floor</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">255</span> <span class=""highlight-o"">*</span> <span class=""highlight-nb"">Math</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">random</span><span class=""highlight-p"">());</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">Component</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//略
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-p"">[</span><span class=""highlight-nx"">color</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">setColor</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">createSignal</span><span class=""highlight-p"">({</span><span class=""highlight-nx"">r</span>: <span class=""highlight-kt"">255</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">g</span>: <span class=""highlight-kt"">255</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">b</span>: <span class=""highlight-kt"">255</span><span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">timer</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">setInterval</span><span class=""highlight-p"">(()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">setColor</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">r</span>: <span class=""highlight-kt"">randInt</span><span class=""highlight-p"">(),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">g</span>: <span class=""highlight-kt"">randInt</span><span class=""highlight-p"">(),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">b</span>: <span class=""highlight-kt"">randInt</span><span class=""highlight-p"">(),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'update color\'</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">color</span><span class=""highlight-p"">());</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">},</span> <span class=""highlight-mi"">1000</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">onMount</span><span class=""highlight-p"">(</span><span class=""highlight-kr"">async</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//略
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""Hello mount\""</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">1500</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">onCleanup</span><span class=""highlight-p"">(()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""Hello panel closed\""</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">1500</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">clearInterval</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">timer</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">class</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""b3-dialog__content\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">class</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""plugin-sample__time\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">System</span> <span class=""highlight-nx"">current</span> <span class=""highlight-nx"">time</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">id</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""time\""</span><span class=""highlight-p"">&gt;{</span><span class=""highlight-nx"">time</span><span class=""highlight-p"">}&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">{</span><span class=""highlight-cm"">/*略*/</span><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">style</span> <span class=""highlight-na"">jsx</span> <span class=""highlight-na"">dynamic</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">{</span><span class=""highlight-sb"">`
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">                    .plugin-sample__time {
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">                        background-color: rgb(</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">color</span><span class=""highlight-p"">().</span><span class=""highlight-nx"">r</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">, </span><span class=""highlight-si"">${</span><span class=""highlight-nx"">color</span><span class=""highlight-p"">().</span><span class=""highlight-nx"">g</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">, </span><span class=""highlight-si"">${</span><span class=""highlight-nx"">color</span><span class=""highlight-p"">().</span><span class=""highlight-nx"">b</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">                    }
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">                `</span><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">style</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">export</span> <span class=""highlight-k"">default</span> <span class=""highlight-nx"">Component</span><span class=""highlight-p"">;</span>
</span></span></code></pre>
<p>然后我们在某个 Dialog 中显示这个组件：</p>
<pre><code class=""language-ts highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">import</span> <span class=""highlight-nx"">Component</span> <span class=""highlight-kr"">from</span> <span class=""highlight-s1"">\'./hello.tsx\'</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">simpleDialog</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">args</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">title</span>: <span class=""highlight-kt"">string</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">ele</span>: <span class=""highlight-kt"">HTMLElement</span> <span class=""highlight-o"">|</span> <span class=""highlight-nx"">DocumentFragment</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">width?</span>: <span class=""highlight-kt"">string</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">height?</span>: <span class=""highlight-kt"">string</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">callback</span><span class=""highlight-o"">?:</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-k"">void</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">dialog</span> <span class=""highlight-o"">=</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Dialog</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">title</span>: <span class=""highlight-kt"">args.title</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">content</span><span class=""highlight-o"">:</span> <span class=""highlight-sb"">`&lt;div class=\""dialog-content\"" style=\""display: flex; height: 100%;\""/&gt;`</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">width</span>: <span class=""highlight-kt"">args.width</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">height</span>: <span class=""highlight-kt"">args.height</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">destroyCallback</span>: <span class=""highlight-kt"">args.callback</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">dialog</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">element</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".dialog-content\""</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">appendChild</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">args</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ele</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-nx"">dialog</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">showDialog</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">container</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">createElement</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'div\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">container</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">display</span> <span class=""highlight-o"">=</span> <span class=""highlight-s1"">\'contents\'</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-cm"">/* 渲染组件
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">       相当于 svelte 的 new Component({target: container})
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">       vue 的 createApp(Component).mount(container)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">    */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">render</span><span class=""highlight-p"">(()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-nx"">Component</span><span class=""highlight-p"">(),</span> <span class=""highlight-nx"">container</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-nx"">simpleDialog</span><span class=""highlight-p"">({...</span><span class=""highlight-nx"">args</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">ele</span>: <span class=""highlight-kt"">container</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">callback</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""Bye!\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p><strong>你注意到什么问题了吗？</strong></p>
<p>如果你没注意到：恭喜你，踩坑了——<strong>Component 的 onCleanup 不会被自动调用，timer 也无法被正确清理，你踩中了一个内存泄漏的坑</strong>。</p>
<p>这里的原因在于，思源的 Dialog 销毁对于框架来说是外部的脚本行为，不涉及到前端组件的生命周期，他们也无法对这种“意外情况”进行响应。</p>
<p>这个很好理解，想想你用脚手架创建的 SPA 代码样例，是不是一般都是在顶层创建一个 <code>App</code> 组件，然后在 HTML 中引入一个顶层的 js 脚本，将 <code>App</code> mount 到一个 <code>#app</code> 元素上？</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1646569891270/assets/image-20240718125808-5om9wvc.png?imageView2/2/interlace/1/format/webp""></p>
<p>只有把各种自定义的组件放到这个 App 下方，框架才能正确管理各种创建、销毁的声明周期——而在思源中写插件显然不符合这种情况。</p>
<h2 id=""如何解决-"">如何解决？</h2>
<p>处理方法非常简单：你必须要在 Dialog 的 <code>destroyCallback</code> 当中显式的调用组件的销毁方法。</p>
<p>比如在 solidjs 中，<code>render</code> 函数会返回一个 <code>dispose</code> 函数（销毁），我们只要在 callback 里调用 dispose 就完事大吉。</p>
<pre><code class=""language-ts highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">showDialog</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">container</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">createElement</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'div\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">container</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">display</span> <span class=""highlight-o"">=</span> <span class=""highlight-s1"">\'contents\'</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">disposer</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">render</span><span class=""highlight-p"">(()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-nx"">Component</span><span class=""highlight-p"">(),</span> <span class=""highlight-nx"">container</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-nx"">simpleDialog</span><span class=""highlight-p"">({...</span><span class=""highlight-nx"">args</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">ele</span>: <span class=""highlight-kt"">container</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">callback</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">()</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">disposer</span><span class=""highlight-p"">();</span> <span class=""highlight-c1"">//必须显式地调用销毁，来触发组件的 Destroy 生命周期
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""Bye!\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>其他框架也是类似操作，例如在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fplugin-sample-vite-svelte%2Fblob%2Fmain%2Fsrc%2Findex.ts"" target=""_blank"" rel=""nofollow ugc""> vite-svelte 模板</a>中，通过调用 <code>pannel.$destroy</code> 来明确地销毁组件。</p>
<pre><code class=""language-ts highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">openDIYSetting</span><span class=""highlight-p"">()</span><span class=""highlight-o"">:</span> <span class=""highlight-k"">void</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">dialog</span> <span class=""highlight-o"">=</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Dialog</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">title</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""SettingPannel\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">content</span><span class=""highlight-o"">:</span> <span class=""highlight-sb"">`&lt;div id=\""SettingPanel\"" style=\""height: 100%;\""&gt;&lt;/div&gt;`</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">width</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""800px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">destroyCallback</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">options</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""destroyCallback\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">options</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">//You\'d better destroy the component when the dialog is closed
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">pannel</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">$destroy</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">pannel</span> <span class=""highlight-o"">=</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">SettingExample</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">target</span>: <span class=""highlight-kt"">dialog.element.querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""#SettingPanel\""</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>‍</p>
                

作者：Frostime
链接：https://ld246.com/article/1721278971170
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,"思源笔记,插件,插件开发",链滴优选
63,块引用样式 | 区分动态和静态锚文本,Thu Jul 18 2024 12:30:06 GMT+0000 (Coordinated Universal Time),"<pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"">/* 块引用*/
div.protyle-wysiwyg [data-node-id] span[data-type=""block-ref""]{
    color:var(--b3-theme-primary) !important;
    padding:0 5px;
    border-radius: 6px ;
    border-top:1px dashed var(--b3-theme-primary) !important;
    border-left: 8px solid var(--b3-theme-primary) !important;
    border-right: 8px  solid var(--b3-theme-primary) !important;
    border-bottom:1px dashed var(--b3-theme-primary) !important;
    border-image:unset !important;
}

/* 块引用 静态*/
div.protyle-wysiwyg [data-node-id] span[data-type=""block-ref""][data-subtype=""s""]{
    border-left: 13px solid var(--b3-theme-primary) !important;
    border-right: 1px dashed !important;
}</code></pre><p><img src=""https://sypai.cc/wp-content/uploads/2024/07/image.png"" alt=""image"" data-edit-file-id=""60"" data-full-url=""https://sypai.cc/wp-content/uploads/2024/07/image.png"" /></p><p> </p>",烟火,代码片段,CSS
45,如何在 / 命令的回调函数中手动删除前面输入的命令,Thu Jul 18 2024 11:30:25 GMT+0000 (Coordinated Universal Time),"<p>思源插件开发当中，可以通过在 <code>plugin</code> 中注册 <code>protyleSlash</code>来自定义<code>/</code>命令。</p><p>这类  API 的时候一般是在 callback 回调函数中调用 <code>protyle.insert(&lt;content&gt;)</code> 在编辑器中插入我们想要的内容。</p><p>但是有些情况我们可能不想要插入内容，而是想要做别的操作，这就需要我们手动清理掉输入的 <code>/xxx</code>了。</p><p>具体方法是插入一个 <code>Lute.Carte</code> 字符，来清空前面的输入。</p><pre class=""enlighter-pre"" contenteditable=""false""><code class=""gl"" data-enlighter-language=""javascript"">protyle.insert(Lute.Carte);</code></pre><p>参考案例：<a href=""https://github.com/frostime/sy-quick-attr/blob/c127d99762cee485ec597e29e479c6356f3177f7/src/index.ts#L255"">https://github.com/frostime/sy-quick-attr/blob/c127d99762cee485ec597e29e479c6356f3177f7/src/index.ts#L255</a></p>",frostime,插件开发,开发
655,【萌新教程】思源笔记使用七牛云 KODO 配置 S3 同步，超详细！ - 链滴,Wed Jul 17 2024 22:01:43 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""1--写在前面"">1. 写在前面</h2>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2F"" target=""_blank"" rel=""nofollow ugc"">思源笔记</a>是一款由国人开发的本地优先，支持双链、块级的开源笔记软件。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-2a32b8f8acb8cc9f68982a7041db8297-20240717220045-2e0lqv0.png?imageView2/2/interlace/1/format/webp""></p>
<p>思源笔记采用 json 作为数据存储格式，编辑器兼容 MarkDown 语法且编辑体验极佳（堪比 Typora）。最重要的是，<strong>自带同步功能</strong>。是我目前使用过的所有笔记软件中，最适合个人多设备使用的笔记软件，既能简单的实现多设备同步，又能保证数据本地化，不受在线笔记产品会员资费、云服务宕机的困扰。</p>
<blockquote>
<p>你可以在官网找到下载页面，也可以去 Github Release 中下载：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2Fdownload.html"" target=""_blank"" rel=""nofollow ugc"">https://b3log.org/siyuan/download.html</a></p>
</blockquote>
<p>思源笔记基础版本提供了几乎所有笔记相关的功能，会员版本分为永久买断功能特性和年付订阅，详见<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2Fpricing.html"" target=""_blank"" rel=""nofollow ugc"">价格页面</a>:</p>
<ul>
<li>永久买断：在所有基础功能的基础上，提供 S3/WEBDAV 同步功能（需自行使用第三方服务）</li>
<li>年付订阅：在永久买断的基础上，提供官方的同步功能（8GB 空间），且支持图床（可以将自己的图片上传至官方图床并在博客中引用）和剪藏、微信收集箱（通过微信公众号实时记录笔记并保存到思源笔记中）功能。</li>
<li>注意，若年付订阅者想使用 S3/WEBDAV 同步功能，<strong>则需要保持按年付费</strong>，会员失效后无法使用 S3/WEBDAV 功能，若想永久使用这两个功能，也需要购买永久买断的功能特性。</li>
</ul>
<p>如下图所示，<strong>付费版本和免费版本的区别只有同步功能是否可以使用</strong>，不会存在基础笔记共的限制。个人感觉目前 64 元买断的价格还是非常香的（之前早鸟付费是 48 元）。考虑到这里标了个原价 96，建议对思源笔记感兴趣，且使用后觉得确实不错的老哥趁早购买功能特性，不排除后续可能会恢复原价 96 的情况。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-bd7cf06a72bae304c8222f78bf126f94-20240717220046-ce5sma2.png?imageView2/2/interlace/1/format/webp""></p>
<p>另外，除非你不太想折腾 S3 同步（本文就是教你怎么做的），个人其实不太建议购买年付订阅。一是提供的同步空间有点小（社区里不少用户反馈认为 8GB 太少了，虽然对于我来说是够用）；二是 S3 的配置并不算麻烦，而官方提供的同步功能和 S3 同步基本没有体验差异。只要敢于尝试配置 S3，完全可以剩下这笔钱。</p>
<p>不过这里有个小提醒，不管是功能特性还是年付订阅均<strong>不支持退款</strong>，付款前请三思。</p>
<h2 id=""2--什么是思源笔记的S3-WEBDAV同步-"">2. 什么是思源笔记的 S3/WEBDAV 同步？</h2>
<h3 id=""2-1--说明"">2.1. 说明</h3>
<p>思源笔记本身是一个<strong>本地</strong>的笔记软件，提供了端到端加密的 S3/WEBDAV 或官方提供的同步功能。当你安装思源笔记后，在默认的思源用户指南笔记本中，可以看到有一整个章节都是关于数据安全的描述：</p>
<ul>
<li>思源云端同步使用端到端加密，密码在本地通过内置密钥加密保存，除使用者之外的任何第三方均无法在云端获得明文数据。</li>
<li>加密和解密过程完全在本地设备上进行</li>
<li>加密算法为业界公认安全的 AES GCM；</li>
</ul>
<p>端到端加密同步功能，简单来说，就是思源笔记使用一个密钥，先在你的电脑上将需要同步的笔记内容加密成密文，然后发送给云端。当这些数据在网络中开始流动时，它们已经是加密后的内容了，<strong>对于不知道密钥的其他人来说，这一堆数据和乱码没有区别</strong>。而在你需要同步的另外一台设备中，它会下载云端的加密内容，数据在流入这台设备之前也是一堆乱码，只能在你的设备中，通过相同的密钥才能正确还原出最初的笔记内容。</p>
<p>端到端加密功能，意味着除非你自己知道你的数据库密钥，否则即便别人获取到了你存放在云端的全量同步数据，<strong>也无法解密内容</strong>。这样一来也完全避免了云端服务商可能存在的扫盘而带来的隐私担忧。与之对应的是，<strong>如果你忘记了你的数据库密钥</strong>，且没有进行其他备份的话，那么任何人都没有办法解密你的云端笔记数据了。</p>
<p>思源提供 S3 和 WEBDAV 这两个不同的云端存储服务协议进行同步。<strong>其中 S3 协议的可靠性和稳定性远远优于 WEBDAV</strong>，除非特殊情况，否则百分百不推荐使用 WEBDAV 进行同步。</p>
<p>当你配置了 S3/WEBDAV 同步之后，只需要在其他设备上使用相同的同步配置以及数据库密钥，即可以实现多设备的同步。思源提供了<strong>三种同步选项</strong>，分别是完全手动、半自动（客户端开启和关闭的时候会自动同步一次，其余时间手动同步）、自动同步（停止修改后 30S 自动同步一次）。</p>
<blockquote>
<p>这里推荐手机 APP 采用<strong>全手动</strong>模式，因为手机端界面按钮较小，极其容易误触导致意外修改一些内容，完全手动同步可以避免这些意外修改的内容被上传。电脑客户端根据您自己的需要选择半自动或全自动。另外，手机 APP 也可以在设置中配置为<strong>默认只读</strong>状态，这样可以避免修改笔记内容。</p>
</blockquote>
<p>但需要注意的是，思源的加密仅限于同步到云端的数据，你的<strong>笔记在设备本地是明文存储的</strong>。也就是说，如果你的设备丢失，那么任何人都可以<strong>在设备本地的硬盘中读取到你的笔记明文内容</strong>。除非你对笔记所在文件夹使用其他软件或系统功能进行了加密，比如微软的 BitLocker。</p>
<p>作为一个本地优先的笔记软件，配置了同步后，即便没有网络，也丝毫不影响你浏览本地已有笔记内容（只不过会有一个无法同步的提示）。这一点对于我个人来说非常重要，我已经遇到过两次因为云端服务商产品协议更改或服务器访问波动导致我急需阅读笔记的时候无法阅读了。在那之后，我就把我所有的笔记内容全都转为纯本地了，包括笔记内的图片附件。</p>
<p>思源对大文本（超过 4W 字）的笔记支持也非常不错，毕竟是个本地笔记软件，性能基本取决于你的电脑配置。</p>
<blockquote>
<p>我曾使用过语雀存放我计算机网络的笔记（大约 5.7W 字），语雀会直接卡到完全不能动弹，整个页面都卡死了。即便我过几天再上去打开那个文档，也依旧是这样。不过 flowus 对这种大文本支持也还算不错，不会卡死。但是 flowus 的免费用户直接限制了 200MB 存储空间也太抠了，我一个计算机网络笔记里面的图片和附件就不止这么多了。</p>
</blockquote>
<p>咳咳，不跑题了，回到正文。</p>
<h3 id=""2-2--思源的同步配置和工作空间"">2.2. 思源的同步配置和工作空间</h3>
<blockquote>
<p>本文将以 2024-07-17 可下载到的最新思源版本 <code>V3.1.1</code> 做演示。</p>
</blockquote>
<p>思源笔记以 <code>工作空间</code> 为基础，独立进行各类主题、设置、密钥、同步配置。工作空间就是你的电脑上的一个文件夹，在这个工作空间中产生的各类笔记本和附件，都会被存放到这个工作空间的文件夹中。每个工作空间之间相互独立，没有任何关联，也需要进行独立的同步配置，和 obisidian 的 vault 是同一个概念。</p>
<p>为了避免出现同步错误，每个工作空间不可共用 S3 的 bucket 或同一个 WEBDAV 的同步路径。正确配置方式是每一个工作空间<strong>独立使用</strong>一个 S3 同步的 bucket 或者 WEBDAV 同步目录。</p>
<p>另外，因为思源笔记经常会实时进行本地文件的索引，所以不能将思源笔记的工作空间文件夹选择放在坚果云、OneDrive 这类会进行实时同步的同步目录中，<strong>必须将思源的工作空间文件夹存放在一个和其他任何软件都没有任何关系的文件目录中</strong>。若想同步，请使用思源笔记自带的同步功能；若想备份，思源笔记的设置中有一个 <code>导出-导出DATA</code> 功能，这个功能会将整个工作空间的笔记和附件全量导出为一个压缩包，可以在另外一个设备上进行导入或上传至云盘进行备份。</p>
<p>在你初次打开思源笔记的界面下，也会有相关的提示。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-92ce5419aa5e159e68dca2e1a39ca0be-20240717220046-p9hm3a5.png?imageView2/2/interlace/1/format/webp""></p>
<p>选择工作空间文件夹的时候也会有提示，不能放在同步盘的路径中。如上文所述，在一个和其他任何软件都没有关系的独立文件夹中创建一个文件夹来存放思源笔记的工作空间，选中这个文件夹后，下方的弹窗点击确定就可以了。</p>
<p><strong>这只是个每次都会出现的提示</strong>，并不代表你当前选中的文件夹有这些第三方同步盘配置。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-7f858cb23ae59c2d46d4491f8fdabaca-20240717220046-y4rxah3.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""2-3--什么是S3协议-"">2.3. 什么是 S3 协议？</h3>
<p>S3 是一个对象存储的公共协议，目前国内主流的云服务厂商如阿里云、腾讯云、七牛云等等都会提供兼容 S3 协议的对象存储的服务。您可以选择任意一家您熟悉的支持对象存储的服务提供商来配置思源的 S3 同步，并不局限于本文举例的服务商。</p>
<p>如果您是第一次使用思源笔记，且没有接触过 S3 对象存储，个人推荐有免费额度的<strong>七牛云</strong>作为入门选择。我已经使用七牛云超过一年了，暂未遇到过收到影响的无法访问的情况，稳定性还是不错的。</p>
<p>几乎所有服务商的对象存储服务，都是分为两个计费项的：</p>
<ul>
<li>流量计费；</li>
<li>存储空间计费；</li>
</ul>
<p>存储空间计费比较好理解，就是为你存储空间占用的硬盘容量付钱。流量付费对于小白来说可能没有听说过，因为商用宽带是很贵的，所以云服务厂家为您提供服务时，需要收取带宽的流量费用。一般情况下来说，都是<strong>上传不计费，下载才计费</strong>。举个例子，您使用思源笔记，将本地的文件同步到 S3 时，使用的是 <code>上传</code> 宽带，这一部分是不计费的；而在另外一台设备上，将云端的内容同步到本地时，使用的是 <code>下载</code>，这一部分就需要计费了。</p>
<p>如果您的设备不多，这部分由同步产生的下载流量费用是不高的。以我个人举例，我使用的思源笔记目前存储空间只有 1GB，在七牛云产生的资费只有极低的外网流出流量的费用。</p>
<p>如下是 2024 年 6 月的账单，可以看到存储空间容量直接扣除了免费的额度，不用钱。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-e246955816ceef383e0dceb4f7c02a5c-20240717220046-wye6zly.png?imageView2/2/interlace/1/format/webp""></p>
<p>外网流出流量 2.68GB，扣费 0.77 元。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-58892f2e7d28d94f96bc41efa0ef47d7-20240717220046-y9syw0o.png?imageView2/2/interlace/1/format/webp""></p>
<p>PUT/DELETE 和 GET 请求都没有超过免费额度，都不用钱。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-9b7bc32056f81b49039199e2b4d9743a-20240717220046-jog61yp.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""3--配置思源S3同步"">3. 配置思源 S3 同步</h2>
<h3 id=""3-1--初始化数据仓库密钥"">3.1. 初始化数据仓库密钥</h3>
<p>初次使用思源时，创建了一个工作空间后，要做的第一件事是在 <code>设置-关于</code> 中，初始化你的仓库密钥。思源会使用这个密钥进行端到端加密，密钥只有你当前使用的设备能知道。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-1003cc7ab75d392c3a727ceaf8b29f08-20240717220046-7ncapmj.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击自动生成密钥，这里会提示您如果在其他设备上已经有工作空间时，应该选择导入密钥。而我们当前是新建的一个工作空间，需要初始化密钥，点击确定即可。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-3dd380d46081974cce118403a3e06d5d-20240717220046-ryn9880.png?imageView2/2/interlace/1/format/webp""></p>
<p>密钥初始化完毕后，这里会显示复制密钥字符串，如果你需要在其他设备上同步这个工作空间的内容，可以在这里复制密钥，然后在另外一台设备上（比如手机 app 或者另外一台电脑）思源 app 设置的 <code>设置-关于-数据仓库密钥</code> 中，选择<strong>导入密钥</strong>。两台设备只有密钥一致，才能正确解密云端同步的数据。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-7521b39d5081c25ee529b5ccc488b8c9-20240717220047-hy1qylz.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""3-2--思源S3同步界面"">3.2. 思源 S3 同步界面</h3>
<p>思源的 S3 同步界面是在 <code>右上角按钮-设置-云端</code> 里面的，在使用同步功能之前，需要先在<strong>账户</strong>一栏登录你的思源账户（用于验证是否购买了订阅）。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-2df437c04fb0dc9213678ff62a421653-20240717220047-ksw4bgc.png?imageView2/2/interlace/1/format/webp""></p>
<p>登录了之后，云端选项就会开放，在下拉菜单中选择 S3 即可。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-480859be7370f05529b8829c01904a60-20240717220047-c3p29fc.png?imageView2/2/interlace/1/format/webp""></p>
<p>你可以先记住这里的几个配置条目，后文会一一说明它们的对应内容。</p>
<h3 id=""3-3--配置七牛云KODO"">3.3. 配置七牛云 KODO</h3>
<p>使用浏览器打开 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.qiniu.com%2F"" target=""_blank"" rel=""nofollow ugc"">七牛云</a> 官网， 注册账户。</p>
<p>七牛云的 S3 对象存储服务名为 KODO，在它的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.qiniu.com%2Fprices%2Fkodo"" target=""_blank"" rel=""nofollow ugc"">定价页面</a>，你可以看到七牛云提供了每月 10GB 的免费存储空间和 10GB 的 CDN 回源流量额度。对于思源笔记的用途而言，CDN 是用不上的，所以这个 10G 的 CDN 回源流量额度是用不到的。<strong>但 10GB 的存储空间额度可以用上了</strong>。至于后续的 PUT/DELETE 还有 GET 的免费额度可以不用管，基本是用不完的。</p>
<p>这里也说明了上传流量是免费的，符合前文关于 S3 计费项目的介绍。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-284ac975a2928deb82469434bd5426c0-20240717220047-up86xe8.png?imageView2/2/interlace/1/format/webp""></p>
<p>另外，在这个页面也有一个<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.qiniu.com%2Fprices%2Fkodo%3Ftab%3Dcalc"" target=""_blank"" rel=""nofollow ugc"">价格计算器</a>，你可以根据你的存储空间容量和设备数量来估计你最终会流出多少流量以及产生的资费。思源笔记的容量大小可以打开本地工作空间的文件夹查看内部 data 文件夹的占用空间。</p>
<p><img src=""https://b3logfile.com/file/2024/07/7a5b9c74b21e45fc888b8cd3b40d6cb2.png?imageView2/2/interlace/1/format/webp""></p>
<p>每个月的外网流出流量（也就是你的同步下载流量）平均到每月大概是在笔记本容量的 1.5 倍左右。注意：这只是个我根据个人情况<strong>猜测出来的大概比例</strong>，不代表实际情况，只用于预估价格。</p>
<p>如下图所示，假设你有 10GB 的笔记容量空间，那么外网流出流量一个月可能会需要 15GB，那么每个月产生的资费是 4.35 元左右。这只是流出流量的费用，因为 10GB 的存储空间是免费的。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-9ca445e8b78103c7743e4aeeaae6d5a9-20240717220047-wqozdvq.png?imageView2/2/interlace/1/format/webp""></p>
<p>现在你已经了解定价啦，来看看怎么配置七牛云的 S3 同步吧。登录七牛云后，点击右上角账户旁边的控制台按钮，进入后台，点击产品与方案，选择对象存储 kodo。你可以在这里选择将其钉住，这样会直接显示在侧边栏上。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-0706e3ee43433f31fa2789e222f35a35-20240717220047-f8txu4a.png?imageView2/2/interlace/1/format/webp""></p>
<p>在对象存储栏目中，点击空间管理，点击新建空间，这会创建一个 bucket，也对应的思源 S3 同步中 bucket 一栏的填写项。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-b9463c8ecd8c05327a5155b9145cc241-20240717220048-u9crtjq.png?imageView2/2/interlace/1/format/webp""></p>
<p>bucket 的名字根据你的喜好填写，<strong>建议填写辨识度高的名字</strong>，而不要填写一个诸如 siyuan 这类没有什么辨识度的名字。辨识度高的名字方便你后续创建更多 bucket 来对应其他思源工作空间或其他软件。</p>
<p>地域的选择采取就近原则，除非你人在国外，否则请不要选择非大陆地域。</p>
<p>访问控制选择<strong>私有</strong>，这代表只有拥有你的七牛云账户和相关密钥的软件可以访问这个 bucket，其他任何人都没有办法直接访问这个 bucket。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-384a403c846ce69b5d0437b53008dbe2-20240717220048-plgc7cc.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击确定后，会弹出如下的提示。这里是很多新手朋友不太理解的一点，什么是测试域名？为什么有效期只有 30 天？实际上，这个域名是用于<strong>公开 bucket</strong> 的访问的，刚刚我们创建 bucket 的时候已经选择了私有，<strong>这个域名对于思源同步来说没有任何用处</strong>，也就不用管他的 30 天过期说明！直接点击 <code>好的,我知道了</code> 忽略这个提示即可！</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-ea73be35361f1647eb68fa5b810e2258-20240717220048-94ye546.png?imageView2/2/interlace/1/format/webp""></p>
<p>现在我们已经创建了一个新的 bucket，点击它的名字，即可进入 bucket 的管理页面</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-ca825415de2154c81ad5fc4e82c60b8d-20240717220048-w4wtekr.png?imageView2/2/interlace/1/format/webp""></p>
<p>在 bucket 的空间概览中，可以看到当前 bucket 的存储空间占用量，以及外网流出流量统计。我们需要记录的是右下角的这个存储空间域名。这个存储空间域名的格式如下所示</p>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">http(s)://siyuan-bucket-1.s3.cn-east-1.qiniucs.com
</span></span><span class=""highlight-line""><span class=""highlight-cl"">http(s)://&lt;bucket名字&gt;.s3.cn-east-1.qiniucs.com
</span></span><span class=""highlight-line""><span class=""highlight-cl"">http(s)://&lt;bucket名字&gt;.&lt;协议&gt;.cn-east-1.qiniucs.com
</span></span><span class=""highlight-line""><span class=""highlight-cl"">http(s)://&lt;bucket名字&gt;.&lt;协议&gt;.&lt;区域名字&gt;.qiniucs.com
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-f8bf7b43794bb2c22fd9a51f7988c20a-20240717220048-7z7rjxk.png?imageView2/2/interlace/1/format/webp""></p>
<p>回到思源的配置中，现在可以填写一部分内容了</p>
<ul>
<li>Bucket：对应刚刚你创建的存储空间的名字，在我的示例中，是 <code>siyuan-bucket-1</code>;</li>
<li>Endpoint：填写域名中除了 bucket 名字以外的部分，即 <code>https://s3.cn-east-1.qiniucs.com</code>；</li>
<li>Region：填写域名中显示的区域名字，即 <code>cn-east-1</code>；</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-d6d18a4d349bb3384f256082620f76b3-20240717220048-sbwrnne.png?imageView2/2/interlace/1/format/webp""></p>
<p>还剩下两个内容分别是 Access Key 和 Secret Key，正如它们的名字翻译过来的结果，这两个是访问你这个 bucket 的用户密钥，也是你的七牛云账户的密钥。这是你的<strong>私密信息</strong>，请一定<strong>不要将用户密钥发送给任何人或发送到论坛上</strong>！</p>
<p>这两个密钥的获取位置是在七牛云界面的右上角，鼠标移动到你的用户头像位置，会弹出一个选择框，点击里面的密钥管理。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-4ab349939ae1115bf41ecc1c2c60f8c6-20240717220049-mw04sz7.png?imageView2/2/interlace/1/format/webp""></p>
<p>这里我已经创建过两组密钥了，我不记得新用户进到这个界面时是否会有一个创建密钥的提示了。总之你可以创建一组密钥，然后分别复制这里的 <strong>AK 和 SK</strong>，填写到思源笔记的 Access Key 和 Secret Key 中，同步配置就完成了！</p>
<blockquote>
<p>如果你认为你的七牛云密钥已经泄漏，可以选择停用密钥，停用后删除这个密钥，再重新创建一个新密钥即可。</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-723f04ab1bc1f51300e4bf2dfe07706d-20240717220049-vpg27nr.png?imageView2/2/interlace/1/format/webp""></p>
<p>填写完毕后，点击下方的启用云端同步</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-9082891d4b4817ef75a96e99354c2c09-20240717220049-y39hf9l.png?imageView2/2/interlace/1/format/webp""></p>
<p>在同步方式中，可以选择前文提到过的三种不同方式。对于电脑客户端而言，选择自动同步或者手动同步都是可以的；而对于手机 APP 而言，强烈推荐选择完全手动同步。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-731b4f2549605e64575e9e63bc1e68ad-20240717220049-gj7ob4s.png?imageView2/2/interlace/1/format/webp""></p>
<p>这里又会出现另外一个会让小白感到困扰的设置，在云端同步目录的设置中，你会发现你的七牛云账户里面的所有 bucket 都会显示出来。但是！刚刚在 S3 的同步配置中有一个 Bucket 填写项，我们使用的 Bucket 已经在填写项目中被<strong>固定</strong>了，所以这里的 bucket 选项是毫无意义的！<strong>它是留给 WEBDAV 协议选择文件路径使用的</strong>！使用了 S3 协议后，请忽略这个 <code>云端同步目录</code> 配置项。</p>
<p>正如前文提到过的，请针对<strong>每一个工作空间配置一个对应的 Bucket</strong>，请不要多个工作空间公用同一个 bucket！</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-846620eca1ae0a2485b07f2df3d45a2f-20240717220049-22rwok8.png?imageView2/2/interlace/1/format/webp""></p>
<p>现在我创建了一个测试笔记本，点击左上角的这个<strong>小云图标</strong>，即可进行同步操作。</p>
<blockquote>
<p>顺带提一嘴，你可能会在文档树中看到 <code>思源用户指南</code> 这个笔记本，请不要在这个笔记中记录任何笔记！每次启动思源的时候，<strong>这个笔记本都会被重置</strong>！他是一个说明书，并不是一个可用的笔记本。一定要在文档树中 <code>右键-新建笔记本</code> 来做你的记录！</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-2e07bd704af10290cb5ef8449fb28b5c-20240717220049-vip8yr5.png?imageView2/2/interlace/1/format/webp""></p>
<p>同步时，左下角会显示实时进度。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-70b0e714f197963591e412662e5a966d-20240717220050-mbf7hgz.png?imageView2/2/interlace/1/format/webp""></p>
<p>同步完毕后，我们可以来到七牛云的 bucket 的文件管理中，查看是否有新增的数据。如下图所示，刚刚我新建的 bucket 中已经出现了一个 repo 文件夹，且内部已有文件，这就代表你的同步配置完成啦！</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-92474957afc3dfd8203b51a2336ebd5d-20240717220050-96z54k4.png?imageView2/2/interlace/1/format/webp""></p>
<p>这里的 repo 文件和本地工作空间路径中的 repo 文件夹内容是一致的，都是使用数据库密钥加密后的笔记内容。</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-f47a493cc9fdd4cab4084f24c307ef69-20240717220050-kb92mjq.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""3-4--如何将同步配置导入其他设备-"">3.4. 如何将同步配置导入其他设备？</h3>
<p>注意：<strong>两台设备请保证思源的版本一致，数据仓库密钥一致，再进行同步</strong>。个人建议关闭思源客户端的自动更新功能，只要你使用当前版本没有遇到任何问题，建议维持版本，不进行更新。我现在还在使用 v2.11.4 老版本呢。</p>
<p>在设置-云端中，会有一个导入和导出的按钮，在这里可以快捷的导出你的云端配置，并在其他设备的云端设置中进行导入。</p>
<blockquote>
<p>请注意区分 云端的导入/导出 和 设置中的导出 选项，<code>设置-导出-导出DATA</code> 是将你的全量笔记数据导出为一个压缩包，方便在其他设备上直接导入笔记或备份笔记。而 <code>设置-云端-导出</code> 则只是导出你的云端配置项目，方便在其他设备上直接引用相同的云端配置项而不需要重新填写而已！</p>
</blockquote>
<p>注意：导出的压缩包是明文存储的，你的 AccessKey 和 SecretKey 都是明文。<strong>请在导入其他设备后，尽快删除压缩包</strong>，避免 AccessKey 和 SecretKey 泄漏！</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-697b546ceaecff9365b3b46bce82d4d8-20240717220050-brf2z4y.png?imageView2/2/interlace/1/format/webp""></p>
<p>在其他设备导入云端配置后，启用云端同步，将同步选项改为 <code>完全手动同步</code>，并手动点击小云图标，选择下载数据。等待云端的数据被下载完毕之后，再修改为其他同步方式。这样能最大限度的保障同步数据不出错！</p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-cc7ca5c616e1c0670d32a9ea35141f3b-20240717220050-4i4qyg6.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/07/siyuan/1685508926476/assets/net-img-72a6d2b5d430eb96520a5750e2e4803a-20240717220050-mcu6gy3.png?imageView2/2/interlace/1/format/webp""></p>
<p>另外，如果你尝试用 QQ 或微信的文件传输助手将这个云端同步压缩包发送给手机，需要注意的是 QQ 的文件传输助手收到的压缩包文件，没有办法在手机自带的文件管理器中被找到，也就没有办法导入思源 APP 中。<strong>建议使用数据线连接手机和电脑，将导出的云端同步配置压缩包传输到手机上</strong>。您还可以同时把导出的 DATA 压缩包也传至手机，先在手机 APP 中导入 DATA 和云端配置，再执行一次下载云端数据到本地，这样可以节省一部分流量费用。</p>
<h2 id=""4--其他服务商的配置教程"">4. 其他服务商的配置教程</h2>
<p>这里给大家贴出其他服务商配置思源 S3 的教程。因为上文第三点已经带大家走过一遍配置流程了，其他云服务厂商的配置都是大同小异，所以这里就只贴出其他服务商如何找到思源 S3 所需配置项的条目，对应填入云端配置项中就 OK 啦。需要特别注意一点，不管您使用哪一个服务商，在开通对象存储服务的时候，一定要选标准的对象存储类型，不要选择低频访问、冷归档之类的对象存储类型！</p>
<ul>
<li>七牛云 KODO：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdeveloper.qiniu.com%2Fkodo%2F4088%2Fs3-access-domainname"" target=""_blank"" rel=""nofollow ugc"">AWS S3 兼容 - 服务域名</a>，<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdeveloper.qiniu.com%2Faf%2Fkb%2F1479%2Fhow-to-access-or-locate-the-access-key-and-secret-key"" target=""_blank"" rel=""nofollow ugc"">怎么获取或者找到 Access Key 和 Secret Key</a>;</li>
<li>阿里云 OSS：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Foss%2Fuser-guide%2Fregions-and-endpoints"" target=""_blank"" rel=""nofollow ugc"">OSS 访问域名</a>，<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fram%2Fuser-guide%2Fcreate-an-accesskey-pair%3Fspm%3Da2c4g.53045.0.0.68147f80YkG9tZ%23task-2245479"" target=""_blank"" rel=""nofollow ugc"">创建 AccessKey</a>;</li>
<li>腾讯云 COS：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fcloud.tencent.com%2Fdocument%2Fproduct%2F436%2F41284"" target=""_blank"" rel=""nofollow ugc"">在兼容 S3 的第三方应用中使用 COS 的通用配置</a>;</li>
<li>又拍云存储：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.upyun.com%2Fknowledge-base%2Faws-s3%25e5%2585%25bc%25e5%25ae%25b9%2F"" target=""_blank"" rel=""nofollow ugc"">AWS S3 协议兼容</a>;</li>
</ul>
<p>这里再次对对象存储服务的资费做一个解释，毕竟这是初次接触这类云服务的小白最容易看不懂的东西。</p>
<p>以<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Foss%2Fproduct-overview%2Fbillable-items%2F"" target=""_blank"" rel=""nofollow ugc"">阿里云 OSS</a> 为例，你会看到阿里云 OSS 提供存储的资源包，如下图所示，40GB 的标准存储一年是费用是 9 元。这个 40GB 的资源包和七牛云提供的免费 10GB 存储容量一样，<strong>都是只抵消了存储空间的按量付费</strong>！即如果您使用阿里云 OSS，购买了这个 40GB 的资源包后，40GB 以内的存储空间都不会进行按量计费，只有超过 40GB 的空间才会需要按量计费。</p>
<p><img src=""https://b3logfile.com/file/2024/07/7ff459274f2c484abff08fadcfed4749.png?imageView2/2/interlace/1/format/webp""></p>
<p>那么我们需不需要购买这个资费包呢？可以来算一笔账，看看按量付费要多少 GB 的存储空间才需要 9 元。根据阿里云 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Foss%2Fproduct-overview%2Fstorage-fees"" target=""_blank"" rel=""nofollow ugc"">OSS 存储空间资费</a>文档，<strong>标准本地冗余存储</strong>的按量付费的计算公式如下</p>
<div class=""language-math"">按量付费：存储费用=存储量（GB）×月单价÷30（天）÷24（小时）</div>
<p>在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.aliyun.com%2Fprice%2Fproduct%3Fspm%3Da2c4g.11186623.0.0.387e7bbezYDEsc%23%2Foss%2Fdetail%2Fossbag"" target=""_blank"" rel=""nofollow ugc"">价格页面</a>可以看到 OSS 的存储空间按量付费单价和外网流出流量的付费单价。</p>
<p><img src=""https://b3logfile.com/file/2024/07/4b1a661398bc4b408d10a12e6f537c86.png?imageView2/2/interlace/1/format/webp""></p>
<p>根据 <code>0.12元/GB/月</code>，我们可以算出一年是 <code>1.44元/GB</code>，进一步计算 <code>9 ÷ 1.44 = 6.25</code>，得出结论，当你的存储空间容量低于 <code>6.25GB</code> 时，可以不用去购买 OSS 的存储空间资费包。如果您的思源笔记内容庞大，则在存储空间占用大于 6GB 的时候，就可以考虑购买 40GB 的资费包了！</p>
<p>顺带计算一下外网流出流量的价格，还是以上文提到的每月平均外网流出流量是占用存储空间的 1.5 倍计算，假设你有占用了 6GB 存储空间的笔记，那么每个月的外网流出流量预估是 9GB，直接按忙时价格计算，外网流出流量资费是 <code>4.5元/月</code>，同时还需 <code>0.72元</code> 的 6GB 月存储空间费用，合计 <code>5.22元</code> 每月。</p>
<p>对于阿里云 OSS 的新用户，您可以领取一次 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Foss%2Fproduct-overview%2Ffree-quota-for-new-users"" target=""_blank"" rel=""nofollow ugc"">20GB 存储空间和 2GB 外网流出流量/3 月</a>的免费额度，这篇文档中还提到了一些地域的 OSS 会有每月 5GB 的标准存储和外网流出流量的免费额度，但根据思源论坛的反馈，中国香港地域和海外地域的 OSS 在大陆访问效果并不好，连通性差，不建议省这笔钱！</p>
<h2 id=""5--The-end"">5. The end</h2>
<p>到这里，云端的配置就大功告成啦！主要是如何找到对象存储服务地域节点的域名，以及用户的 AccessKey 和 SecretKey。这一部分操作都可以去查阅各大云服务厂商编写过的文档。想必聪明的你已经学会啦！</p>
<p>感谢大家支持！如果在配置过程中有任何问题，都可以在评论区与我交流。如果本文帮助到了你，也可以在评论区互动一下，这会让慕雪感觉自己的努力有收获，非常感谢！</p>
                

作者：muxue
链接：https://ld246.com/article/1721224903886
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",muxue,"S3,同步,思源笔记,教程",链滴优选
1,思源派：定义你自己的思源笔记,Wed Jul 17 2024 21:10:03 GMT+0000 (Coordinated Universal Time),"<p><!-- wp:heading {""level"":1} --></p><p><!-- /wp:heading --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">简介</h2><p><!-- /wp:heading --></p><p><!-- wp:paragraph --></p><p><strong>思源派</strong>是一个专为<strong>思源笔记</strong>用户设计的内容分享平台。在这里，你可以找到丰富的资源，包括但不限于CSS片段、JavaScript脚本、内测插件以及高级使用教程，帮助你完全自由地定义和优化你的思源笔记体验。</p><p><!-- /wp:paragraph --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">功能亮点</h2><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>个性化定制</strong>：通过CSS和JS脚本，你可以按照自己的喜好和需求定制笔记的外观和功能。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>内测插件</strong>：获取最新开发的插件，享受前沿功能。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>高级教程</strong>：深入学习如何更高效地使用思源笔记，提升你的生产力。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">资源分类</h2><p><!-- /wp:heading --></p><p><!-- wp:heading {""level"":3} --></p><h3 class=""wp-block-heading"">CSS 片段</h3><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>主题样式</strong>：从经典到现代，多种主题风格供你选择。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>布局调整</strong>：调整笔记的布局，使其更符合你的阅读和编辑习惯。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>字体与颜色</strong>：自定义字体和颜色，提升阅读体验。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading {""level"":3} --></p><h3 class=""wp-block-heading"">JavaScript 脚本</h3><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>自动化操作</strong>：通过脚本实现笔记的自动化管理，如自动归档、标签管理等。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>增强功能</strong>：扩展思源笔记的基本功能，如增加新的快捷键、搜索优化等。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading {""level"":3} --></p><h3 class=""wp-block-heading"">内测插件</h3><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>预览新功能</strong>：参与内测，体验即将发布的新功能。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>反馈与优化</strong>：提供反馈，帮助开发者优化插件，提升用户体验。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading {""level"":3} --></p><h3 class=""wp-block-heading"">高级使用教程</h3><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>基础操作</strong>：从零开始，掌握思源笔记的基本使用方法。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>高级技巧</strong>：学习高级技巧，如笔记间的链接、知识图谱的构建等。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>案例分析</strong>：通过实际案例，了解如何将思源笔记应用到不同的工作和生活场景中。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">社区互动</h2><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>讨论区</strong>：加入我们的社区，与其他用户交流心得，分享你的创意和解决方案。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>求助与支持</strong>：遇到问题时，可以在这里寻求帮助，或提供你的解决方案。</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">如何开始</h2><p><!-- /wp:heading --></p><p><!-- wp:list {""ordered"":true} --></p><ol class=""wp-block-list""><li style=""list-style-type: none;""><ol class=""wp-block-list""><!-- wp:list-item --><li><strong>注册账号</strong>：访问 <a href=""https://sypai.cc"">思源派</a> 并注册账号。</li></ol></li></ol><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ol class=""wp-block-list""><li style=""list-style-type: none;""><ol class=""wp-block-list""><li><strong>浏览资源</strong>：在网站上浏览各类资源，找到你需要的内容。</li></ol></li></ol><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ol class=""wp-block-list""><li style=""list-style-type: none;""><ol class=""wp-block-list""><li><strong>下载与应用</strong>：下载资源并应用到你的思源笔记中，开始你的个性化之旅。</li></ol></li></ol><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">联系方式</h2><p><!-- /wp:heading --></p><p><!-- wp:list --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><!-- wp:list-item --><li><strong>邮箱</strong>：3543118607@qq.com</li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- wp:list-item --></p><ul class=""wp-block-list""><li style=""list-style-type: none;""><ul class=""wp-block-list""><li><strong>社交媒体</strong>：QQ群链接：<a href=""https://qm.qq.com/q/xjNArsK21a"">点击链接加入群聊【笔记软件综合交流群】</a></li></ul></li></ul><p><!-- /wp:list-item --></p><p><!-- /wp:list --></p><p><!-- wp:heading --></p><h2 class=""wp-block-heading"">结语</h2><p><!-- /wp:heading --></p><p><!-- wp:paragraph --></p><p>思源派不仅仅是一个资源分享平台，更是一个创意和知识交流的社区。我们期待你的加入，一起探索数字生活的无限可能！</p><p><!-- /wp:paragraph --></p><p><!-- wp:separator --></p><hr class=""wp-block-separator has-alpha-channel-opacity"" /><p><!-- /wp:separator --></p><p><!-- wp:paragraph --></p><p>如果你觉得我们的服务对你有帮助，可以推荐给更多人使用！</p><p><!-- /wp:paragraph --></p>",HAN,,新闻
653,魔改：从为知笔记（经典版）迁移所有笔记到思源 - 链滴,Wed Jul 17 2024 15:43:27 GMT+0000 (Coordinated Universal Time),"
                    <p>为知下小两千条笔记需要迁移，不想手动搞，魔改了下思源核心，实现自动迁移，分享给有同样需求的朋友们。</p>
<h2 id=""1-省流版-拢共分三步-"">1、省流版 拢共分三步：</h2>
<h2 id=""1-1-同步所有笔记到本地"">1.1、同步所有笔记到本地</h2>
<p>使用为知笔记经典版，新版不支持，使用新版创建的笔记也不支持，同步所有笔记内容到本地：</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-tOiudfO.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""1-2-替换思源笔记内核"">1.2、替换思源笔记内核</h2>
<p>内核位于安装路径的 <code>SiYuan\\resources\\kernel\\SiYuan-Kernel.exe</code>，退出思源笔记后替换成我上传的内核：</p>
<p><a href=""https://b3logfile.com/file/2024/07/SiYuan-Kernel-fN1VfO1.7z"">SiYuanKernel.7z</a></p>
<p>此内核为==3.1.1==版本编译，其它版本请按照下方源码自行编译！</p>
<p>替换前记得备份原内核！！</p>
<h2 id=""1-3-开始迁移"">1.3、开始迁移</h2>
<p>==迁移前请备份思源笔记里原有笔记，这里不对任何迁移过程中丢失笔记数据的事件负责！！==</p>
<p>使用<kbd> 导入</kbd> -<kbd>Markdown 文件夹</kbd> 功能导入;</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-uYKBM2w.png?imageView2/2/interlace/1/format/webp""></p>
<p>选择为知账户数据文件夹</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-CpAJL5l.png?imageView2/2/interlace/1/format/webp""></p>
<p>开始</p>
<p><img src=""https://b3logfile.com/file/2024/07/2e22f327918209261e3d5ae815dc25e-87MIAp2.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""2-Tips"">2、Tips</h2>
<p>已知的问题：</p>
<ul>
<li>仅支持经典版为知笔记客户端，和网页版创建的笔记，新版为知笔记创建的条目会自动忽略；</li>
<li>支持隐藏笔记，不支持加密笔记，加密笔记会被忽略；</li>
<li>不支持单元格内有多行或者其它复杂格式的表格，导入过程将格式复杂的表格转换为 <code>[TABLE]</code> 文本，须手动查找后修复；</li>
<li>如果原笔记标题带路径分隔符\'/\'，导入的笔记标题会变成\'/\'后的字符串，可以做转义，懒得搞了；</li>
<li>为知笔记剪藏时会魔改一些格式，剪藏的内容，可能会格式错乱或者转换失败；</li>
<li>为知笔记转换的 PDF、EXCEL、PPT 等不能转换成 Markdown，不过会保留附件，无伤大雅；</li>
<li>导入过程不会在被导入的文件夹下创建一个新的文件夹来存储笔记，而是按照为知的笔记结构直接导入到被导入文件夹下。</li>
</ul>
<h2 id=""3-魔改源码"">3、魔改源码</h2>
<p>仅修改了一个源码文件，即 <code>model</code> 中的 <code>import.go</code> 文件。</p>
<p><code>import{}</code> 中添加</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">sqlite</span> <span class=""highlight-s"">\""database/sql\""</span> <span class=""highlight-c1"">//魔改：导入原始sqlite3包
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-nx"">_</span> <span class=""highlight-s"">\""github.com/mattn/go-sqlite3\""</span> <span class=""highlight-c1"">// 魔改：导入原始sqlite3包
</span></span></span></code></pre>
<p>添加主函数，详情见注释：</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 魔改：新增函数从为知笔记数据文件夹导入
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kd"">func</span> <span class=""highlight-nf"">ImportFromWiz</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">boxID</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">localPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">baseHPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">baseTargetPath</span> <span class=""highlight-kt"">string</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">err</span> <span class=""highlight-kt"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizdbPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">localPath</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""index.db\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizdb</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">sqlite</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Open</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""sqlite3\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizdbPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-kc"">nil</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">defer</span> <span class=""highlight-nx"">wizdb</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Close</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-c1"">// 注意NULL值与任何值做任何比较，结果都是fasle，过滤条件须添加 `DOCUMENT_TYPE IS NULL`
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-nx"">wizrows_count</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">wizdb</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Query</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""SELECT COUNT(*) FROM WIZ_DOCUMENT WHERE (DOCUMENT_TYPE != \'collaboration\' OR DOCUMENT_TYPE IS NULL) AND DOCUMENT_PROTECT = 0\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-kc"">nil</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizrows_count</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Next</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizCount</span> <span class=""highlight-o"">:=</span> <span class=""highlight-mi"">0</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizColumn</span> <span class=""highlight-o"">:=</span> <span class=""highlight-mi"">0</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">wizrows_count</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Scan</span><span class=""highlight-p"">(</span><span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">wizCount</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizrows_count</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Close</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-kc"">nil</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">wizrows</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">wizdb</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Query</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""SELECT DOCUMENT_GUID, DOCUMENT_TITLE, DOCUMENT_LOCATION, DOCUMENT_NAME, DOCUMENT_URL, DOCUMENT_TYPE, DOCUMENT_FILE_TYPE, DT_CREATED, DT_MODIFIED, DT_ACCESSED, DOCUMENT_ATTACHEMENT_COUNT FROM WIZ_DOCUMENT WHERE (DOCUMENT_TYPE != \'collaboration\' OR DOCUMENT_TYPE IS NULL) AND DOCUMENT_PROTECT = 0 ORDER BY DT_CREATED ASC\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""查询为知数据库失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-kc"">nil</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">defer</span> <span class=""highlight-nx"">wizrows</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Close</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">PushEndlessProgress</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""检测到为知笔记数据库，正在尝试导入笔记……\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">markdownStr</span> <span class=""highlight-kt"">string</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">tree</span> <span class=""highlight-o"">*</span><span class=""highlight-nx"">parse</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Tree</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentGuid</span> <span class=""highlight-kt"">string</span>         <span class=""highlight-c1"">// GUID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentTitle</span> <span class=""highlight-kt"">string</span>        <span class=""highlight-c1"">// 标题
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentLocation</span> <span class=""highlight-kt"">string</span>     <span class=""highlight-c1"">// 路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentName</span> <span class=""highlight-kt"">string</span>         <span class=""highlight-c1"">// 文件名
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentUrl</span> <span class=""highlight-o"">*</span><span class=""highlight-kt"">string</span>         <span class=""highlight-c1"">// 如果不为空则是剪藏的笔记，剪藏的url
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentType</span> <span class=""highlight-o"">*</span><span class=""highlight-kt"">string</span>        <span class=""highlight-c1"">// 类型，除了经典版不存储的值为collaboration的md笔记，lite/markdown为html和md混合排版笔记，其它默认为html笔记
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentFileType</span> <span class=""highlight-o"">*</span><span class=""highlight-kt"">string</span>    <span class=""highlight-c1"">// 如果不为空则是导入的笔记，被导入文件类型
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DtCreated</span> <span class=""highlight-kt"">string</span>            <span class=""highlight-c1"">// 创建时间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DtModified</span> <span class=""highlight-kt"">string</span>           <span class=""highlight-c1"">// 修改时间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DtAccessed</span> <span class=""highlight-kt"">string</span>           <span class=""highlight-c1"">// 访问时间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">DocumentAttachmentCount</span> <span class=""highlight-kt"">int</span> <span class=""highlight-c1"">// 附件数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">targetPaths</span> <span class=""highlight-o"">:=</span> <span class=""highlight-kd"">map</span><span class=""highlight-p"">[</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">]</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">tmpPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Getenv</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""LOCALAPPDATA\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">tmpPath</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-nx"">errors</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">New</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""获取系统应用程序数据文件夹路径失败！\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">tmpPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">tmpPath</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""Temp\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">unzipPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">tmpPath</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""wizunzip\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">luaPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">TempDir</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""pandoc_script.lua\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-c1"">// 生成pandoc过滤器lua脚本，如果存在，则不创建
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-k"">if</span> <span class=""highlight-p"">!</span><span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">File</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">IsExist</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">luaPath</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">luaString</span> <span class=""highlight-o"">:=</span> <span class=""highlight-s"">`
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 定义一个函数，用于检查样式并转换为对应的Markdown标记
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">local function convert_style (elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if #elem.content == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 检查 elem.attributes 是否存在
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if not elem.attributes then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 获取样式属性
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local style = elem.attributes.style
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if not style then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 下划线样式，将内容用&lt;u&gt;包围，排除超链接
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if (string.find(style, \'text%-decoration%s*:%s*underline\') or string.find(style, \'text%-decoration%-style\')) and elem.t ~= \""Link\"" then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 创建 &lt;u&gt; 标签包裹内容
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local u_open = pandoc.RawInline(\'gfm\', \'&lt;u&gt;\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local u_close = pandoc.RawInline(\'gfm\', \'&lt;/u&gt;\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 插入 &lt;u&gt; 标签到内容的前后
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, 1, u_open)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, u_close)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 粗体样式，将内容用**包围
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if string.find(style, \'font%-weight%s*:%s*bold\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 创建字符串节点
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local s_label = pandoc.RawInline(\'gfm\',\'**\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 插入字符串到内容的前后
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, 1, s_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, s_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 斜体样式，将内容用*包围
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if string.find(style, \'font%-style%s*:%s*italic\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local e_label = pandoc.RawInline(\'gfm\',\'*\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, 1, e_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, e_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 删除线样式，将内容用~~包围
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if string.find(style, \'text%-decoration%s*:%s*line%-through\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local so_label = pandoc.RawInline(\'gfm\',\'~~\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, 1, so_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, so_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 高亮样式，将内容用==包围
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if string.find(style, \'background%-color:%s*rgb%(255,%s*255,%s*0%)\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local m_label = pandoc.RawInline(\'gfm\',\'==\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, 1, m_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, m_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 不带\""+raw_html\""情况下提取为知笔记代码块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Div(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 仅处理 class=\""wiz-code-container\"" &lt;div&gt;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if elem.classes[1] == \""wiz-code-container\"" then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local code_lang = elem.attributes.mode
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	local code_content = \""\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	elem.content = elem.content[1].content[6].content[1].content[1].content[1].content[1].content[5].content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	for i, code in ipairs(elem.content) do
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	  if not code.content[4] then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	    code_content = code_content..code.content[2].text..\""\\n\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	  else
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	    code_content = code_content..code.content[4].text..\""\\n\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	return pandoc.CodeBlock(code_content, { class = code_lang })
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  else return pandoc.Div(convert_style(elem))
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- &lt;br&gt;标签转换为自然换行
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function LineBreak(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return pandoc.Str(\""\\n\"")
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理&lt;u&gt;标签，跳过pandoc带-raw_html参数时转换
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Underline(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if #elem.content == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local u_open = pandoc.RawInline(\'gfm\',\'&lt;u&gt;\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local u_close = pandoc.RawInline(\'gfm\',\'&lt;/u&gt;\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  table.insert(elem.content, 1, u_open)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  table.insert(elem.content, u_close)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- &lt;sup&gt;上标
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Superscript(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if #elem.content == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local sup_label = pandoc.RawInline(\'gfm\',\'^\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  table.insert(elem.content, 1, sup_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  table.insert(elem.content, sup_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- &lt;sub&gt;下标
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Subscript(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if #elem.content == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local sub_label = pandoc.RawInline(\'gfm\',\'~\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  table.insert(elem.content, 1, sub_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  table.insert(elem.content, sub_label)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- &lt;kbd&gt;处理流程在&lt;span&gt;标签中
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理&lt;SPAN&gt;标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Span(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 处理&lt;kbd&gt;标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if elem.classes[1] == \""kbd\"" and #elem.content ~= 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local k_open = pandoc.RawInline(\'gfm\',\'&lt;kbd&gt;\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local k_close = pandoc.RawInline(\'gfm\',\'&lt;/kbd&gt;\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	table.insert(elem.content, 1, k_open)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    table.insert(elem.content, k_close)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">	return elem.content
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  else
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 转换&lt;span&gt;的style样式为markdown标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return pandoc.Span(convert_style(elem))
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理&lt;a&gt;标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Link(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 删除空链接或空字符的超链接
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if elem.target == \""\"" or #elem.content == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 返回空字符串，删除整个&lt;a&gt;标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 页内导航直接返回文本
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  elseif elem.target:match(\'^#\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return convert_style(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return pandoc.Link(convert_style(elem),elem.target,elem.title)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理&lt;h&gt;标签样式
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Header(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if #elem.content == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return pandoc.Header(elem.level,convert_style(elem))
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理base64编码内容
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 识别mimetype，并转换为扩展名
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">local mimetypes = {
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""image/jpeg\""] = \""jpg\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""image/png\""] = \""png\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""image/gif\""] = \""gif\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""image/svg+xml\""] = \""svg\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""audio/mpeg\""] = \""mp3\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""audio/ogg\""] = \""ogg\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""video/mp4\""] = \""mp4\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  [\""application/pdf\""] = \""pdf\"",
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 计算字符串hash值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function djb2_hash(str)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local hash = 7
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  for i = 1, #str do
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      hash = hash * 3 + string.byte(str, i)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return hash
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 解码base64
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">local function decode_base64(input)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local b = \'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\'
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  input = string.gsub(input, \'[^\'..b..\'=]\', \'\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return (input:gsub(\'.\', function(x)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    if (x == \'=\') then return \'\' end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local r, f = \'\', (b:find(x) - 1)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    for i = 6, 1, -1 do
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      r = r .. (f % 2 ^ i - f % 2 ^ (i - 1) &gt; 0 and \'1\' or \'0\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return r
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end):gsub(\'%d%d%d?%d?%d?%d?%d?%d?\', function(x)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    if (#x ~= 8) then return \'\' end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local c = 0
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    for i = 1, 8 do c = c + (x:sub(i, i) == \'1\' and 2 ^ (8 - i) or 0) end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return string.char(c)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end))
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 生成文件和链接
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">local function extract_base64(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local src = elem.src
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local mime_type, base64_data = src:match(\'^data:(.-);base64,(.+)\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 清除为知笔记像素点
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if base64_data == \'R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\' then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local ext = mimetypes[mime_type] or \'bin\'
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local file_name = string.format(\""%08x\"", djb2_hash(base64_data)) .. \'.\' .. ext
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local file_path = os.getenv(\'LOCALAPPDATA\')..\""\\\\Temp\\\\wizunzip\\\\\""..file_name
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 如果file_path不存在，则创建文件
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  local file = io.open(file_path, \'r\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if not file then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    local decoded_data = decode_base64(base64_data)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    if ext == \""svg\"" and not string.find(decoded_data, \'xmlns=\""http://www.w3.org\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      decoded_data = decoded_data:gsub(\'&lt;svg\', \'&lt;svg xmlns=\""http://www.w3.org/2000/svg\""\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    -- 创建decode后的二进制文件
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    file = io.open(file_path, \'wb\')
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    file:write(decoded_data)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    file:close()
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  else
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    io.close(file)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 生成markdown链接
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return pandoc.Image(elem.caption,file_name,elem.title)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理&lt;img&gt;&lt;svg&gt;等标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Image(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if elem.src == \""\"" then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return {}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 提取base64图片，思源无法识别gif和svg，此处预处理所有base64图像
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  elseif elem.src:match(\'^data:\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    return extract_base64(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理&lt;pre&gt;标签
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function CodeBlock(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if #elem.classes == 0 then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    elem.classes = {\""plaintext\""}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 如果elem.classes[1]的值是hljs，则是hljs样式，返回elem.classes[2]的值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  elseif elem.classes[1] == \""hljs\"" then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    elem.classes = {elem.classes[2]}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 如果elem.classes的值以brush:开头，则返回elem.classes的值为brush:后的值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  elseif elem.classes[1]:match(\'^brush:\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    elem.classes = {elem.classes[1]:match(\'^brush:(.+)\')}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  -- 如果elem.classes的值以language-开头，则返回elem.classes的值为language-后的值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  elseif elem.classes[1]:match(\'^language-\') then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    elem.classes = {elem.classes[1]:match(\'^language-(.+)\')}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  return elem
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">-- 处理纯附件导入笔记的表格
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">function Table(elem)
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  if elem.bodies[1].body[1].cells[1].contents[1].t == \""Header\"" then
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">   local cell = pandoc.Plain(elem.bodies[1].body[1].cells[1].contents[1].content[1])
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">   elem.bodies[1].body[1].cells[1].contents[1] = cell
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">   return elem
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">  end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">end
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">`</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">WriteFile</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">luaPath</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">[]</span><span class=""highlight-nb"">byte</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">luaString</span><span class=""highlight-p"">),</span> <span class=""highlight-mo"">0755</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">msg</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">fmt</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sprintf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""创建pandoc过滤器lua文件失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">return</span> <span class=""highlight-nx"">errors</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">New</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">defer</span> <span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">RemoveAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">luaPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-s"">\""/\""</span><span class=""highlight-p"">]</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">baseTargetPath</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">succeed</span> <span class=""highlight-o"">:=</span> <span class=""highlight-mi"">0</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">:=</span> <span class=""highlight-mi"">0</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">incomplete</span> <span class=""highlight-o"">:=</span> <span class=""highlight-mi"">0</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">for</span> <span class=""highlight-nx"">wizrows</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Next</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 清理资源
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">RemoveAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">importTrees</span> <span class=""highlight-p"">=</span> <span class=""highlight-p"">[]</span><span class=""highlight-o"">*</span><span class=""highlight-nx"">parse</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Tree</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">searchLinks</span> <span class=""highlight-p"">=</span> <span class=""highlight-kd"">map</span><span class=""highlight-p"">[</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">]</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">wizrows</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Scan</span><span class=""highlight-p"">(</span><span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentGuid</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentTitle</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentName</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentUrl</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentType</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentFileType</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DtCreated</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DtModified</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DtAccessed</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">DocumentAttachmentCount</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">msg</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">fmt</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sprintf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""读取为知数据库失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">return</span> <span class=""highlight-nx"">errors</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">New</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 构造targetPaths哈希表，键为文件夹的相对路径，值为思源笔记树形结构中的绝对路径 &amp; 创建文件夹
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-nx"">DocumentLocation</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Dir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">targetPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-s"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">importTrees</span> <span class=""highlight-p"">=</span> <span class=""highlight-p"">[]</span><span class=""highlight-o"">*</span><span class=""highlight-nx"">parse</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Tree</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-c1"">// 生成当前文档父级路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>			<span class=""highlight-nx"">DocumentPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">DocumentLocation</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">for</span> <span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">targetPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nf"">wizDate</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DtCreated</span><span class=""highlight-p"">)</span><span class=""highlight-o"">+</span><span class=""highlight-s"">\""-\""</span><span class=""highlight-o"">+</span><span class=""highlight-nf"">randStr</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">7</span><span class=""highlight-p"">),</span> <span class=""highlight-nx"">targetPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">DocumentPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Dir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">targetPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">TrimSuffix</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">],</span> <span class=""highlight-s"">\"".sy\""</span><span class=""highlight-p"">),</span> <span class=""highlight-nx"">targetPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-c1"">// 递归生成每级父级路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>			<span class=""highlight-nx"">DocumentPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">DocumentLocation</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">for</span> <span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">]</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">targetPath</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\"".sy\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-c1"">// 构造文件夹树
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>				<span class=""highlight-nx"">tree</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">treenode</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">NewTree</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">boxID</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">],</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">baseHPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">),</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Base</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">importTrees</span> <span class=""highlight-p"">=</span> <span class=""highlight-nb"">append</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">importTrees</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">tree</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">DocumentPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Dir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DocumentPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">targetPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Dir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">targetPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">wizColumn</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">wizNote</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentTitle</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">PushEndlessProgress</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">fmt</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sprintf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""正在导入为知笔记[%d/%d]，成功[%d]失败[%d]：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizColumn</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizCount</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">succeed</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">failed</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 解压单篇为知笔记文件
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-nx"">wizDocument</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">localPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentName</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Zip</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Unzip</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">wizDocument</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""解压笔记[%s]错误：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">continue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">data</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ReadFile</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""index.html\""</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""读取笔记[%s]html文件失败： %s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">continue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 将data转换为utf8编码
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-nx"">data</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">io</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ReadAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">transform</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">NewReader</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">bytes</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">NewReader</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span> <span class=""highlight-nx"">unicode</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">UTF16</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unicode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">LittleEndian</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">unicode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">UseBOM</span><span class=""highlight-p"">).</span><span class=""highlight-nf"">NewDecoder</span><span class=""highlight-p"">()))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""解码笔记[%s]失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">continue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 根据笔记类型DocumentType值按条件处理笔记内容
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">DocumentType</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-o"">*</span><span class=""highlight-nx"">DocumentType</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""lite/markdown\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">markdown</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">regexp</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">MustCompile</span><span class=""highlight-p"">(</span><span class=""highlight-s"">`(?i)(?s)&lt;pre&gt;(.*?)&lt;/pre&gt;`</span><span class=""highlight-p"">).</span><span class=""highlight-nf"">FindStringSubmatch</span><span class=""highlight-p"">(</span><span class=""highlight-nb"">string</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nb"">len</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markdown</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">&gt;</span> <span class=""highlight-mi"">1</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">markdown</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">args</span> <span class=""highlight-o"">:=</span> <span class=""highlight-p"">[]</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-s"">\""-f\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""html+tex_math_dollars\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-s"">\""-t\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""gfm-raw_html\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-s"">\""-L\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">luaPath</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-cm"">/*\""-o\"", markdownPath, // 注释此行输出到标准输出*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-s"">\""--wrap=none\""</span><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">pandoc</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">exec</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Command</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">Conf</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Export</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">PandocBin</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">args</span><span class=""highlight-o"">...</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">CmdAttr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">pandoc</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">pandoc</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Stdin</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">bytes</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">NewBuffer</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">output</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">pandoc</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Output</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""转换笔记[%s]格式失败:%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">continue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nb"">string</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">output</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">TrimSpace</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markdownStr</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 修改带附件笔记
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">DocumentAttachmentCount</span> <span class=""highlight-p"">&gt;</span> <span class=""highlight-mi"">0</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">attachmentDir</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Replace</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DocumentName</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\"".ziw\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""_Attachments\""</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">File</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">CopyDir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">localPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attachmentDir</span><span class=""highlight-p"">),</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attachmentDir</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""复制笔记[%s]附件失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">incomplete</span> <span class=""highlight-p"">=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-c1"">// 处理插入文档的附件
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>			<span class=""highlight-nx"">attachmentSrc</span> <span class=""highlight-o"">:=</span> <span class=""highlight-s"">`wiz://open_attachment\\?guid=[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}`</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">SrcIndex</span> <span class=""highlight-o"">:=</span> <span class=""highlight-p"">[]</span><span class=""highlight-kt"">int</span><span class=""highlight-p"">{</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">attachmentName</span> <span class=""highlight-o"">:=</span> <span class=""highlight-s"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">for</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">SrcIndex</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">regexp</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">MustCompile</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">attachmentSrc</span><span class=""highlight-p"">).</span><span class=""highlight-nf"">FindStringIndex</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markdownStr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">SrcIndex</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">]:])</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nx"">SrcIndex</span> <span class=""highlight-o"">==</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-k"">break</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">guid</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">markdownStr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">SrcIndex</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">]</span><span class=""highlight-o"">+</span><span class=""highlight-nb"">len</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""wiz://open_attachment?guid=\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">:</span> <span class=""highlight-nx"">SrcIndex</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">]]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">attachmentRow</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">wizdb</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Query</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""SELECT ATTACHMENT_NAME FROM WIZ_DOCUMENT_ATTACHMENT WHERE ATTACHMENT_GUID = ?\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">guid</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""查询笔记[%s]附件名称失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">incomplete</span> <span class=""highlight-p"">=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-k"">if</span> <span class=""highlight-nx"">attachmentRow</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Next</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">attachmentRow</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Scan</span><span class=""highlight-p"">(</span><span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">attachmentName</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">							<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""读取笔记[%s]附件名称失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">							<span class=""highlight-nx"">incomplete</span> <span class=""highlight-p"">=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">							<span class=""highlight-nx"">attachmentSrc</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">attachmentDir</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attachmentName</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">							<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">markdownStr</span><span class=""highlight-p"">[:</span><span class=""highlight-nx"">SrcIndex</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">]]</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">attachmentSrc</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">markdownStr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">SrcIndex</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">]:]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">attachmentRow</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Close</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-c1"">// 将附件附在笔记最后
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>			<span class=""highlight-nx"">attachments</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ReadDir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attachmentDir</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""读取笔记[%s]附件文件夹失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">incomplete</span> <span class=""highlight-p"">=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nb"">len</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">attachments</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">&gt;</span> <span class=""highlight-mi"">0</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">markdownStr</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""\\n---\\n\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""# 附件：\\n\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-k"">for</span> <span class=""highlight-nx"">_</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attachment</span> <span class=""highlight-o"">:=</span> <span class=""highlight-k"">range</span> <span class=""highlight-nx"">attachments</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">markdownStr</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""[\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">attachment</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Name</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""]\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""(\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">attachmentDir</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attachment</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Name</span><span class=""highlight-p"">())</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\"")\\n\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">markdownStr</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""---\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 处理带tag的笔记
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">tagName</span> <span class=""highlight-kt"">string</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">tag</span> <span class=""highlight-kt"">string</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tagRow</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">wizdb</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Query</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""SELECT t2.TAG_NAME FROM WIZ_DOCUMENT_TAG AS t1 JOIN WIZ_TAG AS t2 ON t1.TAG_GUID = t2.TAG_GUID WHERE DOCUMENT_GUID = ?\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentGuid</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""查询笔记[%s]tag失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">incomplete</span> <span class=""highlight-p"">=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">for</span> <span class=""highlight-nx"">tagRow</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Next</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">tagRow</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Scan</span><span class=""highlight-p"">(</span><span class=""highlight-o"">&amp;</span><span class=""highlight-nx"">tagName</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""读取笔记[%s]tag信息失败： %s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">incomplete</span> <span class=""highlight-p"">=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nx"">tagName</span> <span class=""highlight-o"">!=</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">tag</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">tag</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""#\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">tagName</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""#\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\"" \""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">tagRow</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Close</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">tag</span> <span class=""highlight-o"">!=</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-s"">\""---\\n标签：\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">tag</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""\\n---\\n\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">markdownStr</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 修改剪藏笔记，如果DocumentUrl指向的值以http开头，则在笔记前添加剪藏信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-k"">if</span> <span class=""highlight-nx"">DocumentUrl</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">HasPrefix</span><span class=""highlight-p"">(</span><span class=""highlight-o"">*</span><span class=""highlight-nx"">DocumentUrl</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""http\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">clipInfo</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">fmt</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sprintf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""---\\n\\n* 使用为知笔记剪藏自：\\n* [%s](%s)\\n* %s\\n\\n---\\n\""</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">*</span><span class=""highlight-nx"">DocumentUrl</span><span class=""highlight-p"">,</span> <span class=""highlight-o"">*</span><span class=""highlight-nx"">DocumentUrl</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DtCreated</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">markdownStr</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">clipInfo</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">markdownStr</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 创建语法树
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-nx"">tree</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">parseStdMd</span><span class=""highlight-p"">([]</span><span class=""highlight-nb"">byte</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markdownStr</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">==</span> <span class=""highlight-nx"">tree</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""解析笔记[%s]MD文件失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">continue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">id</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">wizDate</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DtCreated</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">+</span> <span class=""highlight-s"">\""-\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nf"">randStr</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">7</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">targetPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ReplaceAll</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">targetPaths</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">],</span> <span class=""highlight-nx"">id</span><span class=""highlight-o"">+</span><span class=""highlight-s"">\"".sy\""</span><span class=""highlight-p"">)),</span> <span class=""highlight-s"">\"".sy/\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""/\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ID</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">id</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ID</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">id</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">SetIALAttr</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""id\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ID</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">SetIALAttr</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""title\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentTitle</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">SetIALAttr</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""updated\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nf"">wizDate</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">DtModified</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Box</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">boxID</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Path</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">targetPath</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">HPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">baseHPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentLocation</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">DocumentTitle</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Spec</span> <span class=""highlight-p"">=</span> <span class=""highlight-s"">\""1\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">boxLocalPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">DataDir</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">boxID</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">docDirLocalPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Dir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">boxLocalPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">targetPath</span><span class=""highlight-p"">))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">assetDirPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">getAssetsDir</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">boxLocalPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">docDirLocalPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">assetName</span> <span class=""highlight-o"">:=</span> <span class=""highlight-kd"">map</span><span class=""highlight-p"">[</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">]</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Walk</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">tree</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Root</span><span class=""highlight-p"">,</span> <span class=""highlight-kd"">func</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">n</span> <span class=""highlight-o"">*</span><span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Node</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">entering</span> <span class=""highlight-kt"">bool</span><span class=""highlight-p"">)</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkStatus</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-p"">!</span><span class=""highlight-nx"">entering</span> <span class=""highlight-o"">||</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">NodeLinkDest</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Type</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-p"">!</span><span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">IsTextMarkType</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""a\""</span><span class=""highlight-p"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">return</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkContinue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">dest</span> <span class=""highlight-kt"">string</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">NodeLinkDest</span> <span class=""highlight-o"">==</span> <span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Type</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">dest</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">TokensStr</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">dest</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">TextMarkAHref</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">HasPrefix</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""data:image\""</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Contains</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\"";base64,\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nf"">processBase64Img</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">n</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">dest</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">assetDirPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">return</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkContinue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">dest</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ReplaceAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""%20\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\"" \""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">dest</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ReplaceAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""%5C\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\""/\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">NodeLinkDest</span> <span class=""highlight-o"">==</span> <span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Type</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Tokens</span> <span class=""highlight-p"">=</span> <span class=""highlight-p"">[]</span><span class=""highlight-nb"">byte</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">TextMarkAHref</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">dest</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-p"">!</span><span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">IsRelativePath</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">return</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkContinue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">dest</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">ToSlash</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">dest</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">return</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkContinue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">absolutePath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">dest</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">exist</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">File</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">IsExist</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-p"">!</span><span class=""highlight-nx"">exist</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">absolutePath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nb"">string</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">html</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">DecodeDestination</span><span class=""highlight-p"">([]</span><span class=""highlight-nb"">byte</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">dest</span><span class=""highlight-p"">))))</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">exist</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">File</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">IsExist</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">if</span> <span class=""highlight-nx"">exist</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-c1"">// 去重复制
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>				<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">name</span> <span class=""highlight-kt"">string</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nx"">assetName</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">==</span> <span class=""highlight-s"">\""\""</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">name</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Base</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">name</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">AssetName</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">assetName</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">]</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">name</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">assetTargetPath</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">assetDirPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">filelock</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Copy</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">assetTargetPath</span><span class=""highlight-p"">);</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""复制笔记[%s]资源文件失败:%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">						<span class=""highlight-k"">return</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkContinue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">name</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">assetName</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">absolutePath</span><span class=""highlight-p"">]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">NodeLinkDest</span> <span class=""highlight-o"">==</span> <span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Type</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Tokens</span> <span class=""highlight-p"">=</span> <span class=""highlight-p"">[]</span><span class=""highlight-nb"">byte</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""assets/\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">n</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">TextMarkAHref</span> <span class=""highlight-p"">=</span> <span class=""highlight-s"">\""assets/\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">name</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">return</span> <span class=""highlight-nx"">ast</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">WalkContinue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">importTrees</span> <span class=""highlight-p"">=</span> <span class=""highlight-nb"">append</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">importTrees</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">tree</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 写入笔记
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-k"">if</span> <span class=""highlight-mi"">0</span> <span class=""highlight-p"">&lt;</span> <span class=""highlight-nb"">len</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">importTrees</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nf"">initSearchLinks</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nf"">convertWikiLinksAndTags</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nf"">buildBlockRefInText</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">for</span> <span class=""highlight-nx"">_</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">tree</span> <span class=""highlight-o"">:=</span> <span class=""highlight-k"">range</span> <span class=""highlight-nx"">importTrees</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nf"">indexWriteTreeIndexQueue</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">tree</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""写入笔记[%s]文件失败：%s\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wizNote</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">					<span class=""highlight-k"">continue</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">succeed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-mi"">1</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">failed</span> <span class=""highlight-o"">+=</span> <span class=""highlight-nx"">incomplete</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-c1"">// 清理资源
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>		<span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">RemoveAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">importTrees</span> <span class=""highlight-p"">=</span> <span class=""highlight-p"">[]</span><span class=""highlight-o"">*</span><span class=""highlight-nx"">parse</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Tree</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">searchLinks</span> <span class=""highlight-p"">=</span> <span class=""highlight-kd"">map</span><span class=""highlight-p"">[</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">]</span><span class=""highlight-kt"">string</span><span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">gulu</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">File</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">IsExist</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">os</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">RemoveAll</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">unzipPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nf"">IncSync</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">debug</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">FreeOSMemory</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">failed</span> <span class=""highlight-o"">==</span> <span class=""highlight-mi"">0</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">PushMsg</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">fmt</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sprintf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""成功导入所有有效为知笔记，共%d条。\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">succeed</span><span class=""highlight-p"">),</span> <span class=""highlight-mi"">15000</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-nx"">fmt</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Errorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""成功导入有效为知笔记%d条，失败%d条,详情请查看日志。\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">succeed</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">failed</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">return</span> <span class=""highlight-kc"">nil</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>添加转换为知笔记数据库中时间元数据为思源笔记时间格式的函数：</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 魔改，转换为知笔记中的时间变量
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kd"">func</span> <span class=""highlight-nf"">wizDate</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">wiz_time</span> <span class=""highlight-kt"">string</span><span class=""highlight-p"">)</span> <span class=""highlight-kt"">string</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">t</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">time</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Parse</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""2006-01-02 15:04:05\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">wiz_time</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-nx"">err</span> <span class=""highlight-o"">==</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-nx"">t</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Format</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""20060102150405\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-nx"">time</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Now</span><span class=""highlight-p"">().</span><span class=""highlight-nf"">Format</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""20060102150405\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>在功能函数 <code>func ImportFromLocalPath(boxID, localPath string, toPath string) (err error)</code> 中的</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-kd"">var</span> <span class=""highlight-nx"">baseHPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">baseTargetPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">boxLocalPath</span> <span class=""highlight-kt"">string</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-s"">\""/\""</span> <span class=""highlight-o"">==</span> <span class=""highlight-nx"">toPath</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">baseHPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-s"">\""/\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">baseTargetPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-s"">\""/\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">block</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">treenode</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">GetBlockTreeRootByPath</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">boxID</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">toPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">==</span> <span class=""highlight-nx"">block</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nx"">logging</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">LogErrorf</span><span class=""highlight-p"">(</span><span class=""highlight-s"">\""not found block by path [%s]\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">toPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-k"">return</span> <span class=""highlight-kc"">nil</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">baseHPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">HPath</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nx"">baseTargetPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">strings</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">TrimSuffix</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Path</span><span class=""highlight-p"">,</span> <span class=""highlight-s"">\"".sy\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nx"">boxLocalPath</span> <span class=""highlight-p"">=</span> <span class=""highlight-nx"">filepath</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Join</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">util</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">DataDir</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">boxID</span><span class=""highlight-p"">)</span>
</span></span></code></pre>
<p>下方插入</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-c1"">// 魔改：导入为知笔记
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>	<span class=""highlight-nx"">err</span> <span class=""highlight-p"">=</span> <span class=""highlight-nf"">ImportFromWiz</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">boxID</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">localPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">baseHPath</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">baseTargetPath</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">if</span> <span class=""highlight-kc"">nil</span> <span class=""highlight-o"">!=</span> <span class=""highlight-nx"">err</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-k"">return</span> <span class=""highlight-nx"">err</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}</span>
</span></span></code></pre>
<h2 id=""4-后话"">4、后话</h2>
<p>迁移方案中使用 <code>Pandoc</code> 转换笔记格式，如果对转换效果不满意，可以手动创建 lua 过滤器 <code>pandoc_script.lua</code>，位于思源笔记数据文件夹的 <code>temp</code> 文件夹下，魔改核心不会修改和删除它。</p>
<h2 id=""参考"">参考</h2>
<p>Github 思源笔记</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Ftree%2Fmaster"" target=""_blank"" rel=""nofollow ugc"">siyuan-note/siyuan: A privacy-first, self-hosted, fully open source personal knowledge management software, written in typescript and golang. (github.com)</a></p>
<p>Pandoc 参考手册</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.pandoc.org%2FMANUAL.html"" target=""_blank"" rel=""nofollow ugc"">Pandoc - Pandoc User’s Guide</a></p>
<p>Pandoc lua 过滤器参考手册</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.pandoc.org%2Flua-filters.html"" target=""_blank"" rel=""nofollow ugc"">Pandoc - Pandoc Lua Filters</a></p>
<p>ChatGPT</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fchatgpt.com%2F"" target=""_blank"" rel=""nofollow ugc"">ChatGPT</a></p>
<p>通义千问</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Ftongyi.aliyun.com%2Fqianwen%2F"" target=""_blank"" rel=""nofollow ugc"">通义 (aliyun.com)</a></p>
                

作者：gama
链接：https://ld246.com/article/1721202208224
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",gama,思源笔记,链滴优选
689,Callout 插件更新 v1.2.0：支持快速插入指定模式的 Callout - 链滴,Sat Jul 13 2024 20:27:47 GMT+0000 (Coordinated Universal Time),"
                    <p>在之前的更新中，支持了两种 callout 模式标题：模式（大字）段落模式（小字）。</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-WHsZCFd.png?imageView2/2/interlace/1/format/webp""></p>
<p>但是如果想要同时使用，还是不太方便。</p>
<p>v1.2.0 版本更新后，用户可以在在每个 Callout 编辑面板中单独配置 <code>/</code> 命令。</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-GPXZkAG.png?imageView2/2/interlace/1/format/webp""></p>
<p>之后在编辑器中，用户通过 <code>/</code> 命令可以插入至多三种模式的 callout。（默认，标题、段落）</p>
<p><img src=""https://b3logfile.com/file/2024/07/callout-ov86ND1.gif""></p>
<p>另外由于思源的集市经常加载不出来图片，还额外做了一份<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fflowus.cn%2Fshare%2Fe1961b24-8bf9-4d2f-9ca4-794d81824524%3Fcode%3D80RAFK"" target=""_blank"" rel=""nofollow ugc"">线上文档</a>，可以在 README 中点击链接跳转过去。</p>
                

作者：Frostime
链接：https://ld246.com/article/1720873667601
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
690,【插件开发者请注意】你的插件可能“意外”地无法在 docker 中运行 - 链滴,Thu Jul 11 2024 01:12:48 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>插件在 docker 上用不了，可能有我的一份锅……</p>
</blockquote>
<p>我刚刚看社区帖子的时候，看到有人提到插件对 docker 的适配问题的时候，突然意识到了一个严重的问题。</p>
<p><a href=""https://ld246.com/article/1720535976986"">能不能直接把思源部署在阿里云上访问？</a></p>
<p><img src=""https://b3logfile.com/file/2024/07/image-oKiuT2t.png?imageView2/2/interlace/1/format/webp""></p>
<p>目前插件是否能在 docker 当中运行，主要是靠声明 json 文件中 backend 和 frontend 字段。</p>
<p>一般来说，插件作者选择不在 docker 当中运行插件，<strong>最主要的技术原因</strong>可能是插件需要依赖一些 electron 特供、而在浏览器环境下无法使用的 API。</p>
<p>但是我刚刚发现，可能有些插件是<strong>意料之外地无法在 Docker 当中运行</strong>。</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-N6ykAGZ.png?imageView2/2/interlace/1/format/webp""></p>
<p>原因是：目前无论是 V 维护的 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fplugin-sample"" target=""_blank"" rel=""nofollow ugc"">plugin-sample</a> 还是我维护的两个模板 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Ffrostime%2Fplugin-sample-vite"" target=""_blank"" rel=""nofollow ugc"">plugin-sample-vite</a> 和 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fplugin-sample-vite-svelte"" target=""_blank"" rel=""nofollow ugc"">plugin-sample-vite-svelte</a> 中提供的 Plugin.json 文件都不知道出于什么原因，在 backend 字段都缺少了 \""docker\""。</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-5lNC2VA.png?imageView2/2/interlace/1/format/webp""></p>
<p>这就意味着除非插件作者注意到这个问题并且修改，否则插件应该是默认无法在 docker 当中运行的。</p>
<p>目前我维护的两个模板已经修复这个问题了，官方模板也提了 issue 要求修复这个问题。</p>
<p>各位插件开发者：建议检查一下自己的插件声明，如果插件无需依赖桌面环境，建议把 docker 字段加上。</p>
                

作者：Frostime
链接：https://ld246.com/article/1720631568830
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
692,插件开发者注意：请更新 github action - 链滴,Thu Jul 04 2024 21:38:09 GMT+0000 (Coordinated Universal Time),"
                    <p>之前写插件的时候使用过插件的 vite-svelte 模板（或者纯 vite 模板）的人请注意。</p>
<p>此前写的自动 publish 的 github action 目前已经失效，会在安装阶段就暴毙。</p>
<p><img src=""https://b3logfile.com/file/2024/07/5404b75df5a6cc89cad32d0863d189e3-lBbiawT.png?imageView2/2/interlace/1/format/webp""></p>
<p>解决方法为把 action 文件中的 <code>uses: pnpm/action-setup@v2</code> 改成 <code>uses: pnpm/action-setup@v4</code>。</p>
<p><img src=""https://b3logfile.com/file/2024/07/image-A0jfom6.png?imageView2/2/interlace/1/format/webp""></p>
<p>详情请参考：<br>
<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fpnpm%2Faction-setup%2Fissues%2F136"" target=""_blank"" rel=""nofollow ugc"">Issue #136 · pnpm/action-setup</a></p>
                

作者：Frostime
链接：https://ld246.com/article/1720100289812
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
696,思源 Callout 插件 v1.0.0 发布，支持自定义样式 - 链滴,Sun Jun 02 2024 16:07:55 GMT+0000 (Coordinated Universal Time),"
                    <p>距离 callout 插件第一次发布也有半年了，这段时间刚好空闲多一点，把挖了好久的大坑实现了。</p>
<p>v1.0.0 版在原本的基础上大面积重构，支持了用户自定义功能。</p>
<ul>
<li>支持自定义 callout</li>
<li>支持编辑 callout 配置
<ul>
<li>Emoji Icon</li>
<li>内部配色</li>
</ul>
</li>
<li>支持拖放排序</li>
</ul>
<p>详情操作见 README 文档。</p>
<p><img src=""https://b3logfile.com/file/2024/06/image-mR0F89m.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/06/image-3XpNuHF.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/06/image-HgZyMyV.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/06/image-SK5b6C7.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：Frostime
链接：https://ld246.com/article/1717315676040
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
654,如何进行知识管理丨 MOC：面向主题地去管理笔记链接 - 链滴,Sun May 12 2024 00:55:22 GMT+0000 (Coordinated Universal Time),"
                    <p><img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/MOC面向主题地去管理笔记链接-20240512105740-xzkvbuo.png?imageView2/2/interlace/1/format/webp""></p>
<p>个人认为，双链笔记的核心<strong>并不在于双向链接</strong>，对我而言，我接触到双链笔记软件这 3 年以来的主要收获可以概括为两个点：</p>
<ul>
<li>一个是「<strong>笔记应该是渐进式的</strong>」，目前我觉得这个理念不仅仅应该应用在笔记上，也应该用在生活上——生活也应该是渐进式的，这个之后我会写一篇文章重点介绍我的收获。</li>
<li>另一个收获便是「<strong>面向主题地去管理笔记链接</strong>」，也就是本文章要介绍的笔记理念。</li>
</ul>
<p>「<strong>面向主题地去管理笔记链接</strong>」，这一方法在双链笔记圈常常被叫做 MOC，Map of Contents，直接翻译叫做内容地图，我更喜欢将其翻译为索引笔记、主题笔记。</p>
<p>MOC 是我目前强烈推荐的笔记管理方法，它有着传统笔记分类法、标签管理难以替代的优势。Markdown 笔记格式、OneNote 软件本身就支持管理笔记链接的方式来组织信息，在如今大热的新一代笔记软件——双链笔记软件中，MOC 的作用还得了大大加强，不仅仅能自上而下地管理笔记，还能代替标签进行自下而上的渐进式积累零碎笔记，是一个特别实用、好用的笔记管理方法，能很好地帮助自己搭建起个人的知识体系。</p>
<p>MOC 的核心理念是</p>
<ul>
<li>管理笔记链接而非本体</li>
<li>面向主题地组织信息</li>
<li>学以致用而不纸上谈兵</li>
</ul>
<h2 id=""MOC-的起源"">MOC 的起源</h2>
<p>MOC 这个名词据说最早是由程序员 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fx.com%2FLionKimbro%2Fmedia"" target=""_blank"" rel=""nofollow ugc"">Lion Kimbro</a> 在 2003 年写的《<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fusers.speakeasy.net%2F%7Elion%2Fnb%2Fbook.pdf"" target=""_blank"" rel=""nofollow ugc"">How to Make a Complete Map of Every Thought You Think</a>》一书中提出的。当时 2003 的他还在用活页笔记本维护纸质笔记系统。</p>
<p>而将 MOC 这一概念应用到电子笔记软件里并大力宣扬的人叫 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fx.com%2Fnickmilo%3Flang%3Dzh"" target=""_blank"" rel=""nofollow ugc"">Nick Milo</a>，他是 Obsidian 社区的大神。在他的文章《<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fnotes.linkingyourthinking.com%2FCards%2FWhat%2Bare%2Bhigher-order%2Bnotes"" target=""_blank"" rel=""nofollow ugc"">What can we call higher-order notes?</a>》，将 MOC 认为是高阶笔记，认为它灵活，能满足收集、概述、结构化、导航等笔记目的，还方便链接知识、重塑想法和构建新想法。之后 MOC 这一管理笔记的理念被越来越多人了解并推崇。</p>
<blockquote>
<p><strong>MOC (Map of Content)</strong>  -A flexible higher-order note that serves all the above purposes of gathering, outlining, structuring, and navigating. In addition, it is an active thinking tool that allows for the reshaping, connecting, and building of ideas</p>
<p>——Nick Milo <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fnotes.linkingyourthinking.com%2FCards%2FWhat%2Bare%2Bhigher-order%2Bnotes"" target=""_blank"" rel=""nofollow ugc"">《What can we call higher-order notes?》</a> 2020-06-28</p>
</blockquote>
<p>而本篇文章提到的 MOC 管理笔记方法，融合了 INKP 笔记法、PARA 信息管理系统的理念，已经是个人“改编过”的笔记方法理念了，欢迎其他小伙伴提出意见，交流讨论。</p>
<h2 id=""文件夹和标签管理笔记的弊端"">文件夹和标签管理笔记的弊端</h2>
<p>用文件夹和标签费心维护一个精致复杂的笔记系统其实是费力不讨好的，下面会介绍文件夹和标签管理笔记的弊端。</p>
<h3 id=""文件夹"">文件夹</h3>
<p>传统的笔记方法喜欢用文件夹进行笔记分类，文件夹分类非常简单，只需要建立一个文件夹，然后将笔记丢进去。这和用 Windows 电脑的资源管理器管理文件、用代码编辑器管理代码项目体验很一致。</p>
<p>文件夹分类需要遵循严格的层次结构，文件夹分类的最大弊端就在于此，<strong>一篇笔记只能放在一个分类下。</strong> 如果希望一篇笔记出现在多个分类文件夹下，只能复制出这篇笔记的副本，放到其他分类下，但这时候这些「克隆笔记」的内容如何同步就又是一个问题了。此外，一个文件夹也只能放在另一个文件夹下。这就造成了单纯只用文件夹分类，会导致<strong>过去的笔记难以复用</strong>，<strong>很容易创建重复的笔记</strong>，不断造轮子。</p>
<p><img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/image-20240511002803-wbt2q85.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""标签"">标签</h3>
<p>后来，很多笔记软件开始加入标签这个功能，一篇笔记可以打上多个不同的标签，终于能实现一篇笔记进行多分类了，还可以对标签进行 AND、OR、NOT 等高级联合查询笔记，但标签依然存在很大的问题：</p>
<ul>
<li><strong>标签的管理笔记问题。</strong> 大部分笔记软件的标签功能<strong>其实并没有整理功能</strong>，可能只有简单的按时间排序功能，一个标签里的笔记只能在一个维度上堆积。标签在整理汇总功能上，甚至还不如文件夹（文件夹起码还可以对笔记进行自定义排序）。在某种意义上，<strong>标签更像是一个快捷搜索的功能，一个汇集想法的功能，而不是分类归档功能</strong>。</li>
<li><strong>创建多个重复标签的问题。</strong> 随着笔记越来越多，标签越来越多，管理标签也会变得非常头疼。因为标签的创建可能非常随意，可能重复创建一个标签，以不同的命名形式存在，比如 <code>#神经科学</code>​，<code>#脑科学</code>​、<code>#神经生物学</code>​，如何把这些重复标签合并，将相关的文档聚合在一起呢？虽然一些笔记软件可以标签合并，但是本质问题没有解决，<strong>我还是会创建重复标签，那过一段时间就需要合并标签</strong>，除非我能牢固记住所有的标签命名。</li>
<li><strong>标签依然存在无法多分类的问题。</strong> 为了管理众多标签，很多笔记软件支持通过父子标签来管理标签，然而，<strong>父子标签的这种分类其实也只是单分类，过去使用文件夹单分类的问题，在另一个维度——管理标签上又出现了</strong>：这就意味着你创建一个 <code>#睡眠</code>​ 的标签，收集了很多笔记，你之前将其放在 <code>#神经科学</code>​ 这个标签下，现在你又创建了一个 <code>#健康</code>​ 标签，如何把 <code>#睡眠</code>​ 这个标签同时放在 <code>#神经科学</code>​ 标签和 <code>#健康</code>​ 标签里就是一个问题。只能把之前整理的那些睡眠笔记，合并成一篇《睡眠》笔记，然后打上 <code>#神经科学</code>​ 标签和 <code>#健康</code>​ 标签。这也就是说，<strong>当标签完成它的汇聚信息功能之后，这个标签的功能就丧失了，就应该转化为文档了，否则你难以对这个标签本身进行多分类</strong>。就如一个文件夹下的所有笔记不方便出现在其他文件夹里一样</li>
<li><strong>标签管理笔记的复用问题。</strong> 标签管理的笔记最好是模块化的卡片笔记，标签本身适合是一个比较广泛的主题，比如 <code>#个人碎碎念</code>​、<code>#神经科学</code>​，因为永远也没有汇集完的一天，也不太需要整理为一个文档（正如前面所说的标签多分类问题）。但是标签尽管能对卡片笔记进行多分类，并不意味着它就可以很好的为笔记进行服务了，比如你记了一篇关于《熬夜危害》的笔记，为一个卡片笔记打上 <code>#神经科学</code>​、<code>#睡眠</code>​、<code>#生活百科</code>​、<code>#健康</code>​等标签，<strong>并不意味着这篇笔记可以被复用</strong>，更多情况是<strong>你打的标签可能更多是起美观、总结出关键词的作用。</strong> 以后想要用到这篇《熬夜危害》的笔记，要么在一个个标签里下滑寻找，要么使用搜索功能，这和文件夹体系其实没什么太大区别。</li>
<li><strong>标签体系与双链功能。</strong> 标签体系如果加入双链功能，就可以用 <code>[[</code>​快速搜索找到符合的笔记进行引用了，然而一旦加了双链功能后，双链就可以替代标签了，又何必再用标签呢？毕竟标签对笔记的多分类、信息汇聚功能，使用双链也能做到，甚至需要的信息汇聚之后，直接在双链文档就能进行整理了，而不像标签只是一个标签，无法整理标签内的信息。其实<strong>标签就是这么一个矛盾的功能，很鸡肋，食之无味弃之可惜</strong>。</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/image-20240511005134-i8sjf0y.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""由管理文件和写代码获得的启示"">由管理文件和写代码获得的启示</h2>
<p>用文件夹管理笔记，存在的主要问题在于笔记只能属于一个分类，而且层次结构一旦过深，处于深层结构的笔记就容易被遗忘。我们可以先看看 Windows 电脑的资源管理器管理文件和程序员写代码项目是怎么解决用文件夹管理文件的这些问题的：</p>
<ul>
<li>Windows 电脑的资源管理器管理文件，如果遇到一个文件需要出现在多个文件夹的需求，可以用「<strong>快捷方式」</strong> 创建一个指向该文件的链接，使得这个文件可以在多个文件夹里出现。同时为了避免层级深的文件被遗忘、将常用的文件夹放在更方便的位置，也可以用快捷方式将文件放在桌面或者其他地方，同时 Windows 电脑的资源管理器还有「<strong>快捷访问</strong>」的功能，能将常用文件夹置顶。</li>
<li>程序员写代码项目常常会有一个 main 文件（或者 run 文件、index 文件），main 文件执行主要的程序功能，而 main 文件的文件一般比较简洁，<strong>可以自上而下地把所需要的代码功能的逻辑先大致写出来，不考虑具体实现，写完大概逻辑之后再具体一个个实现这些功能。</strong> 这些功能代码存放的文件夹层级可以很深，但通过 main 文件里的代码链接我就可以跳转到对应的功能代码，所以层级很深也无所谓，或者把所有功能代码都放在一个叫 <code>utils</code>​ 的文件夹里也可以。程序员喜欢会将一个重复使用的功能封装为模块，这样其他代码需要的时候就可以直接调用，不需要重复写一样的代码，后面要改代码还需要一个个修改。而要调用模块的代码，只需要声明这个模块的位置在哪里就可以了。</li>
</ul>
<p>从 Windows 电脑的资源管理器管理文件和程序员写代码项目这两个例子来看，我们可以有如下感悟</p>
<ul>
<li>可以用链接的方式管理笔记，使得<strong>一篇笔记可以出现在多个地方</strong>。写了一篇《多巴胺》笔记，可以把这个笔记的链接放在《神经科学》这篇笔记下面，也可以放在《神经递质》笔记下面，还可以放在《帕金森病》、《手机上瘾》等笔记下面。</li>
<li>用链接的方式可以根据需要对笔记的链接进行<strong>随意排序、分类</strong>，<strong>可以忽略这篇笔记的实际存放位置、根据需要决定这篇笔记的展示位置。</strong> 笔记本体可以按照原来的层级分类存放，也可以全部放在一个文件夹里不分层级，更加省心 <strong>。</strong></li>
<li>笔记可以像写代码一样，<strong>尽量模块化</strong>，笔记模块化后不仅仅能在未来需要用的时候省力，写作时就是组装各种模块，还有助于知识的复利积累。比如一篇《多巴胺》笔记，其他笔记涉及到多巴胺这个名词的段落，在思源笔记里就可以建立双向链接关系，这样既可以回顾《多巴胺》这篇笔记，又可以补充《多巴胺》这篇笔记的信息，比如你在《为什么刷手机会上瘾》这篇笔记中，发现多巴胺原来正是驱动你不断刷手机的元凶之一，你发现原来多巴胺并不给予快乐，只是给你欲望和动力，《为什么刷手机会上瘾》引用《多巴胺》笔记之后，以后再看《多巴胺》这篇笔记和它的反向链接，就可以回顾起这些知识点了。通过不断的完善，《多巴胺》这篇笔记就会越来越完善，会涉及越来越多的领域，变成自己的知识财富。</li>
</ul>
<p>以上的感悟，其实很大程度上就是 MOC 的核心理念了——管理链接而非本体、面向主题组织信息。</p>
<p>接下来就正式介绍 MOC 笔记方法了。</p>
<h2 id=""MOC-管理链接而非本体"">MOC：管理链接而非本体</h2>
<p><strong>MOC 推崇管理笔记的索引链接而非笔记本体。</strong> 可以根据需要让笔记的链接随意出现在不同的笔记里，很轻松地进行笔记复用，让过去记的笔记能在不同的主题笔记下发挥不同作用，一篇概念笔记可以属于多篇主题笔记，一篇主题笔记管理着众多概念笔记，一篇主题笔记又可以出现在其他的主题笔记里，笔记之间可以彼此嵌套引用，这有利于知识的持续性积累，形成自己的知识网络！</p>
<h3 id=""使用MOC的前提"">使用 MOC 的前提</h3>
<p>需要笔记软件支持提供笔记链接才行，比如老大哥「OneNote」，新型双链本地笔记软件「思源笔记」和「Obsidian」 等，就能很好支持 MOC 来管理笔记。</p>
<p>Markdown 其实天生就支持 MOC，使用 Markdown 的链接支持跳转文件， 只是缺少双链，少了将 MOC 当做标签的自下而上积累的功能。这样看来，其实用 Word 也能链接文件，实现 MOC，就是不太便捷。</p>
<p>一般云笔记也支持提供笔记链接，但是需要考虑引用笔记的便捷程度、笔记路径更改路径不失效、内链标题是否支持自动更新、新建文档能否指定路径等问题。</p>
<p>我目前的主力笔记软件是「<strong>思源笔记</strong>」，本篇文章中将以思源笔记为例介绍如何使用 MOC 管理笔记搭建个人知识体系。</p>
<p>思源笔记主要有如下创建笔记链接的方式：</p>
<ul>
<li>
<p>可以在文档树选中文档右键进行复制块引用或者在打开的文档的页签右键进行复制块引用</p>
<p>​<img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/Clip_2024-05-25_17-45-44-20240525174551-iub1ahb.png?imageView2/2/interlace/1/format/webp""></p>
<p>​<img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/Clip_2024-05-25_17-46-02-20240525174606-771ke3v.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>​<code>[[+输入文字</code>​，或是选中一段文字后输入 <code>Alt+[</code>​，检索引用已有笔记或者直接创建新笔记，并建立链接。</p>
<p>​<img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/Clip_2024-05-25_17-46-51-20240525174653-it6yo9o.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id=""怎么管理笔记链接"">怎么<strong>管理笔记链接</strong></h3>
<p>在思源笔记里要使用 MOC，很简单，你需要定一个目前你感兴趣的主题，可以与你的专业有关，也可以是你自己的兴趣爱好，比如可以一个是大主题《神经科学》，也可以是小主题《熬夜的危害》，这个主题向的笔记，我称之为「<strong>主题笔记</strong>」，主题既可以是纯知识型的笔记，也可以是实践型的项目笔记，主题笔记起统筹主题下所有信息的作用。然后在主题笔记下通过块引来引用或新建相关的笔记，与主题相关的笔记，我喜欢称之为「<strong>概念笔记」，</strong> 概念笔记的理念类似于卡片笔记，卡片笔记侧重将一个名词模块化，解释清楚，便于复用，但概念笔记并仅仅停留在卡片，如果一篇概念笔记的内容已经积累太多了，是可以直接升级为主题笔记进行拆解和内容补充的。主题笔记和概念笔记的想法参考了 L 先生的 INKP 笔记法，在他的《打开心智》一书中有具体阐述。</p>
<p>管理链接的形式主要有下面几种：</p>
<ul>
<li>列表型 MOC</li>
<li>表格型 MOC</li>
<li>数据库型 MOC</li>
<li>白板型 MOC</li>
</ul>
<p>我会以《神经科学》这个主题笔记为例，介绍自己是怎么在思源笔记里使用 MOC 收集和管理笔记的。</p>
<p>首先，我一般会给主题笔记的标题<strong>添加 @ 前缀</strong>，以区分概念笔记，并且添加 @ 前缀也有利于快速搜索，因为我搜“神经科学”可能会搜到其他概念笔记，而搜“@ 神经科学”就可以直接命中这篇主题笔记。并且我如果未来要搜索关于神经科学下的概念笔记，比如《神经科学经典教科书》这篇笔记直接搜索不到，也可以通过搜索《@ 神经科学》这篇主题笔记去寻找。</p>
<p>然后，我就会在《@ 神经科学》这篇主题笔记，存放所有关于神经科学的笔记。我最常用的管理链接的方式是列表，因为列表创建非常方便、可以轻松实现层级分类、层级折叠。</p>
<p>列表管理笔记索引的方式，可以单纯用列表管理这些索引，如果有些笔记暂时还没记录、还不了解、或者觉得很简单没必要升级为一篇笔记，可以单纯用文字记录、占位，之后有需要再块引新建文档（是的，<strong>我不会先在文档树找个位置新建文档</strong>，然后把笔记链接丢在主题笔记，而习惯直接在主题笔记通过「<strong>块引新建文档</strong>」直接新建文档）。例如：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[概念笔记1]]
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[概念笔记2]]
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[概念笔记3]]
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> 简单概念4
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> 待了解概念5
</span></span></code></pre>
<p>也可以在索引后添加内容概括，甚至添加引用关系。例如：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[方法1]] 通过方式 A 给出了解决方法。
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[方法2]] 从 B 的角度分析 [[方法1]] 的原理，并用 C 改进了方案，提高了方法的成功率。
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[方法3]] 用 [[理论7]] 降低了 [[方法1]] 的使用成本。
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[方法4]] 通过方式 D 给出的一种解决办法。
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[方法5]] 将 [[方法1]] 与 [[方法4]] 结合，继承了二者各自的优势。
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[文献6]] 对这些方法所试图解决的问题 I 进行了反思，提出在情况 E 下，这个问题可以用方式 F 直接规避，也就不需要解决了。
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> 注：问题 I 与 [[问题II]] 相关。
</span></span></code></pre>
<p>当主题笔记的记录变多时，可以对其下的内容进行更细致的分类。如果某一分类的内容足够多，也可以考虑将其独立为一个新的 MOC，并在原来的 MOC 里留下指向这个新 MOC 的链接。 例如：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> 类型 A
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> [[概念笔记1]] （概括）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> [[概念笔记2]] （概括）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> [[概念笔记3]] （概括）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> 概念7：（概括）
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> 类型 B
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> [[概念笔记4]]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> [[概念笔记5]] （概括）
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> 类型 C
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">-</span> [[概念笔记6]]
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [[类型 D]]
</span></span></code></pre>
<blockquote>
<p>备注：以上几个列表型 MOC 例子改编自：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F603647786"" target=""_blank"" rel=""nofollow ugc"">笔记系统：MOC（内容地图）的组织 - 知乎 (zhihu.com)</a></p>
</blockquote>
<p>实际例子：我收集了一些神经科学方面的教材，在这里我用了列表来管理笔记，一些已经读的书、在读的书，我还可以直接在 MOC 里添加一些网页资料。</p>
<p><img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/Clip_2024-05-11_22-54-07-20240511225409-wjv8hdc.png?imageView2/2/interlace/1/format/webp""></p>
<p>由于《神经系统组成》这个概念比较大、涉及的内容多，所以我将其升级为主题笔记（这里其实还是用列表型 MOC，只是用了主题自带的列表转导图功能）</p>
<p><img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/Clip_2024-05-11_23-16-47-20240511231649-hfconcy.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<p>用表格也能管理索引，不过由于思源笔记不少主题提供了列表转表格功能，再加上目前思源笔记有数据库功能，可以当成高级表格使用，我就比较少用表格了。下面是一个用表格管理链接的例子：</p>
<p><img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/Clip_2024-05-11_23-29-41-20240511232949-m7t1zcg.png?imageView2/2/interlace/1/format/webp""></p>
<p>而数据库这个功能在笔记管理上，除了可以当成高级表格使用外，思源笔记还有一个特色功能——「<strong>添加到数据库</strong>」，可以很轻松的将一个笔记放进<strong>多个数据库里</strong>，于是目前数据库又多了一个功能——<strong>收集零散的概念笔记</strong>，创建了一个笔记之后，可以暂时不着急去思考这篇笔记要放在主题笔记的哪个位置，可以用数据库先存放这些笔记，等时机恰当再进行整理（至于是用列表整理还是就用数据库整理根据自己的喜好）。数据库尤其适合整理名词概念类的笔记，零散杂乱，用列表整理其实挺头疼的，完全不知道该放在哪里，等列表长了，也不方便查看，用数据库整理就非常的适合。</p>
<p>「添加到数据库」功能很适合搭配渐进式笔记法，两者搭配将使得创建笔记更加无压，数据库从此变成一个类似标签的功能，我们可以快速新建一个文档，记完笔记，然后将这篇笔记添加到指定数据库，就完成了这篇笔记的记录和收集，而不用再寻找对应的主题笔记，思考这篇笔记要放在主题笔记的哪个位置。</p>
<p>​<img src=""https://b3logfile.com/file/2024/06/siyuan/1610205759005/assets/image-20240511233638-yeg0o4z.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>而至于白板型的 MOC，我暂时没有这个需求，就不多说了，可以用 Excalidraw 插件实现白板型 MOC，或者使用外部的白板软件管理思源笔记的块 Markdown 链接实现。</p>
<h3 id=""用MOC管理笔记的好处"">用 MOC <strong>管理笔记的好处</strong></h3>
<ul>
<li>
<p><strong>任意的笔记管理方式</strong>：管理链接不受制于一个软件的文件系统，只需要它能提供链接功能，我们就可以根据自己的需要设计我们管理笔记的方式。你可以新建一个文档，用字母排序、创建时间排序管理你需要的笔记，也可以按作者排序、按领域、按主题来管理任何笔记。并且这些管理方式可以共存，同时展现。并且除了简单的层级结构以外， 你可以采用更多维度的方式来展现索引，将深层结构平铺开来，比如用表格、思维导图甚至白板管理索引。</p>
</li>
<li>
<p><strong>更轻松的笔记分类方式</strong>：用链接的方式可以根据需要对笔记的链接进行分类，可以忽略这篇笔记的实际存放位置、根据需要决定这篇笔记的展示位置。笔记本体可以全部放在一个文件夹里不分层级，这样就不用再像用文件夹分类的方式，纠结这篇笔记属于哪个分类，觉得这个笔记和某个 MOC 有关，就丢进去，以后觉得无关再删除这条笔记链接，就完成了笔记分类删除。</p>
</li>
<li>
<p><strong>笔记多分类和知识图谱</strong>：通过粘贴链接，让一个笔记出现在多个 MOC 里，实现笔记多分类。一个 MOC 笔记可以放入其他多个 MOC 笔记里，层层嵌套，笔记之间形成多对多的关系，最终形成自己的知识图谱。</p>
</li>
<li>
<p><strong>轻松复用过去的笔记</strong>：MOC 推崇管理链接，所以可以直接引用过去的笔记，实现知识复用，有利于知识复利。</p>
</li>
<li>
<p><strong>引用外部链接，汇集更多信息</strong>：可以引用内部的笔记链接，也可以引用外部的链接，比如网页链接、其他软件的笔记和项目链接，笔记软件的链接也可以被外部软件引用。把所有需要的信息，无论是这个笔记软件的还是其他软件的，都整理在一起，而且由于他们都是链接，彼此非常统一。</p>
</li>
<li>
<p><strong>兼容自上而下管理和自下而上的渐进式积累</strong>。MOC 管理笔记，推崇以自上而下为主，自下而上为辅的笔记管理。自上而下就是先通过积累形成若干个主题，再从这些主题出发，想清楚自己缺少什么，需要去弥补什么，然后有意识地去获取知识来填充这些主题，完善这些主题。自下而上则是先积累素材，再组装成型。MOC 可以和双链笔记的 dailynote 笔记法（渐进式笔记法）相兼容。举例，我今天学习了通货膨胀的相关笔记，但是对于经济学的我其实了解很粗浅，暂时没有调研计划，就先把通货膨胀这篇笔记的链接丢在《@ 经济学》这个主题笔记里（可以用列表或者数据库型 MOC），等以后积累多了，再整理已有笔记，补充其他笔记，把这篇主题笔记给完善好。</p>
</li>
<li>
<p><strong>代替标签功能</strong>：</p>
<ul>
<li>可以在概念笔记的文档顶部，块引多个主题笔记完成打标签的步骤，可以在主题笔记的反链面板看到这些概念笔记，如果嫌弃用块引的方式打标签不仅仅污染笔记内容，反链面板管理笔记也不方便，可以选择思源笔记的数据库来代替标签功能。只需要点击「点击到数据库」功能，选择对应数据库就完成打标签的步骤，一篇笔记所属的数据库，会显示在右上方，悬浮即可查看，数据库还可以对所属条目进行排序、筛选等更高阶管理。</li>
<li>前面提到标签分类的一大问题是会创建很多重复标签，而在思源笔记里使用 MOC 的话，很大程度是可以解决这个问题的，因为思源笔记的文档是可以设置「<strong>命名</strong>」、「<strong>别名</strong>」的，如果你创建了一个《神经科学》MOC 笔记，害怕以后会把一些笔记会记到《脑科学》、《神经生物学》笔记里，或者害怕这篇笔记之后搜索找不到，那你就给《神经科学》这个 MOC 笔记打上脑科学、神经生物学别名就好了。合并重复文档也很简单，全选 MOC 笔记的内容，然后粘贴到另一个 MOC 笔记里就好了。思源笔记还提供了「转移引用」功能，能将一篇笔记的引用转移到另一篇笔记。所以思源笔记的双链其实是可以代替标签功能的，所以你可以把这些 MOC 笔记当成标签来使用，在 MOC 笔记里对引用这些标签的内容进行整理</li>
<li>前面也说到标签还有一个问题是信息汇聚完了，需要把标签本身转化为文档，否则难以复用，而用 MOC 的方式，本来创建的就是文档，可以直接在 MOC 笔记页面把汇聚的信息整理，MOC 笔记还能引用其他 MOC 笔记，很方便复用。</li>
</ul>
</li>
</ul>
<p>‍</p>
<h2 id=""MOC-面向主题地组织信息"">MOC：面向主题地组织信息</h2>
<p>MOC 的另一个核心理念，在于<strong>面向主题地组织信息</strong>。使用 MOC 管理笔记，会让你养成「<strong>面向主题</strong>」的笔记习惯，「<strong>以问题为导向</strong>」、「<strong>以行动为导向</strong>」去收集信息、整理信息，这能让使用者更多地去主动思考我需要什么、我学到了什么、还有哪些不足，而不是被动地接收信息，只是停留在收集信息这个粗浅水平上。</p>
<p>前面《@ 神经科学》主题笔记就是一个主题，我将所有我记的关于神经科学的笔记都汇总在这里，但是其实《@ 神经科学》这个主题很大，已经是一个领域了，其实管理很费劲。</p>
<p>很多时候，<strong>我们可以拆解大领域为一个个个小主题。</strong> 比如我，最近比较关心睡眠这个主题，那我就新建《@ 睡眠》这个主题笔记，收集所有我感兴趣的信息，如睡眠周期、睡眠与肌电脑电关系、古往今来对梦的认识、熬夜危害等等话题，其中我对熬夜危害特别感兴趣，因为自己总是熬夜，想通过了解危害让自己不敢熬夜。<strong>那我可以将熬夜升级为主题笔记</strong>，在《@ 睡眠》笔记下块引创建《@ 熬夜》这篇主题笔记，收集关于熬夜的各种信息，如经常熬夜会有哪些危害、熬夜之后补觉有没有用、同样的睡眠时间早起还是晚睡对身体危害更大等信息。</p>
<p>这就是「面向主题」的思想——<strong>针对当前感兴趣的主题有目的地去汇总、组织信息。</strong> 传统通过文件夹、标签管理笔记的方式，<strong>只是将单篇笔记进行分类归档，一个文件夹、一个标签下的笔记之间的关系实际还是零乱随意的</strong>。而将一个主题的信息整合在一篇「主题笔记」里，通过建立一个个的主题笔记，我们不再仅仅局限于查看一条条具体的概念笔记，而是可以站在一个更高的视角，<strong>以一种更有概括性的方式来回顾所有的笔记，思考这些笔记之间的关系是什么，帮助大脑为主题知识构建良好的线索，在脑海里建立起知识地图，更有序、更持久地将信息保留在脑中。</strong></p>
<p>然而，「面向主题」的魅力不仅仅在此。</p>
<p>许多人并不知道自己想要什么、需要什么，自己的知识缺口是什么，而是被动地接收各种渠道推送过来的信息，漫无目的地去浏览、学习。这就导致这些信息难以与生活建立关联，无法发挥真正的价值。</p>
<p>「面向主题」的学习，是一种有目的地主动学习、主动阅读，<strong>主动学习非常重要</strong>。被动接收信息，容易让自己患上「<strong>数字囤积症</strong>」，陷入「<strong>收藏者谬误</strong>」，以为收藏到就是学习到，只收集不思考，勤于分类，却懒于产出自己的观点。你有没有发现，当存在迫切的目标或 ddl，收集信息、做事就会特别快，并且完成确切的目标之后会特别有成就感，这就是主动学习的魅力。比起无目的地被动接受信息，主动学习可以更加高效、可以进行更加深入的思考，并且主动学习的内容是与我们自身相关的，能与自身建立关联，建立起记忆，有回忆和情感价值。更进一步地，有目的地收集一个主题的信息，而不是零散的收集五花八门的信息，能让自己在一个主题内有系统完整地学习，更好的吸收信息内化成个人观点、理清各个概念之间的联系，形成系统的知识体系。所谓的知识管理，我认为是<strong>想知道答案去主动探索知识，经过长时间有目的有方向地积累后，形成自己独到的知识体系，而非被动接收信息而不消化，或是搭建起精致的分类体系，对信息分门别类、热衷于囤积信息，却没有产出。</strong></p>
<p>很多人记笔记有几个误区：</p>
<ul>
<li><strong>认为笔记记得越多越好</strong>。其实笔记的数量和自己的认知提升没有正相关性，如果这些笔记乱七八糟，来自各种领域，非常零散，你只是记录没有思考、吸收、转化为自己的观点，那么这些笔记或许对你有害无益，你以为你记了就知道了，把「持有」当成了「拥有」，实际上别人一问依然只能含含糊糊回答。</li>
<li><strong>认为新建一篇笔记，我就要将其分类，分的越细致越好</strong>，于是使用图书馆分类法等复杂的分类管理系统来进行笔记分类。然而知识的价值并不体现在它的组织和分类形式上，而是体现在它是否能对与你相关的人或事产生影响。</li>
</ul>
<p>使用了 MOC 来管理我的笔记后，我发现：</p>
<p><strong>不应该推崇笔记的数量</strong>。笔记的数量并不代表一个人的知识丰富程度，主题笔记才能代表个人的知识体系。我们的目标应该是努力丰富和完善主题笔记，而不是去积累大量零散、不相关的概念笔记，积累概念笔记是过程，而非结果。</p>
<p><strong>使用图书馆分类法管理笔记进而维护起精致却庞杂的个人笔记分类体系其实没有必要，反而或许弊大于利。</strong> 过于执着分类很容易让人对各个领域都<strong>浅尝辄止</strong>，容易让我热衷于囤积与当下目标并不相关的信息，热衷于把信息存放在一个个分类目录下。这就会导致，看似笔记井井有条，搭建了一个精致完善的分类体系，实则脑子里却没有形成自己的知识体系。看似什么都懂实际什么都不精，只知其然，而不知其所以然，没有专精自己真正应该掌握的专业领域。记录的很多信息其实网上一搜就有答案，没有对信息进行更进一步的加工，没有和其他的笔记联动起来，形成自己独有的见解。浪费时间和精力记的这些笔记于自己实际的正向作用很小，记完可能就不再完善了，还容易在整理笔记上花费太多时间甚至影响自己的工作效率。</p>
<p>所以<strong>我推崇「面向主题地管理笔记」而不推崇用图书馆分类法搭建个人图书馆</strong>。我建议是根据自己的兴趣爱好、职业领域去长期且持续关注若干主题，建立若干相关项目，有的放矢，长期持续地去主动积累相关信息、积累自己的见解，真正对某些领域有所深刻了解。我一直都非常羡慕视频网站上的一些博主，他们可以有计划的罗列选题，然后安排时间去学习了解，制作视频，一些选题或许过去他们并不了解，却通过几周的调研查找资料，最终能向观众简单科普概念、介绍原理。我也很想成为这样的人，而他们这种方式其实就是面向主题地去执行任务。</p>
<p>此外，随着 AIGC 时代的到来，很多知识我们是可以直接问 AI 的，加速我们对信息的处理效率。但是有一点是 AI 没办法帮我们做的，那就是建立知识之间的关系、创造独属于个人的见解。而主题笔记实际上就是我们大脑的工作台，通过随心所欲把相关笔记拆散、排布、组合，组装出自己的看法。只要打开这篇主题笔记，自己所有关于这个话题已知的知识，整理的领域内最新的前沿进展以及个人在学习过程中的心得感悟就全都在里面了，一目了然。这就是独属于自己的知识财富，不仅代表着自己独到的思考，还蕴含着自己的回忆和感情，这是网页搜索引擎和 AI 无法替代和产出的。</p>
<h2 id=""MOC-学以致用而不是纸上谈兵"">MOC：学以致用而不是纸上谈兵</h2>
<p><strong>MOC 还与 PARA 信息管理系统的理念相辅相成</strong>。PARA 系统是由 Tiago Forte 提出的一种管理信息的方法，将笔记内容划分为四个部分：Projects（项目）、Areas（领域）、Resources（资源）和 Archives（归档），它点明了“<strong>实践就是知识的最终归宿，知识必须有利于推进项目，否则便是有害无益的</strong>”，推崇以行动为导向。而 MOC 则给予了笔记管理的具体方式，展示以主题为导向组织笔记的优势。</p>
<p>搭建一个精致的分类体系，会让使用者倾向于囤积信息，而非「以我为主，为我所用」。「以我为主，为我所用」的意思是说，一切我们所学到的知识，最终都是为了更好地增进对这个世界的理解，指导我们的行动。只有能够落实到实践中，能够用起来的知识，才是有意义的。无法用起来的知识，囤积在笔记里、记忆里，最终都会慢慢蒙尘，成为被遗忘在仓库里的陈旧累赘。</p>
<p>很多人其实很热衷于笔记分类，我过去也是。为什么要进行笔记分类呢？我想笔记分类有两个目的，一方面是为了方便汇聚信息进行思考，另一方面则是为了未来方便查找到笔记。而面向主题的笔记管理方式，完全能起到这两个作用，并且管理笔记会更轻松——<strong>创建一个主题笔记最重要的是把这个主题笔记完善好，不用再去在乎这个主题笔记属于哪个分类目录下。</strong> 你只需要专注把这个主题下的所有信息汇总、组织起来，经过消化吸收、整理思考，得到自己的观点，能切实对自己的生活、工作有改善，这就足够了。举例，《@ 熬夜》这篇主题笔记属于哪个分类，属于 <code>健康</code>​ 还是 <code>神经科学</code>​，都无所谓，只要你能保证以后需要能找到这篇笔记就行，最重要的是有没有用这篇笔记正确认识到熬夜的危害，养成更健康的作息习惯。《@ 学习 Solidworks 制图》这篇主题笔记属于 <code>软件学习</code>​还是 <code>研究生学习</code>​分类，也不重要，重要的是经过学习之后，能否建立一些模型，并 3D 打印出来。<strong>与其纠结某个主题属于哪个分类，怎么把笔记弄得看起来井井有条，不如多对实际的主题内容进行思考，产出自己的观点，做出实际成绩，切实去改变自己，让自己变得更优秀、身体变得更健康、生活变得更顺心，这才是更重要的。</strong></p>
<p>我现在的笔记管理方式就是 PARA 系统与 MOC 管理方式组合使用，先明确自己的领域是什么，兴趣是什么，列出对自己当下重要的主题，制作项目执行计划，通过“实践 → 复盘 → 完善笔记 → 再去实践”的正向反馈循环，渐进式完善相关主题笔记，在前进过程中实现认知和能力的升级。</p>
<p>“<strong>学以致用</strong>”这个成语早就告诉我们，应该是为了实际应用去学习知识，而不是让学习的知识在收藏夹积灰，只是把记笔记当成一个消磨时间的兴趣爱好。所有的知识，如果只是放在那边囤积起来，它是永远都无法发挥作用的。唯有让知识流动起来，一遍又一遍地经过你的思考，不断完善、修改、丰富自身，指导我们的实践，并从中获得反馈再次自我完善，才能真正地创造价值！</p>
<h2 id=""使用-MOC-可能出现的问题"">使用 MOC 可能出现的问题</h2>
<h3 id=""我使用思源笔记基于MOC管理笔记的相关设置"">我使用思源笔记基于 MOC 管理笔记的相关设置</h3>
<p>我只使用一个笔记本，<strong>我新建文档不是在文档树找一个适当地方新建，而是直接在 MOC 页面，选中以前感兴趣的概念和问题，使用「块引新建文档」功能新建文档</strong>，为此我对笔记本进行了设置，使得新建文档、块引新建文档都统一按月存放：</p>
<ul>
<li>块引新建文档路径：<code>/Notes/{{now | date \""2006/2006-01\""}}/</code>​</li>
<li>通过页签/Ctrl+N 新建文档的存放路径：<code>/Notes/{{now | date \""2006/2006-01\""}}/{{now | date \""2006-01-02 15:04:05\""}}</code>​</li>
</ul>
<p>这样我就可以专心在 MOC 页面块引新建文档，不需要考虑这些新建文档的存放位置了。</p>
<h3 id=""要放弃文件夹和标签-只用-MOC-管理笔记吗"">要放弃文件夹和标签，只用 MOC 管理笔记吗</h3>
<p>不必非此即彼，<strong>一个健康的笔记管理系统应该使用多种功能、多种理念</strong>。MOC 也不是完全没有缺点。</p>
<p>我自己使用 MOC 管理笔记，新建概念笔记可以不在乎存放的路径，但是新建一个领域的 MOC 我还是需要考虑下的，比如说 《@ 神经科学》、《@ 光学》，我喜欢在笔记本建立一个主题文档，将这些 MOC 笔记丢进去。并且目前思源笔记对 MOC 笔记的导出也不够友好，导出 Markdown 只能以脚注形式导出。所以你如果经常需要导出笔记分享给别人，可能需要斟酌下（期待官方或者大佬开发相关功能）。</p>
<p>MOC 管理笔记有一个日常使用问题，笔记导航如何持续存在于可视界面。用文件夹思维进行分类，文档树就是一个笔记导航，一直固定在一侧，这篇笔记看完，通过文档树可以去打开其他笔记。而使用 MOC，其实你的笔记导航是一篇笔记，你如果需要这个导航一直固定在一侧，就需要 MOC 笔记一直不关闭，比较好的方案是通过分屏来打开主题下的一篇笔记或者干脆悬浮查看笔记，如果不分屏的话，MOC 笔记可能被关闭、被其他笔记顶出可视区域，要看其他主题下的笔记，就又得找到这个 MOC 笔记。</p>
<p>MOC 管理笔记还有一个问题，通过概念笔记要回到主题笔记不是那么方便，要么在概念笔记里放主题笔记的链接，要么通过概念笔记的反向链接面板找到主题笔记，但是这都很麻烦。<strong>我现在喜欢在主题笔记里建立一个数据库 MOC</strong>，把概念笔记放进去，这样概念笔记就可以通过文档显示的所属数据库快速找到相关主题笔记。数据库管理笔记其实很灵活，可筛选和排序，只是不方便管理具有层级关系的笔记，这时候其实把数据库当成 Inbox 收集箱，等时机恰当，再批量复制块引用，用列表 MOC 来管理笔记。</p>
<p>标签很大程度上是可以被 MOC 笔记代替的，MOC 可以代替标签的汇总功能，还能在笔记里对汇总信息进行整理，只会比用标签管理笔记更好。所以我现在几乎没有使用标签功能。</p>
<h2 id=""参考"">参考</h2>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmedium.com%2F%40nickmilo22%2Fin-what-ways-can-we-form-useful-relationships-between-notes-9b9ec46973c6"" target=""_blank"" rel=""nofollow ugc"">In what ways can we form useful relationships between notes? | by Nick Milo | Medium</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F603635401"" target=""_blank"" rel=""nofollow ugc"">笔记间关联方式：文件夹，标签，双链与 MOC - 知乎 (zhihu.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F603647786"" target=""_blank"" rel=""nofollow ugc"">笔记系统：MOC（内容地图）的组织 - 知乎 (zhihu.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fhb0gsd"" target=""_blank"" rel=""nofollow ugc"">MOC - 管理链接而非本体 (yuque.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FwWkLV8MVzMm_XF1ES7ljCQ"" target=""_blank"" rel=""nofollow ugc"">双链其实不重要！详解双链笔记的管理核心 (qq.com)</a></li>
</ul>
<p>‍</p>
                

作者：Achuan-2
链接：https://ld246.com/article/1715446523024
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",Achuan-2,思源笔记,链滴优选
657,思源模板功能新人指南：模板语法 + 函数 + md 块语法 - 链滴,Tue May 07 2024 15:03:52 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>Sy 源文件</p>
<p><a href=""https://b3logfile.com/file/2024/05/思源模板功能新人指南_模板语法_函数_md块语法-0TnDYhE.sy.zip"">思源模板功能新人指南模板语法函数 md 块语法.sy.zip</a></p>
</blockquote>
<p>什么是模板？模板，简单来说就是在一段文本中定义一些「<strong>变量</strong>」，这些<strong>变量</strong>在<strong>实际渲染</strong>的时候会按照一定的<strong>规则</strong>被替换为<strong>实际的值</strong>。</p>
<p>比如我们最常见的日记路径模板：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">/daily note/{{now | date \""2006/01\""}}/{{now | date \""2006-01-02\""}}
</span></span></code></pre>
<p>在每天调用 Alt+5 快捷键创建日记的时候，思源就会渲染以上的模板，把其中由 <code>{{}}</code> 内部定义的变量替换为实际的值（在这里是日期），最后变为 <code>/daily note/2024/01/01-31</code> 这样具有实际意义的路径字符串。</p>
<p>思源的模板在功能上非常强大，然而实际用起来的感受——作为一个笔记软件的模板而言——老实说，使用起来还挺繁杂的。</p>
<p>这篇文章不会帮你完全掌握思源的模板功能，而是尽量提纲挈领地告诉大家思源模板功能的概况。如果你想要深入了解甚至熟练掌握——那你需要去认真看看相关文档，并抽空练习。</p>
<hr>
<p>从总体上讲，我会把思源的模板功能划分为这么几个重要的版块：</p>
<ul>
<li>
<p>基于 Golang 的模板语法</p>
<ul>
<li>
<p>基本语法</p>
<ul>
<li><code>{{ }}</code> vs  <code>.action{}</code></li>
</ul>
</li>
<li>
<p>常用的模板函数</p>
</li>
<li>
<p>常用的流程控制</p>
<ul>
<li>条件控制</li>
<li>循环控制</li>
</ul>
</li>
</ul>
</li>
<li>
<p>数据库中的用法</p>
</li>
<li>
<p>Markdown 块语法</p>
<ul>
<li><code>{: }</code> 块属性声明语法</li>
<li>超级块排版声明语法</li>
</ul>
</li>
</ul>
<p>在正式讲解之前，有必要先把这几个版块之间的关系厘清楚：</p>
<ol>
<li>
<p><strong>Golang 模板语法和 Sprig</strong></p>
<ul>
<li>
<p>思源的模板的语法是基于 Golang 的模板引擎来实现的</p>
</li>
<li>
<p>Golang 的模板引擎并没有提供多少好用的模板函数，所以思源又内置了 Sprig 库——这个库提供了大量丰富的模板函数，来增强模板的功能性</p>
</li>
<li>
<p>基本语法</p>
<ul>
<li>原始的 Golang 模板语法是 <code>{{ xxx }}</code></li>
<li>但是在思源中 <code>{{ }}</code> 又是嵌入块的声明语法</li>
<li>为了避免冲突，开发者就自定义了 <code>.action{ xxx }</code> 语法来替换原始的 <code>{{ xxx }}</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>数据库模板列</strong></p>
<ul>
<li>思源目前的数据库当中，可以创建一个「模板列」，在这个列当中可以使用 <code>.action{}</code> 语法，这样就可以在模板列中根据对应行的内容动态展示其内容</li>
<li>一个类似的例子：就好比在 excel 中增加一列公式</li>
</ul>
</li>
<li>
<p><strong>Markdown 块语法</strong></p>
<ul>
<li>Markdown 本身是没有块结构的；思源实现了一种基于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fkramdown.gettalong.org%2F"" target=""_blank"" rel=""nofollow ugc"">kramdown</a> 的 markdown 方言；这个方言不属于 Golang 模板语法的一部分，而是属于思源自己的特殊语法</li>
<li>基于这种方言，思源就可以在模板文件中为块预定义自定义属性、通过特殊的语法创建复杂的超级块排版</li>
<li>注意：<strong>这个语法和 Golang 模板无关</strong>，在数据库 、路径模板的这些地方使用是不会起效果的！</li>
</ul>
</li>
</ol>
<p>‍</p>
<h2 id=""前附-Test-Template-插件"">前附：Test-Template 插件</h2>
<p>在这篇教程之外，我上架了一个插件“测试模板语法”以方便大家测试 Golang 的模板语法。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506191258-tf2dld7.png?imageView2/2/interlace/1/format/webp""></p>
<p>你可以在阅读的过程中，使用这个插件对模板语法进行测试。插件的详细用法见说明文档。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506191602-jotsgpw.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h2 id=""思源-Golang-模板语法-Cheatsheet"">思源 Golang 模板语法 Cheatsheet</h2>
<p>基本的模板语法讲起来不够直观，这里我画了一个 cheatsheet 给大家展示，信息密度高一点会更加方便理解。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240420120805-g833ble.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240420113639-7pof0uh.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506220115-22huyht.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506220143-12xnhjr.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""基础语法快速总结"">基础语法快速总结</h3>
<ol>
<li>
<p>使用 <code>{{ }}</code> 或者 <code>.action{}</code> 来定义模板，里面一般是函数调用</p>
</li>
<li>
<p>函数的基本概念</p>
<ol>
<li>函数可以接受零个或者若干个参数，进行计算后返回一个特定的值</li>
<li>函数的参数和返回值有特定的类型，不同类型之间不能混用</li>
</ol>
</li>
<li>
<p>变量的赋值</p>
<ul>
<li>如果使用 <code>{{ now }}</code> 这种语法，模板引擎会直接将其渲染为具体的值</li>
<li>但是如果使用 <code>{{ $t := now}}</code> 这种语法，那么 <code>now</code> 的返回值会存储在变量 <code>$t</code> 中而不会渲染内部具体的值，此后就可以使用 <code>$t</code> 来引用这个变量</li>
</ul>
</li>
<li>
<p>使用函数</p>
<ul>
<li>
<p>函数是一个封装好的功能包，输入一些参数，进行特定的计算，返回特定的值</p>
</li>
<li>
<p>传入函数的参数类型要和函数接受的参数类型匹配</p>
</li>
<li>
<p><code>|</code> 语法：管道语法，这是一种在计算机领域非常常见的语法，相关参考</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.topgoer.com%2F%25E5%25B8%25B8%25E7%2594%25A8%25E6%25A0%2587%25E5%2587%2586%25E5%25BA%2593%2Ftemplate.html%23pipeline"" title=""Template · Go语言中文文档"" target=""_blank"" rel=""nofollow ugc"">Template · Go 语言中文文档</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F562210220"" title=""linux之管道符详解 - 知乎"" target=""_blank"" rel=""nofollow ugc"">linux 之管道符详解 - 知乎</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507002214-qvfc2yx.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""控制流语法快速介绍"">控制流语法快速介绍</h3>
<p>Go 语言模板控制流的用法可以参考官方文档：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftext%2Ftemplate%23hdr-Actions"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/text/template#hdr-Actions</a></p>
<p>这里介绍最常用的：</p>
<ol>
<li>
<p>if 语句：通过条件判断来<strong>有选择性</strong>地渲染、执行一部分模板语法</p>
<p>基本的用法是：如果 <code>condition</code> 中的条件被判定为 true，则渲染 <code>T1</code> 否则渲染 <code>T2</code></p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{if (condition)}} T1 {{else}} T0 {{end}}
</span></span></code></pre>
<p>例如：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ if eq (Weekday now) 1 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">好好工作
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ else }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">摸鱼!
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ end }}
</span></span></code></pre>
<p>在这里的 condition 中：</p>
<ol>
<li>
<p>首先计算 <code>Weekday now</code> 获取今天的星期数</p>
</li>
<li>
<p>然后通过 <code>eq</code> 和 1 对比，看看是不是周一；</p>
<ol>
<li>如果是，就渲染「好好工作」</li>
<li>如果不是，就渲染「摸鱼！」</li>
</ol>
</li>
</ol>
<blockquote>
<p>如果你不理解这里用到的 <code>eq</code> 函数，请不要焦虑，在后面的部分我们会详细说明在 if 语句中常常用到的函数。</p>
</blockquote>
</li>
<li>
<p>range 语句</p>
<p>range 语句被用来在一个序列当中进行迭代，最常见的语法如下</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ range $v := <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">slice</span><span class=""highlight-p"">&gt;</span> }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  {{ $v }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ end }}
</span></span></code></pre>
<p>这里的含义是：</p>
<ul>
<li>在一个可迭代的 <code>&lt;slice&gt;</code> （通常是一个列表 <code>List</code>）中迭代</li>
<li>每次取出一个值赋值给 <code>$v</code></li>
<li>我们就可以在 range 块内部访问这个 <code>$v</code> 变量</li>
</ul>
<p>一个简单的案例如下：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ $list := list 1 2 3 4 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ range $v := $list }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">-</span> Index: {{ $v }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ end }}
</span></span></code></pre>
<p>这里我们首先通过 <code>list</code> 函数创建一个列表（后面会介绍这个函数），然后在 <code>range</code> 中迭代这个列表，依次访问每个值。</p>
<p>渲染结果为：</p>
<blockquote>
<ul>
<li>Index: 1</li>
<li>Index: 2</li>
<li>Index: 3</li>
<li>Index: 4</li>
</ul>
</blockquote>
</li>
</ol>
<p>这里介绍的是最简单的控制流语法，还有更高级的用法请自行探索。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507002650-o2zntfu.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""常用函数介绍"">常用函数介绍</h2>
<p>函数是想要用好模板功能必定绕不开的一座大山。在上面的 Cheatsheet 中，我们简要介绍过函数的基本概念——函数就是一个封装好的功能包，他可以接收零个或者多个（视函数而定）参数，并计算得到一个输出。</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{{</span> <span class=""highlight-nx"">now</span> <span class=""highlight-p"">}}</span> <span class=""highlight-err"">#</span> <span class=""highlight-nx"">now</span> <span class=""highlight-err"">函数，接收</span> <span class=""highlight-mi"">0</span> <span class=""highlight-err"">个参数，输出当前的时间对象</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{{</span> <span class=""highlight-nx"">add</span> <span class=""highlight-mi"">1</span> <span class=""highlight-mi"">2</span> <span class=""highlight-mi"">3</span> <span class=""highlight-mi"">4</span><span class=""highlight-p"">}}</span> <span class=""highlight-err"">#</span> <span class=""highlight-nx"">add</span> <span class=""highlight-err"">函数，接收任个</span> <span class=""highlight-kt"">int</span> <span class=""highlight-err"">（整数）参数，输出他们的累加结果</span>
</span></span></code></pre>
<p>思源中支持的函数很多，有 Sprig 包支持的也有思源内置的。而实际在思源中常用的函数，我把他们分类为这几类：</p>
<ol>
<li>
<p>算术计算</p>
<ul>
<li>整数算术（int 类型）</li>
<li>浮点数算术（float 类型）</li>
</ul>
</li>
<li>
<p>时间计算</p>
</li>
<li>
<p>字符串操作</p>
</li>
<li>
<p>列表计算</p>
</li>
<li>
<p>类型转换（偶尔）</p>
</li>
<li>
<p>逻辑运算（在写条件块的时候要用）</p>
</li>
<li>
<p>思源模板片段特殊函数</p>
</li>
</ol>
<p>为了方便，我这里整理了最常用的一些函数，进行简单介绍。在介绍的过程中，遵循以下的格式：</p>
<ul>
<li>
<p><code>Fun</code> 代表一个没有参数的函数，比如 <code>now</code></p>
</li>
<li>
<p><code>Fun &lt;int&gt;, &lt;int&gt;</code> 代表有几个固定数量参数的函数，比如 <code>sub &lt;int&gt; &lt;int&gt;</code>；<code>&lt;int&gt;</code> 代表了参数的类型，常用类型还有</p>
<ul>
<li>
<p><code>int</code>：整数类型</p>
<ul>
<li><code>int64</code>：64 位的整数类型，需要通过类型转换函数和 <code>int</code> 类型做转换</li>
</ul>
</li>
<li>
<p><code>float</code>：浮点数类型</p>
<ul>
<li><code>float64</code>：64 位的浮点数类型，需要通过类型转换函数和 <code>float</code> 类型做转换</li>
</ul>
</li>
<li>
<p><code>list</code>：列表类型</p>
</li>
<li>
<p><code>str</code>：字符串类型</p>
</li>
<li>
<p><code>bool</code>：布尔类型（<code>true</code> 或者 <code>false</code>）</p>
</li>
<li>
<p><code>Time</code>：时间对象类型（这个类型会在后面有更加详细的解释）</p>
</li>
</ul>
</li>
<li>
<p><code>Func [&lt;int&gt;,]</code> 代表有不定长数量参数的函数，比如 <code>add</code> 后面可以跟好多个整数</p>
</li>
</ul>
<p>同时我还会给出一些使用范例，以及渲染后的效果，以供参考。</p>
<h3 id=""常用数值计算函数"">常用数值计算函数</h3>
<ul>
<li>
<p>Sprig 函数</p>
<ul>
<li>
<p>整型 int 计算：完整文档见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fmath.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/math.html</a></p>
<ul>
<li><code>add [&lt;int64&gt;,]</code>：<code>int64</code>，累加</li>
<li><code>sub &lt;int64&gt; &lt;int64&gt;</code>：<code>int64</code>，减法</li>
<li><code>mul [&lt;int64&gt;,]</code>：<code>int64</code>，累乘</li>
<li><code>div &lt;int64&gt; &lt;int64&gt;</code> ：<code>int64</code>，整除</li>
<li><code>mod &lt;int64&gt; &lt;int64&gt;</code>：<code>int64</code>，求余</li>
<li><code>min [&lt;int64&gt;,]</code> 和 <code>max [&lt;int64&gt;,]</code>：<code>int64</code>，求最小值和最大值</li>
</ul>
</li>
<li>
<p>浮点型 float 计算：完整文档见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fmathf.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/mathf.html</a></p>
</li>
<li>
<blockquote>
<p><strong>注：Sprig 的数值运算是在 int64 和 float64 类型上进行的，但是很多函数只接受 int 或 float 类型，所以很多时候要配合类型转换函数来使用，这一点会在下面的小节中详细说明</strong></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>思源内置数值函数</p>
<ul>
<li>
<p><code>pow &lt;int&gt;</code>：指数计算，返回整数</p>
</li>
<li>
<p><code>powf &lt;float&gt;</code>：指数计算，返回浮点数</p>
</li>
<li>
<p><code>log &lt;int&gt;</code>：对数计算，返回整数</p>
</li>
<li>
<p><code>logf &lt;float&gt;</code>：对数计算，返回浮点数</p>
</li>
<li>
<p><code>FormatFloat &lt;format str&gt; &lt;n float64&gt;</code>：<code>string</code>，说老实话我不能理解这个函数，这是一个老外要求加的，请参考</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Fgithub.com%2Fdustin%2Fgo-humanize%23FormatFloat"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/github.com/dustin/go-humanize#FormatFloat</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F11158"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/issues/11158</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fliuyun.io%2Farticle%2F1713131424994"" target=""_blank"" rel=""nofollow ugc"">https://liuyun.io/article/1713131424994</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>案例:</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- add
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ add 1 2 3 4 }} -&gt; 10
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- sub
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ sub 4 1 }} -&gt; 3
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- mul
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ mul 1 2 3 4 }} -&gt; 24
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- div
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ div 5 2 }} -&gt; 2.5
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- mod
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ mod 5 2 }} -&gt; 1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- min/max
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ min 5 1 }} -&gt; 1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ max 5 1 }} -&gt; 5
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- pow
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ pow 5 2 }} -&gt; 25
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- powf
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ powf 2.5 2 }} -&gt; 6.25
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- log
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ log 5 2 }} -&gt; 2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- logf
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ logf 5 2 }} -&gt; 约 2.32
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- FormatFloat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ FormatFloat \""#,###.##\"" 2345.6789 }} -&gt; 2,345.68
</span></span></code></pre>
<p>以上的模板会被渲染为：</p>
<blockquote>
<ul>
<li>
<p>add</p>
<ul>
<li>10 -&gt; 10</li>
</ul>
</li>
<li>
<p>sub</p>
<ul>
<li>3 -&gt; 3</li>
</ul>
</li>
<li>
<p>mul</p>
<ul>
<li>24 -&gt; 24</li>
</ul>
</li>
<li>
<p>div</p>
<ul>
<li>2 -&gt; 2.5</li>
</ul>
</li>
<li>
<p>mod</p>
<ul>
<li>1 -&gt; 1</li>
</ul>
</li>
<li>
<p>min/max</p>
<ul>
<li>1 -&gt; 1</li>
<li>5 -&gt; 5</li>
</ul>
</li>
<li>
<p>pow</p>
<ul>
<li>25 -&gt; 25</li>
</ul>
</li>
<li>
<p>powf</p>
<ul>
<li>6.25 -&gt; 6.25</li>
</ul>
</li>
<li>
<p>log</p>
<ul>
<li>2 -&gt; 2</li>
</ul>
</li>
<li>
<p>logf</p>
<ul>
<li>2.321928094887362 -&gt; 约 2.32</li>
</ul>
</li>
<li>
<p>FormatFloat</p>
<ul>
<li>2,345.68 -&gt; 2,345.68</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id=""常用的时间函数"">常用的时间函数</h3>
<ul>
<li>
<p>Sprig 常用函数</p>
<ul>
<li>
<p>所有函数见：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fdate.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/date.html</a></p>
</li>
<li>
<p><code>now</code>：<code>Time</code>，返回当前的时间</p>
</li>
<li>
<p><code>date &lt;fmt str&gt; &lt;Time&gt;</code>：<code>str</code>, 将输入的时间对象格式化为字符串</p>
<ul>
<li>
<p><code>fmt</code> 使用 <code>2006-01-02 15:04:05</code> 这个固定时间格式（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F366830553"" target=""_blank"" rel=""nofollow ugc"">知乎讨论</a>）</p>
</li>
<li>
<p>教你如何记忆这个 ?️ 垃圾到 ? 爆炸的 magin number</p>
<ul>
<li>首先年份固定是 2006</li>
<li>后面的月日时分秒从 01 开始依次递增到 05</li>
<li>所以标准格式为：<code>2006-01-02 03:04:05</code></li>
<li>但是 <code>03:04:05</code> 是 12 小时制，所以如果想用 24 小时制，要换算成 <code>2006-01-02 15:04:05</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>toDate &lt;fmt str&gt; &lt;str&gt;</code>：<code>Time</code> ，将一个字符串转换为一个时间对象</p>
<ul>
<li>注：思源内置的 <code>parseTime</code> 函数使用体验比这个函数要好一点</li>
</ul>
</li>
<li>
<p><code>duratioin &lt;second: int&gt;</code>：<code>Duration</code>, 将传入的秒数（int）转换为 <code>Duration</code> 对象</p>
</li>
</ul>
</li>
<li>
<p>思源内置时间函数</p>
<ul>
<li><code>ISOWeek &lt;Time&gt;</code>：<code>int</code>，返回对应的时间对应今天的第几周</li>
<li><code>Weekday &lt;Time&gt;</code>：<code>int</code>，返回对应的时间是星期几 ；<code>Sunday=0, Monday=1, ..., Saturday=6</code></li>
<li><code>WeekdayCN &lt;Time&gt;</code>：<code>str</code>，返回对应的时间是星期几；<code>Sunday=日, Monday=一, ..., Saturday=六</code></li>
<li><code>WeekdayCN2 &lt;Time&gt;</code>：<code>str</code>，返回对应的时间是星期几；<code>Sunday=天, Monday=一, ..., Saturday=六</code></li>
<li><code>parseTime &lt;string&gt;</code>：<code>Time</code>，解析传入的时间字符串，返回一个时间类型</li>
</ul>
</li>
<li>
<p><code>Time</code>：Golang 的 time.Time 类型，这个类型里面有不少有用的属性可以访问</p>
<ul>
<li>
<p><strong>完整函数参考</strong>：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime%23Time"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/time#Time</a></p>
<ul>
<li>请查找格式为 <code>func (t Time) Func(xxx) XXX</code> 的 API 文档</li>
<li>这类函数（属性）都可以在模板中通过 <code>t.Func</code> 来调用</li>
</ul>
</li>
<li>
<p><code>Year</code>:  <code>int</code></p>
</li>
<li>
<p><code>Month</code>: <code>Month</code>，这是一个枚举类型</p>
<ul>
<li>虽然显示是英文字符串，但是可以当作数值类型参与计算，例如 <code>add 1 now.Month</code></li>
<li>详情参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime%23Month"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/time#Month</a></li>
</ul>
</li>
<li>
<p><code>Day</code>: <code>int</code></p>
</li>
<li>
<p><code>Hour</code>: <code>int</code></p>
</li>
<li>
<p><code>Minute</code>: <code>int</code></p>
</li>
<li>
<p><code>Second</code>: <code>int</code></p>
</li>
<li>
<p><code>Sub &lt;Time&gt;</code>: 计算两个时间之间的差，返回 <code>Duration</code></p>
</li>
<li>
<p><code>Compare &lt;Time&gt;</code>：比较两个时间对象，返回 <code>int</code>, -1 或 0 或 1</p>
</li>
<li>
<p><code>AddDate &lt;year int&gt; &lt;month int&gt; &lt;day int&gt;</code>: <code>int</code>，在当前的时间对象的基础上计算 N 天（月、 年）后的日期（参数可以为负数）</p>
<ul>
<li>注意，这个函数对月份的处理比较坑，只建议使用 year 和 day 这两个参数</li>
<li>详情参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Flearnku.com%2Farticles%2F71760"" target=""_blank"" rel=""nofollow ugc"">令人困惑的 Go time.AddDate</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Duration</code>: Golang 的 time.Duration 类型</p>
<ul>
<li>
<p><strong>完整文档见</strong>：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime%23Duration"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/time#Duration</a></p>
<ul>
<li>请查找格式为 <code>func (d Duration) Func(xxx) XXX</code> 的 API 文档</li>
<li>这类函数是可以在模板中通过 <code>t.Func</code> 来调用</li>
</ul>
</li>
<li>
<p><code>Hours</code>：<code>float64</code>，将 Duration 转换为以小时为单位的数值</p>
</li>
<li>
<p><code>Minutes</code>: <code>float64</code>，将 Duration 转换为以分钟为单位的数值</p>
</li>
<li>
<p><code>Seconds</code>: <code>float64</code>，将 Duration 转换为以秒为单位的数值</p>
</li>
<li>
<p><code>String</code>: <code>str</code>, 将 Duration 按照小时制转换为字符串，显示的格式为 \""72h3m0.5s\""</p>
</li>
</ul>
</li>
</ul>
<p>案例：</p>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- now
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- date
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ date \""2006-01-02 15:04:05\"" now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- toDate
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ toDate \""2006-01-02\"" \""2020-01-01\"" }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- duration
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - 1800 second: {{ duration 1800 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- ISOWeek
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - 第 {{ now | ISOWeek }} 周
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- Weekday
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - 今天是星期:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ now | Weekday }} {{ now | WeekdayCN }} {{ now | WeekdayCN2 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- parseTime
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ parseTime \""2020-01-01 12:00:00\"" }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- Time 对象
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t := parseTime \""2020-01-01 12:00:00\"" }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t.Year }}/{{ $t.Month }}/{{ $t.Day }} {{ $t.Hour }}:{{ $t.Minute }}:{{ $t.Second }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ now.Sub $t }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t.Compare now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t.AddDate 0 0 7}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- Duration 对象
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du := now.Sub $t }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du.Hours }}; {{ $du.Minutes }}; {{ $du.Seconds }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du.String }}
</span></span></code></pre>
<p>以上的模板会被渲染为：</p>
<blockquote>
<ul>
<li>
<p>now</p>
<ul>
<li>2024-05-06 22:08:49.9662126 +0800 CST m=+477.037392501</li>
</ul>
</li>
<li>
<p>date</p>
<ul>
<li>2024-05-06 22:08:49</li>
</ul>
</li>
<li>
<p>toDate</p>
<ul>
<li>2020-01-01 00:00:00 +0800 CST</li>
</ul>
</li>
<li>
<p>duration</p>
<ul>
<li>1800 second: 0s</li>
</ul>
</li>
<li>
<p>ISOWeek</p>
<ul>
<li>第 19 周</li>
</ul>
</li>
<li>
<p>Weekday</p>
<ul>
<li>今天是星期:</li>
<li>1 一 一</li>
</ul>
</li>
<li>
<p>parseTime</p>
<ul>
<li>2020-01-01 12:00:00 +0800 CST</li>
</ul>
</li>
<li>
<p>Time 对象</p>
<ul>
<li>‍</li>
<li>2020/January/1 12:0:0</li>
<li>38098h8m49.9662126s</li>
<li>-1</li>
<li>2020-01-08 12:00:00 +0800 CST</li>
</ul>
</li>
<li>
<p>Duration 对象</p>
<ul>
<li>‍</li>
<li>38098h8m49.9662126s</li>
<li>38098.14721283683; 2.28588883277021e+06; 1.371533299662126e+08</li>
<li>38098h8m49.9662126s</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<p>日期计算可能是思源用户最常接触到的函数了，如果你是一个 daily note 用户，现在打开你主日记本，查看一下你日记的模板会发现它可能是这个样子:</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425010132-2lge3ze.png?imageView2/2/interlace/1/format/webp""></p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">/daily note/{{now | date \""2006/01\""}}/{{now | date \""2006-01-02\""}}
</span></span></code></pre>
<p>现在我们有了理论基础，不妨就这个案例来看一下这个日记模板是怎么回事：</p>
<ol>
<li>
<p><code>{{}}</code> 是 Golang 标准的模板语法，没什么好说的</p>
</li>
<li>
<p><code>now</code> 函数返回了一个 <code>Time</code> 对象</p>
</li>
<li>
<p><code>|</code> 通过管道运算，把 <code>now</code> 的结果传给后面，所以相当于在运行 <code>date \""2006/01\""</code></p>
<blockquote>
<p>你可以把 <code>{{now | date \""2006/01\""}</code> 换成 <code>{{date \""2006/01\"" now}}</code>；他们两个是完全等价的</p>
</blockquote>
</li>
<li>
<p><code>date &lt;fmt str&gt; &lt;Time&gt;</code> 是固定搭配的用法，这里 <code>\""2006/01\""</code> 也是固定的用法</p>
</li>
<li>
<p>所以最后，这个模板会被渲染为 <code>yyyy/mm</code> 这样的格式，和前面的组合起来，就会形成 <code>/daily note/&lt;年份&gt;/&lt;月份&gt;</code> 这样的路径字符串</p>
</li>
</ol>
<p>‍</p>
<h4 id=""分享几个日期计算的模板片段"">分享几个日期计算的模板片段</h4>
<p>就经验来看，在正常 md 模板中会写得比较复杂的也只有和日期计算相关的模板了。这里随便分享几个。</p>
<ul>
<li>
<p>可能会用到日记里面的</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $weekday := WeekdayCN now }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr := now | date \""2006-01-02\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">今天是 .action{$datestr} 星期.action{ $weekday }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-dailynote-${ $datestr_sy }=\"".action{$datestr_sy}\"" }
</span></span></code></pre>
</li>
<li>
<p>计算这周周日、上周周六等</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $weekday := Weekday now }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $begSunday := now.AddDate 0 0 (mul -1 $weekday | int) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $last6 := $begSunday.AddDate 0 0 -1 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $this6 := $begSunday.AddDate 0 0 6 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- 如果以周日为一周的起始，那么本周周日为：.action{ $begSunday | date \""2006-01-02\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- 上周周六为：.action{ $last6 | date \""2006-01-02\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- 本周周六为：.action{ $this6 | date \""2006-01-02\"" }
</span></span></code></pre>
</li>
<li>
<p>周规划</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $week := now | ISOWeek }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $weekday := now | Weekday }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $monday_delta := sub $weekday 1 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if eq $weekday -1}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  .action{ $monday_delta := 6 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $monday := now.AddDate 0 0 (mul -1 $monday_delta | int) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $sunday := $monday.AddDate 0 0 6 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">## 第 .action{$week} 周: .action{$monday | date \""2006-01-02\""} ~ .action{$sunday| date \""2006-01-02\""}
</span></span></code></pre>
</li>
</ul>
<h3 id=""常用字符串操作函数"">常用字符串操作函数</h3>
<p>字符串操作函数在正常 md 模板里面用的没那么多，但是在数据库模板列里面可能会大量用到。</p>
<blockquote>
<p>只列举了很小的一部分，完整文档见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fstrings.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/strings.html</a> 和 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fstring_slice.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/string_slice.html</a></p>
</blockquote>
<ul>
<li><code>trim &lt;str&gt;</code>: <code>str</code>， 将前后的空白字符去掉</li>
<li><code>repeat &lt;int&gt; &lt;str&gt;</code>：<code>str</code>，将给定的字符串重复若干次</li>
<li><code>substr &lt;start int&gt; &lt;end int&gt; &lt;str&gt;</code>: <code>str</code>，提取子字符串，index 从 0 开始</li>
<li><code>trunc &lt;int&gt; &lt;str&gt;</code>: <code>str</code>，将给定的字符串按照最大长度来截断；<code>&lt;int&gt;</code> 参数可以是负数，代表从末尾反向截断</li>
<li><code>abbrev &lt;int&gt; &lt;str&gt;</code>: <code>str</code>，同样是截断字符串，但是会在后面加上一个 <code>...</code></li>
<li><code>contains &lt;part str&gt; &lt;whole str&gt;</code>: <code>bool</code>，检测 <code>whole</code> 中是否包含 <code>part</code></li>
<li><code>cat [&lt;str&gt;,]</code>: <code>str</code>，将若干字符串拼接起来，中间通过空格间隔</li>
<li><code>replace &lt;from str&gt; &lt;to str&gt; &lt;src str&gt;</code> : <code>str</code>，将 <code>src</code> 中所有的 <code>from</code> 替换成 <code>to</code></li>
<li>正则表达式系列的函数（请自行翻阅<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fstrings.html"" target=""_blank"" rel=""nofollow ugc"">文档</a>）</li>
<li><code>join &lt;ch str&gt; &lt;List[str]&gt;</code>: <code>str</code>，将给定的字符串列表通过 <code>ch</code> 连接起来</li>
<li><code>splitList &lt;ch str&gt; &lt;src str&gt;</code>: <code>List[str]</code>，将给定的 <code>src</code> 字符串根据 <code>ch</code> 字符分割为列表</li>
</ul>
<p>案例：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- trim
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ trim \""   aa   \"" }} -&gt; \""aa\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- repeat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ repeat 5 \""12\"" }} -&gt; \""1212121212\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- substr
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ substr 1 3 \""abcedfg\"" }} -&gt; \""bc\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- trunc
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ trunc 3 \""abcedfg\"" }} -&gt; \""abc\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ trunc -3 \""abcedfg\"" }} -&gt; \""efg\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- abbrev
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ abbrev 5 \""hello world\"" }} -&gt; \""he...\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- contains
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ contains \""bb\"" \""aabb\"" }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- cat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ cat \""1\"" \""2\"" \""3\"" }} -&gt; \""1 2 3\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- replace
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ replace \""aa\"" \""bb\"" \""11aaccaa\"" }} -&gt; \""11bbccbb\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- join
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list \""hello\"" \""siyuan\"" | join \""？\"" }} -&gt; \""hello？siyuan\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- splitList
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ splitList \""$\"" \""foo$bar$baz\"" }} -&gt; [\""foo\"", \""bar\"", \""baz\""]
</span></span></code></pre>
<p>渲染结果为：</p>
<blockquote>
<ul>
<li>
<p>trim</p>
<ul>
<li>aa -&gt; \""aa\""</li>
</ul>
</li>
<li>
<p>repeat</p>
<ul>
<li>1212121212 -&gt; \""1212121212\""</li>
</ul>
</li>
<li>
<p>substr</p>
<ul>
<li>bc -&gt; \""bc\""</li>
</ul>
</li>
<li>
<p>trunc</p>
<ul>
<li>abc -&gt; \""abc\""</li>
<li>dfg -&gt; \""efg\""</li>
</ul>
</li>
<li>
<p>abbrev</p>
<ul>
<li>he... -&gt; \""he...\""</li>
</ul>
</li>
<li>
<p>contains</p>
<ul>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>cat</p>
<ul>
<li>1 2 3 -&gt; \""1 2 3\""</li>
</ul>
</li>
<li>
<p>replace</p>
<ul>
<li>11bbccbb -&gt; \""11bbccbb\""</li>
</ul>
</li>
<li>
<p>join</p>
<ul>
<li>hello？siyuan -&gt; \""hello？siyuan\""</li>
</ul>
</li>
<li>
<p>splitList</p>
<ul>
<li>[foo bar baz] -&gt; [\""foo\"", \""bar\"", \""baz\""]</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id=""列表操作函数"">列表操作函数</h3>
<p>列表类函数常常会配合 queryBlocks （见后面的小节） 一同使用。</p>
<p>完整文档请见：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Flists.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/lists.html</a></p>
<ul>
<li>
<p><code>list [&lt;value&gt;,]</code>：<code>List</code>，将后面传入的参数变成一个列表（类型要相同）</p>
</li>
<li>
<p><code>first &lt;List&gt;</code>：返回第一个列表项</p>
</li>
<li>
<p><code>last &lt;List&gt;</code>：返回最后一个列表项</p>
</li>
<li>
<p><code>append &lt;List&gt; &lt;value&gt;</code>：<code>List</code>，在列表后面增加一个元素</p>
</li>
<li>
<p><code>prepend &lt;List&gt; &lt;value&gt;</code>：<code>List</code>，在列表前面增加一个元素</p>
</li>
<li>
<p><code>concat [&lt;List&gt;,]</code>：<code>List</code>，将多个列表合并成一个</p>
</li>
<li>
<p><code>reverse &lt;List&gt;</code>：<code>List</code>，将列表逆序</p>
</li>
<li>
<p><code>has &lt;value&gt; &lt;List&gt;</code>：<code>bool</code>，检查给定的项目是否在列表中</p>
</li>
<li>
<p><code>index &lt;List&gt; &lt;int&gt;</code>：<code>List</code>，根据后面的索引值，索引列表中的内容</p>
</li>
<li>
<p><code>slice &lt;List&gt; &lt;beg int&gt; {&lt;end int&gt;}</code>：<code>List</code>，对给定的列表进行切片</p>
<ul>
<li><code>slice $myList</code> returns <code>[1 2 3 4 5]</code>. It is same as <code>myList[:]</code>.</li>
<li><code>slice $myList 3</code> returns <code>[4 5]</code>. It is same as <code>myList[3:]</code>.</li>
<li><code>slice $myList 1 3</code> returns <code>[2 3]</code>. It is same as <code>myList[1:3]</code>.</li>
<li><code>slice $myList 0 3</code> returns <code>[1 2 3]</code>. It is same as <code>myList[:3]</code>.</li>
</ul>
</li>
<li>
<p><code>empty &lt;List&gt;</code>：<code>bool</code>，检查列表是否为空</p>
</li>
<li>
<p><code>len &lt;List&gt;</code>：<code>int</code>，获取列表的长度</p>
</li>
</ul>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- list
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list 1 2 3 4 }} -&gt; [1 2 3 4]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list \""a\"" \""b\"" \""c\"" }} -&gt; [\""a\"" \""b\"" \""c\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- first
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ first (list 1 2 3) }} -&gt; 1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ first (list \""a\"" \""b\"" \""c\"") }} -&gt; \""a\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- last
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ last (list 1 2 3) }} -&gt; 3
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ last (list \""a\"" \""b\"" \""c\"") }} -&gt; \""c\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- append
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ append (list 1 2 3) 4 }} -&gt; [1 2 3 4]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ append (list \""a\"" \""b\"" \""c\"") \""d\"" }} -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- prepend
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ prepend (list 1 2 3) 0 }} -&gt; [0 1 2 3]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ prepend (list \""a\"" \""b\"" \""c\"") \""z\"" }} -&gt; [\""z\"" \""a\"" \""b\"" \""c\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- concat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ concat (list 1 2) (list 3 4) }} -&gt; [1 2 3 4]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ concat (list \""a\"" \""b\"") (list \""c\"" \""d\"") }} -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- reverse
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ reverse (list 1 2 3) }} -&gt; [3 2 1]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ reverse (list \""a\"" \""b\"" \""c\"") }} -&gt; [\""c\"" \""b\"" \""a\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- has
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ has 2 (list 1 2 3) }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ has \""d\"" (list \""a\"" \""b\"" \""c\"") }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- index
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ index (list 1 2 3 4) 2 }} -&gt; 3
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ index (list \""a\"" \""b\"" \""c\"" \""d\"") 0}} -&gt; \""a\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- slice
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ slice (list 1 2 3 4 5) 1 3 }} -&gt; [2 3]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ slice (list \""a\"" \""b\"" \""c\"" \""d\"") 2 }} -&gt; [\""c\"" \""d\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- len
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list 1 2 3 4 | len }} -&gt; 4
</span></span></code></pre>
<p>渲染结果为</p>
<blockquote>
<ul>
<li>
<p>list</p>
<ul>
<li>[1 2 3 4] -&gt; [1 2 3 4]</li>
<li>[a b c] -&gt; [\""a\"" \""b\"" \""c\""]</li>
</ul>
</li>
<li>
<p>first</p>
<ul>
<li>1 -&gt; 1</li>
<li>a -&gt; \""a\""</li>
</ul>
</li>
<li>
<p>last</p>
<ul>
<li>3 -&gt; 3</li>
<li>c -&gt; \""c\""</li>
</ul>
</li>
<li>
<p>append</p>
<ul>
<li>[1 2 3 4] -&gt; [1 2 3 4]</li>
<li>[a b c d] -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]</li>
</ul>
</li>
<li>
<p>prepend</p>
<ul>
<li>[0 1 2 3] -&gt; [0 1 2 3]</li>
<li>[z a b c] -&gt; [\""z\"" \""a\"" \""b\"" \""c\""]</li>
</ul>
</li>
<li>
<p>concat</p>
<ul>
<li>[1 2 3 4] -&gt; [1 2 3 4]</li>
<li>[a b c d] -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]</li>
</ul>
</li>
<li>
<p>reverse</p>
<ul>
<li>[3 2 1] -&gt; [3 2 1]</li>
<li>[c b a] -&gt; [\""c\"" \""b\"" \""a\""]</li>
</ul>
</li>
<li>
<p>has</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>index</p>
<ul>
<li>3 -&gt; 3</li>
<li>a -&gt; \""a\""</li>
</ul>
</li>
<li>
<p>slice</p>
<ul>
<li>[2 3] -&gt; [2 3]</li>
<li>[c d] -&gt; [\""c\"" \""d\""]</li>
</ul>
</li>
<li>
<p>len</p>
<ul>
<li>4 -&gt; 4</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id=""类型转换函数"">类型转换函数</h3>
<p>在思源一个笔记软件里面，纠结数据类型这种纯编程性的问题挺古怪的——但是只要你开始用模板功能，有些时候偏偏就会出现类型兼容性问题。</p>
<p>例如这个例子，他的作用是计算上一个周日的日期（这里我们姑且认为每周从周一开始）。</p>
<ul>
<li>首先我们使用 <code>Weekday</code> 函数获取今天是星期几，数值范围为 0~6</li>
<li>然后调用 AddDate 函数，减去星期数，就获得了周日的日期</li>
</ul>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ $weekday := Weekday now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ now.AddDate 0 0 (mul -1 $weekday) }}
</span></span></code></pre>
<p>不过运行的这个模板的时候会报错，无法运行：</p>
<blockquote>
<p>模板解析失败：template: :2:27: executing \""\"" at &lt;$weekday&gt;: wrong type for value; expected int; got int64 v3.0.12</p>
</blockquote>
<blockquote>
<p>附：顺便教一下怎么看这个报错信息。</p>
<ul>
<li>关注 <code>template: :2:27</code>，这代表了传入的模板的第二行，第二十七个字符的地方出现了错误</li>
<li>具体的错误就是：「wrong type for value; expected int; got int64」，也就是传入的值的类型出了错。</li>
</ul>
</blockquote>
<p>报错的原因在于，<code>mul</code> 这些 Sprig 算术函数返回的类型是 <code>int64</code>，而 <code>Time.AddDate</code> 函数接受的类型却是 <code>int</code>，所以出现了类型不兼容问题。?</p>
<p>为了解决这一问题，我们不得不进行使用类型转换函数，把 in64 转成 int 类型：</p>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ $weekday := Weekday now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ now.AddDate 0 0 (mul -1 $weekday | int) }}
</span></span></code></pre>
<p>类型转换函数同样是 Sprig 提供的，文档见：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fconversion.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/conversion.html</a></p>
<ul>
<li><code>atoi</code>: Convert a string to an integer.</li>
<li><code>float64</code>: Convert to a <code>float64</code>.</li>
<li><code>int</code>: Convert to an <code>int</code> at the system’s width.</li>
<li><code>int64</code>: Convert to an <code>int64</code>.</li>
<li><code>toDecimal</code>: Convert a unix octal to a <code>int64</code>.</li>
<li><code>toString</code>: Convert to a string.</li>
<li><code>toStrings</code>: Convert a list, slice, or array to a list of strings.</li>
</ul>
<h3 id=""逻辑运算函数"">逻辑运算函数</h3>
<p>逻辑运算函数，主要是在 <code>if</code> 这类流程控制语句内需要用到。比如这个例子当中，eq 就是一个逻辑运算函数，他用来比较传入的两个参数是否相等（equal 的简写）。</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ if eq 1 2 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>在更加实际的例子中，可能我们要写好几个逻辑运算，建议将每个逻辑运算囊括在 () 当中来保证运算的正确性。</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ if or (eq 1 2) (ne 2 3) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>逻辑运算部分可以分为两大类：布尔运算类和比较运算类。这里的参数类型 <code>&lt;interface{}&gt;</code> 表示是任意类型。</p>
<ul>
<li>
<p>布尔运算</p>
<ul>
<li><code>and [&lt;interface{}&gt;,]</code>：<code>interface{}</code>，如果所有参数都为真，则返回最后一个参数；否则返回第一个为假的参数</li>
<li><code>or [&lt;interface{}&gt;,]</code>：<code>interface{}</code>，如果任一参数为真，则返回第一个为真的参数；否则返回最后一个参数</li>
<li><code>not &lt;interface{}&gt;</code>：<code>bool</code>，对单个参数进行逻辑非运算；如果参数为真则返回假，为假则返回真</li>
</ul>
</li>
<li>
<p>比较运算：对两个类型进行比较，注意这里的参数必须要是同样的类型</p>
<ul>
<li><code>eq &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，判断两个参数是否相等；相等返回真，不等返回假</li>
<li><code>ne &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，判断两个参数是否不相等；不相等返回真，相等返回假</li>
<li><code>lt &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个小于第二个，则返回真，否则返回假</li>
<li><code>le &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个小于等于第二个，则返回真，否则返回假</li>
<li><code>gt &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个大于第二个，则返回真，否则返回假</li>
<li><code>ge &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个大于等于第二个，则返回真，否则返回假</li>
</ul>
</li>
</ul>
<p>在常规的逻辑运算函数之外，还有必要介绍一类列表、对象判断类函数，这部份函数由 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fdefaults.html"" title=""Default Functions | sprig"" target=""_blank"" rel=""nofollow ugc"">Default Functions | sprig</a> 提供</p>
<ul>
<li>
<p><code>empty &lt;interface{}&gt;</code>：<code>bool</code>，判断给定的对象是否为空</p>
<ul>
<li>在思源中，最常见的用法是判断一个列表是不是空的</li>
</ul>
</li>
<li>
<p><code>all [&lt;interface{}&gt;,]</code>：<code>bool</code>，判断给定一系列对象，是否每个都是非空的</p>
</li>
<li>
<p><code>any [&lt;interface{}&gt;,]</code>：<code>bool</code>，判断给定一系列对象，是否存在某一个是非空的</p>
</li>
</ul>
<p>‍</p>
<p>案例如下：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- and 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ and true true }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ and true false }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ and 1 2.3 \""str\"" }}  -&gt; \""str\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- or
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ or false false }} -&gt; false  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ or true false }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- not
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ not true }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ not 0 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- eq
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ eq 2 3 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ eq \""a\"" \""a\"" }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- ne 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ne 4 3 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ne 2 2 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- lt
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ lt 4 3 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ lt \""a\"" \""b\"" }} -&gt; true  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- le
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ le 2 2 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ le 4 3 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- gt 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ gt 5 3 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ gt 2 2 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- ge
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ge 3 3 }} -&gt; true  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ge 1 4 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- empty
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list 1 | empty }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list | empty }} -&gt; true
</span></span></code></pre>
<blockquote>
<ul>
<li>
<p>and</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
<li>str  -&gt; \""str\""</li>
</ul>
</li>
<li>
<p>or</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>not</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>eq</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>ne</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>lt</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>le</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>gt</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>ge</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>empty</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
</ul>
</blockquote>
<p>‍</p>
<h4 id=""附-使用-ternary-函数计算内联条件"">附：使用 ternary 函数计算内联条件</h4>
<p>我们上面谈到了最常用的 if 条件语句：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ if eq 1 2 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>如果对编程比较有经验的人应该知道，很多语言中都支持计算内联条件，以 js 为例子</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">x</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">(</span><span class=""highlight-mi"">1</span> <span class=""highlight-o"">==</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">)</span><span class=""highlight-o"">?</span> <span class=""highlight-mi"">1</span> <span class=""highlight-o"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">;</span>
</span></span></code></pre>
<p>在模板函数中，这个内联条件计算可以用 <code>ternary</code> 函数来完成，基本用法为：<code>ternary &lt;arg1&gt; &lt;arg2&gt; &lt;cond bool&gt;</code>：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ ternary \""Show 1\"" \""Show 2\"" (eq 1 2) }
</span></span></code></pre>
<p>‍</p>
<h3 id=""思源模板片段特殊函数"">思源模板片段特殊函数</h3>
<p>有几个思源内置的特殊模板函数在文档里有所介绍，<strong>这几个函数</strong>**==只能用在 md 模板文件==当中**。</p>
<blockquote>
<ul>
<li><code>title</code>：该变量用于插入当前文档名。比如模板内容为 <code># .action{.title}</code>，则调用后会以一级标题语法插入到当前文档内容中</li>
<li><code>id</code>：该变量用于插入当前文档 ID</li>
<li><code>name</code>：该变量用于插入当前文档命名</li>
<li><code>alias</code>：该变量用于插入当前文档别名</li>
</ul>
</blockquote>
<p>这四个实际上是在「访问正在插入模板的容器文档的一些属性」。</p>
<p>我们可以把下面这个例子保存到 template 目录下的 md 模板文件当中。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的标题：.action{.title}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的ID：.action{.id}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的命名：.action{.name}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的别名：.action{.alias}
</span></span></code></pre>
<p>然后在某个文档当中插入这个模板，你就会发现这几个字段被替代为被插入的文档块的具体的属性。</p>
<blockquote>
<p>这个是当前插入文档块的标题：思源模板片段新人指南<br>
这个是当前插入文档块的 ID：20231014181953-m94pl9u<br>
这个是当前插入文档块的命名：<br>
这个是当前插入文档块的别名：</p>
</blockquote>
<p>注意这里使用的时候必须前面要加上 <code>.</code>，也就是 <code>.title</code> 而非 <code>title</code>。至于为什么要加 <code>.</code>，有兴趣可以参考这个：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.topgoer.com%2F%25E5%25B8%25B8%25E7%2594%25A8%25E6%25A0%2587%25E5%2587%2586%25E5%25BA%2593%2Ftemplate.html%23%25E6%25A8%25A1%25E6%259D%25BF%25E8%25AF%25AD%25E6%25B3%2595"" title=""Template · Go语言中文文档"" target=""_blank"" rel=""nofollow ugc"">Template · Go 语言中文文档</a>。</p>
<h3 id=""SQL-查询函数"">SQL 查询函数</h3>
<p>思源还额外提供了两个模板函数，用于做 SQL 查询。</p>
<blockquote>
<p>如果你对思源的 SQL 功能不了解，请阅读：<a href=""https://ld246.com/article/1683355095671"">思源 SQL 新人指南：SQL 语法 + Query + 模板</a></p>
</blockquote>
<ul>
<li>
<p><code>queryBlocks</code>：该函数用于查询数据库，返回值为 blocks 列表，请参考下面的例子</p>
<ul>
<li>⭐ 这个更常用！</li>
</ul>
</li>
<li>
<p><code>querySpans</code>：该函数用于查询数据库，返回值为 spans 列表，请参考下面的例子</p>
<ul>
<li>?‍♂️ 这个很少用。</li>
</ul>
</li>
</ul>
<p>这两个模板函数的返回值都是块的列表。</p>
<h4 id=""queryBlocks"">queryBlocks</h4>
<p><code>queryBlocks</code> 可能是最常用的，他的作用就是在 blocks 表中做查询。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$blocks := queryBlocks \""select * from blocks where 1 limit 1\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">返回结果是列表，这里取出第一个元素：.action{ $b := first $blocks}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">块的 ID .action{$b.ID}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">块的路径 .action{$b.Path}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">完整的块的内容：
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```json
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{toPrettyJson $b }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```
</span></span></code></pre>
<p>我们通过 <code>toPrettyJson</code> 函数（见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fdefaults.html"" title=""Default Functions | sprig"" target=""_blank"" rel=""nofollow ugc"">Default Functions | sprig</a>）将结果变成一个 Json，可以发现返回的就是一个 Block 对象。</p>
<blockquote>
<p>返回结果是列表，这里取出第一个元素：<br>
块的 ID 20220316145831-f0lgt06<br>
块的路径 /20220316145830-u0u6srg/20220316145830-x6kvftp/20220316145831-f0lgt06.sy<br>
完整的块的内容：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""ID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831-f0lgt06\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""ParentID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""RootID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831-f0lgt06\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Hash\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""d7b97e4\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Box\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220305173526-4yjl33h\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Path\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""/20220316145830-u0u6srg/20220316145830-x6kvftp/20220316145831-f0lgt06.sy\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""HPath\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""/daily note/2022/03\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Alias\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Memo\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Tag\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""03\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""FContent\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""03\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Markdown\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Length\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""SubType\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""IAL\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""{: custom-sy-readonly=\\\""true\\\"" id=\\\""20220316145831-f0lgt06\\\"" title=\\\""03\\\"" type=\\\""doc\\\"" updated=\\\""20220316145831\\\""}\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Sort\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Created\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Updated\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
</blockquote>
<p>在这里我们使用了如下的写法：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$blocks := queryBlocks \""select * from blocks where 1 limit 1\""}
</span></span></code></pre>
<p>但是某些情况下，可能 SQL 里面的需要插入一些变量，这种情况下，可以使用 <code>?</code> 占位符来插入变量：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$id := \""20240507145154-4g8hqau\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$blocks := queryBlocks \""select * from blocks where id=\'?\'\"" $id}
</span></span></code></pre>
<p>‍</p>
<h4 id=""querySpans"">querySpans</h4>
<p><code>querySpans</code> 则很少用，他是用来给 spans 表做查询用的</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$spans := querySpans \""select * from spans  where 1 limit 1\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍```json
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{toJson  $spans  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍```
</span></span></code></pre>
<blockquote>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">[{</span><span class=""highlight-nt"">\""ID\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20240420235208-65m9ro6\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""BlockID\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20220324170238-169kwsw\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""RootID\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20220324170216-lp8jviy\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Box\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20220305173526-4yjl33h\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Path\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""/20220316145830-u0u6srg/20220316145830-x6kvftp/20220316145831-f0lgt06/20220324170216-lp8jviy.sy\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Content\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""随想录\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Markdown\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""((20220320164548-ienx5sl \'随想录\'))\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Type\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""textmark block-ref\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""IAL\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">}]</span>
</span></span></code></pre>
</blockquote>
<p>‍</p>
<h3 id=""案例-链接到昨天的日记"">案例：链接到昨天的日记</h3>
<p>querySpans 且不谈，配合 queryBlocks 我们可以在模板中玩一些奇妙的花活。本小节作为模板语法部分的收尾，给大家介绍一个有趣的案例。</p>
<hr>
<p>前两天我看有人在论坛里问：<a href=""https://ld246.com/article/1714915294074"">日记模板怎样设置可以在今天日记页面中自动添加昨天的日记链接？</a></p>
<p>他提得需求就完全可以通过 queryBlocks 来完成。</p>
<p>要实现这个功能，必须知道两个前置知识：</p>
<ol>
<li>在思源里，日记文档会自动添加 <code>custom-dailynote-&lt;yyyymmdd&gt;</code> 属性；比如 2024-05-01 的日记，会自动添加文档属性 <code>custom-dailynote-20240501</code></li>
<li>思源中，超链接的格式为 <code>siyuan://blocks/&lt;块 ID&gt;</code></li>
</ol>
<p>有了这两个知识，我们就有大致的实现思路了：</p>
<ol>
<li>获取昨天的日期</li>
<li>根据昨天的日期构建日记文档属性</li>
<li>查询符合文档属性的文档</li>
<li>如果查询到，就去除文档的 ID 并构建块链接</li>
</ol>
<p>首先要获得 <code>yyyymmdd</code> 属性，这个我在「常用的时间函数」当中已经给出写法了：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-dailynote-${ $datestr_sy }=\"".action{$datestr_sy}\"" }
</span></span></code></pre>
<p>这里我们要把 <code>now</code> 替换成昨天，改成这样以下这样；其中用到了 list、join 两个函数，我在前面也介绍过。</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now.AddDate 0 0 -1 | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $attr := list \""custom-dailynote-\"" $datestr_sy | join \""\"" }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507011639-jh02y6n.png?imageView2/2/interlace/1/format/webp""></p>
<p>接下来我们就要在模板中调用 queryBlock 来查询昨天的日记：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now.AddDate 0 0 -1 | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $attr := list \""custom-dailynote-\"" $datestr_sy | join \""\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $docs := queryBlocks \""select * from blocks where type=\'d\' and ial like \'%custom-dailynote-20240506%\' limit 1\""}
</span></span></code></pre>
<p>获得了 <code>$docs</code> 我们需要做以下的工作：</p>
<ol>
<li>首先判断列表是否为空（用 empty 函数），因为很可能昨天没有写日记</li>
<li>如果不为空，就使用 <code>first</code> 函数取出第一个文档元素</li>
<li>通过 <code>.ID</code> 获取文档的 ID，并构造 markdown 链接</li>
</ol>
<p>最后完整的模板内容如下：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now.AddDate 0 0 -1 | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $attr := list \""custom-dailynote-\"" $datestr_sy | join \""\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $docs := queryBlocks \""select * from blocks where type=\'d\' and ial like \'%custom-dailynote-20240506%\' limit 1\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ if not (empty $docs) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $doc := first $docs }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">[.action{$doc.Content}](siyuan://blocks/.action{ $doc.ID })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507013135-pc2q98t.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""数据库中的模板列"">数据库中的模板列</h2>
<p>思源的数据库中，有一种类型的列叫做「模板列」，通过模板列，我们可以让数据库发挥出更加强大的功能。</p>
<p>口说无凭，来看一个数据库的效果：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425002554-8t5cmxv.png?imageView2/2/interlace/1/format/webp""></p>
<p>在这个数据库当中，「评级」是一个模板列，他会根据左边打分的数值，自动调整显示为不同的星星数量。那么这是怎么做到的呢？</p>
<ol>
<li>
<p>首先新建评级列，将它设置为一个模板列</p>
</li>
<li>
<p>编辑模板为</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $scale := (div .打分 20) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ repeat (int $scale) \""⭐\"" }
</span></span></code></pre>
</li>
</ol>
<p>看起来非常简单！你应该能记得，我们之前讨论过这里用到的三个函数：</p>
<ul>
<li><code>div</code>：进行除法运算，并将结果赋值给 <code>$scale</code> 变量</li>
<li>由于 <code>div</code> 的结果类型为 <code>int64</code> 所以通过 <code>int</code> 函数把他转为整型</li>
<li>通过调用 <code>repeat</code> 函数，根据 <code>$scale</code> 变量的数值来重复显示 ⭐ 符号</li>
</ul>
<blockquote>
<p>插件测试样例，注：由于这里是在插件当中测试，无法访问 <code>.打分</code> 属性，所以用常量 50 来替换以完成测试。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506192211-a2hveqi.png?imageView2/2/interlace/1/format/webp""></p>
</blockquote>
<p>当然以上都不是重点，这里的重点是—— <code>.打分</code> 是什么，为什么我们可以访问他？</p>
<h3 id=""-对象""><code>.</code> 对象</h3>
<p>也许你还记得，<code>.</code> 符号在此前也出现过很多次。比如之前的 <code>now.Year</code> 就表示：</p>
<ul>
<li>通过函数 <code>now</code> 返回的对象 <code>Time</code></li>
<li>对对象 <code>Time</code> 使用 <code>.</code> 获取他的属性 <code>Year</code></li>
</ul>
<p>同样在这里 <code>.</code> 符号也表示获取属性。但是由于之前没有指定被索引的对象，所以这里使用了<u>传入模板的默认数据对象</u>——在思源数据库中，他就**对应了模板列单元所在的****==行本身==**。</p>
<p>例如一个数据库拥有 <code>日期</code>、<code>分数</code>、<code>备注</code> 这些列，我们就可以通过  <code>.日期</code>、<code>.分数</code>、<code>.备注</code> 在模板列中访问他们。</p>
<p>那么除了列本身，还有可以访问的对象吗？</p>
<p>当然有！如果你想知道更加细节的可访问字段，这里有一个简单的技巧：</p>
<ul>
<li>在数据库中新建一个模板列</li>
<li>将模板设置为 <code>.action{toPrettyJson .}</code></li>
<li>将模板列设置为「换行」</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425003536-r3eyzj9.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后你就可以在模板列中看到本数据库中的所有可访问字段了，比如通过 <code>.created</code> 访问行创建的时间。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425003613-zm6ed59.png?imageView2/2/interlace/1/format/webp""></p>
<p>但是注意，并不是所有的属性都可以通过 <code>.</code> 来访问，比如如果我们尝试访问一个名为 <code>.custom-b</code> 的对象，那么会喜提一个报错——因为 custom-b 不符合属性的命名规范。</p>
<p>对于这种情况，可以通过 <code>index . \""name\""</code> 来对属性进行访问，比如这个例子中，我们填写 <code>.action{ index . \""custom-b\""}</code> 就可以访问 <code>custom-b</code> 属性的值了。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506222610-yh5v16v.png?imageView2/2/interlace/1/format/webp""></p>
<p>附注：</p>
<blockquote>
<p>模板使用关联或汇总时，填充值为数组，所以可能需要使用 <code>index .汇总 0</code> 来访问第一个值，或者使用 <code>range</code> 迭代所有值。</p>
<p>参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F11029"">Issue #11029 · siyuan-note/siyuan</a></p>
</blockquote>
<h3 id=""两种主键"">两种主键</h3>
<p>思源的数据库中的主键可以分为两种：</p>
<ol>
<li>普通的文本主键</li>
<li>被绑定到一个块的主键</li>
</ol>
<p>为了方便测试，我们现在新建一个测试用的块，并填写命名、属性、备注还有自定义属性：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507102610-t7dfo2g.png?imageView2/2/interlace/1/format/webp""></p>
<p>以下是不同的两行内部属性的差异：</p>
<ol>
<li>
<p>普通文本主键只有 id、update、created、主键等属性</p>
</li>
<li>
<p>绑定了块的主键，还多出来</p>
<ul>
<li>数据库相关的属性，如 av-names、custom-avs 等</li>
<li>块的内置属性，如命名、别名等</li>
<li>自定义属性，如 \""custom-a\""</li>
</ul>
</li>
<li>
<p>绑定了块的主键，其 ID 指向了被绑定的块，而普通文本主键的 ID 是它自身的 ID</p>
</li>
<li>
<p><strong>注意：普通的文本主键的 ID 并非指向一个块，所以如果你尝试用 SQL 来查询这个 ID 对应的块，是不会得到任何有意义的结果的！</strong></p>
</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507103552-kdpxkmw.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""和-queryBlocks-结合"">和 queryBlocks 结合</h3>
<p>对于主键绑定了块的数据库而言，由于 ID 属性和对应的块打通了沟通渠道，所以把模板列和 queryBlocks 方法结合玩一些更加花哨的功能。</p>
<p>这里给出一个简单的案例：自动获取绑定块的文档的标题</p>
<ol>
<li>
<p>首先使用 queryBlocks 执行 SQL 查询获取对应的文档块，SQL 语句的设计如下：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">root_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'&lt;id&gt;\'</span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>通过 if 语句过滤掉不存在文档块的情况</p>
<ol>
<li>通过  <code>first</code> 函数取出第一个文档块</li>
<li>然后获取它的 Content 字段</li>
</ol>
</li>
<li>
<p>对于不存在文档块的情况，简单输出一个「无」</p>
</li>
</ol>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $blocks := queryBlocks \""select * from blocks where id in (select root_id from blocks where id=\'?\')\"" .id}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ if not (empty $blocks)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ (first $blocks).Content }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">无
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>效果如下：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507112843-cbdn0zc.png?imageView2/2/interlace/1/format/webp""></p>
<p>论坛里有一个帖子，询问：<a href=""https://ld246.com/article/1714938890528"">数据库一些列的值能否自动获取文档里的数据</a>。其实解决思路和上面的是一样的：</p>
<ol>
<li>获取绑定块的 ID</li>
<li>构造 SQL，查询到想要的内容</li>
<li>读取 queryBlocks 的结果，并写入数据库模板列中</li>
</ol>
<h3 id=""和-html-标签结合"">和 html 标签结合</h3>
<p>有一个很重要，但是可能很少人知道的事情：数据库的文本列里面是==可以直接填写 html 元素的==。</p>
<p>举一个例子，我们把如下的 html 粘贴到一个文本列当中：</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    background: conic-gradient(#4CAF50 0%, #4CAF50 75%, #ddd 75%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    border-radius: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    width: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    height: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    position: relative;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      position: absolute;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      top: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      left: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      transform: translate(-50%, -50%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      font-size: 12px;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    75%
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>然后，这个元素就会被完整地渲染在数据库单元内：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507123053-okaheiy.png?imageView2/2/interlace/1/format/webp""></p>
<p>坏消息是：当你再次点击编辑的时候，里面就只剩下纯文本了。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507123148-eotsvzg.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>? 更坏的消息：可能未来某个版本内，文本列不会再支持插入 html 了。</p>
<p>详情请跟踪：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F11255"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/issues/11255</a>。</p>
</blockquote>
<p>好消息是：模板列里面也支持使用自定义的 html 元素。我们不妨再做一个测试：</p>
<ol>
<li>
<p>新建一个数值列“比例”，取值范围从 0 ~ 100</p>
</li>
<li>
<p>将如下的模板粘贴到一个模板列当中，他做的事情很简单：读取「比例」的数值，然后替换到 div 元素当中</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $portion := index . \""比例\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    background: conic-gradient(#4CAF50 0%, #4CAF50 .action{$portion}%, #ddd .action{$portion}%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    border-radius: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    width: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    height: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    position: relative;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      position: absolute;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      top: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      left: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      transform: translate(-50%, -50%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      font-size: 12px;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$portion}%
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
</li>
</ol>
<p>做完以上的工作，数据库就会根据 \""比例\"" 这一列的数值来绘制模板列的样式，从而显示出不同的效果出来：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507123520-gpoz5h2.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<p>‍</p>
<h3 id=""奇奇怪怪的玩法-存在风险-慎用-"">奇奇怪怪的玩法（存在风险，慎用）</h3>
<blockquote>
<p><strong>拓展性花活，普通用户慎用</strong>。</p>
<p>自定义 html + 可执行的 js 是存在安全风险的，这里只是通过这个例子告诉大家数据库可以做到这种程度。</p>
<p>如果你不能百分百确定你在干什么，就不要这么玩。</p>
</blockquote>
<p>先给大家看一个神奇的东西：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/recording-20240507120539-1usqe9v.gif""></p>
<p>在前面我们提到过，数据库的文本实际上是可以直接插入 html 标签的——那既然可以插入 html 标签，那执行一下 js 代码也是非常合理的对吧。</p>
<p>现在我来解释一下上面这个效果的实现方案：</p>
<ol>
<li>
<p>首先将数据库的主键绑定到一个块上——从而保证使用 <code>.id</code> 能访问到块的 id</p>
</li>
<li>
<p>新建一个 css 文本列，用来填写具体的 css 属性表</p>
</li>
<li>
<p>新建一个模板列，里面填写如下内容</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">button</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""margin: 3px;\""</span> <span class=""highlight-na"">class</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""b3-button\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-na"">onclick</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\'event.stopImmediatePropagation(); runJs.api.setBlockAttrs(\"".action{.id}\"", {style: \"".action{index . \""css\""}\""});\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  添加样式
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">button</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
</li>
</ol>
<p>我们来分析一下这个模板：</p>
<ul>
<li>
<p><code>&lt;button style=\""margin: 3px;\"" class=\""b3-button\"" /&gt;</code> 构建了一个按钮元素， <code>b3-button</code> 是思源的内置 class 名称</p>
</li>
<li>
<p>关键是 onclick 元素，我们在 onclick 当中直接填写我们要执行的代码：</p>
<ol>
<li>
<p><code>event.stopImmediatePropagation();</code></p>
<ul>
<li>这行代码是为了阻止思源默认的数据表行为，如果去掉了以后，思源就会弹出一个编辑框，而不会触发点击按钮的事件了</li>
</ul>
</li>
<li>
<p><code>runJs.api.setBlockAttrs</code></p>
<ul>
<li>
<p>这个其实是安装了 <code>RunJs</code> 插件后，插件暴露在外部的一个接口</p>
</li>
<li>
<p>setBlockAttrs 是思源的内核 API，用于为块设置块属性</p>
<ul>
<li>参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fblob%2Fmaster%2FAPI_zh_CN.md%23%25E8%25AE%25BE%25E7%25BD%25AE%25E5%259D%2597%25E5%25B1%259E%25E6%2580%25A7"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md#%E8%AE%BE%E7%BD%AE%E5%9D%97%E5%B1%9E%E6%80%A7</a></li>
</ul>
</li>
<li>
<p>你不一定要安装 runJs 插件，也可以在 JS 代码片段中添加自己想要使用的代码功能</p>
</li>
</ul>
</li>
<li>
<p>setBlockAttrs 接受两个参数：块的 ID，具体的块属性</p>
<ol>
<li>
<p>块 ID：通过模板功能的 <code>.action{.id}</code> 获取</p>
</li>
<li>
<p>块属性：由于我们要设置内联样式属性，所以 API 的 payload body 填写为 <code>{style: \""&lt;具体css代码&gt;\""}</code></p>
<ul>
<li>使用 <code>.action{index . \""css\""}</code> 获取 css 列的内容，填充到 payload body 中</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<p>‍</p>
<h2 id=""思源-Markdown-块语法"">思源 Markdown 块语法</h2>
<blockquote>
<p>严格来说，思源的 Markdown 块语法和模板语法没有半毛钱关系。但是由于在 md 模板文件里面经常需要使用 md 块语法，所以有必要在这里一起介绍一下。</p>
</blockquote>
<p>我们都知道思源是以块为单位的，同时思源一定程度上兼容了 markdown 语法格式（例如在模板文件中）——那么问题来了，markdown 原始的语法就是个瘸子，根本不存在块的概念，更不用提块属性这种概念了——这可怎么办呢。</p>
<p>对于最普通的情况来说来讲，一个 markdown 内置的语法元素，例如标题、列表、引述等等，也会被转化为一个单独的块。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506181637-xicsp7g.png?imageView2/2/interlace/1/format/webp""></p>
<p>而对于更加复杂的情况，思源实现了一种基于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fkramdown.gettalong.org%2F"" target=""_blank"" rel=""nofollow ugc"">kramdown</a> 的 markdown 方言。通过这个方言我们可以在一个普通的 markdown 纯文本文件中定义块及其内部的属性。</p>
<ul>
<li>思源的 markdown 这些拓展属性语法，不仅仅可以用在模板的 md 文件里， 还可以直接用在编辑器中。</li>
<li>在阅读下面的示例的时候，你可以把给出的 md 模板样例复制之后<strong>直接粘贴</strong>到思源的编辑器中，思源同样能够正确识别定义的块属性。</li>
</ul>
<h3 id=""块属性声明语法"">块属性声明语法</h3>
<p>思源可以通过 <code>{: }</code> 这种内联样式表 （简称：<strong>ial</strong>) 的形式来声明一个具备特定属性的块，内联样式表的基本语法格式为如下，注意括号两侧必须留出空格。</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">{</span>: &lt;key1&gt;=\""&lt;value&gt;1\"" &lt;key1&gt;=\""&lt;value&gt;1\"" <span class=""highlight-nb"">}</span>
</span></span></code></pre>
<p>例如，你可以把以下的文本填入 <code>templates</code> 下的 Test.md 文件：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">这是一个简单的段落，但是我会声明「备注」内联样式和「custom-a」自定义属性。
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: memo=\""这是一个块\""  custom-a=\""a\"" }
</span></span></code></pre>
<p>而将这个模板应用到思源正文后，就会创建一个填充了备注和 custom-a 属性的块。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506182531-ka4hdqv.png?imageView2/2/interlace/1/format/webp""></p>
<p>再比如，在使用了 callout （由 Savor 主题以及 callout 插件提供）功能后，想要通过模板快速插入一个 callout——通过观察发现 callout 样式主要依赖于对一个引述块添加 <code>custom-b</code> 属性，所以我们可以首先在 Test.md 中编写引述块的 markdown 语法，然后在下方紧贴着添加 <code>{: }</code> 属性表：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">Meta
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">- ? 文档类型：主题文档 | 事件记录
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">- ⭐ 相关主题：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">- ? 基本介绍：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span>{: custom-b=\""info\"" }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506183155-cwhpxrt.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>注 ：可以使用的块属性包括了<strong>块的内置属性</strong>和<strong>自定义属性</strong></p>
<ol>
<li>可以使用内置样式包括：id, name, alias, bookmark, memo, style</li>
<li>在设置自定义样式的时候，不要忘了添加 <code>custom-</code> 前缀</li>
</ol>
</blockquote>
<h4 id=""Special-Case--ID-属性"">Special Case: ID 属性</h4>
<p>我们可以在 ial 表中定义 ID 属性，比如这样：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">这是一个块，你猜他的 ID 会是什么？
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: id=\""20231004221035-p9r4sh7\""}
</span></span></code></pre>
<p>然而，在 ial 表中定义的 ID 属性并不会真正应用到编辑器的块中——也就是说就算使用了上述的模板，新创建的块的 ID 并不会等于 \""20231004221035-p9r4sh7\""，而是思源自己生成的新的块 ID。</p>
<p>id 属性在 ial 中<strong>唯一的作用</strong>是作为 ial 中的<strong>占位符</strong>来声明一个块——因为一个空的 ial 表是无效的。</p>
<p>听起来像是脱裤子放屁——确实，在大部分情况下，这个 trick 都没有什么用。</p>
<p>但是在处理复杂容器块的时候，我们会不得不使用这个 trick 来区分容器块和内部的内容块。这里给一个例子：</p>
<blockquote>
<p>假定：我们需要编写一个内容为空的列表块，并给这个列表块添加  <code>style=\""border: 1px solid blue;\""</code> 属性（也就是添加外边框的内联 css 样式）。请问要怎么办呢？</p>
</blockquote>
<p>你可能会写出如下的模板样式</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""background: red;\"" }
</span></span></code></pre>
<p>但是以上的模板是无效的。</p>
<p>原因在于，思源中的列表块是一个非常复杂的嵌套对象，一个最简单的单个项目的列表，实际上也包含了三个部分：</p>
<ul>
<li>最内部的段落块</li>
<li>段落块外部的列表项块</li>
<li>列表项从属的列表块</li>
</ul>
<p>而在以上的模板中，思源无法识别 <code>{: style=\""background: red;\"" }</code> 到底是应用在哪个块上面。</p>
<p>在这种情况下，我们必须要通过类似 <code>{: id=\""20231004221035-p9r4sh7\""}</code> 这样的样式表，来明确声明三层块结构，也就是要写成这样子：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> {: id=\""202001010000-abcdefg\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  {: id=\""202001010000-abcdefg\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 1px solid blue;\"" }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506185002-bcpih90.png?imageView2/2/interlace/1/format/webp""></p>
<p>另外虽然 <code>id</code> 的值实际上没有什么卵用，但是在填写的时候必须要遵守 ID 的格式规范，否则无法被正常识别：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">yyyymmddHHMMSS-<span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">7</span><span class=""highlight-err"">位字符或数字</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>诸如 \""202001010000-abcdefg\""、\""202001010000-1234567\""这些都是可以的，而 \""123\"" 这种是不行的。</p>
<h3 id=""超级块排版"">超级块排版</h3>
<p>思源支持通过超级块来进行复杂排版，这个排版同样可以通过拓展的 markdown 语法来定义：</p>
<ul>
<li>
<p>多行超级块（垂直布局）</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{{row
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">&lt;</span>内部内容&gt;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span></code></pre>
</li>
<li>
<p>多列超级块（水平布局）</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{{col
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">&lt;</span>内部内容&gt;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span></code></pre>
</li>
</ul>
<p>具体编写的时候，只需要把 &lt; 内部内容 &gt; 当中替换为正常的块定义即可。然后渲染的时候，内部内容就会按照垂直或者水平布局被囊括在一个新的超级块当中。</p>
<p>这里给一个稍微复杂一点的样例，如果你把这个样例理解了，超级块排版的布局基本上就掌握了。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{{col
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{{row
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu"">### TODO：高优先
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [x]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 2px solid blue;\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{{row
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu"">### TODO：低优先
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [x]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 2px solid blue;\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 2px solid red; padding: 10px;\""}
</span></span></code></pre>
<p>插入编辑器后，样式如下：</p>
<ul>
<li>
<p>最外部是一个水平布局的超级块，内部有两列垂直布局的超级块</p>
</li>
<li>
<p>内部的两个列中，各自都是一个垂直布局的超级块，包括</p>
<ul>
<li>最上面一个标题块</li>
<li>最下面一个任务块</li>
</ul>
</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506190204-zttf5jf.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""相关参考资料"">相关参考资料</h2>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2F"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgeekdaxue.co%2Fread%2Fachuan-2%40siyuan%2FuAfT29sMbD-a5AmI"" target=""_blank"" rel=""nofollow ugc"">https://geekdaxue.co/read/achuan-2@siyuan/uAfT29sMbD-a5AmI</a></li>
<li><a href=""https://ld246.com/article/1627298479208"">https://ld246.com/article/1627298479208</a></li>
</ul>
                

作者：Frostime
链接：https://ld246.com/article/1715065433237
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
695,思源模板功能新人指南：模板语法 + 函数 + md 块语法 - 链滴,Tue May 07 2024 15:03:52 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>Sy 源文件</p>
<p><a href=""https://b3logfile.com/file/2024/05/思源模板功能新人指南_模板语法_函数_md块语法-0TnDYhE.sy.zip"">思源模板功能新人指南模板语法函数 md 块语法.sy.zip</a></p>
</blockquote>
<p>什么是模板？模板，简单来说就是在一段文本中定义一些「<strong>变量</strong>」，这些<strong>变量</strong>在<strong>实际渲染</strong>的时候会按照一定的<strong>规则</strong>被替换为<strong>实际的值</strong>。</p>
<p>比如我们最常见的日记路径模板：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">/daily note/{{now | date \""2006/01\""}}/{{now | date \""2006-01-02\""}}
</span></span></code></pre>
<p>在每天调用 Alt+5 快捷键创建日记的时候，思源就会渲染以上的模板，把其中由 <code>{{}}</code> 内部定义的变量替换为实际的值（在这里是日期），最后变为 <code>/daily note/2024/01/01-31</code> 这样具有实际意义的路径字符串。</p>
<p>思源的模板在功能上非常强大，然而实际用起来的感受——作为一个笔记软件的模板而言——老实说，使用起来还挺繁杂的。</p>
<p>这篇文章不会帮你完全掌握思源的模板功能，而是尽量提纲挈领地告诉大家思源模板功能的概况。如果你想要深入了解甚至熟练掌握——那你需要去认真看看相关文档，并抽空练习。</p>
<hr>
<p>从总体上讲，我会把思源的模板功能划分为这么几个重要的版块：</p>
<ul>
<li>
<p>基于 Golang 的模板语法</p>
<ul>
<li>
<p>基本语法</p>
<ul>
<li><code>{{ }}</code> vs  <code>.action{}</code></li>
</ul>
</li>
<li>
<p>常用的模板函数</p>
</li>
<li>
<p>常用的流程控制</p>
<ul>
<li>条件控制</li>
<li>循环控制</li>
</ul>
</li>
</ul>
</li>
<li>
<p>数据库中的用法</p>
</li>
<li>
<p>Markdown 块语法</p>
<ul>
<li><code>{: }</code> 块属性声明语法</li>
<li>超级块排版声明语法</li>
</ul>
</li>
</ul>
<p>在正式讲解之前，有必要先把这几个版块之间的关系厘清楚：</p>
<ol>
<li>
<p><strong>Golang 模板语法和 Sprig</strong></p>
<ul>
<li>
<p>思源的模板的语法是基于 Golang 的模板引擎来实现的</p>
</li>
<li>
<p>Golang 的模板引擎并没有提供多少好用的模板函数，所以思源又内置了 Sprig 库——这个库提供了大量丰富的模板函数，来增强模板的功能性</p>
</li>
<li>
<p>基本语法</p>
<ul>
<li>原始的 Golang 模板语法是 <code>{{ xxx }}</code></li>
<li>但是在思源中 <code>{{ }}</code> 又是嵌入块的声明语法</li>
<li>为了避免冲突，开发者就自定义了 <code>.action{ xxx }</code> 语法来替换原始的 <code>{{ xxx }}</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>数据库模板列</strong></p>
<ul>
<li>思源目前的数据库当中，可以创建一个「模板列」，在这个列当中可以使用 <code>.action{}</code> 语法，这样就可以在模板列中根据对应行的内容动态展示其内容</li>
<li>一个类似的例子：就好比在 excel 中增加一列公式</li>
</ul>
</li>
<li>
<p><strong>Markdown 块语法</strong></p>
<ul>
<li>Markdown 本身是没有块结构的；思源实现了一种基于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fkramdown.gettalong.org%2F"" target=""_blank"" rel=""nofollow ugc"">kramdown</a> 的 markdown 方言；这个方言不属于 Golang 模板语法的一部分，而是属于思源自己的特殊语法</li>
<li>基于这种方言，思源就可以在模板文件中为块预定义自定义属性、通过特殊的语法创建复杂的超级块排版</li>
<li>注意：<strong>这个语法和 Golang 模板无关</strong>，在数据库 、路径模板的这些地方使用是不会起效果的！</li>
</ul>
</li>
</ol>
<p>‍</p>
<h2 id=""前附-Test-Template-插件"">前附：Test-Template 插件</h2>
<p>在这篇教程之外，我上架了一个插件“测试模板语法”以方便大家测试 Golang 的模板语法。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506191258-tf2dld7.png?imageView2/2/interlace/1/format/webp""></p>
<p>你可以在阅读的过程中，使用这个插件对模板语法进行测试。插件的详细用法见说明文档。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506191602-jotsgpw.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h2 id=""思源-Golang-模板语法-Cheatsheet"">思源 Golang 模板语法 Cheatsheet</h2>
<p>基本的模板语法讲起来不够直观，这里我画了一个 cheatsheet 给大家展示，信息密度高一点会更加方便理解。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240420120805-g833ble.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240420113639-7pof0uh.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506220115-22huyht.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506220143-12xnhjr.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""基础语法快速总结"">基础语法快速总结</h3>
<ol>
<li>
<p>使用 <code>{{ }}</code> 或者 <code>.action{}</code> 来定义模板，里面一般是函数调用</p>
</li>
<li>
<p>函数的基本概念</p>
<ol>
<li>函数可以接受零个或者若干个参数，进行计算后返回一个特定的值</li>
<li>函数的参数和返回值有特定的类型，不同类型之间不能混用</li>
</ol>
</li>
<li>
<p>变量的赋值</p>
<ul>
<li>如果使用 <code>{{ now }}</code> 这种语法，模板引擎会直接将其渲染为具体的值</li>
<li>但是如果使用 <code>{{ $t := now}}</code> 这种语法，那么 <code>now</code> 的返回值会存储在变量 <code>$t</code> 中而不会渲染内部具体的值，此后就可以使用 <code>$t</code> 来引用这个变量</li>
</ul>
</li>
<li>
<p>使用函数</p>
<ul>
<li>
<p>函数是一个封装好的功能包，输入一些参数，进行特定的计算，返回特定的值</p>
</li>
<li>
<p>传入函数的参数类型要和函数接受的参数类型匹配</p>
</li>
<li>
<p><code>|</code> 语法：管道语法，这是一种在计算机领域非常常见的语法，相关参考</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.topgoer.com%2F%25E5%25B8%25B8%25E7%2594%25A8%25E6%25A0%2587%25E5%2587%2586%25E5%25BA%2593%2Ftemplate.html%23pipeline"" title=""Template · Go语言中文文档"" target=""_blank"" rel=""nofollow ugc"">Template · Go 语言中文文档</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F562210220"" title=""linux之管道符详解 - 知乎"" target=""_blank"" rel=""nofollow ugc"">linux 之管道符详解 - 知乎</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507002214-qvfc2yx.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""控制流语法快速介绍"">控制流语法快速介绍</h3>
<p>Go 语言模板控制流的用法可以参考官方文档：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftext%2Ftemplate%23hdr-Actions"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/text/template#hdr-Actions</a></p>
<p>这里介绍最常用的：</p>
<ol>
<li>
<p>if 语句：通过条件判断来<strong>有选择性</strong>地渲染、执行一部分模板语法</p>
<p>基本的用法是：如果 <code>condition</code> 中的条件被判定为 true，则渲染 <code>T1</code> 否则渲染 <code>T2</code></p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{if (condition)}} T1 {{else}} T0 {{end}}
</span></span></code></pre>
<p>例如：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ if eq (Weekday now) 1 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">好好工作
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ else }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">摸鱼!
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ end }}
</span></span></code></pre>
<p>在这里的 condition 中：</p>
<ol>
<li>
<p>首先计算 <code>Weekday now</code> 获取今天的星期数</p>
</li>
<li>
<p>然后通过 <code>eq</code> 和 1 对比，看看是不是周一；</p>
<ol>
<li>如果是，就渲染「好好工作」</li>
<li>如果不是，就渲染「摸鱼！」</li>
</ol>
</li>
</ol>
<blockquote>
<p>如果你不理解这里用到的 <code>eq</code> 函数，请不要焦虑，在后面的部分我们会详细说明在 if 语句中常常用到的函数。</p>
</blockquote>
</li>
<li>
<p>range 语句</p>
<p>range 语句被用来在一个序列当中进行迭代，最常见的语法如下</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ range $v := <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">slice</span><span class=""highlight-p"">&gt;</span> }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  {{ $v }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ end }}
</span></span></code></pre>
<p>这里的含义是：</p>
<ul>
<li>在一个可迭代的 <code>&lt;slice&gt;</code> （通常是一个列表 <code>List</code>）中迭代</li>
<li>每次取出一个值赋值给 <code>$v</code></li>
<li>我们就可以在 range 块内部访问这个 <code>$v</code> 变量</li>
</ul>
<p>一个简单的案例如下：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ $list := list 1 2 3 4 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ range $v := $list }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">-</span> Index: {{ $v }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ end }}
</span></span></code></pre>
<p>这里我们首先通过 <code>list</code> 函数创建一个列表（后面会介绍这个函数），然后在 <code>range</code> 中迭代这个列表，依次访问每个值。</p>
<p>渲染结果为：</p>
<blockquote>
<ul>
<li>Index: 1</li>
<li>Index: 2</li>
<li>Index: 3</li>
<li>Index: 4</li>
</ul>
</blockquote>
</li>
</ol>
<p>这里介绍的是最简单的控制流语法，还有更高级的用法请自行探索。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507002650-o2zntfu.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""常用函数介绍"">常用函数介绍</h2>
<p>函数是想要用好模板功能必定绕不开的一座大山。在上面的 Cheatsheet 中，我们简要介绍过函数的基本概念——函数就是一个封装好的功能包，他可以接收零个或者多个（视函数而定）参数，并计算得到一个输出。</p>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{{</span> <span class=""highlight-nx"">now</span> <span class=""highlight-p"">}}</span> <span class=""highlight-err"">#</span> <span class=""highlight-nx"">now</span> <span class=""highlight-err"">函数，接收</span> <span class=""highlight-mi"">0</span> <span class=""highlight-err"">个参数，输出当前的时间对象</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{{</span> <span class=""highlight-nx"">add</span> <span class=""highlight-mi"">1</span> <span class=""highlight-mi"">2</span> <span class=""highlight-mi"">3</span> <span class=""highlight-mi"">4</span><span class=""highlight-p"">}}</span> <span class=""highlight-err"">#</span> <span class=""highlight-nx"">add</span> <span class=""highlight-err"">函数，接收任个</span> <span class=""highlight-kt"">int</span> <span class=""highlight-err"">（整数）参数，输出他们的累加结果</span>
</span></span></code></pre>
<p>思源中支持的函数很多，有 Sprig 包支持的也有思源内置的。而实际在思源中常用的函数，我把他们分类为这几类：</p>
<ol>
<li>
<p>算术计算</p>
<ul>
<li>整数算术（int 类型）</li>
<li>浮点数算术（float 类型）</li>
</ul>
</li>
<li>
<p>时间计算</p>
</li>
<li>
<p>字符串操作</p>
</li>
<li>
<p>列表计算</p>
</li>
<li>
<p>类型转换（偶尔）</p>
</li>
<li>
<p>逻辑运算（在写条件块的时候要用）</p>
</li>
<li>
<p>思源模板片段特殊函数</p>
</li>
</ol>
<p>为了方便，我这里整理了最常用的一些函数，进行简单介绍。在介绍的过程中，遵循以下的格式：</p>
<ul>
<li>
<p><code>Fun</code> 代表一个没有参数的函数，比如 <code>now</code></p>
</li>
<li>
<p><code>Fun &lt;int&gt;, &lt;int&gt;</code> 代表有几个固定数量参数的函数，比如 <code>sub &lt;int&gt; &lt;int&gt;</code>；<code>&lt;int&gt;</code> 代表了参数的类型，常用类型还有</p>
<ul>
<li>
<p><code>int</code>：整数类型</p>
<ul>
<li><code>int64</code>：64 位的整数类型，需要通过类型转换函数和 <code>int</code> 类型做转换</li>
</ul>
</li>
<li>
<p><code>float</code>：浮点数类型</p>
<ul>
<li><code>float64</code>：64 位的浮点数类型，需要通过类型转换函数和 <code>float</code> 类型做转换</li>
</ul>
</li>
<li>
<p><code>list</code>：列表类型</p>
</li>
<li>
<p><code>str</code>：字符串类型</p>
</li>
<li>
<p><code>bool</code>：布尔类型（<code>true</code> 或者 <code>false</code>）</p>
</li>
<li>
<p><code>Time</code>：时间对象类型（这个类型会在后面有更加详细的解释）</p>
</li>
</ul>
</li>
<li>
<p><code>Func [&lt;int&gt;,]</code> 代表有不定长数量参数的函数，比如 <code>add</code> 后面可以跟好多个整数</p>
</li>
</ul>
<p>同时我还会给出一些使用范例，以及渲染后的效果，以供参考。</p>
<h3 id=""常用数值计算函数"">常用数值计算函数</h3>
<ul>
<li>
<p>Sprig 函数</p>
<ul>
<li>
<p>整型 int 计算：完整文档见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fmath.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/math.html</a></p>
<ul>
<li><code>add [&lt;int64&gt;,]</code>：<code>int64</code>，累加</li>
<li><code>sub &lt;int64&gt; &lt;int64&gt;</code>：<code>int64</code>，减法</li>
<li><code>mul [&lt;int64&gt;,]</code>：<code>int64</code>，累乘</li>
<li><code>div &lt;int64&gt; &lt;int64&gt;</code> ：<code>int64</code>，整除</li>
<li><code>mod &lt;int64&gt; &lt;int64&gt;</code>：<code>int64</code>，求余</li>
<li><code>min [&lt;int64&gt;,]</code> 和 <code>max [&lt;int64&gt;,]</code>：<code>int64</code>，求最小值和最大值</li>
</ul>
</li>
<li>
<p>浮点型 float 计算：完整文档见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fmathf.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/mathf.html</a></p>
</li>
<li>
<blockquote>
<p><strong>注：Sprig 的数值运算是在 int64 和 float64 类型上进行的，但是很多函数只接受 int 或 float 类型，所以很多时候要配合类型转换函数来使用，这一点会在下面的小节中详细说明</strong></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>思源内置数值函数</p>
<ul>
<li>
<p><code>pow &lt;int&gt;</code>：指数计算，返回整数</p>
</li>
<li>
<p><code>powf &lt;float&gt;</code>：指数计算，返回浮点数</p>
</li>
<li>
<p><code>log &lt;int&gt;</code>：对数计算，返回整数</p>
</li>
<li>
<p><code>logf &lt;float&gt;</code>：对数计算，返回浮点数</p>
</li>
<li>
<p><code>FormatFloat &lt;format str&gt; &lt;n float64&gt;</code>：<code>string</code>，说老实话我不能理解这个函数，这是一个老外要求加的，请参考</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Fgithub.com%2Fdustin%2Fgo-humanize%23FormatFloat"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/github.com/dustin/go-humanize#FormatFloat</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F11158"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/issues/11158</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fliuyun.io%2Farticle%2F1713131424994"" target=""_blank"" rel=""nofollow ugc"">https://liuyun.io/article/1713131424994</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>案例:</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- add
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ add 1 2 3 4 }} -&gt; 10
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- sub
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ sub 4 1 }} -&gt; 3
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- mul
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ mul 1 2 3 4 }} -&gt; 24
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- div
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ div 5 2 }} -&gt; 2.5
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- mod
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ mod 5 2 }} -&gt; 1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- min/max
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ min 5 1 }} -&gt; 1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ max 5 1 }} -&gt; 5
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- pow
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ pow 5 2 }} -&gt; 25
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- powf
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ powf 2.5 2 }} -&gt; 6.25
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- log
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ log 5 2 }} -&gt; 2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- logf
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ logf 5 2 }} -&gt; 约 2.32
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- FormatFloat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ FormatFloat \""#,###.##\"" 2345.6789 }} -&gt; 2,345.68
</span></span></code></pre>
<p>以上的模板会被渲染为：</p>
<blockquote>
<ul>
<li>
<p>add</p>
<ul>
<li>10 -&gt; 10</li>
</ul>
</li>
<li>
<p>sub</p>
<ul>
<li>3 -&gt; 3</li>
</ul>
</li>
<li>
<p>mul</p>
<ul>
<li>24 -&gt; 24</li>
</ul>
</li>
<li>
<p>div</p>
<ul>
<li>2 -&gt; 2.5</li>
</ul>
</li>
<li>
<p>mod</p>
<ul>
<li>1 -&gt; 1</li>
</ul>
</li>
<li>
<p>min/max</p>
<ul>
<li>1 -&gt; 1</li>
<li>5 -&gt; 5</li>
</ul>
</li>
<li>
<p>pow</p>
<ul>
<li>25 -&gt; 25</li>
</ul>
</li>
<li>
<p>powf</p>
<ul>
<li>6.25 -&gt; 6.25</li>
</ul>
</li>
<li>
<p>log</p>
<ul>
<li>2 -&gt; 2</li>
</ul>
</li>
<li>
<p>logf</p>
<ul>
<li>2.321928094887362 -&gt; 约 2.32</li>
</ul>
</li>
<li>
<p>FormatFloat</p>
<ul>
<li>2,345.68 -&gt; 2,345.68</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id=""常用的时间函数"">常用的时间函数</h3>
<ul>
<li>
<p>Sprig 常用函数</p>
<ul>
<li>
<p>所有函数见：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fdate.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/date.html</a></p>
</li>
<li>
<p><code>now</code>：<code>Time</code>，返回当前的时间</p>
</li>
<li>
<p><code>date &lt;fmt str&gt; &lt;Time&gt;</code>：<code>str</code>, 将输入的时间对象格式化为字符串</p>
<ul>
<li>
<p><code>fmt</code> 使用 <code>2006-01-02 15:04:05</code> 这个固定时间格式（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F366830553"" target=""_blank"" rel=""nofollow ugc"">知乎讨论</a>）</p>
</li>
<li>
<p>教你如何记忆这个 ?️ 垃圾到 ? 爆炸的 magin number</p>
<ul>
<li>首先年份固定是 2006</li>
<li>后面的月日时分秒从 01 开始依次递增到 05</li>
<li>所以标准格式为：<code>2006-01-02 03:04:05</code></li>
<li>但是 <code>03:04:05</code> 是 12 小时制，所以如果想用 24 小时制，要换算成 <code>2006-01-02 15:04:05</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>toDate &lt;fmt str&gt; &lt;str&gt;</code>：<code>Time</code> ，将一个字符串转换为一个时间对象</p>
<ul>
<li>注：思源内置的 <code>parseTime</code> 函数使用体验比这个函数要好一点</li>
</ul>
</li>
<li>
<p><code>duratioin &lt;second: int&gt;</code>：<code>Duration</code>, 将传入的秒数（int）转换为 <code>Duration</code> 对象</p>
</li>
</ul>
</li>
<li>
<p>思源内置时间函数</p>
<ul>
<li><code>ISOWeek &lt;Time&gt;</code>：<code>int</code>，返回对应的时间对应今天的第几周</li>
<li><code>Weekday &lt;Time&gt;</code>：<code>int</code>，返回对应的时间是星期几 ；<code>Sunday=0, Monday=1, ..., Saturday=6</code></li>
<li><code>WeekdayCN &lt;Time&gt;</code>：<code>str</code>，返回对应的时间是星期几；<code>Sunday=日, Monday=一, ..., Saturday=六</code></li>
<li><code>WeekdayCN2 &lt;Time&gt;</code>：<code>str</code>，返回对应的时间是星期几；<code>Sunday=天, Monday=一, ..., Saturday=六</code></li>
<li><code>parseTime &lt;string&gt;</code>：<code>Time</code>，解析传入的时间字符串，返回一个时间类型</li>
</ul>
</li>
<li>
<p><code>Time</code>：Golang 的 time.Time 类型，这个类型里面有不少有用的属性可以访问</p>
<ul>
<li>
<p><strong>完整函数参考</strong>：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime%23Time"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/time#Time</a></p>
<ul>
<li>请查找格式为 <code>func (t Time) Func(xxx) XXX</code> 的 API 文档</li>
<li>这类函数（属性）都可以在模板中通过 <code>t.Func</code> 来调用</li>
</ul>
</li>
<li>
<p><code>Year</code>:  <code>int</code></p>
</li>
<li>
<p><code>Month</code>: <code>Month</code>，这是一个枚举类型</p>
<ul>
<li>虽然显示是英文字符串，但是可以当作数值类型参与计算，例如 <code>add 1 now.Month</code></li>
<li>详情参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime%23Month"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/time#Month</a></li>
</ul>
</li>
<li>
<p><code>Day</code>: <code>int</code></p>
</li>
<li>
<p><code>Hour</code>: <code>int</code></p>
</li>
<li>
<p><code>Minute</code>: <code>int</code></p>
</li>
<li>
<p><code>Second</code>: <code>int</code></p>
</li>
<li>
<p><code>Sub &lt;Time&gt;</code>: 计算两个时间之间的差，返回 <code>Duration</code></p>
</li>
<li>
<p><code>Compare &lt;Time&gt;</code>：比较两个时间对象，返回 <code>int</code>, -1 或 0 或 1</p>
</li>
<li>
<p><code>AddDate &lt;year int&gt; &lt;month int&gt; &lt;day int&gt;</code>: <code>int</code>，在当前的时间对象的基础上计算 N 天（月、 年）后的日期（参数可以为负数）</p>
<ul>
<li>注意，这个函数对月份的处理比较坑，只建议使用 year 和 day 这两个参数</li>
<li>详情参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Flearnku.com%2Farticles%2F71760"" target=""_blank"" rel=""nofollow ugc"">令人困惑的 Go time.AddDate</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Duration</code>: Golang 的 time.Duration 类型</p>
<ul>
<li>
<p><strong>完整文档见</strong>：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime%23Duration"" target=""_blank"" rel=""nofollow ugc"">https://pkg.go.dev/time#Duration</a></p>
<ul>
<li>请查找格式为 <code>func (d Duration) Func(xxx) XXX</code> 的 API 文档</li>
<li>这类函数是可以在模板中通过 <code>t.Func</code> 来调用</li>
</ul>
</li>
<li>
<p><code>Hours</code>：<code>float64</code>，将 Duration 转换为以小时为单位的数值</p>
</li>
<li>
<p><code>Minutes</code>: <code>float64</code>，将 Duration 转换为以分钟为单位的数值</p>
</li>
<li>
<p><code>Seconds</code>: <code>float64</code>，将 Duration 转换为以秒为单位的数值</p>
</li>
<li>
<p><code>String</code>: <code>str</code>, 将 Duration 按照小时制转换为字符串，显示的格式为 \""72h3m0.5s\""</p>
</li>
</ul>
</li>
</ul>
<p>案例：</p>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- now
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- date
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ date \""2006-01-02 15:04:05\"" now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- toDate
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ toDate \""2006-01-02\"" \""2020-01-01\"" }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- duration
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - 1800 second: {{ duration 1800 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- ISOWeek
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - 第 {{ now | ISOWeek }} 周
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- Weekday
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - 今天是星期:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ now | Weekday }} {{ now | WeekdayCN }} {{ now | WeekdayCN2 }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- parseTime
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ parseTime \""2020-01-01 12:00:00\"" }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- Time 对象
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t := parseTime \""2020-01-01 12:00:00\"" }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t.Year }}/{{ $t.Month }}/{{ $t.Day }} {{ $t.Hour }}:{{ $t.Minute }}:{{ $t.Second }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ now.Sub $t }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t.Compare now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $t.AddDate 0 0 7}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- Duration 对象
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du := now.Sub $t }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du.Hours }}; {{ $du.Minutes }}; {{ $du.Seconds }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ $du.String }}
</span></span></code></pre>
<p>以上的模板会被渲染为：</p>
<blockquote>
<ul>
<li>
<p>now</p>
<ul>
<li>2024-05-06 22:08:49.9662126 +0800 CST m=+477.037392501</li>
</ul>
</li>
<li>
<p>date</p>
<ul>
<li>2024-05-06 22:08:49</li>
</ul>
</li>
<li>
<p>toDate</p>
<ul>
<li>2020-01-01 00:00:00 +0800 CST</li>
</ul>
</li>
<li>
<p>duration</p>
<ul>
<li>1800 second: 0s</li>
</ul>
</li>
<li>
<p>ISOWeek</p>
<ul>
<li>第 19 周</li>
</ul>
</li>
<li>
<p>Weekday</p>
<ul>
<li>今天是星期:</li>
<li>1 一 一</li>
</ul>
</li>
<li>
<p>parseTime</p>
<ul>
<li>2020-01-01 12:00:00 +0800 CST</li>
</ul>
</li>
<li>
<p>Time 对象</p>
<ul>
<li>‍</li>
<li>2020/January/1 12:0:0</li>
<li>38098h8m49.9662126s</li>
<li>-1</li>
<li>2020-01-08 12:00:00 +0800 CST</li>
</ul>
</li>
<li>
<p>Duration 对象</p>
<ul>
<li>‍</li>
<li>38098h8m49.9662126s</li>
<li>38098.14721283683; 2.28588883277021e+06; 1.371533299662126e+08</li>
<li>38098h8m49.9662126s</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<p>日期计算可能是思源用户最常接触到的函数了，如果你是一个 daily note 用户，现在打开你主日记本，查看一下你日记的模板会发现它可能是这个样子:</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425010132-2lge3ze.png?imageView2/2/interlace/1/format/webp""></p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">/daily note/{{now | date \""2006/01\""}}/{{now | date \""2006-01-02\""}}
</span></span></code></pre>
<p>现在我们有了理论基础，不妨就这个案例来看一下这个日记模板是怎么回事：</p>
<ol>
<li>
<p><code>{{}}</code> 是 Golang 标准的模板语法，没什么好说的</p>
</li>
<li>
<p><code>now</code> 函数返回了一个 <code>Time</code> 对象</p>
</li>
<li>
<p><code>|</code> 通过管道运算，把 <code>now</code> 的结果传给后面，所以相当于在运行 <code>date \""2006/01\""</code></p>
<blockquote>
<p>你可以把 <code>{{now | date \""2006/01\""}</code> 换成 <code>{{date \""2006/01\"" now}}</code>；他们两个是完全等价的</p>
</blockquote>
</li>
<li>
<p><code>date &lt;fmt str&gt; &lt;Time&gt;</code> 是固定搭配的用法，这里 <code>\""2006/01\""</code> 也是固定的用法</p>
</li>
<li>
<p>所以最后，这个模板会被渲染为 <code>yyyy/mm</code> 这样的格式，和前面的组合起来，就会形成 <code>/daily note/&lt;年份&gt;/&lt;月份&gt;</code> 这样的路径字符串</p>
</li>
</ol>
<p>‍</p>
<h4 id=""分享几个日期计算的模板片段"">分享几个日期计算的模板片段</h4>
<p>就经验来看，在正常 md 模板中会写得比较复杂的也只有和日期计算相关的模板了。这里随便分享几个。</p>
<ul>
<li>
<p>可能会用到日记里面的</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $weekday := WeekdayCN now }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr := now | date \""2006-01-02\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">今天是 .action{$datestr} 星期.action{ $weekday }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-dailynote-${ $datestr_sy }=\"".action{$datestr_sy}\"" }
</span></span></code></pre>
</li>
<li>
<p>计算这周周日、上周周六等</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $weekday := Weekday now }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $begSunday := now.AddDate 0 0 (mul -1 $weekday | int) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $last6 := $begSunday.AddDate 0 0 -1 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $this6 := $begSunday.AddDate 0 0 6 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- 如果以周日为一周的起始，那么本周周日为：.action{ $begSunday | date \""2006-01-02\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- 上周周六为：.action{ $last6 | date \""2006-01-02\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- 本周周六为：.action{ $this6 | date \""2006-01-02\"" }
</span></span></code></pre>
</li>
<li>
<p>周规划</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $week := now | ISOWeek }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $weekday := now | Weekday }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $monday_delta := sub $weekday 1 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if eq $weekday -1}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  .action{ $monday_delta := 6 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $monday := now.AddDate 0 0 (mul -1 $monday_delta | int) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $sunday := $monday.AddDate 0 0 6 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">## 第 .action{$week} 周: .action{$monday | date \""2006-01-02\""} ~ .action{$sunday| date \""2006-01-02\""}
</span></span></code></pre>
</li>
</ul>
<h3 id=""常用字符串操作函数"">常用字符串操作函数</h3>
<p>字符串操作函数在正常 md 模板里面用的没那么多，但是在数据库模板列里面可能会大量用到。</p>
<blockquote>
<p>只列举了很小的一部分，完整文档见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fstrings.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/strings.html</a> 和 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fstring_slice.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/string_slice.html</a></p>
</blockquote>
<ul>
<li><code>trim &lt;str&gt;</code>: <code>str</code>， 将前后的空白字符去掉</li>
<li><code>repeat &lt;int&gt; &lt;str&gt;</code>：<code>str</code>，将给定的字符串重复若干次</li>
<li><code>substr &lt;start int&gt; &lt;end int&gt; &lt;str&gt;</code>: <code>str</code>，提取子字符串，index 从 0 开始</li>
<li><code>trunc &lt;int&gt; &lt;str&gt;</code>: <code>str</code>，将给定的字符串按照最大长度来截断；<code>&lt;int&gt;</code> 参数可以是负数，代表从末尾反向截断</li>
<li><code>abbrev &lt;int&gt; &lt;str&gt;</code>: <code>str</code>，同样是截断字符串，但是会在后面加上一个 <code>...</code></li>
<li><code>contains &lt;part str&gt; &lt;whole str&gt;</code>: <code>bool</code>，检测 <code>whole</code> 中是否包含 <code>part</code></li>
<li><code>cat [&lt;str&gt;,]</code>: <code>str</code>，将若干字符串拼接起来，中间通过空格间隔</li>
<li><code>replace &lt;from str&gt; &lt;to str&gt; &lt;src str&gt;</code> : <code>str</code>，将 <code>src</code> 中所有的 <code>from</code> 替换成 <code>to</code></li>
<li>正则表达式系列的函数（请自行翻阅<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fstrings.html"" target=""_blank"" rel=""nofollow ugc"">文档</a>）</li>
<li><code>join &lt;ch str&gt; &lt;List[str]&gt;</code>: <code>str</code>，将给定的字符串列表通过 <code>ch</code> 连接起来</li>
<li><code>splitList &lt;ch str&gt; &lt;src str&gt;</code>: <code>List[str]</code>，将给定的 <code>src</code> 字符串根据 <code>ch</code> 字符分割为列表</li>
</ul>
<p>案例：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- trim
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ trim \""   aa   \"" }} -&gt; \""aa\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- repeat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ repeat 5 \""12\"" }} -&gt; \""1212121212\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- substr
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ substr 1 3 \""abcedfg\"" }} -&gt; \""bc\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- trunc
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ trunc 3 \""abcedfg\"" }} -&gt; \""abc\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ trunc -3 \""abcedfg\"" }} -&gt; \""efg\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- abbrev
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ abbrev 5 \""hello world\"" }} -&gt; \""he...\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- contains
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ contains \""bb\"" \""aabb\"" }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- cat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ cat \""1\"" \""2\"" \""3\"" }} -&gt; \""1 2 3\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- replace
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ replace \""aa\"" \""bb\"" \""11aaccaa\"" }} -&gt; \""11bbccbb\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- join
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list \""hello\"" \""siyuan\"" | join \""？\"" }} -&gt; \""hello？siyuan\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- splitList
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ splitList \""$\"" \""foo$bar$baz\"" }} -&gt; [\""foo\"", \""bar\"", \""baz\""]
</span></span></code></pre>
<p>渲染结果为：</p>
<blockquote>
<ul>
<li>
<p>trim</p>
<ul>
<li>aa -&gt; \""aa\""</li>
</ul>
</li>
<li>
<p>repeat</p>
<ul>
<li>1212121212 -&gt; \""1212121212\""</li>
</ul>
</li>
<li>
<p>substr</p>
<ul>
<li>bc -&gt; \""bc\""</li>
</ul>
</li>
<li>
<p>trunc</p>
<ul>
<li>abc -&gt; \""abc\""</li>
<li>dfg -&gt; \""efg\""</li>
</ul>
</li>
<li>
<p>abbrev</p>
<ul>
<li>he... -&gt; \""he...\""</li>
</ul>
</li>
<li>
<p>contains</p>
<ul>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>cat</p>
<ul>
<li>1 2 3 -&gt; \""1 2 3\""</li>
</ul>
</li>
<li>
<p>replace</p>
<ul>
<li>11bbccbb -&gt; \""11bbccbb\""</li>
</ul>
</li>
<li>
<p>join</p>
<ul>
<li>hello？siyuan -&gt; \""hello？siyuan\""</li>
</ul>
</li>
<li>
<p>splitList</p>
<ul>
<li>[foo bar baz] -&gt; [\""foo\"", \""bar\"", \""baz\""]</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id=""列表操作函数"">列表操作函数</h3>
<p>列表类函数常常会配合 queryBlocks （见后面的小节） 一同使用。</p>
<p>完整文档请见：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Flists.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/lists.html</a></p>
<ul>
<li>
<p><code>list [&lt;value&gt;,]</code>：<code>List</code>，将后面传入的参数变成一个列表（类型要相同）</p>
</li>
<li>
<p><code>first &lt;List&gt;</code>：返回第一个列表项</p>
</li>
<li>
<p><code>last &lt;List&gt;</code>：返回最后一个列表项</p>
</li>
<li>
<p><code>append &lt;List&gt; &lt;value&gt;</code>：<code>List</code>，在列表后面增加一个元素</p>
</li>
<li>
<p><code>prepend &lt;List&gt; &lt;value&gt;</code>：<code>List</code>，在列表前面增加一个元素</p>
</li>
<li>
<p><code>concat [&lt;List&gt;,]</code>：<code>List</code>，将多个列表合并成一个</p>
</li>
<li>
<p><code>reverse &lt;List&gt;</code>：<code>List</code>，将列表逆序</p>
</li>
<li>
<p><code>has &lt;value&gt; &lt;List&gt;</code>：<code>bool</code>，检查给定的项目是否在列表中</p>
</li>
<li>
<p><code>index &lt;List&gt; &lt;int&gt;</code>：<code>List</code>，根据后面的索引值，索引列表中的内容</p>
</li>
<li>
<p><code>slice &lt;List&gt; &lt;beg int&gt; {&lt;end int&gt;}</code>：<code>List</code>，对给定的列表进行切片</p>
<ul>
<li><code>slice $myList</code> returns <code>[1 2 3 4 5]</code>. It is same as <code>myList[:]</code>.</li>
<li><code>slice $myList 3</code> returns <code>[4 5]</code>. It is same as <code>myList[3:]</code>.</li>
<li><code>slice $myList 1 3</code> returns <code>[2 3]</code>. It is same as <code>myList[1:3]</code>.</li>
<li><code>slice $myList 0 3</code> returns <code>[1 2 3]</code>. It is same as <code>myList[:3]</code>.</li>
</ul>
</li>
<li>
<p><code>empty &lt;List&gt;</code>：<code>bool</code>，检查列表是否为空</p>
</li>
<li>
<p><code>len &lt;List&gt;</code>：<code>int</code>，获取列表的长度</p>
</li>
</ul>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- list
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list 1 2 3 4 }} -&gt; [1 2 3 4]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list \""a\"" \""b\"" \""c\"" }} -&gt; [\""a\"" \""b\"" \""c\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- first
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ first (list 1 2 3) }} -&gt; 1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ first (list \""a\"" \""b\"" \""c\"") }} -&gt; \""a\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- last
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ last (list 1 2 3) }} -&gt; 3
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ last (list \""a\"" \""b\"" \""c\"") }} -&gt; \""c\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- append
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ append (list 1 2 3) 4 }} -&gt; [1 2 3 4]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ append (list \""a\"" \""b\"" \""c\"") \""d\"" }} -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- prepend
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ prepend (list 1 2 3) 0 }} -&gt; [0 1 2 3]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ prepend (list \""a\"" \""b\"" \""c\"") \""z\"" }} -&gt; [\""z\"" \""a\"" \""b\"" \""c\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- concat
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ concat (list 1 2) (list 3 4) }} -&gt; [1 2 3 4]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ concat (list \""a\"" \""b\"") (list \""c\"" \""d\"") }} -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- reverse
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ reverse (list 1 2 3) }} -&gt; [3 2 1]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ reverse (list \""a\"" \""b\"" \""c\"") }} -&gt; [\""c\"" \""b\"" \""a\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- has
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ has 2 (list 1 2 3) }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ has \""d\"" (list \""a\"" \""b\"" \""c\"") }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- index
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ index (list 1 2 3 4) 2 }} -&gt; 3
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ index (list \""a\"" \""b\"" \""c\"" \""d\"") 0}} -&gt; \""a\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- slice
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ slice (list 1 2 3 4 5) 1 3 }} -&gt; [2 3]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ slice (list \""a\"" \""b\"" \""c\"" \""d\"") 2 }} -&gt; [\""c\"" \""d\""]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- len
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list 1 2 3 4 | len }} -&gt; 4
</span></span></code></pre>
<p>渲染结果为</p>
<blockquote>
<ul>
<li>
<p>list</p>
<ul>
<li>[1 2 3 4] -&gt; [1 2 3 4]</li>
<li>[a b c] -&gt; [\""a\"" \""b\"" \""c\""]</li>
</ul>
</li>
<li>
<p>first</p>
<ul>
<li>1 -&gt; 1</li>
<li>a -&gt; \""a\""</li>
</ul>
</li>
<li>
<p>last</p>
<ul>
<li>3 -&gt; 3</li>
<li>c -&gt; \""c\""</li>
</ul>
</li>
<li>
<p>append</p>
<ul>
<li>[1 2 3 4] -&gt; [1 2 3 4]</li>
<li>[a b c d] -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]</li>
</ul>
</li>
<li>
<p>prepend</p>
<ul>
<li>[0 1 2 3] -&gt; [0 1 2 3]</li>
<li>[z a b c] -&gt; [\""z\"" \""a\"" \""b\"" \""c\""]</li>
</ul>
</li>
<li>
<p>concat</p>
<ul>
<li>[1 2 3 4] -&gt; [1 2 3 4]</li>
<li>[a b c d] -&gt; [\""a\"" \""b\"" \""c\"" \""d\""]</li>
</ul>
</li>
<li>
<p>reverse</p>
<ul>
<li>[3 2 1] -&gt; [3 2 1]</li>
<li>[c b a] -&gt; [\""c\"" \""b\"" \""a\""]</li>
</ul>
</li>
<li>
<p>has</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>index</p>
<ul>
<li>3 -&gt; 3</li>
<li>a -&gt; \""a\""</li>
</ul>
</li>
<li>
<p>slice</p>
<ul>
<li>[2 3] -&gt; [2 3]</li>
<li>[c d] -&gt; [\""c\"" \""d\""]</li>
</ul>
</li>
<li>
<p>len</p>
<ul>
<li>4 -&gt; 4</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id=""类型转换函数"">类型转换函数</h3>
<p>在思源一个笔记软件里面，纠结数据类型这种纯编程性的问题挺古怪的——但是只要你开始用模板功能，有些时候偏偏就会出现类型兼容性问题。</p>
<p>例如这个例子，他的作用是计算上一个周日的日期（这里我们姑且认为每周从周一开始）。</p>
<ul>
<li>首先我们使用 <code>Weekday</code> 函数获取今天是星期几，数值范围为 0~6</li>
<li>然后调用 AddDate 函数，减去星期数，就获得了周日的日期</li>
</ul>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ $weekday := Weekday now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ now.AddDate 0 0 (mul -1 $weekday) }}
</span></span></code></pre>
<p>不过运行的这个模板的时候会报错，无法运行：</p>
<blockquote>
<p>模板解析失败：template: :2:27: executing \""\"" at &lt;$weekday&gt;: wrong type for value; expected int; got int64 v3.0.12</p>
</blockquote>
<blockquote>
<p>附：顺便教一下怎么看这个报错信息。</p>
<ul>
<li>关注 <code>template: :2:27</code>，这代表了传入的模板的第二行，第二十七个字符的地方出现了错误</li>
<li>具体的错误就是：「wrong type for value; expected int; got int64」，也就是传入的值的类型出了错。</li>
</ul>
</blockquote>
<p>报错的原因在于，<code>mul</code> 这些 Sprig 算术函数返回的类型是 <code>int64</code>，而 <code>Time.AddDate</code> 函数接受的类型却是 <code>int</code>，所以出现了类型不兼容问题。?</p>
<p>为了解决这一问题，我们不得不进行使用类型转换函数，把 in64 转成 int 类型：</p>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{ $weekday := Weekday now }}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{ now.AddDate 0 0 (mul -1 $weekday | int) }}
</span></span></code></pre>
<p>类型转换函数同样是 Sprig 提供的，文档见：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fconversion.html"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/conversion.html</a></p>
<ul>
<li><code>atoi</code>: Convert a string to an integer.</li>
<li><code>float64</code>: Convert to a <code>float64</code>.</li>
<li><code>int</code>: Convert to an <code>int</code> at the system’s width.</li>
<li><code>int64</code>: Convert to an <code>int64</code>.</li>
<li><code>toDecimal</code>: Convert a unix octal to a <code>int64</code>.</li>
<li><code>toString</code>: Convert to a string.</li>
<li><code>toStrings</code>: Convert a list, slice, or array to a list of strings.</li>
</ul>
<h3 id=""逻辑运算函数"">逻辑运算函数</h3>
<p>逻辑运算函数，主要是在 <code>if</code> 这类流程控制语句内需要用到。比如这个例子当中，eq 就是一个逻辑运算函数，他用来比较传入的两个参数是否相等（equal 的简写）。</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ if eq 1 2 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>在更加实际的例子中，可能我们要写好几个逻辑运算，建议将每个逻辑运算囊括在 () 当中来保证运算的正确性。</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ if or (eq 1 2) (ne 2 3) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>逻辑运算部分可以分为两大类：布尔运算类和比较运算类。这里的参数类型 <code>&lt;interface{}&gt;</code> 表示是任意类型。</p>
<ul>
<li>
<p>布尔运算</p>
<ul>
<li><code>and [&lt;interface{}&gt;,]</code>：<code>interface{}</code>，如果所有参数都为真，则返回最后一个参数；否则返回第一个为假的参数</li>
<li><code>or [&lt;interface{}&gt;,]</code>：<code>interface{}</code>，如果任一参数为真，则返回第一个为真的参数；否则返回最后一个参数</li>
<li><code>not &lt;interface{}&gt;</code>：<code>bool</code>，对单个参数进行逻辑非运算；如果参数为真则返回假，为假则返回真</li>
</ul>
</li>
<li>
<p>比较运算：对两个类型进行比较，注意这里的参数必须要是同样的类型</p>
<ul>
<li><code>eq &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，判断两个参数是否相等；相等返回真，不等返回假</li>
<li><code>ne &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，判断两个参数是否不相等；不相等返回真，相等返回假</li>
<li><code>lt &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个小于第二个，则返回真，否则返回假</li>
<li><code>le &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个小于等于第二个，则返回真，否则返回假</li>
<li><code>gt &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个大于第二个，则返回真，否则返回假</li>
<li><code>ge &lt;interface{}&gt;, &lt;interface{}&gt;</code>：<code>bool</code>，比较两个参数，如果第一个大于等于第二个，则返回真，否则返回假</li>
</ul>
</li>
</ul>
<p>在常规的逻辑运算函数之外，还有必要介绍一类列表、对象判断类函数，这部份函数由 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fdefaults.html"" title=""Default Functions | sprig"" target=""_blank"" rel=""nofollow ugc"">Default Functions | sprig</a> 提供</p>
<ul>
<li>
<p><code>empty &lt;interface{}&gt;</code>：<code>bool</code>，判断给定的对象是否为空</p>
<ul>
<li>在思源中，最常见的用法是判断一个列表是不是空的</li>
</ul>
</li>
<li>
<p><code>all [&lt;interface{}&gt;,]</code>：<code>bool</code>，判断给定一系列对象，是否每个都是非空的</p>
</li>
<li>
<p><code>any [&lt;interface{}&gt;,]</code>：<code>bool</code>，判断给定一系列对象，是否存在某一个是非空的</p>
</li>
</ul>
<p>‍</p>
<p>案例如下：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- and 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ and true true }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ and true false }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ and 1 2.3 \""str\"" }}  -&gt; \""str\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- or
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ or false false }} -&gt; false  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ or true false }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- not
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ not true }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ not 0 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- eq
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ eq 2 3 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ eq \""a\"" \""a\"" }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- ne 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ne 4 3 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ne 2 2 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- lt
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ lt 4 3 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ lt \""a\"" \""b\"" }} -&gt; true  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- le
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ le 2 2 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ le 4 3 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- gt 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ gt 5 3 }} -&gt; true
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ gt 2 2 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- ge
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ge 3 3 }} -&gt; true  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ ge 1 4 }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">- empty
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list 1 | empty }} -&gt; false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  - {{ list | empty }} -&gt; true
</span></span></code></pre>
<blockquote>
<ul>
<li>
<p>and</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
<li>str  -&gt; \""str\""</li>
</ul>
</li>
<li>
<p>or</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>not</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>eq</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>ne</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>lt</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
<li>
<p>le</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>gt</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>ge</p>
<ul>
<li>true -&gt; true</li>
<li>false -&gt; false</li>
</ul>
</li>
<li>
<p>empty</p>
<ul>
<li>false -&gt; false</li>
<li>true -&gt; true</li>
</ul>
</li>
</ul>
</blockquote>
<p>‍</p>
<h4 id=""附-使用-ternary-函数计算内联条件"">附：使用 ternary 函数计算内联条件</h4>
<p>我们上面谈到了最常用的 if 条件语句：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ if eq 1 2 }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>如果对编程比较有经验的人应该知道，很多语言中都支持计算内联条件，以 js 为例子</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">x</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">(</span><span class=""highlight-mi"">1</span> <span class=""highlight-o"">==</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">)</span><span class=""highlight-o"">?</span> <span class=""highlight-mi"">1</span> <span class=""highlight-o"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">;</span>
</span></span></code></pre>
<p>在模板函数中，这个内联条件计算可以用 <code>ternary</code> 函数来完成，基本用法为：<code>ternary &lt;arg1&gt; &lt;arg2&gt; &lt;cond bool&gt;</code>：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ ternary \""Show 1\"" \""Show 2\"" (eq 1 2) }
</span></span></code></pre>
<p>‍</p>
<h3 id=""思源模板片段特殊函数"">思源模板片段特殊函数</h3>
<p>有几个思源内置的特殊模板函数在文档里有所介绍，<strong>这几个函数</strong>**==只能用在 md 模板文件==当中**。</p>
<blockquote>
<ul>
<li><code>title</code>：该变量用于插入当前文档名。比如模板内容为 <code># .action{.title}</code>，则调用后会以一级标题语法插入到当前文档内容中</li>
<li><code>id</code>：该变量用于插入当前文档 ID</li>
<li><code>name</code>：该变量用于插入当前文档命名</li>
<li><code>alias</code>：该变量用于插入当前文档别名</li>
</ul>
</blockquote>
<p>这四个实际上是在「访问正在插入模板的容器文档的一些属性」。</p>
<p>我们可以把下面这个例子保存到 template 目录下的 md 模板文件当中。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的标题：.action{.title}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的ID：.action{.id}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的命名：.action{.name}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">这个是当前插入文档块的别名：.action{.alias}
</span></span></code></pre>
<p>然后在某个文档当中插入这个模板，你就会发现这几个字段被替代为被插入的文档块的具体的属性。</p>
<blockquote>
<p>这个是当前插入文档块的标题：思源模板片段新人指南<br>
这个是当前插入文档块的 ID：20231014181953-m94pl9u<br>
这个是当前插入文档块的命名：<br>
这个是当前插入文档块的别名：</p>
</blockquote>
<p>注意这里使用的时候必须前面要加上 <code>.</code>，也就是 <code>.title</code> 而非 <code>title</code>。至于为什么要加 <code>.</code>，有兴趣可以参考这个：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.topgoer.com%2F%25E5%25B8%25B8%25E7%2594%25A8%25E6%25A0%2587%25E5%2587%2586%25E5%25BA%2593%2Ftemplate.html%23%25E6%25A8%25A1%25E6%259D%25BF%25E8%25AF%25AD%25E6%25B3%2595"" title=""Template · Go语言中文文档"" target=""_blank"" rel=""nofollow ugc"">Template · Go 语言中文文档</a>。</p>
<h3 id=""SQL-查询函数"">SQL 查询函数</h3>
<p>思源还额外提供了两个模板函数，用于做 SQL 查询。</p>
<blockquote>
<p>如果你对思源的 SQL 功能不了解，请阅读：<a href=""https://ld246.com/article/1683355095671"">思源 SQL 新人指南：SQL 语法 + Query + 模板</a></p>
</blockquote>
<ul>
<li>
<p><code>queryBlocks</code>：该函数用于查询数据库，返回值为 blocks 列表，请参考下面的例子</p>
<ul>
<li>⭐ 这个更常用！</li>
</ul>
</li>
<li>
<p><code>querySpans</code>：该函数用于查询数据库，返回值为 spans 列表，请参考下面的例子</p>
<ul>
<li>?‍♂️ 这个很少用。</li>
</ul>
</li>
</ul>
<p>这两个模板函数的返回值都是块的列表。</p>
<h4 id=""queryBlocks"">queryBlocks</h4>
<p><code>queryBlocks</code> 可能是最常用的，他的作用就是在 blocks 表中做查询。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$blocks := queryBlocks \""select * from blocks where 1 limit 1\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">返回结果是列表，这里取出第一个元素：.action{ $b := first $blocks}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">块的 ID .action{$b.ID}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">块的路径 .action{$b.Path}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">完整的块的内容：
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```json
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{toPrettyJson $b }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```
</span></span></code></pre>
<p>我们通过 <code>toPrettyJson</code> 函数（见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2Fdefaults.html"" title=""Default Functions | sprig"" target=""_blank"" rel=""nofollow ugc"">Default Functions | sprig</a>）将结果变成一个 Json，可以发现返回的就是一个 Block 对象。</p>
<blockquote>
<p>返回结果是列表，这里取出第一个元素：<br>
块的 ID 20220316145831-f0lgt06<br>
块的路径 /20220316145830-u0u6srg/20220316145830-x6kvftp/20220316145831-f0lgt06.sy<br>
完整的块的内容：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""ID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831-f0lgt06\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""ParentID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""RootID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831-f0lgt06\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Hash\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""d7b97e4\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Box\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220305173526-4yjl33h\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Path\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""/20220316145830-u0u6srg/20220316145830-x6kvftp/20220316145831-f0lgt06.sy\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""HPath\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""/daily note/2022/03\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Alias\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Memo\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Tag\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""03\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""FContent\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""03\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Markdown\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Length\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""SubType\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""IAL\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""{: custom-sy-readonly=\\\""true\\\"" id=\\\""20220316145831-f0lgt06\\\"" title=\\\""03\\\"" type=\\\""doc\\\"" updated=\\\""20220316145831\\\""}\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Sort\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Created\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""Updated\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20220316145831\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
</blockquote>
<p>在这里我们使用了如下的写法：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$blocks := queryBlocks \""select * from blocks where 1 limit 1\""}
</span></span></code></pre>
<p>但是某些情况下，可能 SQL 里面的需要插入一些变量，这种情况下，可以使用 <code>?</code> 占位符来插入变量：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$id := \""20240507145154-4g8hqau\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$blocks := queryBlocks \""select * from blocks where id=\'?\'\"" $id}
</span></span></code></pre>
<p>‍</p>
<h4 id=""querySpans"">querySpans</h4>
<p><code>querySpans</code> 则很少用，他是用来给 spans 表做查询用的</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$spans := querySpans \""select * from spans  where 1 limit 1\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍```json
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{toJson  $spans  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍```
</span></span></code></pre>
<blockquote>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">[{</span><span class=""highlight-nt"">\""ID\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20240420235208-65m9ro6\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""BlockID\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20220324170238-169kwsw\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""RootID\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20220324170216-lp8jviy\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Box\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""20220305173526-4yjl33h\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Path\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""/20220316145830-u0u6srg/20220316145830-x6kvftp/20220316145831-f0lgt06/20220324170216-lp8jviy.sy\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Content\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""随想录\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Markdown\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""((20220320164548-ienx5sl \'随想录\'))\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""Type\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""textmark block-ref\""</span><span class=""highlight-p"">,</span><span class=""highlight-nt"">\""IAL\""</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">}]</span>
</span></span></code></pre>
</blockquote>
<p>‍</p>
<h3 id=""案例-链接到昨天的日记"">案例：链接到昨天的日记</h3>
<p>querySpans 且不谈，配合 queryBlocks 我们可以在模板中玩一些奇妙的花活。本小节作为模板语法部分的收尾，给大家介绍一个有趣的案例。</p>
<hr>
<p>前两天我看有人在论坛里问：<a href=""https://ld246.com/article/1714915294074"">日记模板怎样设置可以在今天日记页面中自动添加昨天的日记链接？</a></p>
<p>他提得需求就完全可以通过 queryBlocks 来完成。</p>
<p>要实现这个功能，必须知道两个前置知识：</p>
<ol>
<li>在思源里，日记文档会自动添加 <code>custom-dailynote-&lt;yyyymmdd&gt;</code> 属性；比如 2024-05-01 的日记，会自动添加文档属性 <code>custom-dailynote-20240501</code></li>
<li>思源中，超链接的格式为 <code>siyuan://blocks/&lt;块 ID&gt;</code></li>
</ol>
<p>有了这两个知识，我们就有大致的实现思路了：</p>
<ol>
<li>获取昨天的日期</li>
<li>根据昨天的日期构建日记文档属性</li>
<li>查询符合文档属性的文档</li>
<li>如果查询到，就去除文档的 ID 并构建块链接</li>
</ol>
<p>首先要获得 <code>yyyymmdd</code> 属性，这个我在「常用的时间函数」当中已经给出写法了：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-dailynote-${ $datestr_sy }=\"".action{$datestr_sy}\"" }
</span></span></code></pre>
<p>这里我们要把 <code>now</code> 替换成昨天，改成这样以下这样；其中用到了 list、join 两个函数，我在前面也介绍过。</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now.AddDate 0 0 -1 | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $attr := list \""custom-dailynote-\"" $datestr_sy | join \""\"" }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507011639-jh02y6n.png?imageView2/2/interlace/1/format/webp""></p>
<p>接下来我们就要在模板中调用 queryBlock 来查询昨天的日记：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now.AddDate 0 0 -1 | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $attr := list \""custom-dailynote-\"" $datestr_sy | join \""\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $docs := queryBlocks \""select * from blocks where type=\'d\' and ial like \'%custom-dailynote-20240506%\' limit 1\""}
</span></span></code></pre>
<p>获得了 <code>$docs</code> 我们需要做以下的工作：</p>
<ol>
<li>首先判断列表是否为空（用 empty 函数），因为很可能昨天没有写日记</li>
<li>如果不为空，就使用 <code>first</code> 函数取出第一个文档元素</li>
<li>通过 <code>.ID</code> 获取文档的 ID，并构造 markdown 链接</li>
</ol>
<p>最后完整的模板内容如下：</p>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $datestr_sy := now.AddDate 0 0 -1 | date \""20060102\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $attr := list \""custom-dailynote-\"" $datestr_sy | join \""\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $docs := queryBlocks \""select * from blocks where type=\'d\' and ial like \'%custom-dailynote-20240506%\' limit 1\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ if not (empty $docs) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ $doc := first $docs }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">[.action{$doc.Content}](siyuan://blocks/.action{ $doc.ID })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507013135-pc2q98t.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""数据库中的模板列"">数据库中的模板列</h2>
<p>思源的数据库中，有一种类型的列叫做「模板列」，通过模板列，我们可以让数据库发挥出更加强大的功能。</p>
<p>口说无凭，来看一个数据库的效果：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425002554-8t5cmxv.png?imageView2/2/interlace/1/format/webp""></p>
<p>在这个数据库当中，「评级」是一个模板列，他会根据左边打分的数值，自动调整显示为不同的星星数量。那么这是怎么做到的呢？</p>
<ol>
<li>
<p>首先新建评级列，将它设置为一个模板列</p>
</li>
<li>
<p>编辑模板为</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $scale := (div .打分 20) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ repeat (int $scale) \""⭐\"" }
</span></span></code></pre>
</li>
</ol>
<p>看起来非常简单！你应该能记得，我们之前讨论过这里用到的三个函数：</p>
<ul>
<li><code>div</code>：进行除法运算，并将结果赋值给 <code>$scale</code> 变量</li>
<li>由于 <code>div</code> 的结果类型为 <code>int64</code> 所以通过 <code>int</code> 函数把他转为整型</li>
<li>通过调用 <code>repeat</code> 函数，根据 <code>$scale</code> 变量的数值来重复显示 ⭐ 符号</li>
</ul>
<blockquote>
<p>插件测试样例，注：由于这里是在插件当中测试，无法访问 <code>.打分</code> 属性，所以用常量 50 来替换以完成测试。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506192211-a2hveqi.png?imageView2/2/interlace/1/format/webp""></p>
</blockquote>
<p>当然以上都不是重点，这里的重点是—— <code>.打分</code> 是什么，为什么我们可以访问他？</p>
<h3 id=""-对象""><code>.</code> 对象</h3>
<p>也许你还记得，<code>.</code> 符号在此前也出现过很多次。比如之前的 <code>now.Year</code> 就表示：</p>
<ul>
<li>通过函数 <code>now</code> 返回的对象 <code>Time</code></li>
<li>对对象 <code>Time</code> 使用 <code>.</code> 获取他的属性 <code>Year</code></li>
</ul>
<p>同样在这里 <code>.</code> 符号也表示获取属性。但是由于之前没有指定被索引的对象，所以这里使用了<u>传入模板的默认数据对象</u>——在思源数据库中，他就**对应了模板列单元所在的****==行本身==**。</p>
<p>例如一个数据库拥有 <code>日期</code>、<code>分数</code>、<code>备注</code> 这些列，我们就可以通过  <code>.日期</code>、<code>.分数</code>、<code>.备注</code> 在模板列中访问他们。</p>
<p>那么除了列本身，还有可以访问的对象吗？</p>
<p>当然有！如果你想知道更加细节的可访问字段，这里有一个简单的技巧：</p>
<ul>
<li>在数据库中新建一个模板列</li>
<li>将模板设置为 <code>.action{toPrettyJson .}</code></li>
<li>将模板列设置为「换行」</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425003536-r3eyzj9.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后你就可以在模板列中看到本数据库中的所有可访问字段了，比如通过 <code>.created</code> 访问行创建的时间。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240425003613-zm6ed59.png?imageView2/2/interlace/1/format/webp""></p>
<p>但是注意，并不是所有的属性都可以通过 <code>.</code> 来访问，比如如果我们尝试访问一个名为 <code>.custom-b</code> 的对象，那么会喜提一个报错——因为 custom-b 不符合属性的命名规范。</p>
<p>对于这种情况，可以通过 <code>index . \""name\""</code> 来对属性进行访问，比如这个例子中，我们填写 <code>.action{ index . \""custom-b\""}</code> 就可以访问 <code>custom-b</code> 属性的值了。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506222610-yh5v16v.png?imageView2/2/interlace/1/format/webp""></p>
<p>附注：</p>
<blockquote>
<p>模板使用关联或汇总时，填充值为数组，所以可能需要使用 <code>index .汇总 0</code> 来访问第一个值，或者使用 <code>range</code> 迭代所有值。</p>
<p>参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F11029"">Issue #11029 · siyuan-note/siyuan</a></p>
</blockquote>
<h3 id=""两种主键"">两种主键</h3>
<p>思源的数据库中的主键可以分为两种：</p>
<ol>
<li>普通的文本主键</li>
<li>被绑定到一个块的主键</li>
</ol>
<p>为了方便测试，我们现在新建一个测试用的块，并填写命名、属性、备注还有自定义属性：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507102610-t7dfo2g.png?imageView2/2/interlace/1/format/webp""></p>
<p>以下是不同的两行内部属性的差异：</p>
<ol>
<li>
<p>普通文本主键只有 id、update、created、主键等属性</p>
</li>
<li>
<p>绑定了块的主键，还多出来</p>
<ul>
<li>数据库相关的属性，如 av-names、custom-avs 等</li>
<li>块的内置属性，如命名、别名等</li>
<li>自定义属性，如 \""custom-a\""</li>
</ul>
</li>
<li>
<p>绑定了块的主键，其 ID 指向了被绑定的块，而普通文本主键的 ID 是它自身的 ID</p>
</li>
<li>
<p><strong>注意：普通的文本主键的 ID 并非指向一个块，所以如果你尝试用 SQL 来查询这个 ID 对应的块，是不会得到任何有意义的结果的！</strong></p>
</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507103552-kdpxkmw.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""和-queryBlocks-结合"">和 queryBlocks 结合</h3>
<p>对于主键绑定了块的数据库而言，由于 ID 属性和对应的块打通了沟通渠道，所以把模板列和 queryBlocks 方法结合玩一些更加花哨的功能。</p>
<p>这里给出一个简单的案例：自动获取绑定块的文档的标题</p>
<ol>
<li>
<p>首先使用 queryBlocks 执行 SQL 查询获取对应的文档块，SQL 语句的设计如下：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">root_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'&lt;id&gt;\'</span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>通过 if 语句过滤掉不存在文档块的情况</p>
<ol>
<li>通过  <code>first</code> 函数取出第一个文档块</li>
<li>然后获取它的 Content 字段</li>
</ol>
</li>
<li>
<p>对于不存在文档块的情况，简单输出一个「无」</p>
</li>
</ol>
<pre><code class=""language-template highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $blocks := queryBlocks \""select * from blocks where id in (select root_id from blocks where id=\'?\')\"" .id}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ if not (empty $blocks)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ (first $blocks).Content }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ else }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">无
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{ end }
</span></span></code></pre>
<p>效果如下：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507112843-cbdn0zc.png?imageView2/2/interlace/1/format/webp""></p>
<p>论坛里有一个帖子，询问：<a href=""https://ld246.com/article/1714938890528"">数据库一些列的值能否自动获取文档里的数据</a>。其实解决思路和上面的是一样的：</p>
<ol>
<li>获取绑定块的 ID</li>
<li>构造 SQL，查询到想要的内容</li>
<li>读取 queryBlocks 的结果，并写入数据库模板列中</li>
</ol>
<h3 id=""和-html-标签结合"">和 html 标签结合</h3>
<p>有一个很重要，但是可能很少人知道的事情：数据库的文本列里面是==可以直接填写 html 元素的==。</p>
<p>举一个例子，我们把如下的 html 粘贴到一个文本列当中：</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    background: conic-gradient(#4CAF50 0%, #4CAF50 75%, #ddd 75%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    border-radius: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    width: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    height: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    position: relative;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      position: absolute;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      top: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      left: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      transform: translate(-50%, -50%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      font-size: 12px;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    75%
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>然后，这个元素就会被完整地渲染在数据库单元内：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507123053-okaheiy.png?imageView2/2/interlace/1/format/webp""></p>
<p>坏消息是：当你再次点击编辑的时候，里面就只剩下纯文本了。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507123148-eotsvzg.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>? 更坏的消息：可能未来某个版本内，文本列不会再支持插入 html 了。</p>
<p>详情请跟踪：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F11255"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/issues/11255</a>。</p>
</blockquote>
<p>好消息是：模板列里面也支持使用自定义的 html 元素。我们不妨再做一个测试：</p>
<ol>
<li>
<p>新建一个数值列“比例”，取值范围从 0 ~ 100</p>
</li>
<li>
<p>将如下的模板粘贴到一个模板列当中，他做的事情很简单：读取「比例」的数值，然后替换到 div 元素当中</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{ $portion := index . \""比例\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    background: conic-gradient(#4CAF50 0%, #4CAF50 .action{$portion}%, #ddd .action{$portion}%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    border-radius: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    width: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    height: 40px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">    position: relative;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      position: absolute;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      top: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      left: 50%;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      transform: translate(-50%, -50%);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-s"">      font-size: 12px;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$portion}%
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
</li>
</ol>
<p>做完以上的工作，数据库就会根据 \""比例\"" 这一列的数值来绘制模板列的样式，从而显示出不同的效果出来：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240507123520-gpoz5h2.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<p>‍</p>
<h3 id=""奇奇怪怪的玩法-存在风险-慎用-"">奇奇怪怪的玩法（存在风险，慎用）</h3>
<blockquote>
<p><strong>拓展性花活，普通用户慎用</strong>。</p>
<p>自定义 html + 可执行的 js 是存在安全风险的，这里只是通过这个例子告诉大家数据库可以做到这种程度。</p>
<p>如果你不能百分百确定你在干什么，就不要这么玩。</p>
</blockquote>
<p>先给大家看一个神奇的东西：</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/recording-20240507120539-1usqe9v.gif""></p>
<p>在前面我们提到过，数据库的文本实际上是可以直接插入 html 标签的——那既然可以插入 html 标签，那执行一下 js 代码也是非常合理的对吧。</p>
<p>现在我来解释一下上面这个效果的实现方案：</p>
<ol>
<li>
<p>首先将数据库的主键绑定到一个块上——从而保证使用 <code>.id</code> 能访问到块的 id</p>
</li>
<li>
<p>新建一个 css 文本列，用来填写具体的 css 属性表</p>
</li>
<li>
<p>新建一个模板列，里面填写如下内容</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">button</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""margin: 3px;\""</span> <span class=""highlight-na"">class</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""b3-button\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-na"">onclick</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\'event.stopImmediatePropagation(); runJs.api.setBlockAttrs(\"".action{.id}\"", {style: \"".action{index . \""css\""}\""});\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  添加样式
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">button</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
</li>
</ol>
<p>我们来分析一下这个模板：</p>
<ul>
<li>
<p><code>&lt;button style=\""margin: 3px;\"" class=\""b3-button\"" /&gt;</code> 构建了一个按钮元素， <code>b3-button</code> 是思源的内置 class 名称</p>
</li>
<li>
<p>关键是 onclick 元素，我们在 onclick 当中直接填写我们要执行的代码：</p>
<ol>
<li>
<p><code>event.stopImmediatePropagation();</code></p>
<ul>
<li>这行代码是为了阻止思源默认的数据表行为，如果去掉了以后，思源就会弹出一个编辑框，而不会触发点击按钮的事件了</li>
</ul>
</li>
<li>
<p><code>runJs.api.setBlockAttrs</code></p>
<ul>
<li>
<p>这个其实是安装了 <code>RunJs</code> 插件后，插件暴露在外部的一个接口</p>
</li>
<li>
<p>setBlockAttrs 是思源的内核 API，用于为块设置块属性</p>
<ul>
<li>参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fblob%2Fmaster%2FAPI_zh_CN.md%23%25E8%25AE%25BE%25E7%25BD%25AE%25E5%259D%2597%25E5%25B1%259E%25E6%2580%25A7"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md#%E8%AE%BE%E7%BD%AE%E5%9D%97%E5%B1%9E%E6%80%A7</a></li>
</ul>
</li>
<li>
<p>你不一定要安装 runJs 插件，也可以在 JS 代码片段中添加自己想要使用的代码功能</p>
</li>
</ul>
</li>
<li>
<p>setBlockAttrs 接受两个参数：块的 ID，具体的块属性</p>
<ol>
<li>
<p>块 ID：通过模板功能的 <code>.action{.id}</code> 获取</p>
</li>
<li>
<p>块属性：由于我们要设置内联样式属性，所以 API 的 payload body 填写为 <code>{style: \""&lt;具体css代码&gt;\""}</code></p>
<ul>
<li>使用 <code>.action{index . \""css\""}</code> 获取 css 列的内容，填充到 payload body 中</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<p>‍</p>
<h2 id=""思源-Markdown-块语法"">思源 Markdown 块语法</h2>
<blockquote>
<p>严格来说，思源的 Markdown 块语法和模板语法没有半毛钱关系。但是由于在 md 模板文件里面经常需要使用 md 块语法，所以有必要在这里一起介绍一下。</p>
</blockquote>
<p>我们都知道思源是以块为单位的，同时思源一定程度上兼容了 markdown 语法格式（例如在模板文件中）——那么问题来了，markdown 原始的语法就是个瘸子，根本不存在块的概念，更不用提块属性这种概念了——这可怎么办呢。</p>
<p>对于最普通的情况来说来讲，一个 markdown 内置的语法元素，例如标题、列表、引述等等，也会被转化为一个单独的块。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506181637-xicsp7g.png?imageView2/2/interlace/1/format/webp""></p>
<p>而对于更加复杂的情况，思源实现了一种基于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fkramdown.gettalong.org%2F"" target=""_blank"" rel=""nofollow ugc"">kramdown</a> 的 markdown 方言。通过这个方言我们可以在一个普通的 markdown 纯文本文件中定义块及其内部的属性。</p>
<ul>
<li>思源的 markdown 这些拓展属性语法，不仅仅可以用在模板的 md 文件里， 还可以直接用在编辑器中。</li>
<li>在阅读下面的示例的时候，你可以把给出的 md 模板样例复制之后<strong>直接粘贴</strong>到思源的编辑器中，思源同样能够正确识别定义的块属性。</li>
</ul>
<h3 id=""块属性声明语法"">块属性声明语法</h3>
<p>思源可以通过 <code>{: }</code> 这种内联样式表 （简称：<strong>ial</strong>) 的形式来声明一个具备特定属性的块，内联样式表的基本语法格式为如下，注意括号两侧必须留出空格。</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">{</span>: &lt;key1&gt;=\""&lt;value&gt;1\"" &lt;key1&gt;=\""&lt;value&gt;1\"" <span class=""highlight-nb"">}</span>
</span></span></code></pre>
<p>例如，你可以把以下的文本填入 <code>templates</code> 下的 Test.md 文件：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">这是一个简单的段落，但是我会声明「备注」内联样式和「custom-a」自定义属性。
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: memo=\""这是一个块\""  custom-a=\""a\"" }
</span></span></code></pre>
<p>而将这个模板应用到思源正文后，就会创建一个填充了备注和 custom-a 属性的块。</p>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506182531-ka4hdqv.png?imageView2/2/interlace/1/format/webp""></p>
<p>再比如，在使用了 callout （由 Savor 主题以及 callout 插件提供）功能后，想要通过模板快速插入一个 callout——通过观察发现 callout 样式主要依赖于对一个引述块添加 <code>custom-b</code> 属性，所以我们可以首先在 Test.md 中编写引述块的 markdown 语法，然后在下方紧贴着添加 <code>{: }</code> 属性表：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">Meta
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">- ? 文档类型：主题文档 | 事件记录
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">- ⭐ 相关主题：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span><span class=""highlight-k"">&gt; </span><span class=""highlight-ge"">- ? 基本介绍：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-ge""></span>{: custom-b=\""info\"" }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506183155-cwhpxrt.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>注 ：可以使用的块属性包括了<strong>块的内置属性</strong>和<strong>自定义属性</strong></p>
<ol>
<li>可以使用内置样式包括：id, name, alias, bookmark, memo, style</li>
<li>在设置自定义样式的时候，不要忘了添加 <code>custom-</code> 前缀</li>
</ol>
</blockquote>
<h4 id=""Special-Case--ID-属性"">Special Case: ID 属性</h4>
<p>我们可以在 ial 表中定义 ID 属性，比如这样：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">这是一个块，你猜他的 ID 会是什么？
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: id=\""20231004221035-p9r4sh7\""}
</span></span></code></pre>
<p>然而，在 ial 表中定义的 ID 属性并不会真正应用到编辑器的块中——也就是说就算使用了上述的模板，新创建的块的 ID 并不会等于 \""20231004221035-p9r4sh7\""，而是思源自己生成的新的块 ID。</p>
<p>id 属性在 ial 中<strong>唯一的作用</strong>是作为 ial 中的<strong>占位符</strong>来声明一个块——因为一个空的 ial 表是无效的。</p>
<p>听起来像是脱裤子放屁——确实，在大部分情况下，这个 trick 都没有什么用。</p>
<p>但是在处理复杂容器块的时候，我们会不得不使用这个 trick 来区分容器块和内部的内容块。这里给一个例子：</p>
<blockquote>
<p>假定：我们需要编写一个内容为空的列表块，并给这个列表块添加  <code>style=\""border: 1px solid blue;\""</code> 属性（也就是添加外边框的内联 css 样式）。请问要怎么办呢？</p>
</blockquote>
<p>你可能会写出如下的模板样式</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">- 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""background: red;\"" }
</span></span></code></pre>
<p>但是以上的模板是无效的。</p>
<p>原因在于，思源中的列表块是一个非常复杂的嵌套对象，一个最简单的单个项目的列表，实际上也包含了三个部分：</p>
<ul>
<li>最内部的段落块</li>
<li>段落块外部的列表项块</li>
<li>列表项从属的列表块</li>
</ul>
<p>而在以上的模板中，思源无法识别 <code>{: style=\""background: red;\"" }</code> 到底是应用在哪个块上面。</p>
<p>在这种情况下，我们必须要通过类似 <code>{: id=\""20231004221035-p9r4sh7\""}</code> 这样的样式表，来明确声明三层块结构，也就是要写成这样子：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> {: id=\""202001010000-abcdefg\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  {: id=\""202001010000-abcdefg\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 1px solid blue;\"" }
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506185002-bcpih90.png?imageView2/2/interlace/1/format/webp""></p>
<p>另外虽然 <code>id</code> 的值实际上没有什么卵用，但是在填写的时候必须要遵守 ID 的格式规范，否则无法被正常识别：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">yyyymmddHHMMSS-<span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">7</span><span class=""highlight-err"">位字符或数字</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>诸如 \""202001010000-abcdefg\""、\""202001010000-1234567\""这些都是可以的，而 \""123\"" 这种是不行的。</p>
<h3 id=""超级块排版"">超级块排版</h3>
<p>思源支持通过超级块来进行复杂排版，这个排版同样可以通过拓展的 markdown 语法来定义：</p>
<ul>
<li>
<p>多行超级块（垂直布局）</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{{row
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">&lt;</span>内部内容&gt;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span></code></pre>
</li>
<li>
<p>多列超级块（水平布局）</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{{col
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">&lt;</span>内部内容&gt;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span></code></pre>
</li>
</ul>
<p>具体编写的时候，只需要把 &lt; 内部内容 &gt; 当中替换为正常的块定义即可。然后渲染的时候，内部内容就会按照垂直或者水平布局被囊括在一个新的超级块当中。</p>
<p>这里给一个稍微复杂一点的样例，如果你把这个样例理解了，超级块排版的布局基本上就掌握了。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{{col
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{{row
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu"">### TODO：高优先
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [x]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 2px solid blue;\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{{{row
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu"">### TODO：低优先
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-gu""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">-</span> [x]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 2px solid blue;\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}}}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: style=\""border: 2px solid red; padding: 10px;\""}
</span></span></code></pre>
<p>插入编辑器后，样式如下：</p>
<ul>
<li>
<p>最外部是一个水平布局的超级块，内部有两列垂直布局的超级块</p>
</li>
<li>
<p>内部的两个列中，各自都是一个垂直布局的超级块，包括</p>
<ul>
<li>最上面一个标题块</li>
<li>最下面一个任务块</li>
</ul>
</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/05/siyuan/1646569891270/assets/image-20240506190204-zttf5jf.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""相关参考资料"">相关参考资料</h2>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmasterminds.github.io%2Fsprig%2F"" target=""_blank"" rel=""nofollow ugc"">https://masterminds.github.io/sprig/</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgeekdaxue.co%2Fread%2Fachuan-2%40siyuan%2FuAfT29sMbD-a5AmI"" target=""_blank"" rel=""nofollow ugc"">https://geekdaxue.co/read/achuan-2@siyuan/uAfT29sMbD-a5AmI</a></li>
<li><a href=""https://ld246.com/article/1627298479208"">https://ld246.com/article/1627298479208</a></li>
</ul>
                

作者：Frostime
链接：https://ld246.com/article/1715065433237
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
659,数据库进度条模板 - 链滴,Mon Apr 15 2024 18:38:26 GMT+0000 (Coordinated Universal Time),"
                    <p><img src=""https://b3logfile.com/file/2024/04/siyuan/1623291975208/assets/image-20240415183745-gcparm1.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""简略"">简略</h2>
<h3 id=""模板代码"">模板代码</h3>
<blockquote>
<p>请优先看回帖中的解决方案，这里的代码在一些情况下有问题。</p>
</blockquote>
<h4 id=""日期范围内进度"">日期范围内进度</h4>
<ul>
<li>从 <code>开始时间</code>、<code>结束时间</code> 列获取时间</li>
<li>修改 <code>rgb(45,164,78)</code> 以修改进度条前景色；</li>
</ul>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$today := (now | date \""20060102150405\"")}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowdate := (toDate \""20060102150405\"" $today)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$startTime := .开始时间}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$endTime := .结束时间}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$percentage := 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if eq nil $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$percentage = 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq nil $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$startTime = $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$endTime = date \""20060102150405\"" $endTime }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$endTime = parseTime $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$totalDuration := $endTime.Sub $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$elapsedDuration := $nowdate.Sub $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$percentage = 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq 0 (div $totalDuration.Hours 24)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$percentage = 100.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$percentage = (mulf (divf (divf $elapsedDuration.Hours 24) (divf $totalDuration.Hours 24)) 100.0)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color := \""rgb(45,164,78)\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 在下面一行粘贴切换颜色的模板代码 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""background-color: rgba(175,184,193,0.2); width: 100%; display: inline-block;height: 12px;border-radius: 6px;align-self: center;overflow: hidden;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""text-align: right; font-size: 12px; width: .action{$percentage}%; background-color: .action{$color}; display: inline-block;height: inherit;vertical-align: top;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>‍</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 一个日期列内使用结束时间 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$today := (now | date \""20060102150405\"")}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowdate := (toDate \""20060102150405\"" $today)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$startTime := .计划时间}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$endTime := index . \""计划时间_end\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$percentage := 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 判断空值 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if eq nil $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$percentage = 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq nil $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$startTime = $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c"">&lt;!-- 或许能够解决 _end时间div0的问题？ --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$endTime = date \""20060102150405\"" $endTime }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$endTime = parseTime $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$totalDuration := $endTime.Sub $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$elapsedDuration := $nowdate.Sub $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$percentage = 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq 0 (div $totalDuration.Hours 24)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$percentage = 100.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$percentage = (mulf (divf (divf $elapsedDuration.Hours 24) (divf $totalDuration.Hours 24)) 100.0)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color := \""rgb(45,164,78)\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 在下面一行粘贴切换颜色的模板代码 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""background-color: rgba(175,184,193,0.2); width: 100%; display: inline-block;height: 12px;border-radius: 6px;align-self: center;overflow: hidden;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""text-align: right; font-size: 12px; width: .action{$percentage}%; background-color: .action{$color}; display: inline-block;height: inherit;vertical-align: top;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<h4 id=""随进度改变颜色"">随进度改变颜色</h4>
<ul>
<li>
<p>颜色更改时机：从左到右逐渐减小，以空格分隔，应为浮点数 <code>list 70.0 50.0 30.0 10.0 0.0</code>；</p>
<ul>
<li>对应颜色 <code>(+, 70.0]</code> 对应颜色 1，<code>(70.0, 50.0]</code> 对应颜色 2……；</li>
</ul>
</li>
<li>
<p>更改到的颜色：依次对应上面的更改时机，值满足 css 的颜色要求即可 <code>list \""#f94144\"" \""#FF6E34\"" \""#B88B06\"" \""#2DA44E\"" \""#2571BF\""</code>；</p>
<ul>
<li>上述示例为 红 橙 黄 绿 蓝，对应已过的时间 &gt;70, &gt; 50, ...</li>
</ul>
</li>
</ul>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$colorGradient_triggerPercentage := list 70.0 50.0 30.0 10.0 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$colorGradient_baseColor := list \""#f94144\"" \""#FF6E34\"" \""#B88B06\"" \""#2DA44E\"" \""#2571BF\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{range $index, $element := $colorGradient_triggerPercentage}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if ge $percentage (index $colorGradient_triggerPercentage $index)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$color = index $colorGradient_baseColor $index}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{break}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span></code></pre>
<p>示例：</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$percentage := 60.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color := \""rgb(45,164,78)\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 上面是需要使用到的变量，下面是具体更改的代码，用作上面进度的变色切换时，不要包含上面 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$colorGradient_triggerPercentage := list 70.0 50.0 30.0 10.0 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$colorGradient_baseColor := list \""#f94144\"" \""#FF6E34\"" \""#B88B06\"" \""#2DA44E\"" \""#2571BF\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{range $index, $element := $colorGradient_triggerPercentage}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if ge $percentage (index $colorGradient_triggerPercentage $index)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$color = index $colorGradient_baseColor $index}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{break}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 下面是用于修改文字的示例，用作上面进度的变色切换时，不要包含下面 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color}
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""color: .action{$color};\""</span><span class=""highlight-p"">&gt;</span> 还有x天 <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<h4 id=""还有x天-示例"">还有 x 天 示例</h4>
<blockquote>
<p>v1 版本已经移除，如有需要，请使用编辑历史查看；</p>
</blockquote>
<h5 id=""v3"">v3</h5>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$today := (now | date \""20060102150405\"")}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowdate := (toDate \""20060102150405\"" $today)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$startTime := .开始时间}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$endTime := .结束时间}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$percentage := 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 判断空值 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if eq nil $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$percentage = 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq nil $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$startTime = $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$endTime = date \""20060102150405\"" $endTime }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$endTime = parseTime $endTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$totalDuration := $endTime.Sub $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$elapsedDuration := $nowdate.Sub $startTime}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$percentage = 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq 0 (div $totalDuration.Hours 24)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$percentage = 100.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$percentage = (mulf (divf (divf $elapsedDuration.Hours 24) (divf $totalDuration.Hours 24)) 100.0)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color := \""rgb(45,164,78)\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 修改颜色 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$colorGradient_triggerPercentage := list 70.0 50.0 30.0 10.0 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$colorGradient_baseColor := list \""#f94144\"" \""#FF6E34\"" \""#B88B06\"" \""#2DA44E\"" \""#2571BF\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{range $index, $element := $colorGradient_triggerPercentage}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if ge $percentage (index $colorGradient_triggerPercentage $index)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$color = index $colorGradient_baseColor $index}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{break}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 剩余天数 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$daysLeft := 0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$remainingText := \""\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if ne nil $endTime }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$daysLeft = divf ($endTime.Sub $nowdate).Hours 24}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if eq 0 $startTime.Minute $startTime.Hour $endTime.Minute $endTime.Hour }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$daysLeft = ceil (divf ($endTime.Sub $nowdate).Hours 24)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{if gt $daysLeft 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$remainingText = printf \""还有%.0f天\"" $daysLeft}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{else if eq $daysLeft 0.0}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$remainingText = \""当天\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        .action{$remainingText = printf \""已过%.0f天\"" (subf 0.0 $daysLeft)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""color: .action{$color};\""</span><span class=""highlight-p"">&gt;</span>.action{$remainingText}<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>‍</p>
<h4 id=""今年进度"">今年进度</h4>
<blockquote>
<p>仅供参考，如果只是展示一个，不如使用 任务进度条挂件。</p>
</blockquote>
<ul>
<li>计算所在当年 1.1 至当前 12.31</li>
</ul>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$now := now}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowYear := now.Year}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowYearStr := printf \""%d-01-01\"" $nowYear}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$startOfYear := (toDate \""2006-01-02\"" $nowYearStr)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$endOfYear := (toDate \""2006-01-02\"" (printf \""%d-12-31\"" $nowYear))}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$today := (now | date \""20060102150405\"")}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowdate := (toDate \""20060102150405\"" $today)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$totalDuration := $endOfYear.Sub $startOfYear}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$elapsedDuration := $nowdate.Sub $startOfYear}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$daysSinceStart := div $elapsedDuration.Hours 24}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$totalDaysInYear := div $totalDuration.Hours 24}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$percentage := mulf (divf $daysSinceStart $totalDaysInYear) 100.0 | printf \""%.2f\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color := \""rgb(45,164,78)\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 在下面一行粘贴切换颜色的模板代码 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""background-color: rgba(175,184,193,0.2); width: 100%; display: inline-block;height: 12px;border-radius: 6px;align-self: center;overflow: hidden;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""text-align: right; font-size: 12px; width: .action{$percentage}%; background-color: .action{$color}; display: inline-block;height: inherit;vertical-align: top;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<h4 id=""当月进度"">当月进度</h4>
<blockquote>
<p>仅供参考，如果只是展示一个，不如使用 任务进度条挂件。</p>
</blockquote>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{$now := now}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowYear := $now.Year}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowMonth := $now.Month}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nowDay := $now.Day}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$startOfMonth := toDate \""2006-01-02\"" (printf \""%d-%02d-01\"" $nowYear $nowMonth) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nextMonth := add (mod $nowMonth 12) 1}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$nextYear :=$nowYear}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{if eq $nowMonth 12}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{$nextYear = add $nextYear 1}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$endOfMonth := toDate \""2006-01-02\"" (printf \""%d-%02d-01\"" $nextYear $nextMonth)}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$endOfMonth := $endOfMonth | date_modify \""-24h\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$today := now}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$totalDuration := $endOfMonth.Sub $startOfMonth}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$elapsedDuration := $today.Sub $startOfMonth}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$daysSinceStart := div $elapsedDuration.Hours 24}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$totalDaysInMonth := div $totalDuration.Hours 24}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$percentage := mulf (divf $daysSinceStart $totalDaysInMonth) 100.0 | printf \""%.2f\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{$color := \""rgb(45,164,78)\"" }
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">&lt;!-- 在下面一行粘贴切换颜色的模板代码 --&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""background-color: rgba(175,184,193,0.2); width: 100%; display: inline-block;height: 12px;border-radius: 6px;align-self: center;overflow: hidden;\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">span</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""text-align: right; font-size: 12px; width: .action{$percentage}%; background-color: .action{$color}; display: inline-block;height: inherit;vertical-align: top;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<h2 id=""简单模板入门"">简单模板入门</h2>
<blockquote>
<p>思源的很多功能都在官方帮助文档有说明，右下角 <code>?</code> 点击“帮助”打开帮助文档，待索引完成，点击右侧链接：<a href=""https://ld246.com/forward?goto=siyuan%3A%2F%2Fblocks%2F20210104091309-fhb549c"" target=""_blank"" rel=""nofollow ugc"">模板片段</a>  <a href=""https://ld246.com/forward?goto=siyuan%3A%2F%2Fblocks%2F20240208120846-72y7j0d"" target=""_blank"" rel=""nofollow ugc"">数据库-模板</a></p>
<p>我也很想用生成式 AI 完成模板，但似乎还是有点问题。给出下面的参考应该可以让 AI 完成的更好。</p>
</blockquote>
<h3 id=""主要参考"">主要参考</h3>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftext%2Ftemplate"" target=""_blank"" rel=""nofollow ugc"">template package - text/template - Go Packages</a> 关于 Go 模板的语法和使用，只参考 Overview 部分就够了；</li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpkg.go.dev%2Ftime"" target=""_blank"" rel=""nofollow ugc"">time package - time - Go Packages</a> 关于 Go 中 Time 类型的使用；在数据库“日期列”“创建时间”、模板中 <code>parseTime</code> 转换后等变量都是 <code>time.Time</code> 类型，均可使用这个文档中介绍的属性或方法；</li>
<li><a href=""https://ld246.com/forward?goto=http%3A%2F%2Fmasterminds.github.io%2Fsprig%2F"" target=""_blank"" rel=""nofollow ugc"">Sprig 帮助文档</a>（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdocs.siyuan-note.club%2Fzh-Hans%2Freference%2Ftemplate%2Fsprig%2F"" target=""_blank"" rel=""nofollow ugc"">思源社区-中文版</a>） 如果要创建一个数组（列表），或其他方法，都需要参考这里；</li>
</ul>
<h3 id=""前导说明-基本规则"">前导说明&amp;基本规则</h3>
<ol>
<li>
<p>加减乘除数学运算均使用 sprig 函数实现，不要使用 <code>+-*/%</code>；</p>
</li>
<li>
<p>注意区分整型和浮点型计算，浮点数使用 <code>addf subf mulf divf</code> 等；</p>
<ol>
<li>在 <code>if</code> 等做比较时，必须类型相同才可比较，即浮点数 <code>float</code> 不能和整型 <code>int</code> 做比较；</li>
</ol>
</li>
<li>
<p>函数调用时，基本遵从 <code>函数名 操作变量1 操作变量2 操作变量3 ...</code> 的格式，例如：<code>mul 3 4</code>；</p>
</li>
<li>
<p>基本规则（如果 gpt 能跟着链接找到基本语法，那就不需要下面的规则）</p>
<ol>
<li>
<p>在做基本判断时，使用如下格式</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.action{if 判断条件}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{/*具体的代码*/}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{else if 判断条件}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{/*具体的代码*/}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{else}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    .action{/*具体的代码*/}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.action{end}
</span></span></code></pre>
<p><code>.action{}</code> 形式仅仅是对 <code>{{}}</code> 的替代，不要使用以下格式：</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">.if{}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.else{}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.elseif{}
</span></span></code></pre>
</li>
</ol>
</li>
</ol>
<p>‍</p>
                

作者：Undii
链接：https://ld246.com/article/1713177507282
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",Undii,思源笔记,链滴优选
693,目前来看，最近的较稳定版本应该是 3.0.5 - 链滴,Thu Apr 11 2024 21:47:11 GMT+0000 (Coordinated Universal Time),"
                    <p>这几次更新由于涉及到基本结构，引发了奇妙的化学反应，出现了各种奇妙的 bug……</p>
<p>D 头秃中。</p>
                

作者：Frostime
链接：https://ld246.com/article/1712843231700
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
660,【硬核】思源导出之 PDF 水印 - 链滴,Wed Apr 10 2024 16:30:33 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""水印的定义"">水印的定义</h2>
<p>在 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzh.wikipedia.org%2Fzh-cn%2F%25E6%25B0%25B4%25E5%258D%25B0"" target=""_blank"" rel=""nofollow ugc"">WIKI</a> 中，水印的定义是：</p>
<blockquote>
<p><strong>水印</strong>（watermark）是<strong>一种能让人识别纸上图案的技术</strong>，当光线照射纸张时，纸张上会显现出各种不同阴影，这些阴影组成的图案就是水印。</p>
</blockquote>
<p>而在思源中，处理水印的方式是使用一款 <code>pdfcpu</code>​ 制作的 <code>watermark</code>​ 来处理的。</p>
<p>由于市面上有关 <code>watermark</code>​ 水印的使用方法入门较高，且不契合思源，于是就有了这篇文章的产生。</p>
<p>‍</p>
<h2 id=""选项如何填写-配置-使用-"">选项如何填写/配置/使用？</h2>
<p>开始使用水印。首先你需要在思源【设置（快捷键 alt + p）】-&gt; 【导出】这里面找到下面这两个选项：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/image-20240409232420-q3tqr10.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍</p>
<h3 id=""水印文本或水印文件路径"">水印文本或水印文件路径</h3>
<p>这个选项支持输入三种格式的内容，分别是文本（text）、图片（image）和 PDF 文档（pdf）。</p>
<p>官方为此贴心的提供了自动匹配机制，也就意味着你只需填写以上支持内容即可。例：</p>
<table>
<thead>
<tr>
<th>支持格式</th>
<th>填写例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>文本（text）</td>
<td>我是文本</td>
</tr>
<tr>
<td>图片（image）</td>
<td>D:\\logo.png</td>
</tr>
<tr>
<td>PDF 文档（pdf）</td>
<td>D:\\test.pdf</td>
</tr>
</tbody>
</table>
<p>设置和默认效果如下：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/image-20240409235853-h1j1dfb.png?imageView2/2/interlace/1/format/webp"">​</p>
<blockquote>
<p>这里的图片（image）和 PDF 文档（pdf）需要注意的是：<strong>要你自己机器路径里面有这些文档，才可以正常识别滴~</strong></p>
</blockquote>
<p>可惜这里 PDF 没有办法在后面添加 <code>:X</code>​（X 是指定 PDF 的页数，意思是指定获取 PDF 第几页用来做水印）。<strong>目前的操作逻辑是：PDF 一页页对应模式。</strong> 不过没关系，谁会用 PDF 来做水印呀~</p>
<p>‍</p>
<h3 id=""水印位置-大小和样式"">水印位置、大小和样式</h3>
<p>重点来啦，配置水印的位置、大小、样式都在这个选项。在思源里，经过我的测试目前可以用的主要是这几个：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数解释</th>
<th>参数使用例子</th>
<th>使用例子简写</th>
</tr>
</thead>
<tbody>
<tr>
<td>position</td>
<td>水印位置</td>
<td>position:center</td>
<td>pos:c</td>
</tr>
<tr>
<td>scalefactor<br></td>
<td>水印放大缩小</td>
<td>scalefactor:0.5 <strong>abs/rel</strong></td>
<td>scale:0.5 rel<br></td>
</tr>
<tr>
<td>strokecolor</td>
<td>水印文字描边颜色</td>
<td>strokecolor:#808080</td>
<td>strokec:#808080</td>
</tr>
<tr>
<td>fillcolor</td>
<td>水印文字颜色</td>
<td>fillcolor:#808080</td>
<td>color:#808080</td>
</tr>
<tr>
<td>rendermode</td>
<td>水印文字渲染模式</td>
<td>rendermode:2</td>
<td>mo:2</td>
</tr>
<tr>
<td>rotation</td>
<td>水印的旋转角度</td>
<td>rotation:0</td>
<td>rot:0</td>
</tr>
<tr>
<td>opacity</td>
<td>水印的不透明度</td>
<td>opacity:0.6</td>
<td>op:0.6</td>
</tr>
<tr>
<td>margins</td>
<td>水印的边距</td>
<td>margins:5</td>
<td>ma:5</td>
</tr>
<tr>
<td>backgroundcolor</td>
<td>水印的边距框背景颜色</td>
<td>backgroundcolor:#808080</td>
<td>bgcolor:#808080</td>
</tr>
<tr>
<td>border</td>
<td>水印的边界框</td>
<td>border:7</td>
<td>bo:7</td>
</tr>
</tbody>
</table>
<p>在这里你可以同时配置多个参数。但是要遵守以下规则：</p>
<p>1）每个参数都要写成这种形势（<strong>其中符号</strong>​ <code>**:**</code>​<strong>要使用英文符号</strong>）：&lt; 参数 &gt; : &lt; 内容 &gt;</p>
<p>2）多个参数之间的要<strong>用英文</strong>  <code>**，**</code>​<strong>符号区分开来</strong>：&lt; 参数 &gt; : &lt; 内容 &gt;, &lt; 参数 &gt; : &lt; 内容 &gt;</p>
<p>例如：</p>
<pre><code class=""language-comm highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">position:center, color:#808080, op:0.6     # 正确
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">position:center, bgcolor:#808080，op:0.6   # 错误（原因：,符号中文）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">pos：c, rot:-90, op:0.6                    # 错误（原因：:符号中文）
</span></span></code></pre>
<p>‍</p>
<h4 id=""position-位置"">position 位置</h4>
<p>在 <code>Watermark</code>​ 中，位置被分为以下几个部分：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/Snipaste_2024-04-09_17-49-43_x4-20240409175208-j5r0hge.webp"">​</p>
<p>这里的规则，我举个例子，比如我要把水印设置在【顶部】并且【居中】的情况，那么就可以这样拼接：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/Animation-20240410094543-x29f7gn.webp"">​</p>
<p>‍</p>
<p>最后拼接完成的 <code>TC</code>​，修改为小写 <code>tc</code>​，然后在前面添加 <code>pos:</code>​。完整内容：<code>pos:tc</code>​。</p>
<p>为了更加方便的使用，<code>Watermark</code>​ 提供了简写的方式，比如这里提到的 <code>position</code>​ 就可以用 <code>pos</code>​ 来代替。顶部 <code>Top</code>​ 可以用 <code>T</code>​ 来代替，以此类推...</p>
<p>‍</p>
<p>‍</p>
<h4 id=""scalefactor-放大缩小"">scalefactor 放大缩小</h4>
<p>注意这里的 <code>scalefactor</code>​ 选项是有输入区间的：在最小 <code>0.0</code>​ 和最大 <code>1.0</code>​之间的数值，如：<code>0.7</code>​。</p>
<p>在这里还有个可选项，分别是：<strong>绝对位移 abs、相对位移 rel，属于可填可不填，它们的区别在于：</strong></p>
<p>1）绝对位移(abs): 绝对位移是指水印相对于 PDF 页面的固定位置。</p>
<p>2）相对位移(rel): 相对位移是指水印相对于 PDF 页面的大小进行定位。</p>
<p><strong>绝对位移是按照固定的点数来定位水印，而相对位移是按照页面宽度和高度的比例来定位水印。</strong></p>
<p>‍</p>
<p>‍</p>
<h4 id=""strokecolor-fillcolor-rendermode-文字颜色"">strokecolor、fillcolor、rendermode 文字颜色</h4>
<p>水印的颜色包括：水印描边颜色和水印本身的填充颜色两种。在这里我放在一起说是因为它们的参数很相似，均可接受以下参数：</p>
<p>1）RGB 浮点，即：RGB(r, g, b)。例：<code>color:0.6 0.2 0.9</code>​ 其中 <code>0.6</code>​ 是 <code>R</code>​，<code>0.2</code>​ 是 <code>G</code>​，<code>0.9</code>​ 是 <code>B</code>​ 。</p>
<p>2）RGB 十六进制，即：#RRGGBB。例：<code>color:#000000</code>​。</p>
<p>3）Watermark 中有提前预设好的值，但经测试，并未生效。</p>
<p>‍</p>
<p>注意这里还有一个 <code>rendermode</code>​ 水印文字渲染模式选择。它默认支持输入以下参数：</p>
<table>
<thead>
<tr>
<th>参数解释</th>
<th>参数值</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用填充颜色</td>
<td>0</td>
</tr>
<tr>
<td>应用描边颜色</td>
<td>1</td>
</tr>
<tr>
<td>同时应用填充和描边颜色</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>如果你同时设置了水印描边颜色和水印本身的填充颜色两种，又想同时将其应用，只需要添加一个 <code>mo:2</code>​ 即可。</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/image-20240410120246-q620bv1.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍</p>
<p>‍</p>
<h4 id=""rotation-旋转"">rotation 旋转</h4>
<p>注意这里的 <code>rotation</code>​ 选项是有输入区间的：即在 <code>-180.0</code>​ 和 <code>180.0</code>​之间的角度（可以输入负数），如：<code>-90</code>​。</p>
<p>说到旋转，就不得不提到在 <code>Watermark</code>​ 里的对角线。对角线 <code>diagonal</code>​，其实它是一个参数，例：<code>diagonal:2</code>​ 或者简写成 <code>d:2</code>​，它默认参数是 <code>1</code>​，只能接受两个参数：</p>
<p>1）从左下角至右上角，记作 1</p>
<p>2）从左上角到右下角，记作 2</p>
<p>**很可惜，在思源中，**​<code>**diagonal:2**</code> <strong>这种写法暂时不支持。所以默认的对角线就只有</strong>​<code>**diagonal:1**</code> <strong>即从左下角至右上角。并且基于该对角线进行旋转！</strong></p>
<p>‍</p>
<p>‍</p>
<h4 id=""opacity-不透明度"">opacity 不透明度</h4>
<p>这里的 <code>opacity</code>​ 选项是有输入区间的：在最小 <code>0.0</code>​ 和最大 <code>1.0</code>​之间的数值，如：<code>0.3</code>​。</p>
<p>其中 <code>1.0</code>​ 是完全不透明，<code>0.0</code>​ 是完全透明。</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/Animation-20240410151222-tci2upx.webp"">​</p>
<p>‍</p>
<p>‍</p>
<h4 id=""margins-边距框"">margins 边距框</h4>
<p>在水印的边距 <code>margins</code>​ 中，你需要先设置背景颜色 <code>backgroundcolor</code>​ 参数，举例：<code>backgroundcolor:#beded9</code>​ 或者是使用简写：<code>bgcolor:#beded9</code>​。然后在设置水印的边距 <code>margins</code>​，它可接受以下的这两种方式：</p>
<p>1）直接设置四个边框。例：<code>margins:5</code>​。</p>
<p>2）为四个边框单独设置边距。这四个参数分别为 &lt; 顶部 &gt; &lt; 右侧 &gt; &lt; 底部 &gt; &lt; 左侧 &gt;：例：<code>margins:5 0 5 0</code>​。</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/image-20240410161223-kihohr2.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍</p>
<p>‍</p>
<h4 id=""border-边界框"">border 边界框</h4>
<p>在水印的边界框 <code>border</code>​ 中，你需要和上面的边距框 <code>margins</code>​配合使用。它的参数是这样子的，举例：<code>border:7 round 0.3 0.7 0.7</code>​ 或者是使用简写：<code>bo:7 round 0.3 0.7 0.7</code>​。你还可以使用 <code>bo:7</code>​ 表示我就要一个边界，这样也是可行的。</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1665320903908/assets/image-20240410162516-14ss5ep.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍</p>
                

作者：wwxiaoqi
链接：https://ld246.com/article/1712737833847
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",wwxiaoqi,思源笔记,链滴优选
662,思源笔记数据库使用新思路：谈自上而下管理与自下而上积累 - 链滴,Thu Apr 04 2024 21:05:33 GMT+0000 (Coordinated Universal Time),"
                    <p>2024.04.15 更新：纠正下对 moc 的描述，下文中的 moc 指代列表型 moc，数据库也算是一种高级表格 moc</p>
<hr>
<p>之前思源笔记 3.0 发布，我就简单总结了下传统数据库的应用场景，如高级表格、整理书影音、文献笔记、制作 TODO list、管理博客文章等，具体见 <a href=""https://ld246.com/article/1708530190182"">Notion 的本地平替！思源笔记 v3.0 发布! - 链滴 (ld246.com)</a></p>
<p>最近实际使用数据库有一段时间，又有了很多新的想法，觉得数据库真的非常好用，有其存在的意义：它补足了思源笔记作为双链笔记软件在管理笔记上的<strong>短板</strong>，数据库即可以与 moc 互补进行<strong>自上而下的知识体系管理</strong>，思源笔记的「添加到数据库」功能又可以与 dailynote 笔记法互补进一步完善无压笔记流程，进行<strong>自下而上的积累，</strong> 能充当 dailynote 笔记法<strong>过去一直缺失的文档树。</strong></p>
<blockquote>
<p>什么是自上而下和自下而上呢？L 先生的《打开心智》一书中做了阐述</p>
<ul>
<li><strong>自上而下</strong>：先通过积累形成若干个主题，再从这些主题出发，想清楚自己缺少什么，需要去弥补什么，然后有意识地去获取知识来填充这些主题，完善这些主题。简言之：先建立框架，再填充框架。</li>
<li><strong>自下而上</strong>：先不要考虑太多，先去学习。先积累和收集大量的笔记，让它们“自由生长”。然后再通过复习，把它们整合起来，自下而上地构成一个个框架、文章、成果。亦即：先收集素材，再组装成型。</li>
</ul>
</blockquote>
<p>最近一直在生病，干活少，难受就读书，最近就在读《神经科学：探索脑》这本书，所以就以读此书为例，介绍我现在是怎么使用思源笔记的数据库。</p>
<h2 id=""数据库与MOC-自上而下的管理"">数据库与 MOC：自上而下的管理</h2>
<p>首先，最显而易见，用数据库可以来管理读书过程中的每一章读书笔记。在没有数据库之前，我会使用 MOC 方法来管理每一章读书笔记，搞一个列表块，添加各章节，读到哪一章节，就块引新建文档，然后记笔记。比如下图这样：</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_19-46-11-20240404194615-2s3i7c5.png?imageView2/2/interlace/1/format/webp""></p>
<p>这一方法在实际使用过程中有一些问题：</p>
<ul>
<li><strong>这章节的笔记要回到目录页、跳转到下一章节有点麻烦：</strong> 要么通过反链面板到书籍页面，再到下一章，但反链面板常常有其他文档和 dailynote 干扰，不好找到书籍目录页面；要么在这一章节添加书籍页面块引和下一章节块引，这一点困扰了我很久。</li>
<li><strong>删除笔记的管理麻烦</strong>：如果把这一章节的笔记删除，moc 的链接不会消失，需要自己手动删除。这个问题在读书笔记上可能比较少出现，但在用 MOC 管理概念笔记、博客笔记等时，就会容易碰到。<strong>这也是思源一直没有目录块的弊端。</strong></li>
</ul>
<p>而使用数据库来管理笔记目录有什么好处呢？</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_19-51-53-20240404195156-g2u74tu.png?imageView2/2/interlace/1/format/webp""></p>
<ol>
<li>
<p>可以通过章节文档右上方的数据库角标打开对应数据库，查看其他章节笔记，没有其他干扰，非常便捷</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_19-55-33-20240404195539-my6ia1e.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>数据库中的文档删除，数据库对应条目自动删除，不需要额外处理</p>
</li>
<li>
<p>数据库能根据更新时间、创建时间等条件进行筛选和排序。</p>
</li>
<li>
<p>思源的数据库主键除了文档外，还可以是普通文本，可以提前新建图书章节，读到那一章，再新建文档。这一点在管理知识体系、管理写作文章也很好用，提前把自己想写的、想研究的标题填入数据库，等要写了，再新建文档。这点与用 MOC 管理笔记的体验是差不多的。</p>
</li>
</ol>
<p><strong>当然用数据库管理目录也有问题</strong>：</p>
<ul>
<li>没有列表管理那么方便，不是那么方便批量添加</li>
<li>目前数据库视图并没有目录视图，表格视图只适合简单的一级目录线性管理，无法像列表 MOC 和表格 MOC 一样，提供丰富的层级关系。但凭借多选列和单选列构建不同视图，可以对条目进行分类，对于没有多层级的目录管理而言，还是够用的。有多层级的笔记目录管理还是建议用 MOC，实在想用数据库来管理，也可以用数据库嵌套的方式，即一级目录用一个数据库管理，二级目录通过一级目录各个文档里嵌套数据库管理。</li>
</ul>
<p>需要注意的是，我觉得<strong>数据库和 MOC 管理笔记并不矛盾</strong>，数据库更倾向与笔记管理、项目管理，MOC 更自由更倾向于梳理笔记关系，还能方便引用其他笔记。完全可以在主题笔记同时用 MOC 和数据库。如下图，是一个简单的示例：</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-05_10-20-52-20240405102121-so8vlti.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>PS：现在发现做笔记就不要追求不重复，怎么方便怎么来，数据库和 MOC 我全都要！！！</p>
</blockquote>
<p>另一个例子，我就举例我的尤克里里笔记吧，算是比较典型，具体的学习笔记由于靠考虑<strong>尤克里里弹奏学习、乐理知识、制谱软件、学习资源等分类</strong>，所以我使用 <strong>MOC</strong> 来管理笔记，而<strong>具体弹唱和指弹曲目的学习</strong>，则是使用<strong>数据库</strong>来管理，还能起一个简单的任务管理作用（数据库就非常适合管理 Project 笔记）。</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-05_10-09-52-20240405101021-bgkcjdt.png?imageView2/2/interlace/1/format/webp""></p>
<p>当然，根据图书的章节一章一章的记笔记，只是低级的自上而下，更进一步的自上而下管理是问自己感兴趣和需要的方面，比如</p>
<ul>
<li>海马与记忆有什么关联？什么是情景记忆？什么是印记细胞？什么是位置细胞？</li>
<li>为什么神经领域会用钙荧光信号作为指示剂来表征神经元活动？钙信号图像的数据处理步骤有哪些？常见的后期数据分析方法有哪些？</li>
<li>三光子显微镜为什么可以直接看到脑子里神经元的活动？</li>
<li>现在脑机接口的发展如何了？脑机接口是如何知道人在想什么的？</li>
<li>……</li>
</ul>
<p>然后根据自己罗列的问题，有时间就去一个个查资料读文献，深入了解。这里就不再展开。</p>
<h2 id=""数据库与dailynote-自下而上的积累"">数据库与 dailynote：自下而上的积累</h2>
<p>我目前的大部分的笔记文档都是通过笔记本的设置实现块引新建文档和标签页新建文档<strong>按月来存放，不追求文档的分类</strong>。相信很多践行 dailynote 笔记法的朋友也是如此设置。</p>
<p>笔记本设置</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_20-10-44-20240404201045-hgz4gvn.png?imageView2/2/interlace/1/format/webp""></p>
<p>文档树预览</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_21-09-56-20240404210958-bjq4d0s.png?imageView2/2/interlace/1/format/webp""></p>
<p>L 先生的《打开心智》一书中，提到的 <strong>INKP 法</strong>（收集箱 I，概念笔记 N，知识主题 K，项目 P）说，读一本书，<strong>不要只按章节来记笔记，而是应该整理出一个个概念</strong>，这样方便知识体系的建立、知识复用和知识的更新。</p>
<p>于是我就开始在思源笔记里践行 INKP 笔记法，依然以读《探索脑》这本书为例，读《第 5 章 突触传递》这一章时，我碰见了电突触、神经递质、化学突触、乙酰胆碱等名词，我就块引新建文档，建立概念笔记。为了管理这些概念笔记，我会建立主题笔记，如建立一个《神经科学》笔记。然后接下来就有一个问题了，<strong>这些概念笔记该如何放到主题笔记里去呢</strong>？</p>
<p>没有数据库之前，为了把《乙酰胆碱》这篇概念笔记传递到主题笔记，又同时为了方便所谓的无压，我会像思源笔记社区的一些人学习，<strong>在概念笔记文档里建立块引标签</strong>。</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_20-59-19-20240404205926-x6w8tif.png?imageView2/2/interlace/1/format/webp""></p>
<p>这样在《神经科学》笔记的反向链接就能看到《乙酰胆碱》这个文档了。</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_20-57-58-20240404205816-y2ltnln.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后呢？有空就整理到《神经科学》的 MOC 列表里？不，<strong>一般情况下，我就完全懒得管这篇笔记了</strong>，因为觉得通过反链面板整理文档真的很<strong>痛苦</strong>呀！！！尤其如果建立一口气建立很多概念笔记，要一个个打块引标签，然后之后再到主题笔记添加对应的概念块引，<strong>那我为什么不直接在主题笔记就添加块引呢</strong>？而且这种方法还会污染笔记正文，不方便我分享到其他平台上。所以，我目前已经<strong>不再像过去那样热衷于什么都要块引传递积累</strong>了，当下就能整理，为什么要未来整理，东西一积累多反而就懒得整理了。</p>
<p>但现在有了数据库，尤其思源笔记的块标菜单有一个「添加到数据库」功能，天哪，这简直是一个伟大的 idea，经过试用后，觉得拨云见日，发现新大陆。感谢 Gaofy 在<a href=""https://ld246.com/article/1706364438422"">在 dailynote 流程中，如何把当前块添加到数据库？畅想一种新的方式 - 链滴 (ld246.com)</a>提的建议！让数据库也有了自下而上渐进式积累的无压笔记体验。</p>
<p>方法就是《神经科学》这篇主题笔记新建一个数据库，比如也命名为“神经科学数据库”，《乙酰胆碱》这篇文档直接通过「添加到数据库」添加到该数据库，然后就完成了归档步骤，就这么简单，之后就专心记你的笔记 。</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_21-02-04-20240404210214-rrg2nrc.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<p>我发现数据库尤其适合整理这种名词概念笔记，零散杂乱，用 MOC 整理其实挺头疼的，完全不知道该放在哪里，等列表长了，也不方便查看。现在<strong>用数据库，直接往里丢就好了，你都完全不用打开主题笔记想着这个概念要放在哪里</strong>。之后有需要利用标签、排序筛选、新建视图等功能进行管理就好了。</p>
<p>这种方法，我个人认为非常便于学科及领域的概念学习和积累：</p>
<ul>
<li>在渐进式读书过程中遇到的名词块引新建文档通过块标放入数据库中</li>
<li>如果你是 dailynote 笔记法的践行者，在一天遇到的新名词，也可以在 dailynote 通过块引新建文档，然后放入对应的主题数据库里，</li>
</ul>
<p>而且添加到数据库也支持同一篇笔记放入多个不同的数据库，应该可以平替标签和“块引标签”，管理更方便！</p>
<p>再举一个例子，对于经济学，我非常不了解，前段时间看繁花积累了一点点储备，像经济学这种我过去几乎不怎么了解的领域，我根本就不在乎知识相互之间的关联，我只在乎当前遇到的名词我学会就好了。</p>
<p><img src=""https://b3logfile.com/file/2024/04/siyuan/1610205759005/assets/Clip_2024-04-04_21-17-14-20240404211717-olp0h7n.png?imageView2/2/interlace/1/format/webp""></p>
<p>此外，也不必局限于只传递概念笔记，只建立概念笔记数据库，大可以建立一个主题数据库，除了概念笔记之外，写了对应领域的博客，阅读了对应领域的文章和文献，都可以放进去，分别打上「概念笔记」「写作输出」「文献阅读」标签即可。即<strong>把数据库作为 dailynote 笔记法对应主题的文档树</strong>，同时具备根据标签进行分类和排序的功能！</p>
<p>总结，dailynote 笔记法说到底就是为了进行渐进式的积累，无论是块引传递还是数据库，只要能达到这个渐进式积累的目的就 ok，不管黑猫白猫能抓到老鼠就是好猫，<strong>不必执着于只用块引传递</strong>！个人目前认为反链面板在渐进式学习过程中，更适合积累碎碎念和思考，<strong>对于概念笔记和文档笔记而言，更适合用数据库来进行积累</strong>，因为这样，起码对我来说，后者<strong>留给未来的心智压力更小</strong>！<strong>块引传递用来积累单个话题的观点和思考，数据库积累主题下的一篇篇笔记，</strong> 彼此互补，多棒 <strong>！</strong></p>
<p>以上！</p>
<p>‍</p>
                

作者：Achuan-2
链接：https://ld246.com/article/1712235934222
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",Achuan-2,思源笔记,链滴优选
665,第二次漫游：双链、xanadu 与渐进学习 - 链滴,Sun Mar 31 2024 16:08:58 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""第二次漫游-双链-xanadu与渐进学习"">第二次漫游：双链、xanadu 与渐进学习</h2>
<p>这是一次漫游，不同于之前的文章，主要进行一个发散式的闲聊，以及共享我思考的上下文。</p>
<p>渐进学习手册已经修稿完了，增删了一些内容，再加上这两天做的这张图就能完结了：</p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/思源双链流程图-20240328150130-hjphmp8.png?imageView2/2/interlace/1/format/webp""></p>
<p>我把图中提到的可选选项都丢到了文章末尾，有需求直接去拿。</p>
<p>Roam 式双链用法其实一直挺简单的，没有分类、文档树这些元素，点进 DailyNotes 里记就完了，必要时打个 <code>[[块引用]]</code> 点进去看反链汇总，没什么复杂的，回归辅助思考的本质。</p>
<p>可能是太过简单，导致使用起来反而有压力，所以需要社区有讨论，让社区来进行背书：<strong>放心用，大胆记，真的就这么简单，别整那些复杂的玩具浪费动力。如果你觉得这样记笔记会发展成屎山，那么其它方法也一样会成屎山。</strong></p>
<p>比如我 2020 年的时候就老问我的思源启蒙老师 @<a href=""https://ld246.com/member/zhangzz"" class=""tooltipped__user"" target=""_blank"">zhangzz</a> “真的就这么简单？”，反复确认几次才敢这么用 DailyNotes 。</p>
<h2 id=""记录-整理存在着压力"">记录、整理存在着压力</h2>
<ul>
<li>我用双链的时候正巧碰到 @<a href=""https://ld246.com/member/deerain"" class=""tooltipped__user"" target=""_blank"">deerain</a>  来<a href=""https://ld246.com/article/1628672942107"">游说反链改版</a>，后来又写了<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fffqk2e"" target=""_blank"" rel=""nofollow ugc"">双向链接时代的快速无压记录</a>，这里哈桑老师敏锐地察觉到 Roam 带来的使用体验不在“互相关联与网状”上，而在于记录与整理的压力处理上。</li>
<li>当时我一听，这和我的经验相符啊，关联知识点确实没感觉到对我有啥用，传统的先分类再进去记笔记步骤太多了，写几次就烦了，直接进行一个摆。</li>
<li>也就从这里，我开始了第 N 次笔记入门，当时写下了<a href=""https://ld246.com/article/1633719399031"">实践中对双链和写作的一些思考</a>。</li>
</ul>
<h2 id=""很多人被传统记录流程拦在了门前-包括我"">很多人被传统记录流程拦在了门前，包括我</h2>
<ul>
<li>在这里我想共享的视角是，像之前的我一样不记录的人也是有的。</li>
<li>我没有记录的内在动力，看到炫酷的展示我也会尝试两天，然后放弃。</li>
<li>记录和整理对我而言太累太累，最重要的是，之前的我从未感受到过记录和整理有任何意义或者奖励，它对我的学习而言没有任何帮助。</li>
<li>大多有内在动力的人无法理解，他们从笔记里获得了激励，或者养成了习惯发展为了爱好，但对我来说，笔记的记录和整理过程里只有无聊，以及动力的损耗。</li>
<li>像我这样被挡在门槛前的人，因为从未进门，所以也很少有人在门里听见我们的声音。</li>
</ul>
<h2 id=""笔记的不同使用目的"">笔记的不同使用目的</h2>
<ul>
<li>笔记这个词太过宽泛，并不能反映我们的具体需求，例如有些人只是想要个资料库，进行一些信息管理，有些人是想借助工具帮助自己成长，这是完全不同的需求，我最早在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F352176551"" target=""_blank"" rel=""nofollow ugc"">为什么任何笔记系统在 SuperMemo 面前都是垃圾 (如 OneNote 和 Evernote)</a>的评论区里看到这种矛盾，这是不深入笔记社区就无法了解到的。</li>
<li>无论国内还是国外都是。</li>
</ul>
<h2 id=""为什么我不说知识管理"">为什么我不说知识管理</h2>
<ul>
<li>大家对知识管理的定义也很模糊，当我提到知识管理也会被理解为资料管理、创意管理、参考管理、资源管理等等，所以不如直接描述自己的目的，比如：发展自己的想法，让自己变得更有洞察力</li>
<li>而我的目的，只是想让自己有积极起来的欲望。</li>
</ul>
<h2 id=""是表达促进了学习-而不是记录和整理"">是表达促进了学习，而不是记录和整理</h2>
<ul>
<li>在笔记社区另一个有趣的点就是讨论整理，分目的来讨论的话，有些信息管理是要去做整理的，比如个人的重要的证件信息、密码之类的。</li>
<li>但如果有人告诉你不去整理就无法学习成长，别信，有坑。</li>
<li>这就像有人和你说记笔记就能获得好成绩一样，太扯了我的朋友。</li>
<li>如果记笔记的过程中有什么能促进学习，那只有表达，表达促进了学习，学习又增强了表达，只有见理不明才会说话不清。</li>
</ul>
<h2 id=""表达也存在着压力"">表达也存在着压力</h2>
<ul>
<li>
<p>将语言组织成有逻辑的长句对我来说有点吃力，之前记笔记被劝退也有这方面的原因，后来学到了使用大纲快速固定想法：</p>
<ul>
<li>只敲下想法的关键词，回车，缩进，写下新的想法关键词，不考虑修辞，不考虑逻辑。</li>
</ul>
</li>
<li>
<p>这时候我才明白，为什么 FLY 老哥说他的块引用会在很深的大纲层级中使用，而不仅仅是在大纲首项中用。</p>
</li>
<li>
<p>这种速记有让我爽到，它让我的记录第一次跟上了思考的速度，以往我都是写写停停，琢磨下修辞，然后开始走神犯困。</p>
</li>
</ul>
<h2 id=""哈桑的-DailyNotes-流程"">哈桑的 DailyNotes 流程</h2>
<ul>
<li>有点混淆的是，哈桑老师分享的是自己解析出来的个人流程，有 Page 级的引用和上下文反链，但是没怎么说块级引用。</li>
<li>在<a href=""https://ld246.com/article/1634538470534"">【笔记方法分享】conor 的写作工作流 | 块引用的作用</a>里看出块级引用的作用，就在 FLY 老哥分享的 Conor 工作流里，我学到了第二个关于双链的知识点：DailyNotes 中的记录是一种记忆的锚点，可以通过记录的上下文事件唤醒记忆，它也可以用来索引。</li>
<li>所以准确的说，DailyNotes 流程的全称应该是“哈桑的 DailyNotes 流程”。</li>
</ul>
<h2 id=""ADHD-Xanadu-与非线性写作"">ADHD、Xanadu 与非线性写作</h2>
<ul>
<li>
<p>提出 Project Xanadu 的 Ted Nelson 有严重的注意力缺陷障碍（Attention Deficit Disorder, ADD），他很容易迷失在大脑产生的疯狂的大量联想中，同样他也无法忍受传统写作和结构：</p>
<ul>
<li>
<blockquote>
<p>Ted Nelson 喜欢文字，它是记忆的工具，但他讨厌传统的写作和编辑方式强加了一个虚假的的和有限的秩序。他对书中流畅、渐进的叙述不感兴趣。他希望所有的东西都被保存在所有混乱的流动之中，这样就可以根据需要重建了。——<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F59394667"" target=""_blank"" rel=""nofollow ugc"">上都的诅咒（The Curse of Xanadu）</a></p>
</blockquote>
</li>
<li>
<blockquote>
<p>Ted Nelson 希望将内容（content）从结构（structure）中分开，这样同一个内容可以有多个结构，读者和作者可以根据自己的需求从不同的角度看内容。<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.huxiu.com%2Farticle%2F115607.html"" target=""_blank"" rel=""nofollow ugc"">计算机历史人物中的另类，Ted Nelson：将想法和表达从四方的纸质监狱中解放出来</a></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>在了解 Ted Nelson 之前我对 Project Xanadu 并没有什么共鸣，那些愿景离我太远，什么对信息追溯到其来源、看到谁引用了原版重新混合和扩展了原版，什么出版系统付费啊，这都是多人模式下的功能，我是单机玩家没什么实感。</p>
</li>
<li>
<p>但是当知道他的注意力缺陷障碍后，这我懂啊，切换了视角不去看那些愿景，而是基于 Ted Nelson 对注意力解放的追求来看，Project Xanadu 也可以拿来当非线性写作用：</p>
</li>
<li>
<p>可以先尽情写一堆可能用到或用不到的想法片段，而选择展示哪些內容，如何组织起來则是分成了另一件任务。</p>
</li>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240330004612-nb740ox.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>双向链接就可以用来跟踪所有不同的想法，因为这些想法会发展成不同的写作路径，同一个想法可能存在于不同的上下文语境中。</p>
</li>
<li>
<p>沿着链接能激活不同的上下文语境，因为都是自己思考的内容，所以很容易激活大脑中的相关记忆，就像在自己的大脑中漫游，SuperMemo18 加入的神经学习就是类似这种模式。</p>
</li>
<li>
<p>当然，前提是你链接的是自己大脑里的想法，不是完全陌生的信息，我试过链接到资料，漫游到它们时得停好久重新阅读，很不爽。</p>
</li>
</ul>
<h2 id=""神经学习-想法与双链"">神经学习、想法与双链</h2>
<ul>
<li>SuperMemo18 加入的神经学习有一个链接功能，不过是单链，可以手动建立双链。</li>
<li>刚开始用神经学习时我就热衷于打链接，使用后感觉再次上当了：这玩意跟双链的互相关联一样没啥效果啊。</li>
<li>初期我是拿来当分类用，后来发现不行，和双链软件一样完全没效果，和 SM 社区交流后发现得链接重要的 idea，不能只是分类、预整理：</li>
<li>
<blockquote>
<p>【概念】和【链接】是想要将我们脑内的知识网络映射出来，【概念】就应该是脑子里一瞬间能反应过来的事物，而不是庞大臃肿的分类学集合，那些包含太多卡片的【概念】，其内部的卡片间逻辑无法真正映射到脑中，事物间的联系被模糊了，而这应该是神经学习使用者不想见到的。</p>
</blockquote>
</li>
<li>嘿巧了，在思源里也能这么用双链啊！从那时起我开始用双链发展我的想法，不只是单纯的信息记录和整理。</li>
<li>现在以我的三年来的经验来看：双链对知识和想法的组织极其有用</li>
<li>我无法告诉你它对信息管理用处大不大，只从记录的视角来看它改变了规则，将整理的压力转移到未来，但就像<a href=""https://ld246.com/article/1628672942107"">【共同探讨】移动块 / 反链 / 快速无压记录 / 标签 </a>评论区种所讨论的那样：“整理的压力一直都有，无论是现在还是未来，它都在那里，区别只在于你什么时候处理这个压力。”</li>
<li>这句话对信息管理来说是对的，但如果你像我一样是为了发展想法、获得成长来使用思源，那规则完全不一样了，我们完全不需要在思源里整理数据。</li>
<li>我们只需要在思源里发展想法，进行表达。当进行表达的那一刻，就已经做出了在大脑里进行了整理。</li>
<li>这种需求不需要必须建立索引，记录的上下文事件、想法之间的联系都能帮助定位到笔记，它们的使用成本又很低。</li>
<li>也就是说我们在大脑里建立索引，而不是在笔记里。</li>
<li>除此之外整理信息是不会获得内在奖励的，它会损耗你的内在动力，但发展想法会产生内在奖励，提升你的内在动力，这是极大的不同，也是为什么使用双链和大纲能越写越爽。</li>
<li>现在就剩下一个问题，哈桑老师所说的双链无压到底是不是 Roam 故意设计出来的？</li>
</ul>
<h2 id=""ADHD-Conor-White-Sullivan-和上下文反链"">ADHD、Conor White-Sullivan 和上下文反链</h2>
<ul>
<li>
<p>RoamResearch 刚开始可以看成 Project Xanadu 的单机版，现在有没有加入类似 Xanadu 的愿景我不好说，但是仅从设计来看，RoamResearch 解放注意力更直接：</p>
<ul>
<li>有一个笔记的最底层 DailyNotes，可以当成写任何东西的草稿纸</li>
<li>有一个 Page 级的引用 <code>[[</code>，配合大纲能进行快速输入</li>
<li>有一个块级引用 <code>((</code>，可以将快速输入的内容进行再组织</li>
<li>最重要的，它和 Xanadu 不同的是加入了上下文反链，这改变了游戏规则，诞生了一系列突破想象力的功能和用法，例如反链转移、空白节点、反链的筛选等等。</li>
</ul>
</li>
<li>
<p>巧合的是，Conor 也患有 ADHD，他曾多次提到这点并推荐 ADHD 患者使用 RoamResearch 来改善记录：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240330041246-9gt7i05.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>哈桑老师对 Roam 的判断是对的，或许是能感同身受传统记录和结构带来的压力，那些热爱写作的 ADHD 患者会去尝试做出改变，果然替身使者是会相互吸引的。</p>
</li>
<li>
<p>后来我在 Roam 社区看到了渐进形式化这个概念，酷！它把我想要解释的东西全部串联起来：Roam 的设计、传统记录的压力、编程注意力、流畅的非线性写作、结构化的思想工具等等，于是<a href=""https://ld246.com/article/1681801981651"">一次漫游：学习中的快乐与束缚</a>就诞生了。</p>
</li>
</ul>
<h2 id=""渐进形式化"">渐进形式化</h2>
<ul>
<li>
<p>支持渐进形式化的软件很适合我，比如 Roam 式双链和 SuperMemo。</p>
</li>
<li>
<p>它们以一定的程度贴合我跳跃的思维，我能直观地理解如何定制和使用它们，用来适应我的特定方式，并且它们支持了我这样做。</p>
</li>
<li>
<p>比如：</p>
<ul>
<li>我不想先分类再记录，那么双链就给了我选择可以不去分类。</li>
<li>我不想进行正式的、有逻辑的表达，那就能使用大纲快速输入想法。</li>
<li>我很少能阅读完一本书，看了两三页就开始犯困，只想看有趣的内容，渐进阅读鼓励我这么做。</li>
</ul>
</li>
<li>
<p>这些软件对使用中的压力进行了优化，这真的很棒。</p>
</li>
</ul>
<h2 id=""SuperMemo-中的压力优化"">SuperMemo 中的压力优化</h2>
<ul>
<li>说起压力，Anki 类软件用起来的压力对我来说是最大的，每天都要日清太反人类了，用之前雄心壮志，考完试之后再也不想打开。</li>
<li>SuperMemo 原来也是，后来出现了优先级队列、复习自动排序和自动推迟这些优化压力的功能，官方 wiki 也一直在引导使用这些功能，以尽可能低的摩擦力找到学习中产生的内在动力。</li>
<li>我非常喜欢 SuperMemo 中的渐进主义：当感觉到无聊或者注意力不集中就可以跳过。</li>
<li>以及作者对知识的态度：用你的新知识来娱乐。</li>
<li>从学习中得到动力之后我就像赚到了第一桶金，想去玩点花活，去尝试了很多学习策略，后来发现还是表达最经济实惠，消耗的动力不多，效果也挺好。</li>
<li>另外我还在 SM 中使用<strong>提取练习</strong>这个消耗大量动力的策略，表达的低消耗能保持我动力的收支平衡。</li>
</ul>
<h2 id=""各个语境下的自上而下与自下而上"">各个语境下的自上而下与自下而上</h2>
<ul>
<li>
<p>说起这个是突然想起好玩的事，这两个词是个筐，你往里装什么都行，只要能解释的通。</p>
</li>
<li>
<p>在笔记社区常用自上而下和自下而上这两个词，分别指代传统记录和双链的不分类记录。</p>
</li>
<li>
<p>我曾经用自上而下来描述渐进阅读，用自下而上来形容双链，产生了融合两者的想法：</p>
<ul>
<li>既有自上而下，又有自下而上。</li>
</ul>
</li>
<li>
<p>所以当我看到 Andy 老师的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F657707605"" target=""_blank"" rel=""nofollow ugc"">自上而下，再自下而上</a>时，我兴奋地认为他和我的想法一样，结果他不是在讲笔记方法，而是在说学习上的大方向：先整体，再细节，通过整体激发直觉与兴趣，再去学习基础。</p>
</li>
<li>
<p>在文章里他提到的还原论是通过将复杂的系统分解成基本组分，这个过程类似渐进阅读，是自上而下地拆解。</p>
</li>
<li>
<p>但是他反而用自下而上来指代还原论，我想 Andy 老师可能是在说拆解后从基本部分开始学习的过程是自下而上的，我拗了好久才理解。</p>
</li>
<li>
<p>后来又在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F33183603"" target=""_blank"" rel=""nofollow ugc"">注意力的认知神经机制是什么</a>里看到这两个词，在这里：</p>
<ul>
<li>自下而上指的是通过视觉等信息的外界刺激，由外部环境信息驱动注意力。</li>
<li>自上而下指的是根据当前任务的目标和以往的知识对视觉通路中信息的进行的调控，这是大脑内部信息驱动的注意力。</li>
</ul>
</li>
<li>
<p>挺有趣的，我想起之前哈桑老师在 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fhb0gsd"" target=""_blank"" rel=""nofollow ugc"">MOC - 管理链接而非本体</a>里提到过面向主题和面向结构，后来又在<a href=""https://ld246.com/article/1636729600143"">哈桑式 DailyNote 工作流整理之难</a>里提到过“如果预先维护一个结构，那就失去 daily notes 的意义了”。</p>
</li>
<li>
<p>我从注意力的角度来思考，发现面向主题和面向结构本质都是在做注意力编程：</p>
<ul>
<li>面向主题要求持久思考某个主题，然后在思考中建立自己的结构。</li>
<li>面向结构里，如果热衷维护结构则会把注意力都放在维护上，容易忽视思考。</li>
</ul>
</li>
<li>
<p>而一些工具就是依靠结构对注意力的编程实现的，比如模版啊、写作结构都是的。</p>
</li>
<li>
<p>我们可以进行扩展，比如间隔重复系统是在时间线上编程注意力，卡片的提示也是在编程注意力，这些都在我之前的文章中。</p>
</li>
</ul>
<p>到这里，我的任务就已经结束，如果您想与我进行更深入的交流，可以加入：</p>
<p><a href=""https://ld246.com/forward?goto=http%3A%2F%2Fqm.qq.com%2Fcgi-bin%2Fqm%2Fqr%3F_wv%3D1027%26k%3D7tm-NNY4Z8bkoj8c6KXVE43H25vcyq72%26authKey%3D%252FHpsAQV%252FD850xU85DDPDwd8wm0EEsTyBs1c95JQMggj6OPCD%252F8rbgbu5jqEQKb1y%26noverify%3D0%26group_code%3D538155062"" target=""_blank"" rel=""nofollow ugc"">思源笔记民间交流群</a>：538155062</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fpd.qq.com%2Fs%2Foo8s79rr"" target=""_blank"" rel=""nofollow ugc"">思源笔记频道</a>：频道号  SiYuanTFT42</p>
<h2 id=""一些资源-"">一些资源：</h2>
<ul>
<li>
<p>渐进阅读流程图</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20220716055427-c0auuhd.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>关于双链：</p>
<ul>
<li>
<p>临时哈桑的游说</p>
<ul>
<li><a href=""https://ld246.com/article/1628672942107"">【共同探讨】移动块 / 反链 / 快速无压记录 / 标签 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1613823303971"">恭喜思源发布 1.0，同时来解决几个疑问 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1630268678551"">1.3.1 浮窗拖动块的使用反馈 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F2762%3Futm_source%3Dld246.com"" target=""_blank"" rel=""nofollow ugc"">反链面板层级、上下文和移动改进 · Issue #2762 · siyuan-note/siyuan (github.com)</a></li>
</ul>
</li>
<li>
<p>哈桑老师的好文章</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fhb0gsd"" target=""_blank"" rel=""nofollow ugc"">MOC - 管理链接而非本体 (yuque.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fffqk2e"" target=""_blank"" rel=""nofollow ugc"">双向链接时代的快速无压记录 (yuque.com)</a></li>
</ul>
</li>
<li>
<p>FLY 老哥的文章和教程：</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fzvideo%2F1437768791271403520"" target=""_blank"" rel=""nofollow ugc"">越写越爽的笔记方法！迅速进入心流状态的“无摩擦”笔记法【思源笔记教程】 - 知乎 (zhihu.com)</a></li>
<li><a href=""https://ld246.com/article/1634538470534"">【笔记方法分享】conor 的写作工作流 | 块引用的作用 - 链滴 (ld246.com)</a></li>
</ul>
</li>
<li>
<p>大米的文章：</p>
<ul>
<li><a href=""https://ld246.com/article/1633719399031"">实践中对双链和写作的一些思考 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1681801981651"">一次漫游：学习中的快乐与束缚 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1711024416183"">思源渐进学习手册：双链与间隔重复系统 - 链滴 (ld246.com)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id=""图中提到的可选选项-"">图中提到的可选选项：</h2>
<ol>
<li>
<p>DailyNotes 汇总展示</p>
<ul>
<li>
<p>方法一：可使用 F 的文档流插件对所有 DailyNotes 进行汇总展示</p>
<ol>
<li>
<p>在集市里找到文档流插件下载并启用</p>
</li>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240328151543-prjyjqm.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>安装好后在左上角点击文档流插件图标</p>
</li>
<li>
<p>选择 SQL 查询</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240328152002-2ov4kbp.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>输入搜索所有 DailyNotes 的查询语句，例如：</p>
<ul>
<li>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">select B.* from blocks as B join attributes as A
</span></span><span class=""highlight-line""><span class=""highlight-cl"">on B.id = A.block_id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">where A.name like \'custom-dailynote-202%%%%%\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">order by A.value desc
</span></span></code></pre>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>方法二：在汇总所有 DailyNotes 的时候，会遇到文档数量太多导致卡顿的情况，我是用烟火酱的<a href=""https://ld246.com/article/1681801981651#%E6%97%B6%E9%97%B4%E7%BA%BF%E6%B1%87%E6%80%BB-%E6%9C%80%E5%90%8E%E7%9A%84%E4%BF%9D%E9%9A%9C"">块嵌入分页辅助挂件</a>解决的，挂件已经下架，可以在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fwinter60%2FEmbed-Pagination"" target=""_blank"" rel=""nofollow ugc"">这里</a>找到，在浏览嵌入块的时候可以利用下面的预览折叠列表功能查看子级。</p>
</li>
</ul>
</li>
<li>
<p>使用查询挂件建立主题的表格索引</p>
<ol>
<li>
<p>打开集市下载查询挂件</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240328153353-9susz67.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>在思源里使用“/挂件”唤出查询挂件，点击<kbd>Query 图标</kbd>唤出代码块</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/recording-20240328153922-alnng3z.gif""></li>
</ul>
</li>
<li>
<p>复制烟火酱分享的 SQL 填入代码块</p>
<ul>
<li><a href=""https://ld246.com/article/1676212878445"">Query 挂件实现统计每月新建了哪些【主题】 - 链滴 (ld246.com)</a></li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240328154437-au8tk3j.png?imageView2/2/interlace/1/format/webp""></li>
<li>记得将链滴小尾巴去掉</li>
</ul>
</li>
</ol>
</li>
<li>
<p>思源增强插件，在思源里提升双链使用的体验，有页内反链和反链筛选等功能，在集市里下载启用即可</p>
<ul>
<li><img src=""https://b3logfile.com/file/2024/05/image-IRn6wzi.png?imageView2/2/interlace/1/format/webp""></li>
<li>使用预览：</li>
<li><img src=""https://b3logfile.com/file/2024/05/recording-tNSm50y.gif""></li>
</ul>
</li>
<li>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2FUFDXD%2FHBuilderX-Light"" target=""_blank"" rel=""nofollow ugc"">HBLX 主题的功能</a>：聚焦折叠的列表大纲后自动展开、预览折叠的列表大纲</p>
<ul>
<li>
<p>效果图</p>
<ul>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/recording-20240331154949-jo0m21e.gif""></p>
</li>
<li>
<p>新版本记得打开点击聚焦选项（选项怎么又多了</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240331154855-w1pfliy.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用方法</p>
<ul>
<li>
<p>打开思源笔记设置</p>
</li>
<li>
<p>点击进入外观——代码片段</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240331155100-2q24ppw.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>在 CSS 一栏添加下方给出的代码片段并启用：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240331155159-71j9mv5.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>在 JS 一栏添加下方给出的代码片段并启用</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240331155247-e8xtvcf.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>配合使用的 CSS</p>
<ul>
<li>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">/*列表折叠*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.h1&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.h1&gt;[spellcheck])::after,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.h2&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.h2&gt;[spellcheck])::after,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.h3&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.h3&gt;[spellcheck])::after,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.h4&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.h4&gt;[spellcheck])::after,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.h5&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.h5&gt;[spellcheck])::after,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.h6&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.h6&gt;[spellcheck])::after,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">.protyle-wysiwyg [data-node-id].li[fold=\""1\""]&gt;.p&gt;[spellcheck]:not(.fn__flex-1.history__text.protyle [data-node-id].li[fold=\""1\""]&gt;.p&gt;[spellcheck])::after {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    content: \""  · · ·  \"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    font-family: \""Trebuchet MS\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    display: inline;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    font-weight: bold;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    vertical-align: 5%;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    font-size: 75%;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    color: rgb(95, 99, 104);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    word-break: break-all;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    border: 1px solid rgb(95, 99, 104);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    margin-left: 9px;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    border-radius: 5px;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span></code></pre>
</li>
</ul>
</li>
<li>
<p>JS</p>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * HBXL主题特性js
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.HBuilderXLight = {};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.HBuilderXLight.ButtonControl = {};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">//渲染进程和主进程通信
</span></span><span class=""highlight-line""><span class=""highlight-cl"">const { ipcRenderer } = require(\'electron\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">ipcRenderer.on(\""siyuan-send_windows\"", (event, data) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //console.log(data);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    switch (data.Value) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        case \""ButtonControl\""://按钮状态控制
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var ControlButtonIDs = data.ControlButtonIDs;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let index = 0; index &lt; ControlButtonIDs.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                const ControlButtonID = ControlButtonIDs[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                window.HBuilderXLight.ButtonControl[ControlButtonID.ButtonID][ControlButtonID.ControlFun]();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">});
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function broadcast(data) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ipcRenderer.send(\""siyuan-send_windows\"", data);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**----------------------------------自动展开悬浮窗折叠列表,展开搜索条目折叠列表,聚焦单独列表-----体验优化----------------------------------*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function autoOpenList() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //找到所有的悬浮窗
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var Preview = document.querySelectorAll(\""[data-oid]\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //如果发现悬浮窗内首行是折叠列表就展开并打上标记
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (Preview.length != 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let index = 0; index &lt; Preview.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                diguiTooONE_2(Preview[index], (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    if (v.classList.contains(\""block__content\"")) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        var vs = v.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        for (let index = 0; index &lt; vs.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            var obj = vs[index].children[1]
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (obj == null) continue;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            const element = obj.firstElementChild.firstElementChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (element == null) continue;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (!element.classList.contains(\""li\"")) continue;//判断是否是列表
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (element.getAttribute(\""foldTag\"") != null) continue;//判断是否存在标记
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (element.getAttribute(\""foid\"") == 0) continue;//判断是折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            element.setAttribute(\""fold\"", 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            element.setAttribute(\""foldTag\"", true);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }, 7)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var searchPreview = document.querySelector(\""#searchPreview [data-doc-type=\'NodeListItem\'].protyle-wysiwyg.protyle-wysiwyg--attr&gt;div:nth-child(1)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (searchPreview == null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            searchPreview = document.querySelector(\""#searchPreview [data-doc-type=\'NodeList\'].protyle-wysiwyg.protyle-wysiwyg--attr&gt;div:nth-child(1)&gt;div:nth-child(1)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (searchPreview != null &amp;&amp; searchPreview.getAttribute(\""data-type\"") == \""NodeListItem\"" &amp;&amp; searchPreview.getAttribute(\""fold\"") == 1) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (searchPreview.getAttribute(\""foldTag\"") == null) {//判断是否存在标记
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                searchPreview.setAttribute(\""fold\"", 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                searchPreview.setAttribute(\""foldTag\"", true);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var contentLIst = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var item1 = document.querySelectorAll(\"".layout-tab-container&gt;.fn__flex-1.protyle:not(.fn__none) [data-doc-type=\'NodeListItem\'].protyle-wysiwyg.protyle-wysiwyg--attr&gt;div:nth-child(1)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var item2 = document.querySelectorAll(\"".layout-tab-container&gt;.fn__flex-1.protyle:not(.fn__none) [data-doc-type=\'NodeList\'].protyle-wysiwyg.protyle-wysiwyg--attr&gt;div:nth-child(1)&gt;div:nth-child(1)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        contentLIst = [...item1, ...item2];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; contentLIst.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element = contentLIst[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (element != null &amp;&amp; element.getAttribute(\""data-type\"") == \""NodeListItem\"" &amp;&amp; element.getAttribute(\""fold\"") == 1) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (element.getAttribute(\""foldTag\"") != null) continue;//判断是否存在标记
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                element.setAttribute(\""fold\"", 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                element.setAttribute(\""foldTag\"", true);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }, 500)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**----------------------------------列表折叠内容预览查看---------------------------------- */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function collapsedListPreview() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    BodyEventRunFun(\""mouseover\"", collapsedListPreviewEvent, 3000)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function collapsedListPreviewEvent() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var _turn = [...document.querySelectorAll(\"".layout-tab-container&gt;.fn__flex-1.protyle:not(.fn__none) [data-node-id].li[fold=\'1\']\""),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ...document.querySelectorAll(\""[data-oid] [data-node-id].li[fold=\'1\']\""),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ...document.querySelectorAll(\""#searchPreview [data-node-id].li[fold=\'1\']\"")];//查询页面所有的折叠列表
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var turn = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let index = 0; index &lt; _turn.length; index++) {//找到列表第一列表项（父项）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const element = _turn[index].children[1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var item = element.className;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (item == \""p\"" || item == \""h1\"" || item == \""h2\"" || item == \""h3\"" || item == \""h4\"" || item == \""h5\"" || item == \""h6\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            turn.push(element.firstElementChild)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //检查注册事件的折叠列表是否恢复未折叠状态,是清除事件和去除标志属性
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var ListPreview = [...document.querySelectorAll(\"".layout-tab-container&gt;.fn__flex-1.protyle:not(.fn__none) [ListPreview]\""),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ...document.querySelectorAll(\""[data-oid] [ListPreview]\""),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ...document.querySelectorAll(\""#searchPreview [ListPreview]\"")];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let index = 0; index &lt; ListPreview.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const element = ListPreview[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var fold = element.parentElement.getAttribute(\""fold\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (fold == null || fold == 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element.removeAttribute(\""ListPreview\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var item = element.firstElementChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            myRemoveEvent(item, \""mouseenter\"", LIstIn);//解绑鼠标进入
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            myRemoveEvent(item.parentElement.parentElement, \""mouseleave\"", LIstout);//解绑鼠标离开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var items = Array.from(item.parentElement.parentElement.children);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let index = 0; index &lt; items.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                const element = items[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (element.getAttribute(\""triggerBlock\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    element.remove();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let index = 0; index &lt; turn.length; index++) {//重新注册、筛选未注册鼠标事件折叠列表
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const element = turn[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var elementPP = element.parentElement.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (element.parentElement.getAttribute(\""ListPreview\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            myRemoveEvent(element, \""mouseenter\"", LIstIn);//解绑鼠标进入
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            myRemoveEvent(elementPP, \""mouseleave\"", LIstout);//解绑鼠标离开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(element, \""mouseenter\"", LIstIn);//注册鼠标进入
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(elementPP, \""mouseleave\"", LIstout);//注册鼠标离开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element.parentElement.setAttribute(\""ListPreview\"", true);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(element, \""mouseenter\"", LIstIn);//注册鼠标进入
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(elementPP, \""mouseleave\"", LIstout);//注册鼠标离开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">var flag22 = false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function LIstout(e) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    items = Array.from(e.target.children);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    flag22 = false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let index = 0; index &lt; items.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const element = items[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (element.getAttribute(\""triggerBlock\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element.remove();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function LIstIns(e) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var id = setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (!flag22) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            clearInterval(id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var obj = e.target;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var timeDiv = addinsertCreateElement(obj, \""div\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        timeDiv.style.display = \""inline-block\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        timeDiv.style.width = \""0px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        timeDiv.style.height = \""16px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var X = timeDiv.offsetLeft;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var Y = timeDiv.offsetTop;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        timeDiv.remove();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var item = obj.parentElement.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (item == null) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var items = item.children
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var itemobj = items[items.length - 1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (itemobj != null &amp;&amp; itemobj.getAttribute(\""triggerBlock\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var items1 = items[items.length - 1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            items1.style.top = (Y + 35) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            items1.style.left = (obj.offsetLeft + 35) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var items2 = items[items.length - 2];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            items2.style.top = (Y + 2) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            items2.style.left = (X + 45) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }, 500);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function LIstIn(e) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    flag22 = true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var obj = e.target;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var timeDiv = addinsertCreateElement(obj, \""div\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    timeDiv.style.display = \""inline-block\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    timeDiv.style.width = \""0px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    timeDiv.style.height = \""16px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var X = timeDiv.offsetLeft;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var Y = timeDiv.offsetTop;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    timeDiv.remove();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var f = obj.parentElement.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!f) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var items = f.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var itemobj = items[items.length - 1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (itemobj != null &amp;&amp; itemobj.getAttribute(\""triggerBlock\"") != null) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var triggerBlock1 = CreatetriggerBlock(e)//创建触发块1
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //设置触发块样式，将触发块显示在〔 ··· 〕第二行位置
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock1.style.top = (Y + 35) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock1.style.left = (obj.offsetLeft + 35) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(triggerBlock1, \""mouseenter\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //一秒延时后搜索打开的悬浮窗，将悬浮窗中的列表展开,重复检查三次
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        setTimeout(Suspended, 1000)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });//注册鼠标进入
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var triggerBlock2 = CreatetriggerBlock(e)//创建触发块2
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //设置触发块样式，将触发块显示在〔 ··· 〕位置
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock2.style.top = (Y + 2) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock2.style.left = (X + 45) + \""px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(triggerBlock2, \""mouseenter\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //一秒延时后搜索打开的悬浮窗，将悬浮窗中的列表展开,重复检查三次
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        setTimeout(Suspended, 1000)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });//注册鼠标进入
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //一秒延时后搜索打开的悬浮窗，将悬浮窗中的列表展开,重复检查三次
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var previewID = obj.parentElement.parentElement.getAttribute(\""data-node-id\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var jisu = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function Suspended() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        jisu++;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var y = false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (jisu == 3) return
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var Sd = document.querySelectorAll(\""[data-oid]\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (Sd.length &gt;= 1) { //如果找到那么就将悬浮窗中列表展开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let index = 0; index &lt; Sd.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                const element = Sd[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var item = element.children[1].firstElementChild.children[1].firstElementChild.firstElementChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (item == null) continue;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (item.getAttribute(\""data-node-id\"") == previewID) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    item.setAttribute(\""fold\"", 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    y = true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (!y) { setTimeout(Suspended, 800) }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    LIstIns(e);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function CreatetriggerBlock(e) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var objParent = e.target.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var triggerBlock = addinsertCreateElement(objParent.parentElement, \""div\"");//创建触发块
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //设置触发块样式，将触发块显示在〔 ··· 〕位置
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.setAttribute(\""triggerBlock\"", true);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.position = \""absolute\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.width = \""40px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.height = \""15px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //triggerBlock.style.background=\""red\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.display = \""flex\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.zIndex = \""9\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.cursor = \""pointer\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.WebkitUserModify = \""read-only\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.setAttribute(\""contenteditable\"", \""false\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.innerHTML = \""\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //获取折叠列表ID,设置悬浮窗
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //protyle-wysiwyg__embed data-id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var previewID = objParent.parentElement.getAttribute(\""data-node-id\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.setAttribute(\""class\"", \""protyle-attr\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.style.opacity = \""0\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //在触发块内创建思源超链接 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    triggerBlock.innerHTML = \""&lt;span data-type=\'a\' class=\'list-A\' data-href=siyuan://blocks/\"" + previewID + \""&gt;####&lt;/span&gt;\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //将这个思源连接样式隐藏
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var a = triggerBlock.firstElementChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    a.style.fontSize = \""15px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    a.style.lineHeight = \""15px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    a.style.border = \""none\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return triggerBlock;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**----------------鼠标中键标题、列表文本折叠/展开----------------*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function collapseExpand_Head_List() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var flag45 = false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(document.body, \""mouseup\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        flag45 = false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(document.body, \""mousedown\"", (e) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (e.button == 2) { flag45 = true; return }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (flag45 || e.shiftKey || e.altKey || e.button != 1) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var target = e.target;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (target.getAttribute(\""contenteditable\"") == null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            isFatherFather(target, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (v.getAttribute(\""contenteditable\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    target = v;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }, 10);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var targetParentElement = target.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (targetParentElement == null) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //是标题吗？
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (targetParentElement != null &amp;&amp; targetParentElement.getAttribute(\""data-type\"") == \""NodeHeading\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var targetParentElementParentElement = targetParentElement.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //标题父元素是列表吗？
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (targetParentElementParentElement != null &amp;&amp; targetParentElementParentElement.getAttribute(\""data-type\"") == \""NodeListItem\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                e.preventDefault();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                //列表项实现折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                _collapseExpand_NodeListItem(target);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                e.preventDefault();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                //标题块标项实现折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                _collapseExpand_NodeHeading(target);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {//是列表
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var targetParentElementParentElement = targetParentElement.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (targetParentElementParentElement != null &amp;&amp; targetParentElementParentElement.getAttribute(\""data-type\"") == \""NodeListItem\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                e.preventDefault();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                //列表项实现折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                _collapseExpand_NodeListItem(target);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //标题，块标实现折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function _collapseExpand_NodeHeading(element) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var i = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        while (element.className != \""protyle\"" &amp;&amp; element.className != \""fn__flex-1 protyle\"" &amp;&amp; element.className != \""block__edit fn__flex-1 protyle\"" &amp;&amp; element.className != \""fn__flex-1 spread-search__preview protyle\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (i == 999) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            i++;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element = element.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var ddddd = element.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = ddddd.length - 1; index &gt;= 0; index--) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element = ddddd[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (element.className == \""protyle-gutters\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var fold = diguiTooONE_1(element, (v) =&gt; { return v.getAttribute(\""data-type\"") === \""fold\""; })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (fold != null) fold.click();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //列表，列表项实现折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function _collapseExpand_NodeListItem(element) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //在悬浮窗中第一个折叠元素吗？
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var SiyuanFloatingWindow = isSiyuanFloatingWindow(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (SiyuanFloatingWindow) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var vs = isFatherFather(element, (v) =&gt; v.classList.contains(\""li\""), 7);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (vs != null &amp;&amp; (vs.previousElementSibling == null)) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var foid = vs.getAttribute(\""fold\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (foid == null || foid == \""0\"") {//判断是折叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    vs.setAttribute(\""fold\"", \""1\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    vs.setAttribute(\""fold\"", \""0\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var i = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        while (element.getAttribute(\""contenteditable\"") == null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (i == 999) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            i++;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element = element.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var elementParentElement = element.parentElement.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var fold = elementParentElement.getAttribute(\""fold\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (elementParentElement.children.length == 3) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (fold == null || fold == \""0\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            setBlockfold_1(elementParentElement.getAttribute(\""data-node-id\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            setBlockfold_0(elementParentElement.getAttribute(\""data-node-id\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 元素是否在思源悬浮窗中
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 是返回悬浮窗元素，否返回null
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function isSiyuanFloatingWindow(element) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return isFatherFather(element, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (v.getAttribute(\""data-oid\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**----------------------------------查找匹配列表条目前的图标可以鼠标悬停打开悬浮窗--------------------------------------*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function findMatchingListEntries() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    BodyEventRunFun(\""mouseover\"", _findMatchingListEntries, 3000);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function _findMatchingListEntries() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var searchList = document.getElementById(\""searchList\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var globalSearchList = document.getElementById(\""globalSearchList\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (searchList != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var searchLists = searchList.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; searchLists.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element = searchLists[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //var b3_list_item__text=element.children[1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //if(element.getAttribute(\""title\"")!=null)break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //element.setAttribute(\""title\"",b3_list_item__text.innerText);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var itemlianjie = element.firstElementChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (itemlianjie == null || itemlianjie.getAttribute(\""data-defids\"") != null) break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            itemlianjie.setAttribute(\""data-defids\"", \'[\""\""]\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            itemlianjie.setAttribute(\""class\"", \""b3-list-item__graphic popover__block\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            itemlianjie.setAttribute(\""data-id\"", element.getAttribute(\""data-node-id\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (globalSearchList != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var globalSearchLists = globalSearchList.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; globalSearchLists.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element = globalSearchLists[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //var b3_list_item__text=element.children[1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //if(element.getAttribute(\""title\"")!=null)break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //element.setAttribute(\""title\"",b3_list_item__text.innerText);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var itemlianjie = element.firstElementChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (itemlianjie == null || itemlianjie.getAttribute(\""data-defids\"") != null) break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            itemlianjie.setAttribute(\""data-defids\"", \'[\""\""]\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            itemlianjie.setAttribute(\""class\"", \""b3-list-item__graphic popover__block\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            itemlianjie.setAttribute(\""data-id\"", element.getAttribute(\""data-node-id\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**------------------------------------思源悬浮窗头栏中键关闭------------------------------------- */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function theFloatingWindowIsClosed() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(document.body, \""mousedown\"", (e) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (e.button != 1) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var element = e.target;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var className = element.className;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (className == \""block__icons block__icons--border\"" || className == \""fn__space fn__flex-1\"" || className == \""maxMinButton\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element = element.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        diguiTooONE_1(element, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (v.getAttribute(\""data-type\"") == \""close\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                v.click();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**----------------------思源悬浮窗检测到单个段落块，单个列表项，面包屑前一级展示/反链计数悬浮窗反链引用高亮标记----------------------- */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/*请无视糟糕中文代码 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function SuspendedWindowNoSection() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //获取所有悬浮窗内容类型,排除一个以元素和非段落块,查找面包屑模拟点击倒数第二级展开内容
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        document.querySelectorAll(\""[data-oid]:not([zhankai])\"").forEach((da) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (da.querySelector(\"".fn__loading\"")) return; //有内容没加载
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var protyles;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            try {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                protyles = da.children[1].children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (protyles == null) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } catch (error) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let index = 0; index &lt; protyles.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                const element = protyles[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                /***********************************************排除失效引用但还站一个悬浮窗格的情况 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (element.querySelector(\""[data-doc-type]\"" &amp;&amp; element.firstElementChild != null) == null) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (da.getAttribute(\""zhankai\"") != null) return;//已经处理过的悬浮窗
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            da.setAttribute(\""zhankai\"", true);//标记已经处理，防止下次循环多次处理
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Array.from(da.children[1].children).forEach((g) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var v = g.querySelector(\""[data-doc-type]\"");//查询基力悬浮窗内容类型元素
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (v.children.length != 1 &amp;&amp; v.getAttribute(\""data-doc-type\"") != \""NodeHeading\"") return;//剔除data-doc-type存在多个子元素的悬浮窗
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var 悬浮窗类型 = \""引用悬浮窗\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var 反链引用ID;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var defmark = v.querySelector(\"".def--mark\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (defmark) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    悬浮窗类型 = \""反链悬浮窗\"";//判断悬浮窗类型
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    反链引用ID = defmark.getAttribute(\""data-id\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                //console.log(悬浮窗类型, 反链引用ID);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var 悬浮窗出现的单独块是什么块;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                //悬浮窗出现的单独块是什么块？
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                switch (v.firstElementChild.className) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    case \""render-node\""://嵌入块
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        悬浮窗出现的单独块是什么块 = \""嵌入块\""; break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    case \""p\""://段落块
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        悬浮窗出现的单独块是什么块 = \""段落块\""; break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    case \""li\""://单独列表项块//列表只要有三个子元素就是单独列表项块
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        if (v.firstElementChild.children.length == 3) 悬浮窗出现的单独块是什么块 = \""列表块\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        else 悬浮窗出现的单独块是什么块 = \""\""; break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    case \""sb\""://单独超级快
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        悬浮窗出现的单独块是什么块 = \""超级块\""; break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        悬浮窗出现的单独块是什么块 = \""\""; break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var 引用ID;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var 拟点击面包屑模元素;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var 时间累加器 = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var iD = setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    时间累加器 += 100;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    if (时间累加器 &gt; 3000) clearInterval(iD);//超时
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    try {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        if (悬浮窗出现的单独块是什么块 != \""超级块\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            引用ID = v.parentElement.previousElementSibling.firstElementChild.lastElementChild.getAttribute(\""data-node-id\"");//记录原块id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        } else {//思源超级块不显示面包屑上因此需要单独处理
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            引用ID = v.firstElementChild.getAttribute(\""data-node-id\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        拟点击面包屑模元素 = v.parentElement.previousElementSibling.firstElementChild.lastElementChild.previousElementSibling.previousElementSibling.children[1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        clearInterval(iD);//上段代码没报错就证明元素获取成功了,关闭定时器
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        if (悬浮窗出现的单独块是什么块 != \""\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            悬浮窗面包屑跳转();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            不需要模拟点击的反链展示();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    } catch (error) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        console.log(\""面包屑模拟点击元素获取错误\"", v.parentElement.previousElementSibling.firstElementChild.lastElementChild);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }, 100);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                function 悬浮窗面包屑跳转() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    拟点击面包屑模元素.click();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    const observer = new MutationObserver(() =&gt; {//创建监视
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        observer.disconnect();//关闭监视
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            switch (悬浮窗类型) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                case \""反链悬浮窗\"":
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    switch (悬浮窗出现的单独块是什么块) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        case \""嵌入块\"":
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            var ts = v.parentElement.querySelectorAll(`[data-content=\""select * from blocks where id=\'${反链引用ID}\'\""]`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            for (let index = 0; index &lt; ts.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                const element = ts[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                element.classList.add(\""blockhighlighting\"")///块高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                if (index == 0) 高亮内容跳转到悬浮窗中间(element, v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            var ts = v.parentElement.querySelectorAll(`[data-id=\'${反链引用ID}\'][data-subtype]`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            for (let index = 0; index &lt; ts.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                const element = ts[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                element.classList.add(\""blockRefhighlighting\"")//引用高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                isFatherFather(element, (f) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                    if (f.getAttribute(\""contenteditable\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                        f.classList.add(\""blockhighlighting\"")//块高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                        if (index == 0) 高亮内容跳转到悬浮窗中间(element, v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                        return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                    if (f.tagName == \""TD\"" || f.tagName == \""TR\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                        f.classList.add(\""blockhighlighting\"")//块高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                        if (index == 0) 高亮内容跳转到悬浮窗中间(element, v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                        return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                    return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                                }, 4)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                case \""引用悬浮窗\"":
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    switch (悬浮窗出现的单独块是什么块) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        case \""嵌入块\"":
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            var ts = v.parentElement.querySelector(`[data-node-id=\'${引用ID}\'][data-type=\""NodeBlockQueryEmbed\""]`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            ts.classList.add(\""blockhighlighting\"")//引用高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            高亮内容跳转到悬浮窗中间(ts, v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            var ts = v.parentElement.querySelector(`[data-node-id=\'${引用ID}\']`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            ts.classList.add(\""blockhighlighting\"")//引用高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            高亮内容跳转到悬浮窗中间(ts, v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }, 500)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    observer.observe(v, { attributes: false, childList: true, subtree: false });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                function 不需要模拟点击的反链展示() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    switch (悬浮窗类型) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        case \""反链悬浮窗\"":
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            var protyle_content = v.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            var ts = protyle_content.querySelectorAll(`[data-id=\'${反链引用ID}\']`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            for (let index = 0; index &lt; ts.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                const element = ts[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                element.classList.add(\""blockRefhighlighting\"")//引用高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                isFatherFather(element, (f) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    if (f.getAttribute(\""contenteditable\"") != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        f.classList.add(\""blockhighlighting\"")//块高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        if (index == 0) 高亮内容跳转到悬浮窗中间(element, v)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    if (f.tagName == \""TD\"" || f.tagName == \""TR\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        f.classList.add(\""blockhighlighting\"")//块高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        if (index == 0) 高亮内容跳转到悬浮窗中间(element, v)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                        return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                    return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                }, 4)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        case \""引用悬浮窗\"":
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            var protyle_content = v.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            var ts = protyle_content.querySelector(`[data-node-id=\'${引用ID}\']`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            //ts.scrollIntoView(true);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            // ts.classList.add(\""blockRefhighlighting\"")//引用高亮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                function 高亮内容跳转到悬浮窗中间(element, v) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        element.scrollIntoView(false);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            var tim = v.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            //console.log(tim, tim.scrollTop);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (tim.scrollTop != 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                tim.scrollBy(0, tim.offsetHeight / 2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }, 100);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        isFatherFather(v, (g) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (g.getAttribute(\""class\"") == \""block__content\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                g.scrollTo(0, 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                return true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }, 5)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }, 100);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }, 1000);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/* 操作 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获得所选择的块对应的块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns {string} 块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns {
</span></span><span class=""highlight-line""><span class=""highlight-cl""> *     id: string, // 块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> *     type: string, // 块类型
</span></span><span class=""highlight-line""><span class=""highlight-cl""> *     subtype: string, // 块子类型(若没有则为 null)
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * }
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns {null} 没有找到块 ID */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getBlockSelected() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let node_list = document.querySelectorAll(\'.protyle-wysiwyg--select\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (node_list.length === 1 &amp;&amp; node_list[0].dataset.nodeId != null) return {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: node_list[0].dataset.nodeId,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        type: node_list[0].dataset.type,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        subtype: node_list[0].dataset.subtype,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function ClickMonitor() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    window.addEventListener(\'mouseup\', MenuShow)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function MenuShow() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let selectinfo = getBlockSelected()
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (selectinfo) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            let selecttype = selectinfo.type
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            let selectid = selectinfo.id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (selecttype == \""NodeList\"" || selecttype == \""NodeTable\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                setTimeout(() =&gt; InsertMenuItem(selectid, selecttype), 0)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }, 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function InsertMenuItem(selectid, selecttype) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let commonMenu = document.querySelector(\""commonMenu\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let readonly = commonMenu.querySelector(\"".b3-menu__item--readonly\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let selectview = commonMenu.querySelector(\'[id=\""viewselect\""]\')
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (readonly) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (!selectview) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            commonMenu.insertBefore(ViewSelect(selectid, selecttype), readonly)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            commonMenu.insertBefore(MenuSeparator(), readonly)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function ViewMonitor(event) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let id = event.currentTarget.getAttribute(\""data-node-id\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let attrName = \'custom-\' + event.currentTarget.getAttribute(\""custom-attr-name\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let attrValue = event.currentTarget.getAttribute(\""custom-attr-value\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let blocks = document.querySelectorAll(`.protyle-wysiwyg [data-node-id=\""${id}\""]`)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (blocks) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        blocks.forEach(block =&gt; block.setAttribute(attrName, attrValue))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let attrs = {}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    attrs[attrName] = attrValue
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    设置思源块属性(id, attrs)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">//+++++++++++++++++++++++++++++++++思源API++++++++++++++++++++++++++++++++++++
</span></span><span class=""highlight-line""><span class=""highlight-cl"">//思源官方API文档  https://github.com/siyuan-note/siyuan/blob/master/API_zh_CN.md
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function queryAPI(sqlstmt, then, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await 向思源请求数据(\""/api/query/sql\"", {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        stmt: sqlstmt
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; then(v.data, obj))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} 内容块id 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} 回调函数 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} 传递对象 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 根据ID获取人类可读路径(内容块id, then, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await 向思源请求数据(\'/api/filetree/getHPathByID\', {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: 内容块id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; then(v.data, obj))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 以id获取文档聚焦内容(id, then, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await 向思源请求数据(\'/api/filetree/getDoc\', {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: id,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        k: \""\"",
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        mode: 0,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        size: 36,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; then(v.data, obj))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 更新块(id, dataType, data, then = null, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await 向思源请求数据(\'/api/block/updateBlock\', {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: id,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        dataType: dataType,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        data: data,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (then) then(v.data, obj);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 设置思源块属性(内容块id, 属性对象) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let url = \'/api/attr/setBlockAttrs\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return 解析响应体(向思源请求数据(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: 内容块id,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        attrs: 属性对象,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 获取块属性(内容块id, then = null, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let url = \'/api/attr/getBlockAttrs\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return 向思源请求数据(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: 内容块id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (then) then(v.data, obj);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 向思源请求数据(url, data) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    const response = await fetch(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        body: JSON.stringify(data),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        method: \'POST\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        headers: {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Authorization: `Token \'\'`,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (response.status === 200)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return await response.json();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    else return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 解析响应体(response) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let r = await response
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return r.code === 0 ? r.data : null
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 获取文件(path, then = null, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let url = \'/api/file/getFile\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await 向思源请求数据(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        path: path
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (then) then(v, obj);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} notebookID 笔记本id
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} dataPath 父文档路径
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} sortType 文档排序类型
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} then 回调函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} obj 传递对象
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 获取子文档数据(notebookID, dataPath, sortType, then = null, obj = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let url = \""/api/filetree/listDocsByPath\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await 向思源请求数据(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        notebook: notebookID,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        path: dataPath,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        sort: sortType,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (then) then(v.data.files, obj);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 写入文件(path, filedata, then = null, obj = null, isDir = false, modTime = Date.now()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let blob = new Blob([filedata]);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let file = new File([blob], path.split(\'/\').pop());
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let formdata = new FormData();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""path\"", path);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""file\"", file);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""isDir\"", isDir);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""modTime\"", modTime);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await fetch(
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""/api/file/putFile\"", {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        body: formdata,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        method: \""POST\"",
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        headers: {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Authorization: `Token \""\""`,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        },
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        console.log(v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (then) then(obj);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }, 200)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function 写入文件2(path, filedata, then = null, obj = null, isDir = false, modTime = Date.now()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let blob = new Blob([filedata]);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let file = new File([blob], path.split(\'/\').pop());
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let formdata = new FormData();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""path\"", path);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""file\"", file);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""isDir\"", isDir);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    formdata.append(\""modTime\"", modTime);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    const response = await fetch(
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""/api/file/putFile\"", {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        body: formdata,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        method: \""POST\"",
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        headers: {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Authorization: `Token \""\""`,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        },
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (response.status === 200) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (then) then(obj);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">//+++++++++++++++++++++++++++++++++辅助API++++++++++++++++++++++++++++++++++++
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 方便为主题功能添加开关按钮，并选择是否拥有记忆状态
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} ButtonID 按钮ID。
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} ButtonTitle 按钮作用提示文字。
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} ButtonFunctionType 按钮功能类型。:EnumButtonFunctionType 枚举
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} ButtonCharacteristicType 按钮特性类型。:EnumButtonCharacteristicType 枚举
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} NoButtonSvg 按钮激活Svg图标路径
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} OffButtonSvg 按钮未激活Svg图标路径
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} OnClickRunFun 按钮开启执行函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} OffClickRunFun 按钮关闭执行函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} Memory 是否设置记忆状态 true为是留空或false为不设置记忆状态。
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function HBuiderXThemeToolbarAddButton(ButtonID, ButtonFunctionType, ButtonCharacteristicType, ButtonTitle, ONButtonSvgURL, OffButtonSvgURL, OnClickRunFun, OffClickRunFun, Memory = false) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //确认主题功能区toolbar是否存在，不存在就创建
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var HBuiderXToolbar = document.getElementById(\""HBuiderXToolbar\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (HBuiderXToolbar == null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (isPc()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar = document.createElement(\""div\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.id = \""HBuiderXToolbar\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.marginRight = \""3px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.marginTop = \""6px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            document.getElementById(\""windowControls\"").parentElement.insertBefore(HBuiderXToolbar, document.getElementById(\""windowControls\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.width = \""35px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.overflow = \""hidden\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(HBuiderXToolbar, \""mouseover\"", () =&gt; { HBuiderXToolbar.style.width = \""auto\"" })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(HBuiderXToolbar, \""mouseout\"", () =&gt; { HBuiderXToolbar.style.width = \""35px\"" })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else if (isBrowser()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar = insertCreateAfter(document.getElementById(\""barMode\""), \""div\"", \""HBuiderXToolbar\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.marginRight = \""3px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.marginTop = \""4px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.width = \""35px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.overflow = \""hidden\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(HBuiderXToolbar, \""mouseover\"", () =&gt; { HBuiderXToolbar.style.width = \""auto\"" })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(HBuiderXToolbar, \""mouseout\"", () =&gt; { HBuiderXToolbar.style.width = \""35px\"" })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        else if (isPcWindow()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar = insertCreateBefore(document.getElementById(\""minWindow\""), \""div\"", \""HBuiderXToolbar\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.position = \""absolute\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.height = \""25px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.paddingTop = \""2px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.overflowY = \""scroll\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.right = \""77px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.width = \""35px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.overflow = \""hidden\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(HBuiderXToolbar, \""mouseover\"", () =&gt; { HBuiderXToolbar.style.width = \""auto\"" })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            AddEvent(HBuiderXToolbar, \""mouseout\"", () =&gt; { HBuiderXToolbar.style.width = \""35px\"" })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else if (isPhone()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar = insertCreateBefore(document.getElementById(\""toolbarEdit\""), \""div\"", \""HBuiderXToolbar\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.position = \""relative\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.height = \""25px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.overflowY = \""scroll\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.paddingTop = \""7px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            HBuiderXToolbar.style.marginRight = \""9px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var addButton = addinsertCreateElement(HBuiderXToolbar, \""div\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.width = \""17px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.height = \""100%\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.float = \""left\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.marginLeft = \""10px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.backgroundImage = \""url(\"" + OffButtonSvgURL + \"")\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.backgroundRepeat = \""no-repeat\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.backgroundPosition = \""left top\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.backgroundSize = \""100%\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.style.cursor = \""pointer\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.setAttribute(\""title\"", ButtonTitle);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    addButton.id = ButtonID;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var offon = \""0\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var isclick = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var broadcastData_off = { \""Value\"": \""ButtonControl\"", \""ControlButtonIDs\"": [{ \""ButtonID\"": ButtonID, \""ControlFun\"": \""ControlFun_off\"" }] };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var broadcastData_on = { \""Value\"": \""ButtonControl\"", \""ControlButtonIDs\"": [{ \""ButtonID\"": ButtonID, \""ControlFun\"": \""ControlFun_on\"" }] };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (Memory) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        GetItem(ButtonID, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            offon = v;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (offon == \""1\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                _on();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } else if (offon == null || offon == undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                offon = \""0\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(addButton, \""click\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.HBuilderXLight.ButtonControl[ButtonID].Isclick = isclick = 1;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (offon == \""0\"" || offon == null || offon == undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            broadcast(broadcastData_on);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (offon == \""1\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            broadcast(broadcastData_off);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(addButton, \""mouseover\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (offon == \""0\"" || offon == null || offon == undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            addButton.style.filter = \""drop-shadow(rgb(0, 0, 0) 0px 0)\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(addButton, \""mouseout\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (offon == \""0\"" || offon == null || offon == undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            addButton.style.filter = \""none\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function buttonCharacteristicDispose() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        switch (ButtonCharacteristicType) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            case 2:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (ButtonFunctionType == 2) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    var topicfilterButtons = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    var ButtonControl = window.HBuilderXLight.ButtonControl;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    for (var t in ButtonControl) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        if (t != ButtonID &amp;&amp; ButtonControl[t].ButtonFunctionType == 2 &amp;&amp; ButtonControl[t].OffOn == \""1\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            //console.log(t, ButtonControl[t].OffOn);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            ButtonControl[t].Isclick = 1;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            topicfilterButtons.push(ButtonControl[t]);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    if (topicfilterButtons.length == 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        window.HBuilderXLight.ButtonControl[ButtonID].Isclick = isclick = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    //console.log(ButtonControl[ButtonID].Isclick);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    if (window.HBuilderXLight.ButtonControl[ButtonID].Isclick == 1) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        var index = (topicfilterButtons.length) - 1;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        var id = setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            if (index &gt;= 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                //console.log(window.HBuilderXLight.ButtonControl[ButtonID].Isclick);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                const element = topicfilterButtons[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                element[\""ControlFun_off\""]();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                // console.log(window.HBuilderXLight.ButtonControl[ButtonID].Isclick);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                clearInterval(id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                                window.HBuilderXLight.ButtonControl[ButtonID].Isclick = isclick = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            index--;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }, 300)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        for (let index = 0; index &lt; topicfilterButtons.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            const element = topicfilterButtons[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            element[\""ControlFun_off\""]();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            default:
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function _off() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        addButton.style.backgroundImage = \""url(\"" + OffButtonSvgURL + \"")\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        addButton.style.filter = \""none\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.HBuilderXLight.ButtonControl[ButtonID].OffOn = offon = \""0\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //console.log(window.HBuilderXLight.ButtonControl[ButtonID].Isclick);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (Memory &amp;&amp; window.HBuilderXLight.ButtonControl[ButtonID].Isclick == 1) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //console.log(\""bbbbbbbbbbbb\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            SetItem(ButtonID, \""0\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                OffClickRunFun(addButton);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                window.HBuilderXLight.ButtonControl[ButtonID].Isclick = isclick = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //console.log(\""aaaaaaaaaaa\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            OffClickRunFun(addButton);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            window.HBuilderXLight.ButtonControl[ButtonID].Isclick = isclick = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function _on() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        addButton.style.backgroundImage = \""url(\"" + ONButtonSvgURL + \"")\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        addButton.style.filter = \""drop-shadow(rgb(0, 0, 0) 0px 0)\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.HBuilderXLight.ButtonControl[ButtonID].OffOn = offon = \""1\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //console.log(window.HBuilderXLight.ButtonControl[ButtonID].Isclick);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (Memory &amp;&amp; window.HBuilderXLight.ButtonControl[ButtonID].Isclick == 1) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            SetItem(ButtonID, \""1\"", () =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                OnClickRunFun(addButton);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                buttonCharacteristicDispose();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            OnClickRunFun(addButton);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            buttonCharacteristicDispose();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    window.HBuilderXLight.ButtonControl[ButtonID] = {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""ControlFun_off\"": _off,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""ControlFun_on\"": _on,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""OffOn\"": offon,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""Isclick\"": isclick,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""ButtonFunctionType\"": ButtonFunctionType,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        \""ButtonCharacteristicType\"": ButtonCharacteristicType
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function setItem(key, value) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    window.HBuilderXLight.config[key] = value;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getItem(key) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return window.HBuilderXLight.config[key] === undefined ? null : window.HBuilderXLight.config[key];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function removeItem(key) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    delete window.HBuilderXLight.config[key];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function SetItem(key, value, fun = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    获取文件(\""/data/widgets/HBuilderX-Light.config.json\"", (config) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (config) {//不存在配置文件就要创建
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            config[key] = value;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //console.log(config);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            写入文件2(\""/data/widgets/HBuilderX-Light.config.json\"", JSON.stringify(config, undefined, 4), fun);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            写入文件2(\""/data/widgets/HBuilderX-Light.config.json\"", JSON.stringify({ \""HBuilderXLight\"": 1, key: value }, undefined, 4), fun);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function GetItem(key, then = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    获取文件(\""/data/widgets/HBuilderX-Light.config.json\"", (config) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (config) {//不存在配置文件就要创建
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            // console.log(config[key]);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            try {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (then) then(config[key]);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } catch (error) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (then) then(null);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            写入文件2(\""/data/widgets/HBuilderX-Light.config.json\"", JSON.stringify({ \""HBuilderXLight\"": 1 }, undefined, 4), then(null));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function RemoveItem(key, fun = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    获取文件(\""/data/widgets/HBuilderX-Light.config.json\"", (config) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (config) {//不存在配置文件就要创建
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            delete config[key];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            //console.log(config);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            写入文件2(\""/data/widgets/HBuilderX-Light.config.json\"", JSON.stringify(config, undefined, 4), fun);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            写入文件2(\""/data/widgets/HBuilderX-Light.config.json\"", JSON.stringify({ \""HBuilderXLight\"": 1 }, undefined, 4), fun);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 在DIV光标位置插入内容
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} content 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function insertContent(content) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (content) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var sel = window.getSelection();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (sel.rangeCount &gt; 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var range = sel.getRangeAt(0); //获取选择范围
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            range.deleteContents(); //删除选中的内容
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var el = document.createElement(\""div\""); //创建一个空的div外壳
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            el.innerHTML = content; //设置div内容为我们想要插入的内容。
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var frag = document.createDocumentFragment(); //创建一个空白的文档片段，便于之后插入dom树
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var node = el.firstChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var lastNode = frag.appendChild(node);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            range.insertNode(frag); //设置选择范围的内容为插入的内容
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var contentRange = range.cloneRange(); //克隆选区
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            contentRange.setStartAfter(lastNode); //设置光标位置为插入内容的末尾
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            contentRange.collapse(true); //移动光标位置到末尾
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            sel.removeAllRanges(); //移出所有选区
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            sel.addRange(contentRange); //添加修改后的选区
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获取DIV文本光标位置
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getPosition(element) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var caretOffset = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var doc = element.ownerDocument || element.document;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var win = doc.defaultView || doc.parentWindow;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var sel;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (typeof win.getSelection != \""undefined\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //谷歌、火狐
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        sel = win.getSelection();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (sel.rangeCount &gt; 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var range = sel.getRangeAt(0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var preCaretRange = range.cloneRange(); //克隆一个选区
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            preCaretRange.selectNodeContents(element); //设置选区的节点内容为当前节点
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            preCaretRange.setEnd(range.endContainer, range.endOffset); //重置选中区域的结束位置
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            caretOffset = preCaretRange.toString().length;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else if ((sel = doc.selection) &amp;&amp; sel.type != \""Control\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //IE
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var textRange = sel.createRange();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var preCaretTextRange = doc.body.createTextRange();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        preCaretTextRange.moveToElementText(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        preCaretTextRange.setEndPoint(\""EndToEnd\"", textRange);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        caretOffset = preCaretTextRange.text.length;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return caretOffset;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 在指定DIV索引位置设置光标
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} index 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function setCursor(element, index) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var codeEl = element.firstChild;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var selection = window.getSelection();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    // 创建新的光标对象
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let range = selection.getRangeAt(0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    // 光标对象的范围界定为新建的代码节点
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    range.selectNodeContents(codeEl)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    // 光标位置定位在代码节点的最大长度
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    // console.log(codeEl.length);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    range.setStart(codeEl, index);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    // 使光标开始和光标结束重叠
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    range.collapse(true)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    selection.removeAllRanges()
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    selection.addRange(range)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获得文本的占用的宽度
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} text 字符串文班
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} font 文本字体的样式
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getTextWidth(text, font) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement(\""canvas\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var context = canvas.getContext(\""2d\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    context.font = font;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var metrics = context.measureText(text);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return metrics.width;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 触发元素的事件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {触发元素事件} type 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} detail 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function trigger(type, element) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var customEvent = new Event(type, { bubbles: false, cancelable: true });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    element.dispatchEvent(customEvent);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 向body注入新style覆盖原本的css
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {css文本字符串} csstxt 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function injectionCss(csstxt) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var styleElement = document.createElement(\'style\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    styleElement.innerText = t;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    document.body.appendChild(styleElement);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 向指定父级创建追加一个子元素，并可选添加ID,
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {Element} fatherElement 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {string} addElementTxt 要创建添加的元素标签
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {string} setId 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns addElementObject
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function addinsertCreateElement(fatherElement, addElementTxt, setId = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!fatherElement) console.error(\""指定元素对象不存在！\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!addElementTxt) console.error(\""未指定字符串！\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var element = document.createElement(addElementTxt);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (setId) element.id = setId;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    fatherElement.appendChild(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return element;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 向指定元素后创建插入一个元素，可选添加ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} targetElement 目标元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} addElementTxt 要创建添加的元素标签
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} setId 为创建元素设置ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function insertCreateAfter(targetElement, addElementTxt, setId = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!targetElement) console.error(\""指定元素对象不存在！\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!addElementTxt) console.error(\""未指定字符串！\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var element = document.createElement(addElementTxt);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (setId) element.id = setId;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var parent = targetElement.parentNode;//得到父节点
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (parent.lastChild === targetElement) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //如果最后一个子节点是当前元素那么直接添加即可
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        parent.appendChild(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return element;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        parent.insertBefore(element, targetElement.nextSibling);//否则，当前节点的下一个节点之前添加
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return element;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 向指定元素前创建插入一个元素，可选添加ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} targetElement 目标元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} addElementTxt 要创建添加的元素标签
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} setId 为创建元素设置ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function insertCreateBefore(targetElement, addElementTxt, setId = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!targetElement) console.error(\""指定元素对象不存在！\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!addElementTxt) console.error(\""未指定字符串！\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var element = document.createElement(addElementTxt);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (setId) element.id = setId;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    targetElement.parentElement.insertBefore(element, targetElement);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return element;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 为元素注册监听事件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {Element} element 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {string} strType 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {Fun} fun 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function AddEvent(element, strType, fun) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //判断浏览器有没有addEventListener方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (element.addEventListener) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element.addEventListener(strType, fun, false);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //判断浏览器有没 有attachEvent IE8的方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else if (element.attachEvent) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element.attachEvent(\""on\"" + strType, fun);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //如果都没有则使用 元素.事件属性这个基本方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element[\""on\"" + strType] = fun;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 为元素解绑监听事件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {Element}  element ---注册事件元素对象
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {String}   strType ---注册事件名(不加on 如\""click\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {Function} fun	 ---回调函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function myRemoveEvent(element, strType, fun) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    //判断浏览器有没有addEventListener方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (element.addEventListener) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        // addEventListener方法专用删除方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element.removeEventListener(strType, fun, false);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //判断浏览器有没有attachEvent IE8的方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else if (element.attachEvent) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        // attachEvent方法专用删除事件方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element.detachEvent(\""on\"" + strType, fun);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //如果都没有则使用 元素.事件属性这个基本方法
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //删除事件用null
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element[\""on\"" + strType] = null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* 加载脚本文件
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {string} url 脚本地址
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {string} type 脚本类型
</span></span><span class=""highlight-line""><span class=""highlight-cl"">*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function loadScript(url, type = \'module\') {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let script = document.createElement(\'script\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (type) script.setAttribute(\'type\', type);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    script.setAttribute(\'src\', url);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    document.head.appendChild(script);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 得到思源toolbar
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getSiYuanToolbar() { return document.getElementById(\""toolbar\""); }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 得到HBuiderXToolbar
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getHBuiderXToolbar() { return document.getElementById(\""HBuiderXToolbar\""); }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**简单判断目前思源是否是手机模式 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function isPhone() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return document.getElementById(\""toolbarEdit\"") != null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**简单判断目前思源是否是pc窗口模式 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function isPcWindow() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return document.body.classList.contains(\""body--window\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**简单判断目前思源是pc模式 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function isPc() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return document.getElementById(\""windowControls\"") != null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 加载样式文件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {string} url 样式地址
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {string} id 样式 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function loadStyle(url, id, cssName) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var headElement = document.head;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let style = document.getElementById(id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (id != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (style) headElement.removeChild(style);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style = document.createElement(\'link\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (id != null) style.id = id;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style.setAttribute(\'type\', \'text/css\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style.setAttribute(\'rel\', \'stylesheet\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style.setAttribute(\'href\', url);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (cssName != null) style.setAttribute(\""class\"", cssName);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    headElement.appendChild(style);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return style;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 取出两个数组的不同元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} arr1 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} arr2 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getArrDifference(arr1, arr2) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return arr1.concat(arr2).filter(function (v, i, arr) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return arr.indexOf(v) === arr.lastIndexOf(v);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 取出两个数组的相同元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} arr1 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} arr2 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getArrEqual(arr1, arr2) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let newArr = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let i = 0; i &lt; arr2.length; i++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let j = 0; j &lt; arr1.length; j++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (arr1[j] === arr2[i]) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                newArr.push(arr1[j]);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return newArr;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 思源吭叽元素属性解析看是否包含那种行级元素类型
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {} attributes 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} attribute 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function attributesContains(attributes, attribute) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (attribute == true) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (attributes == null) return false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var arr = attributes.split(\"" \"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (arr.length != 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        arr.forEach((v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (v == attribute) attribute = true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return attribute == true ? true : false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return attributes == attribute;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 间隔执行指定次数的函数(不立即执行)
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} time 间隔时间s
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} frequency 执行次数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} Fun 执行函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function IntervalFunTimes(time, frequency, Fun) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let i = 0; i &lt; frequency; i++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        sleep(time * i).then(v =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Fun();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function sleep(time2) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return new Promise((resolve, reject) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                resolve()
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }, time2)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获得当前浏览器缩放系数 默认值为1
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function detectZoom() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var ratio = 0, screen = window.screen, ua = navigator.userAgent.toLowerCase();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (window.devicePixelRatio !== undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        ratio = window.devicePixelRatio;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else if (~ua.indexOf(\'msie\')) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (screen.deviceXDPI &amp;&amp; screen.logicalXDPI) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            ratio = screen.deviceXDPI / screen.logicalXDPI;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else if (window.outerWidth !== undefined &amp;&amp; window.innerWidth !== undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        ratio = window.outerWidth / window.innerWidth;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (ratio) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        ratio = Math.round(ratio * 100);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return ratio * 0.01;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 递归DOM元素查找深度子级的一批符合条件的元素返回数组
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 要查找DOM元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} judgeFun 查找函数 : fun(v) return true or false
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns array
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function diguiTooALL(element, judgeFun) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var target = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (element == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (judgeFun == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    digui(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return target;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function digui(elem) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var child = elem.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (child.length == 0) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; child.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element2 = child[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (judgeFun(element2)) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                target.push(element2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                digui(element2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                digui(element2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* 递归DOM元素查找深度子级的第一个符合条件的元素 - 子级的子级深度搜索赶紧后在搜索下一个子级
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {*} element 要查找DOM元素
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {*} judgeFun 查找函数: fun(v) return true or false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @returns element
</span></span><span class=""highlight-line""><span class=""highlight-cl"">*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function diguiTooONE_1(element, judgeFun, xianz = 999) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (element == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (judgeFun == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var i = xianz &lt;= 0 ? 10 : xianz;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return digui(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function digui(elem) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (i &lt;= 0) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        i--;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var child = elem.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (child.length == 0) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; child.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element2 = child[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (judgeFun(element2)) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return element2;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                var item = digui(element2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (item == null) continue;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return item;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* 递归DOM元素查找深度子级的第一个符合条件的元素-同层全部筛选一遍在依次深度搜索。
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {*} element 要查找DOM元素
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {*} judgeFun 查找函数 : fun(v) return true or false
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @param {*} xianz 限制递归最大次数
</span></span><span class=""highlight-line""><span class=""highlight-cl"">* @returns element
</span></span><span class=""highlight-line""><span class=""highlight-cl"">*/
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function diguiTooONE_2(element, judgeFun, xianz = 999) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (element == null || element.firstElementChild == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (judgeFun == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var i = xianz &lt;= 0 ? 10 : xianz;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return digui(element);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function digui(elem) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (i &lt;= 0) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        i--;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var child = elem.children;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var newchild = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; child.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element2 = child[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (judgeFun(element2)) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return element2;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (newchild.firstElementChild != null) newchild.push(element2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        for (let index = 0; index &lt; newchild.length; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            const element2 = newchild[index];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var item = digui(element2);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (item == null) continue;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return item;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 不断查找元素父级的父级知道这个父级符合条件函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 起始元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} judgeFun 条件函数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} upTimes 限制向上查找父级次数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 返回符合条件的父级，或null
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function isFatherFather(element, judgeFun, upTimes) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var i = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (; ;) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (!element) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (upTimes &lt; 1 || i &gt;= upTimes) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (judgeFun(element)) return element;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        element = element.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        i++;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获得焦点所在的块
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @return {HTMLElement} 光标所在块
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @return {null} 光标不在块内
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getFocusedBlock() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let block = window.getSelection()
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        &amp;&amp; window.getSelection().focusNode
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        &amp;&amp; window.getSelection().focusNode.parentElement; // 当前光标
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    while (block != null &amp;&amp; block.dataset.nodeId == null) block = block.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return block;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获得指定块位于的编辑区
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @params {HTMLElement} 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @return {HTMLElement} 光标所在块位于的编辑区
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @return {null} 光标不在块内
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getTargetEditor(block) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    while (block != null &amp;&amp; !block.classList.contains(\'protyle-content\')) block = block.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return block;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 清除选中文本
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function clearSelections() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (window.getSelection) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var selection = window.getSelection();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        selection.removeAllRanges();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    } else if (document.selection &amp;&amp; document.selection.empty) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        document.selection.empty();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * body全局事件频率优化执行
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} eventStr 那种事件如 \""mouseover\""
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} fun(e) 执行函数,e：事件对象
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} accurate 精确度：每隔多少毫秒检测一次触发事件执行
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} delay 检测到事件触发后延时执行的ms
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} frequency 执行后再延时重复执行几次
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} frequencydelay 执行后再延时重复执行之间的延时时间ms
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function BodyEventRunFun(eventStr, fun, accurate = 100, delay = 0, frequency = 1, frequencydelay = 16) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var isMove = true;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var _e = null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(document.body, eventStr, (e) =&gt; { isMove = true; _e = e })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (!isMove) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        isMove = false;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            fun(_e);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (frequency == 1) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (frequencydelay &lt; 16) frequencydelay = 16;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var _frequencydelay = frequencydelay;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let index = 0; index &lt; frequency; index++) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                setTimeout(() =&gt; { fun(_e); }, frequencydelay);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                frequencydelay += _frequencydelay;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }, delay);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }, accurate);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 为元素添加思源悬浮打开指定ID块内容悬浮窗事件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 绑定的元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} id 悬浮窗内打开的块的ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function suspensionToOpenSiyuanSuspensionWindow(element, id) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    element.setAttribute(\""data-defids\"", \'[\""\""]\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    element.classList.add(\""popover__block\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    element.setAttribute(\""data-id\"", id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 为元素添加思源点击打开指定ID块内容悬浮窗事件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} element 绑定的元素
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} id 悬浮窗内打开的块的ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function clickToOpenSiyuanFloatingWindow(element, id) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    element.classList.add(\""protyle-wysiwyg__embed\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    element.setAttribute(\""data-id\"", id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 控制台打印输出
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} obj 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function c(...data) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    console.log(data);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 安全While循环
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * frequency:限制循环次数
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 返回值不等于null终止循环
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function WhileSafety(fun, frequency = 99999) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var i = 0;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (frequency &lt;= 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        console.log(\""安全循环次数小于等于0\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    while (i &lt; frequency) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var _return = fun();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (_return != null || _return != undefined) return _return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        i++;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**设置思源块展开 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function setBlockfold_0(BlockId) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    设置思源块属性(BlockId, { \""fold\"": \""0\"" });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**设置思源块折叠 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function setBlockfold_1(BlockId) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    设置思源块属性(BlockId, { \""fold\"": \""1\"" });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    * 得到光标编辑状态下的显示commonMenu菜单;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getcommonMenu_Cursor() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if ((window.getSelection ? window.getSelection() : document.selection.createRange().text).toString().length != 0) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var commonMenu = document.querySelector(\""#commonMenu:not(.fn__none)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (commonMenu == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (commonMenu.firstChild == null) return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (commonMenu.children.length &lt; 8) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return commonMenu;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    * 得到光标选中编辑状态下的显示commonMenu菜单;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getcommonMenu_Cursor2() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if ((window.getSelection ? window.getSelection() : document.selection.createRange().text).toString().length != 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return document.querySelector(\""#commonMenu:not(.fn__none)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 得到快选中状态下的显示commonMenu菜单;
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getcommonMenu_Bolck() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var commonMenu = document.querySelector(\""#commonMenu:not(.fn__none)\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (commonMenu.children.length &lt; 8) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return commonMenu;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getNotebookID(docId, then) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    queryAPI(`SELECT box, path FROM blocks WHERE id = \'${docId}\'`, (g) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let notebook = g[0].box;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        then(notebook);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getDocPath(docId, then) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    queryAPI(`SELECT box, path FROM blocks WHERE id = \'${docId}\'`, (g) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let thisDocPath = g[0].path;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        then(thisDocPath);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**++++++++++++++++++++++++++++++++按需调用++++++++++++++++++++++++++++++ */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function 调整新窗口头栏位置() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (!document.body.classList.contains(\""body--window\"")) return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    const toolbar__window = document.querySelector(\""body &gt; .toolbar__window\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    const layouts = document.getElementById(\""layouts\"")?.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var toolbarTxt = insertCreateBefore(toolbar__window.firstElementChild, \""div\"", \""toolbarTxt\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (toolbar__window &amp;&amp; layouts) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        document.body.insertBefore(toolbar__window, layouts);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    /************************************************************窗口一些元素调整 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var layoutTabBarReadonly = document.querySelector(\"".layout-tab-bar.layout-tab-bar--readonly.fn__flex-1\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    layoutTabBarReadonly.style.paddingRight = \""0px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    layoutTabBarReadonly.style.marginTop = \""-26px\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    /**********************************************************更改子窗口标题 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let _id = /^\\d{14}\\-[0-9a-z]{7}$/;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let _url = /^siyuan:\\/\\/blocks\\/(\\d{14}\\-[0-9a-z]{7})\\/*(?:(?:\\?)(\\w+=\\w+)(?:(?:\\&amp;)(\\w+=\\w+))*)?$/;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    /**
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     * 获得目标的块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     * @params {HTMLElement} target: 目标
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     * @return {string} 块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     * @return {null} 没有找到块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function getTargetBlockID(target) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let element = target;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        while (element != null
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            &amp;&amp; !(element.localName === \'a\' &amp;&amp; element.href
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                || element.dataset.href
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                || _id.test(element.dataset.nodeId)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                || _id.test(element.dataset.oid)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                || _id.test(element.dataset.id)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                || _id.test(element.dataset.rootId)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            )) element = element.parentElement;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (element != null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (_id.test(element.dataset.nodeId)) return element.dataset.nodeId;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (_id.test(element.dataset.oid)) return element.dataset.oid;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (_id.test(element.dataset.id)) return element.dataset.id;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (_id.test(element.dataset.oid)) return element.dataset.rootId;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (_url.test(element.dataset.href)) return url2id(element.dataset.href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (_url.test(element.href)) return url2id(element.href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return element.href || element.dataset.href || null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        else return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function url2id(url) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let results = _url.exec(url);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (results &amp;&amp; results.length &gt;= 2) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return results[1];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var reg = new RegExp(\'&lt;[^&gt;]+&gt;\', \'gi\');  //过滤所有的html标签，不包括内容
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var title = document.querySelector(\""title\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    title.innerText = \""[#] 思源子窗口 - HBuilderX [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    toolbarTxt.innerText = \""[#] 思源子窗口 - HBuilderX [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    AddEvent(document.body, \""click\"", (e) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //console.log(e);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var title = document.querySelector(\""title\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var TargetBlockID = getTargetBlockID(e.target);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (TargetBlockID == null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            title.innerText = \""[#] 思源子窗口 - HBuilderX [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            toolbarTxt.innerText = \""[#] 思源子窗口 - HBuilderX [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        titleTxt(TargetBlockID);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function titleTxt(TargetBlockID) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        以id获取文档聚焦内容(TargetBlockID, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var htmltxt = v.content;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var element = document.createElement(\""div\"");
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element.innerHTML = htmltxt;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            htmltxt = diguiTooONE_1(element, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return v.getAttribute(\""contenteditable\"") == \""true\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            var txt = (htmltxt.innerText).replace(reg, \'\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (txt == \""\"" || txt == \""\"") {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                txt = \""[#] 思源子窗口 - HBuilderX [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                根据ID获取人类可读路径(TargetBlockID, (v) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    title.innerText = \""[#] \"" + v.substring(1, v.length) + \"" [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    toolbarTxt.innerText = \""[#] \"" + v.substring(1, v.length) + \"" [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                return;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            if (txt.length &gt; 25) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                title.innerText = \""[#] \"" + txt.substring(0, 25) + \""...\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                toolbarTxt.innerText = \""[#] \"" + txt.substring(0, 25) + \""...\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                title.innerText = \""[#] \"" + txt + \"" [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                toolbarTxt.innerText = \""[#] \"" + txt + \"" [#]\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            element.remove();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">调整新窗口头栏位置();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">var Funs;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">if (isPhone()) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    Funs = [
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        collapseExpand_Head_List,//鼠标中键标题、列表文本折叠/展开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        () =&gt; console.log(\""==============&gt;来自HBXL的附加CSS和特性JS_已经执行&lt;==============\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    /*  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">} else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    Funs = [
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        autoOpenList,//自动展开悬浮窗内折叠列表（第一次折叠）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        collapsedListPreview,//折叠列表内容预览查看
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        collapseExpand_Head_List,//鼠标中键标题、列表文本折叠/展开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        theFloatingWindowIsClosed,//思源悬浮窗头栏中键关闭
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        SuspendedWindowNoSection,//思源悬浮窗检测到单个段落块，单个列表项，面包屑前一级展示
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        () =&gt; console.log(\""==============&gt;来自HBXL的附加CSS和特性JS_已经执行&lt;==============\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    ];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    /*
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        // createHBuiderXToolbar();//创建BuiderXToolbar
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        //setTimeout(() =&gt; ClickMonitor(), 3000);//各种列表转xx
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        showDocumentCreationDate();//为打开文档标题下面显示文档创建日期
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        displayParentChildDocuments2();//为文档展示父子文档
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        autoOpenList();//自动展开悬浮窗内折叠列表（第一次折叠）
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        collapsedListPreview();//折叠列表内容预览查看
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        collapseExpand_Head_List();//鼠标中键标题、列表文本折叠/展开
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        // findMatchingListEntries();//查找匹配列表条目前的图标可以鼠标悬停打开悬浮窗
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        theFloatingWindowIsClosed();//思源悬浮窗头栏中键关闭
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        zoomOutToRestoreTheFloatingWindow();//钉住悬浮窗增强
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        SuspendedWindowNoSection();//思源悬浮窗检测到单个段落块，单个列表项，面包屑前一级展示
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    Funs.reverse();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var index = (Funs.length) - 1;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    var ID = setInterval(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (index &gt;= 0) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Funs[index]();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        } else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            clearInterval(ID);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        index--;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }, 100)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}, 1000)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  /****************************思源API操作**************************/ 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  async function 设置思源块属性(内容块id, 属性对象) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let url = \'/api/attr/setBlockAttrs\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return 解析响应体(向思源请求数据(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: 内容块id,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        attrs: 属性对象,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  async function 向思源请求数据(url, data) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let resData = null
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await fetch(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        body: JSON.stringify(data),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        method: \'POST\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        headers: {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            Authorization: `Token \'\'`,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then(function (response) { resData = response.json() })
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return resData
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  async function 解析响应体(response) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let r = await response
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return r.code === 0 ? r.data : null
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/* 操作 */ 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 获得所选择的块对应的块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns {string} 块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns {
</span></span><span class=""highlight-line""><span class=""highlight-cl""> *     id: string, // 块 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> *     type: string, // 块类型
</span></span><span class=""highlight-line""><span class=""highlight-cl""> *     subtype: string, // 块子类型(若没有则为 null)
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * }
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns {null} 没有找到块 ID */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function getBlockSelected() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let node_list = document.querySelectorAll(\'.protyle-wysiwyg--select\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (node_list.length === 1 &amp;&amp; node_list[0].dataset.nodeId != null) return {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        id: node_list[0].dataset.nodeId,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        type: node_list[0].dataset.type,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        subtype: node_list[0].dataset.subtype,
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    };
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return null;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function ClickMonitor () {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  window.addEventListener(\'mouseup\', MenuShow)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function MenuShow() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let selectinfo = getBlockSelected()
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      if(selectinfo){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      let selecttype = selectinfo.type
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      let selectid = selectinfo.id
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      if(selecttype==\""NodeList\""||selecttype==\""NodeTable\""||selecttype==\""NodeParagraph\""){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        setTimeout(()=&gt;InsertMenuItem(selectid,selecttype), 0)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  }, 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function InsertMenuItem(selectid,selecttype){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let commonMenu = document.querySelector(\"".b3-menu__items\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let  readonly = commonMenu.querySelector(\"".b3-menu__item--readonly\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let  selectview = commonMenu.querySelector(\'[id=\""viewselect\""]\')
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  if(readonly){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if(!selectview){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    commonMenu.insertBefore(ViewSelect(selectid,selecttype),readonly)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    commonMenu.insertBefore(MenuSeparator(),readonly)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">function ViewMonitor(event){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let id = event.currentTarget.getAttribute(\""data-node-id\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let attrName = \'custom-\'+event.currentTarget.getAttribute(\""custom-attr-name\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let attrValue = event.currentTarget.getAttribute(\""custom-attr-value\"")
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let blocks = document.querySelectorAll(`.protyle-wysiwyg [data-node-id=\""${id}\""]`)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  if(blocks){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    blocks.forEach(block=&gt;block.setAttribute(attrName,attrValue))
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  let attrs={}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    attrs[attrName] =attrValue
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  设置思源块属性(id,attrs)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">setTimeout(()=&gt;ClickMonitor(),1000)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">// REF https://github.com/Zuoqiu-Yingyi/siyuan-theme-dark-plus/blob/main/theme.js
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.theme = {};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/* 颜色配置文件列表 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.theme.colors = [
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/autumn.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/blue.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/cyan.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/dark.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/green.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/light.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/spring.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/tonight.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/fountain.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/bearlight.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/fruitspink.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/mediawiki.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/qianlan.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/yinxiang.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    \'palette/pbook.css\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/* DOM 节点 ID */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.theme.IDs = {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    STYLE_COLOR: \'custom-id-style-theme-color\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    BUTTON_TOOLBAR_CHANGE_COLOR: \'custom-id-button-toolbar-change-color\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    LOCAL_STORAGE_COLOR_HREF: \'langzhou-color-href\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">};
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/* 循环迭代器 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.theme.Iterator = function* (items) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    // REF [ES6中的迭代器(Iterator)和生成器(Generator) - 小火柴的蓝色理想 - 博客园](https://www.cnblogs.com/xiaohuochai/p/7253466.html)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    for (let i = 0; true; i = (i + 1) % items.length) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        yield items[i];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 加载样式文件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @params {string} href 样式地址
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @params {string} id 样式 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.theme.loadStyle = function (href, id = null) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let style = document.createElement(\'link\');
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (id) style.id = id;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style.type = \'text/css\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style.rel = \'stylesheet\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    style.href = href;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    document.head.appendChild(style);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 更新样式文件
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @params {string} id 样式文件 ID
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @params {string} href 样式文件地址
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">window.theme.updateStyle = function (id, href) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let style = document.getElementById(id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (style) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        style.setAttribute(\'href\', href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.theme.loadStyle(href, id);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">setTimeout(() =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    const drag = document.getElementById(\'drag\'); // 标题栏
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    const themeStyle = document.getElementById(\'themeStyle\'); // 当前主题引用路径
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (drag &amp;&amp; themeStyle) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const THEME_ROOT = new URL(themeStyle.href).pathname.replace(\'theme.css\', \'\'); // 当前主题根目录
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        /* 通过颜色配置文件列表生成完整 URL 路径 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const colors_href = [];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.theme.colors.forEach(color =&gt; colors_href.push(`${THEME_ROOT}${color}`));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.theme.iter = window.theme.Iterator(colors_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        var color_href = window.siyuan?.storage[window.theme.IDs.LOCAL_STORAGE_COLOR_HREF];
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (!color_href) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            localStorage.getItem(window.theme.IDs.LOCAL_STORAGE_COLOR_HREF);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (color_href) { // 将迭代器调整为当前配色
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            for (let i = 0; i &lt; window.theme.colors.length; ++i) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                if (window.theme.iter.next().value === color_href) break;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        else { // 迭代器第一个为当前配色
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            color_href = window.theme.iter.next().value;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            localStorage.setItem(window.theme.IDs.LOCAL_STORAGE_COLOR_HREF, color_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            setLocalStorageVal(window.theme.IDs.LOCAL_STORAGE_COLOR_HREF, color_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        /* 加载配色文件 */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.theme.updateStyle(window.theme.IDs.STYLE_COLOR, color_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        const button_change_color = document.createElement(\'button\'); // 切换主题颜色按钮
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        button_change_color.id = window.theme.IDs.BUTTON_TOOLBAR_CHANGE_COLOR;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        button_change_color.className = \'toolbar__item b3-tooltips b3-tooltips__sw\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        button_change_color.ariaLabel = \'切换主题颜色\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        button_change_color.innerHTML = `&lt;svg&gt;&lt;use xlink:href=\""#iconTheme\""&gt;&lt;/use&gt;&lt;/svg&gt;`;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        button_change_color.addEventListener(\'click\', e =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            color_href = window.theme.iter.next().value;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            localStorage.setItem(window.theme.IDs.LOCAL_STORAGE_COLOR_HREF, color_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            setLocalStorageVal(window.theme.IDs.LOCAL_STORAGE_COLOR_HREF, color_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            window.theme.updateStyle(window.theme.IDs.STYLE_COLOR, color_href);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        // REF [JS DOM 编程复习笔记 -- insertAdjacentHTML（九） - 知乎](https://zhuanlan.zhihu.com/p/425616377)
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        drag.insertAdjacentElement(\'afterend\', button_change_color);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        drag.insertAdjacentHTML(\'afterend\', `&lt;div class=\""protyle-toolbar__divider\""&gt;&lt;/div&gt;`);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}, 0);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 发送API请求
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} data 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} url 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @returns 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function postRequest(data, url){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let result;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    await fetch(url, {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        body: JSON.stringify(data),
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        method: \'POST\',
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        headers: {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            \""Authorization\"": \""Token \"",
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            \""Content-Type\"": \""application/json\""
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }).then((response) =&gt; {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        result = response.json();
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    });
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    return result;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">/**
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * 设置LocalStorage
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} ikey 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> * @param {*} ival 
</span></span><span class=""highlight-line""><span class=""highlight-cl""> */
</span></span><span class=""highlight-line""><span class=""highlight-cl"">async function setLocalStorageVal(ikey, ival) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let url = \""/api/storage/setLocalStorageVal\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    let response = await postRequest({app: getAppId(), key: ikey, val: ival}, url);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    if (window.top.siyuan.storage != undefined) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        window.top.siyuan.storage[ikey] = ival;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    function getAppId() {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let wsurl = window.top.siyuan.ws.ws.url;
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        let appIdMatchResult = wsurl.match(new RegExp(`(\\\\?app=|&amp;app=)[^&amp;]+`, \""g\""));
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        if (appIdMatchResult.length == 1){
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return appIdMatchResult[0].substring(5);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }else if (appIdMatchResult.length &gt; 1) {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            console.warn(\""正则获取appId错误\"", appIdMatchResult);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return appIdMatchResult[0].substring(5);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }else {
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            console.error(\""正则获取appId错误\"", appIdMatchResult);
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            return \""\"";
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    }
</span></span><span class=""highlight-line""><span class=""highlight-cl"">}
</span></span></code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ol>
                

作者：dammy
链接：https://ld246.com/article/1711872539704
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",dammy,思源笔记,链滴优选
661,F 的分享 | 如何在思源中使用 KaTex 宏 - 链滴,Wed Mar 27 2024 15:46:35 GMT+0000 (Coordinated Universal Time),"
                    <p>思源笔记当中「设置」-「编辑器」中有一个「Katex 宏定义」的设置选项，长久以来一直被人忽略，甚至连官方文档里面都没有提到他——但实际上这个东西非常有用。</p>
<p><img src=""https://b3logfile.com/file/2024/03/image-hXzy5FL.png?imageView2/2/interlace/1/format/webp""></p>
<p>在 KaTeX 中，「宏」允许你将一个长且复杂的表达式缩写成一个简短的标识符。</p>
<p>他实际上就是一种字符串替换规则：首先定义一个简短的字符串（宏名），并告诉 KaTeX 当你写下这个宏名时，应该用哪个更长的字符串（通常是一个数学表达式）来替换它。</p>
<p>这样一来，在编写数学公式时，只需输入宏名，KaTeX 就会自动将其替换为对应的完整表达式。这使得重复输入复杂表达式变得快速且不易出错。</p>
<p>定义宏首先要指定一个用 \\ 开头的文本，比如 \\foo；然后，指定一个字符串来描述这个宏应该展开成什么，就像在一个字典或者映射表中一样。在实际使用的时候，KaTex 引擎就会用后面的替代文本来替代前面的键。</p>
<p>思源中支持用 Json 格式来声明宏定义，其中的键是宏的名称，值是宏的替代文本。例如下面这个例子中，当你在 KaTeX 中使用 <code>\\foo</code> 时，它会被替换为 <code>{x^2}</code>。</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\foo\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""{x^2}\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<blockquote>
<p>注：之所以这里用 \\\\foo 而不是 \\foo 是因为程序处理 json 的时候，需要转义 \\ 字符。</p>
</blockquote>
<h3 id=""更加复杂的案例"">更加复杂的案例</h3>
<p>这里给一个更复杂一些的案例：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\aligned\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\\\\begin{aligned}#1\\\\end{aligned}\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>有了这个宏只需写 <code>\\aligned{...}</code>，并把方程组作为参数放在大括号中，就能定义一个 <code>aligned</code> 环境。</p>
<p>我们可以使用刚刚定义的 <code>\\aligned</code> 宏来整洁地表示一个复数的极坐标和直角坐标之间的转换。</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\aligned</span><span class=""highlight-nb"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span>z = (real, imag) = (M, <span class=""highlight-k"">\\theta</span>)<span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> M = <span class=""highlight-k"">\\sqrt</span><span class=""highlight-nb"">{</span>real<span class=""highlight-nb"">^</span>2 + imag<span class=""highlight-nb"">^</span>2<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span><span class=""highlight-k"">\\theta</span> = <span class=""highlight-k"">\\arctan</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\left</span>(<span class=""highlight-k"">\\frac</span><span class=""highlight-nb"">{</span>imag<span class=""highlight-nb"">}{</span>real<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\right</span>)<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> real = M<span class=""highlight-k"">\\cos</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> imag = M<span class=""highlight-k"">\\sin</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">}</span>
</span></span></code></pre>
<p>以上代码就会被展开为:</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\begin</span><span class=""highlight-nb"">{</span>aligned<span class=""highlight-nb"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span>z = (real, imag) = (M, <span class=""highlight-k"">\\theta</span>)<span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> M = <span class=""highlight-k"">\\sqrt</span><span class=""highlight-nb"">{</span>real<span class=""highlight-nb"">^</span>2 + imag<span class=""highlight-nb"">^</span>2<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span><span class=""highlight-k"">\\theta</span> = <span class=""highlight-k"">\\arctan</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\left</span>(<span class=""highlight-k"">\\frac</span><span class=""highlight-nb"">{</span>imag<span class=""highlight-nb"">}{</span>real<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\right</span>)<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> real = M<span class=""highlight-k"">\\cos</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> imag = M<span class=""highlight-k"">\\sin</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\end</span><span class=""highlight-nb"">{</span>aligned<span class=""highlight-nb"">}</span>
</span></span></code></pre>
<h3 id=""宏参数"">宏参数</h3>
<p>上面的案例用到了宏参数，它用 <code>#</code> 后跟一个数字表示，例如 #1，#2 等。这些数字指的是宏使用时相应位置的参数。</p>
<p>例如，如果定义了一个宏 <code>\\foo</code> 来表示某个带有一个参数的数学操作，就像这样：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\foo\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""f(#1)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>在这里，<code>#1</code> 将会被替换为在使用宏时提供的第一个参数。当你在数学表达式中写下 <code>\\foo{x}</code> 时，KaTeX 会将其展开为 <code>f(x)</code>。</p>
<p>如果定义的宏需要多个参数，你可以在定义中包含 #1，#2，#3 等，以此类推，对应使用时的第一、第二、第三个括号里面的内容。</p>
<p>举一个多参数宏的例子：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\binomial\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\\\\left(\\\\frac{#1}{#2}\\\\right)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>在这个宏定义中，<code>\\binomial</code> 用来创建一个二项式系数。使用 <code>\\binomial{n}{k}</code> 时，#1 会被替换为 n，而 #2 会被替换为 k，所以它会展开为 <code>\\left(\\frac{n}{k}\\right)</code>。</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\binomial</span><span class=""highlight-nb"">{</span>2<span class=""highlight-nb"">}{</span>3<span class=""highlight-nb"">}</span>
</span></span></code></pre>
<div class=""language-math"">\\left(\\frac{2}{3}\\right)</div>
                

作者：Frostime
链接：https://ld246.com/article/1711525595978
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,"KaTex,思源笔记",链滴优选
699,F 的分享 | 如何在思源中使用 KaTex 宏 - 链滴,Wed Mar 27 2024 15:46:35 GMT+0000 (Coordinated Universal Time),"
                    <p>思源笔记当中「设置」-「编辑器」中有一个「Katex 宏定义」的设置选项，长久以来一直被人忽略，甚至连官方文档里面都没有提到他——但实际上这个东西非常有用。</p>
<p><img src=""https://b3logfile.com/file/2024/03/image-hXzy5FL.png?imageView2/2/interlace/1/format/webp""></p>
<p>在 KaTeX 中，「宏」允许你将一个长且复杂的表达式缩写成一个简短的标识符。</p>
<p>他实际上就是一种字符串替换规则：首先定义一个简短的字符串（宏名），并告诉 KaTeX 当你写下这个宏名时，应该用哪个更长的字符串（通常是一个数学表达式）来替换它。</p>
<p>这样一来，在编写数学公式时，只需输入宏名，KaTeX 就会自动将其替换为对应的完整表达式。这使得重复输入复杂表达式变得快速且不易出错。</p>
<p>定义宏首先要指定一个用 \\ 开头的文本，比如 \\foo；然后，指定一个字符串来描述这个宏应该展开成什么，就像在一个字典或者映射表中一样。在实际使用的时候，KaTex 引擎就会用后面的替代文本来替代前面的键。</p>
<p>思源中支持用 Json 格式来声明宏定义，其中的键是宏的名称，值是宏的替代文本。例如下面这个例子中，当你在 KaTeX 中使用 <code>\\foo</code> 时，它会被替换为 <code>{x^2}</code>。</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\foo\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""{x^2}\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<blockquote>
<p>注：之所以这里用 \\\\foo 而不是 \\foo 是因为程序处理 json 的时候，需要转义 \\ 字符。</p>
</blockquote>
<h3 id=""更加复杂的案例"">更加复杂的案例</h3>
<p>这里给一个更复杂一些的案例：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\aligned\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\\\\begin{aligned}#1\\\\end{aligned}\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>有了这个宏只需写 <code>\\aligned{...}</code>，并把方程组作为参数放在大括号中，就能定义一个 <code>aligned</code> 环境。</p>
<p>我们可以使用刚刚定义的 <code>\\aligned</code> 宏来整洁地表示一个复数的极坐标和直角坐标之间的转换。</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\aligned</span><span class=""highlight-nb"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span>z = (real, imag) = (M, <span class=""highlight-k"">\\theta</span>)<span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> M = <span class=""highlight-k"">\\sqrt</span><span class=""highlight-nb"">{</span>real<span class=""highlight-nb"">^</span>2 + imag<span class=""highlight-nb"">^</span>2<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span><span class=""highlight-k"">\\theta</span> = <span class=""highlight-k"">\\arctan</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\left</span>(<span class=""highlight-k"">\\frac</span><span class=""highlight-nb"">{</span>imag<span class=""highlight-nb"">}{</span>real<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\right</span>)<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> real = M<span class=""highlight-k"">\\cos</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> imag = M<span class=""highlight-k"">\\sin</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">}</span>
</span></span></code></pre>
<p>以上代码就会被展开为:</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\begin</span><span class=""highlight-nb"">{</span>aligned<span class=""highlight-nb"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span>z = (real, imag) = (M, <span class=""highlight-k"">\\theta</span>)<span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> M = <span class=""highlight-k"">\\sqrt</span><span class=""highlight-nb"">{</span>real<span class=""highlight-nb"">^</span>2 + imag<span class=""highlight-nb"">^</span>2<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span><span class=""highlight-k"">\\theta</span> = <span class=""highlight-k"">\\arctan</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\left</span>(<span class=""highlight-k"">\\frac</span><span class=""highlight-nb"">{</span>imag<span class=""highlight-nb"">}{</span>real<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\right</span>)<span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> real = M<span class=""highlight-k"">\\cos</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span><span class=""highlight-k"">\\\\</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">&amp;</span> imag = M<span class=""highlight-k"">\\sin</span><span class=""highlight-nb"">{</span><span class=""highlight-k"">\\theta</span><span class=""highlight-nb"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\end</span><span class=""highlight-nb"">{</span>aligned<span class=""highlight-nb"">}</span>
</span></span></code></pre>
<h3 id=""宏参数"">宏参数</h3>
<p>上面的案例用到了宏参数，它用 <code>#</code> 后跟一个数字表示，例如 #1，#2 等。这些数字指的是宏使用时相应位置的参数。</p>
<p>例如，如果定义了一个宏 <code>\\foo</code> 来表示某个带有一个参数的数学操作，就像这样：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\foo\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""f(#1)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>在这里，<code>#1</code> 将会被替换为在使用宏时提供的第一个参数。当你在数学表达式中写下 <code>\\foo{x}</code> 时，KaTeX 会将其展开为 <code>f(x)</code>。</p>
<p>如果定义的宏需要多个参数，你可以在定义中包含 #1，#2，#3 等，以此类推，对应使用时的第一、第二、第三个括号里面的内容。</p>
<p>举一个多参数宏的例子：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""\\\\binomial\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\\\\left(\\\\frac{#1}{#2}\\\\right)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>在这个宏定义中，<code>\\binomial</code> 用来创建一个二项式系数。使用 <code>\\binomial{n}{k}</code> 时，#1 会被替换为 n，而 #2 会被替换为 k，所以它会展开为 <code>\\left(\\frac{n}{k}\\right)</code>。</p>
<pre><code class=""language-tex highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">\\binomial</span><span class=""highlight-nb"">{</span>2<span class=""highlight-nb"">}{</span>3<span class=""highlight-nb"">}</span>
</span></span></code></pre>
<div class=""language-math"">\\left(\\frac{2}{3}\\right)</div>
                

作者：Frostime
链接：https://ld246.com/article/1711525595978
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,"KaTex,思源笔记",链滴优选
663,手机伺服经验帖汇总（持续更新） - 链滴,Sun Mar 24 2024 20:40:22 GMT+0000 (Coordinated Universal Time),"
                    <p>手机伺服是个好东西，但直接用的话，存在一些不方便的地方。而通过一些配置，可以让思源笔记的手机伺服功能更好用。本文将与手机伺服相关的经验帖汇编在一起，方便大家查阅。（注意：部分帖子需结合评论区一起看）</p>
<h3 id=""零-新手教程"">零、新手教程</h3>
<p><a href=""https://ld246.com/article/1660914641044"">手机伺服使用指南（新手向）以及一些个人经验分享</a></p>
<h3 id=""一-每次都要在浏览器地址栏输入手机的ip地址很麻烦"">一、每次都要在浏览器地址栏输入手机的 ip 地址很麻烦</h3>
<p>如果使用场景比较固定，那么手机连 wifi 时可以设置为静态 ip。其它场景可以看下这几篇帖子：</p>
<p><a href=""https://ld246.com/article/1698644913442"">【分享】手机热点 + 伺服，笔记本免输网址打开思源</a></p>
<p><a href=""https://ld246.com/article/1700137695849"">手机伺服，笔记本免输网址打开思源 2.0</a></p>
<p><a href=""https://ld246.com/article/1705387747246"">无需输入 ip 访问思源伺服，解决 ip 变化要重新收藏地址的烦恼</a></p>
<p><a href=""https://ld246.com/article/1711978885757"">节约 quicker 空间，一键打开 siyuan 伺服页面 2.0（自动更新 hosts）</a></p>
<h3 id=""二-公司电脑是台式机-连的网线-所以用不了手机伺服"">二、公司电脑是台式机，连的网线，所以用不了手机伺服</h3>
<p>可以看这篇帖子：</p>
<p><a href=""https://ld246.com/article/1698695704446"">【分享】公司环境（台式机连网线，手机连 wifi 伺服）</a></p>
<h3 id=""三-安卓手机杀后台-导致伺服掉线"">三、安卓手机杀后台，导致伺服掉线</h3>
<p>总之就是省电方面的优化，能关尽关。可以看这两篇帖子：</p>
<p><a href=""https://ld246.com/article/1697560390605"">手机熄屏，网络伺服不可用，望改进</a></p>
<p><a href=""https://ld246.com/article/1712293221012"">手机伺服保活方案 2.0（黑屏显示）</a></p>
<p><a href=""https://ld246.com/article/1698591750628"">【分享】保持手机屏幕常亮的 APP，咖啡因</a></p>
<h3 id=""四-希望浏览器的dark-reader插件不对思源生效"">四、希望浏览器的 dark reader 插件不对思源生效</h3>
<p>使用思源原生暗黑主题，而不用 dark reader 渲染。</p>
<p><a href=""https://ld246.com/article/1699684407460"">【分享】手机热点伺服，如何使 dark reader 插件不生效？</a></p>
<h3 id=""五-伺服时无法直接打开外部链接"">五、伺服时无法直接打开外部链接</h3>
<p>使用手机伺服时，每次打开诸如 onenote、bookxnotepro 这样的外部 url scheme 链接时，edge 或 chrome 浏览器都会弹出一个确认框，提示“此站点正在打开 xxx，xxx 想要打开此应用程序”，很影响体验。</p>
<p><a href=""https://ld246.com/article/1711269577321"">解决手机伺服时无法直接打开外部链接</a></p>
<h3 id=""六-手机伺服不支持-ctrl---shift---v-快捷键"">六、手机伺服不支持 ctrl + shift + v 快捷键</h3>
<p>这个快捷键的意思是粘贴为纯文本。</p>
<p><a href=""https://ld246.com/article/1706426121675"">手机伺服不支持 ctrl + shift + v 快捷键</a></p>
<h3 id=""七-PC端用于备份-但会产生很多名为Conflicted的冲突文件"">七、PC 端用于备份，但会产生很多名为 Conflicted 的冲突文件</h3>
<p>只需在 PC 端的设置里把“同步冲突时生成冲突文件”这一选项关闭即可。</p>
<h3 id=""八-手机伺服遇到的bug-可能和浏览器插件有关"">八、手机伺服遇到的 bug，可能和浏览器插件有关</h3>
<p>可能遇到一些 bug，即使关闭了思源的所有插件和代码片段，依然存在，且别人无法复现，那么就有可能是由浏览器插件带来的。</p>
<p><a href=""https://ld246.com/article/1711430694113"">经验：手机伺服遇到的问题可能和浏览器插件有关</a></p>
<h3 id=""九-手机伺服使用不了file---链接"">九、手机伺服使用不了 </h3>
<p><a href=""https://ld246.com/article/1711464917171"">手机伺服用不了 file:// 链接的解决办法 1.0</a></p>
<p><a href=""https://ld246.com/article/1711481368317"">手机伺服用不了 file:// 链接的解决办法 2.0（兼容带空格及中文的文件名或路径）</a></p>
<h3 id=""十-增大伺服页面的显示面积-隐藏地址栏-"">十、增大伺服页面的显示面积（隐藏地址栏）</h3>
<p><a href=""https://ld246.com/article/1712143716729"">分享：增大伺服页面的显示面积</a></p>
<hr>
<p>本文可随意转载。如果你觉得还有别的帖子值得本文收录的，欢迎在评论区留言。</p>
                

作者：openAI
链接：https://ld246.com/article/1711284023275
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",openAI,思源笔记,链滴优选
668,思源渐进学习手册：双链与间隔重复系统 - 链滴,Thu Mar 21 2024 20:33:35 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""思源渐进学习手册-双链与间隔重复系统"">思源渐进学习手册：双链与间隔重复系统</h2>
<h2 id=""序"">序</h2>
<p>思源用户推荐使用思源阅读本篇文章，这里提供了源文件下载</p>
<p><a href=""https://b3logfile.com/file/2024/03/草稿_思源渐进学习手册第三版-fCuRska.sy.zip"">草稿思源渐进学习手册第三版.sy.zip</a></p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240321200844-z9dl6vz.png?imageView2/2/interlace/1/format/webp""></p>
<p>在思源里的食用指南：</p>
<ul>
<li>点击列表大纲符号聚焦查看，点击同一个大纲符号返回上一级</li>
<li>点击索引文档进行跳转</li>
<li>推荐使用 TOY 主题，有聚焦自动展开的功能。</li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240321201128-qnjrtxs.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/03/食用指南-min-99ppTly.gif""></p>
<p>这篇文章的结构：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240319215421-4v9aru8.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
<p>在和社区的交流中，我们发现每个人对“笔记”一词的理解都不同，大多数人并不需要一个帮助思考的软件，他们的需求主要是进行一些信息管理，以及必要时处理下文本。</p>
<p>得益于思源的设计和优化它能胜任这些工作，甚至比其它软件做得更好，比如端对端加密同步、强大的搜索、长文阅读，以及完善的导出。</p>
<p>在今天，我们并不对信息管理做多余赘述，这篇文章只分享如何通过合适的策略加强内在的学习动力，让自己变为一个积极主动的学习者。</p>
<p>在文章中，我将会描述：</p>
<ul>
<li>学习中的奖励—被忽略的奖励因素，奖励带来乐趣与内在驱动力</li>
<li>主动学习—学习的根，根子是坏的长不出来参天大树</li>
<li>先验知识—学习的对象，解决了学什么的问题</li>
<li>认知自动化—学习的进化，学习会让自我变得越来越强</li>
<li>提取练习—学习的格式化，把学习当成更具体的练习任务</li>
<li>SRS/渐进—学习的间隔与情感优化，大部分人都忽略了学习需要时间，以及学习过程中内在驱动力的消耗</li>
</ul>
<p>这篇文章由于综合了多人的观点，所以显得复杂且冗长，你可以根据自己的喜好从右侧大纲那随意跳转，虽然本篇文章是线性的，但我推荐大家根据大脑的味蕾进行非线性阅读，不用有什么必须读完的压力，挑着感兴趣的看就行，比如你只想知道如何在思源里如何用双链，那么直接跳到“双链的非定向渐进流程”即可，上手就是毕业。</p>
<p>这篇文章中提到的<strong>策略</strong>和<strong>惊才绝艳的想法</strong>大多出自：</p>
<ul>
<li>SuperMemo 作者 Piotr Wozniak<sup class=""footnotes-ref"" id=""footnotes-ref-1""><a href=""#footnotes-def-1"">1</a></sup></li>
<li>间隔重复系统的资深使用者以及开拓者、常青笔记的作者、独立研究员 Andy Matuschak<sup class=""footnotes-ref"" id=""footnotes-ref-2""><a href=""#footnotes-def-2"">2</a></sup></li>
<li>量子物理学家 Michael Nielsen<sup class=""footnotes-ref"" id=""footnotes-ref-3""><a href=""#footnotes-def-3"">3</a></sup></li>
<li>Lain</li>
</ul>
<p>在此要感谢 Thoughts Memo<sup class=""footnotes-ref"" id=""footnotes-ref-4""><a href=""#footnotes-def-4"">4</a></sup> 汉化组创造了一个机会，能让我去理解他们在想什么。</p>
<p>如有疑问，可以评论区留言和我们进行交流。</p>
<h2 id=""学习中的奖励"">学习中的奖励</h2>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320203128-tvyuxwj.png?imageView2/2/interlace/1/format/webp""></p>
<p>在一次漫游：学习中的快乐与束缚<sup class=""footnotes-ref"" id=""footnotes-ref-5""><a href=""#footnotes-def-5"">5</a></sup>中我们以进化的角度解释了大脑讨厌不确定性、天然渴求着信息与知识，用来消除陌生环境中的不确定性和不安感。这也是为什么如今智能手机、上网冲浪、短视频这么受欢迎的原因之一。</p>
<p>除了消除不确定性外，“获得新知识”本身会使大脑的奖励机制产生愉悦感。与进食等欲望相反，学习的愉悦感不会随着满足而结束，这种愉悦感是进一步信息寻求行为的基础。</p>
<p>也就是说，当你获得了知识的奖励后，你会越来越渴望知识，并且只有“学习”这种行为能强化渴望，外在的奖励反而会破坏这种驱动力。这是每个人类都拥有的生物机制，从生物学的角度上来讲，它能鼓励我们去适应新环境，提高生存几率。</p>
<h2 id=""-那为什么我从未感受到学习的快感--"">“那为什么我从未感受到学习的快感？”</h2>
<p>回答这个问题需要我们先明确下“学习”这个概念，学习有广义和狭义之分。</p>
<p>狭义上的学习也就是我们常说的校内学习，学生迫于压力说服自己从教学、专业书中吸收知识，当毕业之后通常就不会再进行狭义的学习活动。</p>
<p>而在广义上，当经验（包括实践）导致个体的知识、行为或行为倾向发生相对永久的变化时，就发生了学习<sup class=""footnotes-ref"" id=""footnotes-ref-6""><a href=""#footnotes-def-6"">6</a></sup>。</p>
<p>也就是说，看剧、阅读网文、打游戏等行为同样会发生学习，关键不在于场合，而在于：</p>
<ol>
<li>学习是一种变化。</li>
<li>学习者的知识、行为或行为倾向发生相对永久的变化。</li>
<li>这种变化是由学习者的经验导致的。</li>
</ol>
<p>举例说明（资料改编于 应用学习科学[美]理查德·梅耶. (2016).）：</p>
<ul>
<li>大米这两个礼拜天天都在玩电脑游戏。他的游戏分数得到了很大提高——这是学习，经验（玩电脑游戏）导致相关知识（由游戏分数表现出来）发生了变化。</li>
<li>大米不喜欢狗。不过这个周末，他需要去照顾朋友的一只可爱的金毛。从那以后，他就开始喜欢狗了——这是学习。</li>
<li>大米从自行车上摔下来，撞伤了头，并在瞬间失去了知觉。他苏醒后却不记得这件事了——这不是学习，失忆是摔倒导致，是外部物理干预，而不是经验导致。</li>
<li>大米在规定时间内做完了 100 道算术题。尽管筋疲力尽，但他又继续做了另外 100 道相同类型的题目。这次花的时间比第一次花的时间更长——这不是学习，这是由疲劳引起的变化。</li>
</ul>
<p>一位学习者可能会在看电视剧时学习到转场的技巧、镜头如何拍摄出美感，可能会在阅读网文时学到如何设计情节、如何制造读者喜欢的爽点，也可能会在打游戏时总结出关于设计场景的模型。广义上学习是不拘泥于形式的。</p>
<p>狭义上的学习即是我们日常语境下的学习，在这种学习下我们通常很少能感受到学习中的奖励，在学业压力的迫使下，我们不得不面对高于先验知识水平的信息，陷入认知过载：</p>
<ul>
<li>当我们阅读一段完全陌生文本时，文本中的新元素进入到工作记忆代表的“意识工作台”中，占据了我们的组块容量：</li>
<li>面对两个元素时，工作记忆容量还有余，我们能轻松进行心智运算。</li>
<li>而当元素多余三个时，我们思考时就有些吃力，特别是当它们之间产生相互作用时：例如，电池需要一个正极和一个负极，正负极之间是电解质。这样就有三个元素，但当要描述它们的顺序时就可能出现六种情况<sup class=""footnotes-ref"" id=""footnotes-ref-7""><a href=""#footnotes-def-7"">7</a></sup>。</li>
<li>当项目的数量增加时，它们相互联系的方式也会增加。我们很难一下子在工作记忆中同时处理所有元素以及它们之间的关系，这些相互影响的元素会产生高强度负荷，导致我们过载：</li>
<li>“明明字我都认识，但为什么连起来就是读不懂”。</li>
<li>“读到后文忘记前文，有时还会没意识到自己已经忘记了前文，当意识到后只能从头开始再来一遍。”</li>
<li>文本中的文字只是在视觉上解码了一遍，我们完全没注意到其中的意义，文本大部分内容被挡在外面，连工作记忆都无法进入，更别说经过处理进入长时记忆<sup class=""footnotes-ref"" id=""footnotes-ref-8""><a href=""#footnotes-def-8"">8</a></sup>。</li>
</ul>
<p>这是大部分人感受不到“学习快感”的直接原因：</p>
<ul>
<li>大众语境下的学习是指狭义学习，也就是校内学习</li>
<li>学生迫于学业压力不得不时刻处于认知过载状态，说服自己学习无意义的内容通过死记硬背面对考试</li>
</ul>
<p>长期处于这种压力下很难昧着良心说“学习是快乐的”。</p>
<h2 id=""-那学习的快感是怎样的-它有哪些特性--"">“那学习的快感是怎样的？它有哪些特性？”</h2>
<h3 id=""学习的乐趣"">学习的乐趣</h3>
<p>在 woz 的文章学习的乐趣<sup class=""footnotes-ref"" id=""footnotes-ref-9""><a href=""#footnotes-def-9"">9</a></sup>中提供了他多年来自由学习的经验和探索，描述了学习中奖励的属性：</p>
<ul>
<li>
<p>具有可预测性和意外性的“低概率信息”可以带来奖励</p>
<ul>
<li>如现在让人成瘾的大数据信息推送、短视频等等</li>
</ul>
</li>
<li>
<p>先验知识获得学习奖励的基础，向大脑传递信息必须要考虑先验知识</p>
<ul>
<li>
<blockquote>
<p>为了获得学习的奖励，新的意外的信息需要符合已有的知识（模型、图式、预测等）。为了获得奖励，脑神经需要处理输入的信息，并将之与已存于大脑中的信息进行比较。大脑中处理输入信息的主要处理器之一是海马体。它是大脑的信息交换板，能够将输入的信息与先验知识进行比较。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>有价值的联想会产生奖励</p>
<ul>
<li>
<blockquote>
<p>一个被认为有用的联想很有价值。能够解决难题的联想会更有意义。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>具有高价值的知识会带来学习中最纯粹的终极奖励，同时会进入长时记忆</p>
<ul>
<li>例如顿悟、尤里卡时刻</li>
<li>
<blockquote>
<p>当科学家有新发现时，他可能会大叫「尤里卡！ 」，向空中挥拳。他大脑某处的神经网络产生了一个泛化，由此发出奖励信号。经过进一步传播，这会让一个老人像个孩子一样在实验室里跳来跳去。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>合意困难会增加奖励</p>
<ul>
<li>例如解决一个“刚刚好”的问题</li>
<li>
<blockquote>
<p>如果困难是合意的，它将带来奖励。如果不存在奖励，则表明困难是无法逾越的。这种情况下，困难没有意义也不值得追求。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>学习本身就是愉快，这无关运用知识的回报</p>
<ul>
<li>
<blockquote>
<p>产生新发现时的“啊哈！”、“哇！”或“尤里卡！”是学习中最纯粹的终极奖励。我们不需要别人的称赞或表扬作为进一步的奖励。在这里，知识本身就是奖励。</p>
</blockquote>
</li>
<li>
<blockquote>
<p>泛化证实一个模型，或者为一个更好的新模型构建基础。</p>
<p>学习内驱力的奖励来自已准备好进入长期记忆的高价值知识。</p>
<p>这种奖励的共同特征是：都会将新的高价值信息编码进记忆中。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>存在最优信息传授</p>
<ul>
<li>
<blockquote>
<p>最令人愉快的信道将持续提供意外，证实现有的模型，并为之增加新的语义枝条，以便引入新的知识。意外地破坏现有模型可能一开始令人不愉快，但可能会导向令人非常愉快的思维进化。</p>
<p>打个比方，你可以把这想象成信道在修整你的知识树，并添加新的分支，就像一个陶工在他完美塑造的作品中添加新的黏土层。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>学习不会像进食等欲望一样随着满足而停止</p>
<ul>
<li>
<blockquote>
<p>与进食或做爱相反，学习的乐趣不会随着行为的结束而终止。学习的乐趣是可持续的，只有学习过程中涉及的网络过载时，这种乐趣才会缓慢减弱。而且，通过睡眠就可以将其恢复到基准线。</p>
</blockquote>
</li>
<li>
<blockquote>
<p>学习内驱力取决于当前已有知识的状态，此状态可以通过学习行为本身进行改变。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>存在学习的反馈循环</p>
<ul>
<li>
<blockquote>
<p>学习熵（知识的吸引力）提升学习内驱力，进而提升估值，估值反过来决定学习熵，构成强大的反馈循环。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>学习不会停止的一个原因是知识获取时的无规律奖赏会使多巴胺活动幅度增大，产生强烈的渴望<sup class=""footnotes-ref"" id=""footnotes-ref-10""><a href=""#footnotes-def-10"">10</a></sup>。这也是为什么赌博、短视频平台那么令人上瘾。</p>
<h3 id=""知识获取的奖励学习框架"">知识获取的奖励学习框架</h3>
<p>在 Murayama 提出的知识获取的奖励学习框架<sup class=""footnotes-ref"" id=""footnotes-ref-11""><a href=""#footnotes-def-11"">11</a></sup>里也解释了知识获取不会随着满足而停止：</p>
<blockquote>
<p>人们很容易把获取知识视为类似于获取食物。当我们长时间没有食物时，我们会感到饥饿。一旦我们接受了食物，并且消费了它(带着一些兴奋或者失望，取决于味道) ，我们就很可能变得满足。在这方面，我们很容易看到食物和知识获取之间的相似之处。</p>
<p>然而，在现实生活的学习中，知识的获得并不是终点。</p>
</blockquote>
<p>知识获取除了上文描述的奖励强化外，还改变了先验知识及状态作为进一步寻求学习的基础：</p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/知识获得的奖励学习框架-20240227153751-ljao3p4.png?imageView2/2/interlace/1/format/webp""></p>
<p>获取的知识被整合到一个人的先验知识中，更新的先验知识以一种促进进一步信息搜索行为的方式工作。更新后的先验知识至少通过三种途径提示进一步的信息搜索行为：</p>
<ol>
<li>
<p>获取知识使学习者意识到一个以前没有意识到的“知识缺口”。这会引发更多的兴趣，进而促进获取知识的进一步动机(路径  A，图中的“新问题的产生”）。</p>
<ul>
<li>例子：大米正在玩一款游戏，游戏里需要使用星象来导航，在学习天文定位法时他意识到对天体运行存在理解偏差，从而对天文学产生了兴趣，想要学习和解释它。</li>
<li>这是因为丰富知识网络可以突出扩展知识的更大空间<sup class=""footnotes-ref"" id=""footnotes-ref-12""><a href=""#footnotes-def-12"">12</a></sup>*<sup class=""footnotes-ref"" id=""footnotes-ref-13""><a href=""#footnotes-def-13"">13</a></sup>。</li>
<li>当然，这些过程发生的可能性取决于任务结构的性质、一个人的先验知识和他们的技能<sup class=""footnotes-ref"" id=""footnotes-ref-14""><a href=""#footnotes-def-14"">14</a></sup>。例如，学习一个简短的、自成一体的琐碎问题的答案可能不足以激发进一步探索这个主题的兴趣。</li>
</ul>
</li>
<li>
<p>积累的知识也有可能让我们意识到一个主题的重要性（路径 B，图中的“估值”），这进一步加强了新知识的奖励价值。</p>
<ul>
<li>例如大米本来学习如何制卡，结果随着学习发现 Andy 教授制卡的文章里有很多元认知的策略应用，大米意识到制卡不仅可以强化记忆，还可以促进自己的理解，这极大鼓舞了他。</li>
<li>这是因为新信息的价值应该取决于我们能在多大程度上将这些新信息与先验知识联系起来。</li>
</ul>
</li>
<li>
<p>积累的知识还帮助我们理解新的信息，这会调节我们从事信息搜索行为的决策。换句话说，新知识的获取增加了我们的知觉能力或技能（路径  C，图 2 中的“增加的能力”），为进一步探索提供所需。</p>
</li>
</ol>
<p>基于内在动力的参与与基于外在奖励的参与是非常不同的：</p>
<ul>
<li>具体而言，知识获取及其与先验知识的整合是未来信息寻求行为的驱动力，使得知识获得行为具有可持续性。</li>
<li>换句话说，新知识的获取增强了进一步获取知识的动机。</li>
<li>一旦这种自我提升效应发挥作用，奖励系统就为知识获取创造了一个积极的反馈回路，实现了基于“兴趣”的参与的长期可持续性。</li>
<li>这种自我可持续性与基于外部奖励的奖励学习形成鲜明对比，后者的可持续性在很大程度上取决于外部奖励的持续供应。</li>
<li>之前的研究表明<sup class=""footnotes-ref"" id=""footnotes-ref-15""><a href=""#footnotes-def-15"">15</a></sup>，强烈的外在奖励可能会破坏内在动机，知识获取的奖励学习框架提出一个假设：外在奖励的提供阻止了在奖励网络中内在奖励的有效生成，这或许是无法感受学习快感的原因之一。</li>
</ul>
<p>在 woz 的文章和 Murayama 的模型里“先验知识”是极重要的组成，而在本文里则强调先验知识是我们唯一需要维护的部分，在人是如何学习的中有提到：</p>
<blockquote>
<p>人类被看作是由目标指引、积极搜寻信息的行动者，他们带着丰富的先验知识、技能、信仰和概念进入正规教育，而这些已有的知识极大地影响着人们对周围环境的关注以及组织环境和解释环境的方式。反过来，这也影响着他们记忆、推理、解决问题、获取新知识的能力<sup class=""footnotes-ref"" id=""footnotes-ref-16""><a href=""#footnotes-def-16"">16</a></sup>。</p>
</blockquote>
<h2 id=""建构知识"">建构知识</h2>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320203512-z3d2g9v.png?imageView2/2/interlace/1/format/webp""></p>
<p>一些理论能很好地解释先验知识的特性，理解它们能帮助我们理解知识建构，也能让我们对自己的认知过程进行监控，使用对应的调节策略。</p>
<h2 id=""什么是先验知识-"">什么是先验知识？</h2>
<p>它是指接受新信息前大脑中就已经存在的知识。</p>
<h3 id=""为什么要使用这个词-"">为什么要使用这个词？</h3>
<p>使用这个词是专门指代大脑中已有的知识，和通常语境下的“知识”区分开。</p>
<p>在日常交流时“知识”和“信息”这两个概念已经被混淆，这也导致我们很难进行有效沟通，比如我们常说的个人知识管理，但大多是在管理剪藏的书籍、文章之类的信息，这很酷，但不是我们的目标。</p>
<h2 id=""是什么决定了先验知识-"">是什么决定了先验知识？</h2>
<p>主要因素有两点：</p>
<ol>
<li>
<p>文化与境脉（context）的潜移默化</p>
<ul>
<li>在第一次漫游<sup class=""footnotes-ref"" id=""footnotes-ref-5:2""><a href=""#footnotes-def-5"">5</a></sup>里我们探讨了文化、社会等人造物塑造了人类的认知，由于每个人所面对的环境（家庭、身份、关系）是完全不同的，所以每个人都会在互动中发展出独一无二的知识序列，也就是先验知识。</li>
</ul>
</li>
<li>
<p>学习者的主动建构</p>
<ul>
<li>每个人都会通过自己的经验、观察、实验和思考来建构知识，先验知识不仅仅是被动接受的，而是通过个体主动探索和内化外部世界的信息而形成的。</li>
</ul>
</li>
</ol>
<h2 id=""先验知识认知过程中起到什么作用-"">先验知识认知过程中起到什么作用？</h2>
<h3 id=""先验知识带来更多知识-富者越富"">先验知识带来更多知识：富者越富</h3>
<p>学习科学的研究有条重要的指导原则就是：学习总是在原有的知识背景下发生的<sup class=""footnotes-ref"" id=""footnotes-ref-17""><a href=""#footnotes-def-17"">17</a></sup>，以应用的角度来看，学习可以看作原有经验的迁移。</p>
<p>提到迁移，人们通常首先想到的是学习某事，然后评价学习者把它应用于别的事情上的能力。但即使是初始学习时段也涉及到迁移，因为迁移是以人们带到学习情境的知识为基础的，人们应用他们所知道的去建构新的理解，这一原理被解释为“所有的学习都涉及到原有经验的迁移”<sup class=""footnotes-ref"" id=""footnotes-ref-16:2""><a href=""#footnotes-def-16"">16</a></sup>，它在我们学习时经常被验证：</p>
<p>“有一条很好的原则就是，如果你已经有了其他的知识，学习新的东西就会变得更容易。”<sup class=""footnotes-ref"" id=""footnotes-ref-18""><a href=""#footnotes-def-18"">18</a></sup></p>
<p>先验知识以三种方式帮助我们获得新的知识：</p>
<ol>
<li>帮助我们接收新的信息</li>
<li>帮助我们思考新的信息</li>
<li>帮助我们固定新的信息</li>
</ol>
<h4 id=""接收新信息"">接收新信息</h4>
<h5 id=""提升理解能力"">提升理解能力</h5>
<p>在日常交流和阅读中，如果缺乏必要的背景知识，理解对方的意图会很困难。丰富的背景知识意味着你很少需要让对方重述或者重读文本来确定含义。</p>
<p>例子：</p>
<ul>
<li>&gt;当和朋友一起聊天时，他们聊到游戏中话题：“我用反惯性飞爬空时总被卡视角用枪刀打下来，我已经被打成黄锁 bot 了，你有什么应对策略吗？”</li>
<li>&gt;缺乏相关知识的大米：“啊？什么？”</li>
<li>&gt;另一个朋友：“这是你们熟练掌握反惯性飞的在互卷，我就不会用，你们只要一被压视角就想用反惯性飞升空，太容易针对了。”</li>
</ul>
<p>新手与专家的区别是专家拥有一个丰富并组织起来的先验知识，能更容易对新信息进行分类，并确定新信息与已有知识之间的关联<sup class=""footnotes-ref"" id=""footnotes-ref-19""><a href=""#footnotes-def-19"">19</a></sup>，从而理解新信息。</p>
<h5 id=""提供深层次看待问题的方式"">提供深层次看待问题的方式</h5>
<p>在思源社区进行交流时，我发现很多人拥有卓越的“洞察力”，他们能一眼看到问题的本质，后来我才知道这并不是什么天赋，而是先验知识带来的特性：新手关注问题的表面特征，而具有更多知识的人则关注问题的基本原理<sup class=""footnotes-ref"" id=""footnotes-ref-16:3""><a href=""#footnotes-def-16"">16</a></sup>。</p>
<p>在一项经典实验中要求物理学新手和专家将物理问题分类<sup class=""footnotes-ref"" id=""footnotes-ref-20""><a href=""#footnotes-def-20"">20</a></sup>，新手根据问题的表面特征进行分类，比如问题是否涉及弹簧、斜面等。然而，专家根据解决问题所需的物理定律进行分类，例如能量守恒。</p>
<p>专家不仅仅比新手知道更多，更重要的是他们的先验知识提供了深层次看待问题的方式。</p>
<p>专家的先验知识也能让他知道该把注意力集中到哪里，例如 ：</p>
<ul>
<li>DOTA2 中熟练的玩家在观看比赛时会把注意力集中到兵线的控制、节奏的压制、阵容的优劣势时间段上。</li>
<li>格斗游戏的熟练玩家在观赛时会将注意力放在选手对帧数据的理解和应用、资源管理、空间位置的地形利用、攻防节奏上。</li>
</ul>
<p>而新手玩家则注意不到这些，有些精彩的细节操作在他们看来都是一样的。</p>
<p>这是由于大脑能根据当前任务的目标和先验知识对视觉通路中信息的进行调控，能通过“自上而下”的内部信息驱动注意力<sup class=""footnotes-ref"" id=""footnotes-ref-21""><a href=""#footnotes-def-21"">21</a></sup>。</p>
<p>当我们初次看到图一时只觉得是张黑白色块组成的图。</p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240228145445-5byppo1.png?imageView2/2/interlace/1/format/webp""></p>
<p>但是当我们看完图二发现图中有两只动物，这时候再去看图一就会怀着特定的目的去搜索图一中的动物。</p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240228145644-9i8kwlt.png?imageView2/2/interlace/1/format/webp""></p>
<p>除此之外还有个作用是，先验知识帮助个体意识到，在特定情景下应该期待什么和注意什么，即知道“自身周遭”的事物是如何运作的<sup class=""footnotes-ref"" id=""footnotes-ref-22""><a href=""#footnotes-def-22"">22</a></sup>，消除环境中的未知以获得心安感。</p>
<h4 id=""思考新信息"">思考新信息</h4>
<p>先验知识增强了我们接收新信息的能力，但更重要的是接收新信息后在工作记忆中对其的处理，先验知识也提升了这方面的能力。</p>
<p>在信息进入我们有限的工作记忆中时，先验知识能将多个单独的信息项组合成一个有意义的单元或“块”：</p>
<ul>
<li>假设你需要记住一个电话号码：2095550134</li>
<li>如果没有任何先验知识，你只能死记硬背。</li>
<li>但是，如果你利用先验知识，比如知道美国的电话号码通常是按 3-3-4 的模式分割的（区号-前缀-用户号），你可以将这个电话号码分块成三部分：209-555-0134。</li>
<li>这样你只需要记住三个数字组合，而不是十个单独的数字。</li>
<li>如果你知道 209 是加州的区号，那么这个电话号码就可以与“加利福尼亚州”这一地理信息关联起来，进一步减少了记忆负担。</li>
<li>此外，如果数字组合（比如 555）在你的经验中是常见的或有特殊含义（在电影中常用 555 作为虚构的电话号码前缀），那么这个信息块会因为与已有知识的联系而更容易记住。</li>
</ul>
<p>新手会看到“一兵一车”等一系列单独的棋子，大师则看到更加精妙的“组块”：他们识别为单位的棋子组合，由此可在比单个棋子更高的抽象层次上推理<sup class=""footnotes-ref"" id=""footnotes-ref-23""><a href=""#footnotes-def-23"">23</a></sup>。</p>
<p>随着先验知识的生长，你会发现自己能理解越来越复杂的细节，注意到之前忽略的内容，你的关注点可能逐渐转移到其中的模式（pattern）、联接（connection）乃至图景更宏大的洞察（insight）。更妙的是，你或许会跳出作者的内容，开始聚焦在自己的观察和疑问上<sup class=""footnotes-ref"" id=""footnotes-ref-24""><a href=""#footnotes-def-24"">24</a></sup>。</p>
<p>由于先验知识的提高会使得注意力跟着提高，我们能逐渐注意到之前自己行为、表达的缺陷之处，并加以改善，这就衍生出一个有趣的解释：教练是花钱请人对你的注意力进行编程<sup class=""footnotes-ref"" id=""footnotes-ref-25""><a href=""#footnotes-def-25"">25</a></sup>。</p>
<h4 id=""固定新信息"">固定新信息</h4>
<p>你可能看到过某人学习新东西特别快，这并不是天赋异禀，而是他在相关领域有着丰富的先验知识。</p>
<p>当您学习新的信息时，其中和先验知识的相同元素会激活先验知识，并对先验知识进行重组和重新巩固。</p>
<p>共同元素的交叠使得先验知识被不断重新加工，并接收新的信息进行整合，新信息中附带的元素也会被记忆，等待着接收相同元素的信息，先验知识就这样得到了扩展，完成了自由生长。</p>
<p>举例：</p>
<ol>
<li>想象一下您在公园里散步的时候看到一位女士在遛狗
<ul>
<li>这是先验知识，在大脑里与一组同时被激活的神经元相联结</li>
</ul>
</li>
<li>后来您在别处散步的时候见到一位男士在遛同一条狗（共同元素）
<ul>
<li>这是知觉上的交叠事件</li>
</ul>
</li>
<li>狗（共同元素）触发了您的先验知识，这一激活使得您大脑里关于狗、男士、女士的神经表征发生了联结，这种记忆的整合使得您创造出了新的知识——即使您没看到这位男士和女士在一起，但是您已经知道他们有某种关系</li>
</ol>
<blockquote>
<p>资料来源：改编自 Schlichting, M. L., &amp; Preston, A. R. (2015). Memory integration: Neural mechanisms and implications for behavior. <em>Current Opinion in Behavioral Sciences</em>, <em>1</em>, 1–8.</p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240218061042-7behad5.png?imageView2/2/interlace/1/format/webp""></p>
</blockquote>
<p>这个过程类似于拼图游戏，学习者在各种活动中（学校、老师、游戏、社会实践、书籍、网络）捕捉最恰当的知识碎片，用以组装进先验知识中，这也是上文所说的知识的建构。</p>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240218132044-1oyh1cb.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""先验知识能释放工作记忆容量"">先验知识能释放工作记忆容量</h3>
<p>在始于认知架构的认知负荷理论<sup class=""footnotes-ref"" id=""footnotes-ref-26""><a href=""#footnotes-def-26"">26</a></sup>中，假设我们拥有：</p>
<ul>
<li>
<p>大容量的长时记忆</p>
<ul>
<li>人类通常无法直接访问长时记忆中的信息，我们对长时记忆的内容和功能的意识，是通过将这些信息调入工作记忆并在那里加以处理来实现的。</li>
<li>长时记忆中包括先验知识，先验知识不仅仅是由孤立的事实组成，还可以包括心智模型等复杂的认知结构。</li>
<li>人类的智力能力来自于先验知识，而不是来自于在工作记忆中进行长而复杂推理的能力。</li>
</ul>
</li>
<li>
<p>有限容量的工作记忆</p>
<ul>
<li>工作记忆可以等同于意识，人类只能意识到并只能监控工作记忆的内容。所有其他认知功能都被隐藏起来，除非它可以被带入工作记忆中。</li>
<li>大约只有四个组块的容量<sup class=""footnotes-ref"" id=""footnotes-ref-27""><a href=""#footnotes-def-27"">27</a></sup>，就像上文所说，当你陷入过载时大部分信息连工作记忆都无法进入。</li>
</ul>
</li>
</ul>
<p>先验知识能以释放工作记忆容量的方式，允许我们将更多的注意资源集中于认知处理任务上。</p>
<h4 id=""先验知识的建构释放工作记忆容量"">先验知识的建构释放工作记忆容量</h4>
<p>在学龄早期，孩子们通过建构对字母的认知，学会将各种形状（包括手写）分类为有限的字母类别。这些基础元素进一步组合成单词，单词组合成短语，如此层层递进。最终，读者达到能够迅速理解复杂长句的境界。</p>
<p>这些先验知识被存储在长期记忆中，它们的一个明显功能是固定新的信息，除此之外还能降低工作记忆的负荷。</p>
<p>尽管工作记忆容量有限，只可以储存和处理少量元素，但单个元素的大小、复杂性和复杂性却不受限制。即使是最复杂的先验知识，提取到工作记忆中都能作为单个元素（组块）来处理。</p>
<p>也就是说，我们能通过不断建构先验知识来理解愈来愈复杂的信息。</p>
<h4 id=""先验知识的自动化释放工作记忆容量--无想神通"">先验知识的自动化释放工作记忆容量——无想神通</h4>
<h5 id=""什么是先验知识自动化-"">什么是先验知识自动化？</h5>
<p>在本篇文章里，先验知识自动化包含两个概念：</p>
<ul>
<li>认知信息加工自动化</li>
<li>技能习得的自动化阶段</li>
</ul>
<h6 id=""认知信息加工自动化"">认知信息加工自动化</h6>
<p>什么是认知信息加工自动化？</p>
<p>认知信息加工自动化是指某一心理活动或行为随着持续的、大量的练习，所需的注意资源逐渐减少，直至可以无意识地进行处理<sup class=""footnotes-ref"" id=""footnotes-ref-28""><a href=""#footnotes-def-28"">28</a></sup>。</p>
<p>这也是在第一次漫游中所说的：在工作记忆容量的限制下，学习能提高单个组块所能掌控的内部知识（或者将其变成一个无需注意力控制的知识块<sup class=""footnotes-ref"" id=""footnotes-ref-29""><a href=""#footnotes-def-29"">29</a></sup>）和外部信息，就能将复杂的合成任务转变为可以在脑内进行的心智运算。</p>
<h6 id=""技能习得的自动化阶段"">技能习得的自动化阶段</h6>
<p>在对技能习得的研究里，一个经典模型将技能发展分为三个阶段<sup class=""footnotes-ref"" id=""footnotes-ref-30""><a href=""#footnotes-def-30"">30</a></sup>：</p>
<ul>
<li>
<p>陈述性知识阶段</p>
<ul>
<li>在初始阶段，我们的任务是将知识进行编码和记忆，运用这些知识指导行动。</li>
<li>这个过程断断续续，需要经常回忆现在该怎么办，需要做什么。由于需要回忆各个项目（步骤），各个项目几乎不会产生相互作用或组块（熟练后多个项目可视为一个组块），导致工作记忆负荷很大。</li>
<li>当工作记忆负荷增加时，这个阶段的表现水平就会随着降低，出现“脑子卡壳”过载的情况。</li>
<li>例子：我们刚开始学习打字时、刚上手使用思源时。</li>
</ul>
</li>
<li>
<p>混合阶段</p>
<ul>
<li>这一阶段的任务是陈述性知识到程序性知识的转变。通过练习，行动从一开始的断断续续达到流畅，有一定的记忆负荷，需要投入注意资源。</li>
</ul>
</li>
<li>
<p>自动化阶段（程序性知识阶段）</p>
<ul>
<li>最后一个阶段的任务是是通过练习从混合阶段达到自动化，能够自动化地操作所学技能，行动几乎不需要有意识的注意，行动顺应自如的流畅，而且包含大量组块。</li>
</ul>
</li>
</ul>
<p>在三个阶段中，每个阶段都会发生遗忘：</p>
<ul>
<li>在陈述性阶段发生遗忘就会导致无法进入第二阶段</li>
<li>在混合阶段遗忘陈述性知识则会导致练习错误，导致错误的自动化</li>
<li>在自动化阶段遗忘陈述性知识，虽然还能执行任务但会降低效率</li>
</ul>
<p>由于程序性知识的长期保留和衰退的研究很少，所以只描述了陈述性知识的遗忘。</p>
<p>在三个阶段中，第一阶段和第二阶段都需要投入注意力资源，随着练习所投入的注意资源会随之减少，最后几乎不需要占用工作记忆容量。</p>
<p>在技能发展的过程中，技能的自动化阶段是我们的目标，而认知信息加工的自动化构成了技能自动化的基础，它们都能以解放工作记忆容量的形式来帮助我们进行更复杂的思考。</p>
<h2 id=""知识建构"">知识建构</h2>
<h3 id=""什么是知识建构-"">什么是知识建构？</h3>
<p>知识建构是一个教育心理学概念，出自建构主义理论，它指的是个体通过自己的经验、思考和理解，主动地创造和组织知识的过程。</p>
<p>在知识建构的过程中，它有以下特征：</p>
<ul>
<li>主动：学习者不是被动接收信息，而是通过主动探索和实践在先验知识上建构知识。</li>
<li>文化参与建构过程：社会互动和文化背景对知识的建构起到关键作用，学习者通过与他人的互动来发展理解。</li>
<li>情境性：知识的建构与学习者所处的具体情境和境脉（或者说是上下文，context）紧密相关。</li>
<li>个体差异：每个学习者根据自己的先验知识带来的理解、认知能力来建构知识，因此每个人建构的知识都是独特的。</li>
<li>反思：学习者需要反思自己的思考过程和学习策略，这是知识建构的重要部分。</li>
<li>建构意义：学习者试图理解信息的内在意义，并将新信息与已有知识连接起来，形成有意义的整体。</li>
<li>渐进：知识建构是一个持续的过程，学习者的先验知识随着新经验和信息的不断更新而演变。</li>
</ul>
<p>Mayer 对知识的建构有过一个基于信息处理理论的解释：</p>
<blockquote>
<p>当人们在学习过程中出现合适的认知处理行为——例如，选择相关信息、组织信息使之成为连贯的心理表征、将这些心理表征融为一体并且将它们与长期记忆中已被激活的相关知识整合时，就产生了有意义的学习<sup class=""footnotes-ref"" id=""footnotes-ref-31""><a href=""#footnotes-def-31"">31</a></sup>。</p>
</blockquote>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20230719164133-99uxiku.png?imageView2/2/interlace/1/format/webp""></p>
<p>图来自 应用学习科学[美]理查德·梅耶. (2016)</p>
<h3 id=""知识建构带来的启示"">知识建构带来的启示</h3>
<p>知识建构中有个关键点是主动。</p>
<p>我们的智力技能、专业能力来源自大脑中经过组织的先验知识。而我们的思维和行为模式，在很大程度上是由我们所创造和所处的环境塑造的，这包括我们的决策、对事物的看法以及我们的情绪反应，这是被动的过程。</p>
<p>在我们没有意识到并主动掌握自己的认知过程之前，学习往往似乎依赖于偶然，像是一场“撞大运”的游戏。如果我们恰好接触到了“最佳信息流”，并且获得了积极的反馈，那么思考就像是滚雪球一样开始启动，可能最终会发展成为持久的兴趣。</p>
<p>在这个过程中，我们似乎并没有真正掌控自我，只是被外界信息流和反馈所引导。看似我们主动做出了选择，其实只是注定。</p>
<p>现在我们可以掌控此过程，主动建构自己的先验知识，通过学习改变我们的习惯、性格和思维模式，我们能够更加自主地选择信息来源和学习路径，审视这个过程，而不是无目的地被外部信息所左右。</p>
<p>进一步地，通过深入理解自我，我们可以重新审视和评估我们的学习目标和生活方向。这种自我反思的过程允许我们从之前未经审视的习惯和信念中解放出来，找到新的意义和目标。</p>
<p>在渐进学习中，我们主要通过提取练习、自我解释和创造性阐述这三种策略促进知识的建构。</p>
<h2 id=""世界知识的拼图游戏"">世界知识的拼图游戏</h2>
<p>文化与环境会导致我们每个人都会发展出独一无二的知识序列，也就是说，从出生开始，我们就拥有一个独属于自己的谜题，它是由基因、环境与文化构成的，它就是这个世界。</p>
<p>欢迎来到世界知识的拼图游戏！</p>
<p>在游戏里，我们拥有一个几乎无限的容量的长期记忆，用来保存各种经过组织的先验知识。</p>
<p>或许是为了有效地管理这些信息，并保护它们免受随机干扰，我们的认知架构限制了工作记忆，以确保长期记忆中的重要信息不被随机过程破坏<sup class=""footnotes-ref"" id=""footnotes-ref-32""><a href=""#footnotes-def-32"">32</a></sup>。</p>
<p>也就是说我们必须依赖有限的工作记忆来逐步处理、理解和整合新的信息。</p>
<p>在这里，我将会分享渐进学习的策略，它的侧重点在于记忆以及激活先验知识进行知识的建构。</p>
<p>在此之前需要我们先进行一些澄清，来破除一些固有印象。</p>
<h2 id=""渐进学习"">渐进学习</h2>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320203759-vgmfvk6.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""什么是渐进学习-"">什么是渐进学习？</h2>
<p>渐进学习中有两个大方向的策略，能帮我们建构知识，分别是：</p>
<ul>
<li>渐进阅读中的自我解释</li>
<li>渐进写作中的创造性阐述</li>
</ul>
<h3 id=""类比"">类比</h3>
<p>关于渐进学习有一个非常形象的类比，它来自 Georgios Zonnios<sup class=""footnotes-ref"" id=""footnotes-ref-33""><a href=""#footnotes-def-33"">33</a></sup>：</p>
<ul>
<li>
<p>假设我们竞相制作一些橙汁。</p>
</li>
<li>
<p>我们每个人都有一个水壶和大量的橙子，比赛是看谁能先装满他们的水壶。</p>
</li>
<li>
<p>我们每个人都采取不同的方法来赢得比赛：</p>
<ul>
<li><strong>方法 1</strong>：将每个橙子一个一个地挤压，直到它变干，然后继续前进。</li>
<li><strong>方法 2</strong>：只要橙汁流得快，就挤压每个橙子，但是一旦橙汁流得慢下来，就继续挤压下一个橙子，直到橙汁停止流动。</li>
</ul>
</li>
<li>
<p>虽然第二种方法可能会留下一大堆半挤的橙子，但罐子装满的速度要快得多。既然方法 2 要快得多，我们如何在学习中使用它？</p>
</li>
</ul>
<h4 id=""榨知机-渐进学习"">榨知机：渐进学习</h4>
<p>在学习过程中，我们的信息来源（比如书籍、生活经验和其他人）就像是橘子，而获得的知识就是橙汁。学习的目标是尽可能多地从我们的信息来源中榨取知识！</p>
<p>渐进阅读是由 SuperMemo 首创的一个旨在实现这一目标的过程。在渐进阅读中，你阅读文章的一部分，找到一两个好想法，然后继续前进，留下未完的文章。你对一篇又一篇文章重复这个过程，直到你觉得当天足够了。第二天回来时，你重复这个过程，许多半读的文章会再次出现，同时还会有全新的文章。</p>
<p>虽然这种方法起初听起来可能很疯狂，但橙汁的故事说明了它为什么实际上非常有效。你不再专注于你留下的半读文章，而是开始关注途中获得的知识。你停止关注“完成”书籍，开始关注你正在获得的洞见。</p>
<p>这种学习的真正效果要深远得多。我们不仅学得更快，而且当我们以这种方式阅读许多相关文章时，我们开始容易地在文章之间看到模式和结论，从而以一种比专注于单一作者的模型更复杂的方式建构我们自己的理解。</p>
<h3 id=""避免形式主义"">避免形式主义</h3>
<p>Georgios Zonnios 的类比指出一个关键点，我们去阅读一本书、听讲座的目的是想从中获取知识，但在进行这些形式的过程中，我们逐渐<strong>将注意力放在完成这些形式上</strong>，专注于读完一本书，热衷于搭建知识管理系统，却忽视了从中建构我们自己的理解。</p>
<p>举例来说，Andy 的常青笔记具有复杂的发展性，他能不断地去完善之前的笔记，这是因为他不断在阅读、思考，在建构自己的先验知识，先验知识带来了更高的洞察力，那么自然就会有产生独特的见解来去完善之前的笔记。</p>
<p>简单来说，如果你要学着像 Andy 一样发展笔记，<strong>前提是你得思考，才能对内容有想法</strong>：</p>
<ul>
<li>
<blockquote>
<p>我通常先开启写作收件箱，翻阅收件箱中的提示和不完整的笔记。<strong>如果有什么内容激发了我的想法</strong>，我便就此起草常青笔记。书写笔记的跨度可能不止一天：我可能把笔记大大充实一番，直到筋疲力尽，便将笔记存在收件箱里，改天再完成。</p>
</blockquote>
</li>
</ul>
<p>而发展常青笔记只是其中我们能观测到的一部分<sup class=""footnotes-ref"" id=""footnotes-ref-34""><a href=""#footnotes-def-34"">34</a></sup>。</p>
<ul>
<li>
<blockquote>
<p>我们容易把注意力集中在「做笔记」上，因为它是一个虚无缥缈的实践中的可见部分：如果你看到一个有洞察力的人在他们的笔记本上写东西，你可能会想，如果你得到一个合适的笔记本并把它整理好，你也会变得有洞察力。</p>
</blockquote>
</li>
</ul>
<p>这也是这篇文章的核心观点：以自己的先验知识为中心，将注意力放在发展想法、见解上。你越是确保个人的想法得到很好的整合，你就越有可能朝着智慧的方向努力。</p>
<p>为了避免我们陷入形式主义，有一个很好的检测方法，那就是没有快乐就没有好的学习。</p>
<p>这也衍生出维护动机的策略：<strong>如果你觉得分心或者无聊，就可以跳过</strong>。</p>
<p>利用学习中的快乐驱动策略的使用，如果没有快乐，那么接下来的这些策略你很难能去使用。</p>
<p>当你猎取到碎片完善了拼图，发现自己能逐渐理解越来越复杂的细节，乃至背后的模式，由衷地产生对知识碎片的渴望，就像是在渴望那肥美多汁的烤肉，那么祝贺你，同志，这就是我们走的路。</p>
<h2 id=""渐进学习中的策略-"">渐进学习中的策略：</h2>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320155404-zbb0avo.png?imageView2/2/interlace/1/format/webp""></p>
<p>渐进学习中有两个重要组成：渐进阅读和渐进写作，它们都离不开渐进处理，让我们先从渐进处理的凭依 SRS 说起。</p>
<h3 id=""SRS"">SRS</h3>
<h4 id=""什么是-SRS--"">什么是 SRS ？</h4>
<p>间隔重复系统（Spaced Repetition Systems），简称 SRS。它是指 Supermemo 等系统。</p>
<h5 id=""间隔重复系统和闪卡有什么不同-"">间隔重复系统和闪卡有什么不同？</h5>
<ul>
<li>我们常说的闪卡全称应是间隔重复记忆系统（Spaced repetition memory system），是 SRS 的一种应用，如 anki，具有专门的遗忘算法用来排期，将 SRS 和它区分开是为了以更广阔的视角开拓间隔重复的应用。</li>
<li>间隔重复记忆系统实际是由 SRS 和提取练习共同组成的。</li>
</ul>
<h4 id=""SRS-具有有什么用-"">SRS 具有有什么用？</h4>
<p>SRS 的自动排期功能可实现编程注意力，让时间轴上不同阶段的自己重复参与某个任务，只要是有趣的事物，你都可以拿来间隔，发送给未来的自己处理<sup class=""footnotes-ref"" id=""footnotes-ref-35""><a href=""#footnotes-def-35"">35</a></sup>。</p>
<p>SRS 的排期非常拿来做渐进形式化，将一个复杂的任务拆解为多个简单的任务，降低其中的复杂度、阻力与风险，在机会成本与时间成本中找到平衡。例如：</p>
<ul>
<li>SRS + 提取练习：通过回忆加强记忆，背后的机制是提取练习，和 SRS 结合能加强长期记忆，它需要独特的算法支持以最小的摩擦实现最大化收益，比如 FSRS 算法。</li>
<li>SRS + 阅读<sup class=""footnotes-ref"" id=""footnotes-ref-36""><a href=""#footnotes-def-36"">36</a></sup>：具有 SRS 支持阅读可实现无负担的速读、略读，可以专注于建构自己的理解，无需担心错过其中有价值的内容，也无需担心没有目标引导会导致过度碎片化，因为排期会让目标回到正轨。</li>
<li>SRS + 思考<sup class=""footnotes-ref"" id=""footnotes-ref-37""><a href=""#footnotes-def-37"">37</a></sup>：排期探索的问题、模糊的想法、主干想法，完善并从中积累思考。需要手动决策排期，比如有所得就要扩大时间间隔，增加时间去积累；无所得则要缩小时间间隔，将更多的注意力分配在这些想法上。</li>
<li>SRS + 习惯养成<sup class=""footnotes-ref"" id=""footnotes-ref-38""><a href=""#footnotes-def-38"">38</a></sup>：排期一些反思、思维模式以应用到生活中，默认间隔扩大。比如 <code>不要在情绪起伏大时做任何决定</code>、<code>当改稿时默念：不要追求完美</code>、<code>早起刷牙时我应该[...]</code>，甚至可以为它们编写一些提取练习的卡片，用以强化行为，在下方有更详细的策略介绍。</li>
<li>SRS + 程序性知识的练习：例如练习输入法、骑自行车、弹钢琴等程序类任务。程序性记忆很复杂，要进行到自动化阶段需要大量的练习，这需要你自己进行手动排期。</li>
<li>一些人（Andy、woz）会把邮件、任务、个人通讯加入 SRS 进行排期，在给他们发邮件时像是隔着时间长河在交流。</li>
</ul>
<p>Andy 将排期的内容的称为 prompts（提示、引导），这揭示了传统语义上闪卡的内在属性——能引导未来的我们进行一系列练习、思考。</p>
<p>我们可以将排期的内容看做发送给未来自己的任务，你可以要求未来的自己进行提取练习、改变习惯、思考某个问题，如此的制作思路就出现了——设计卡片即是设计任务，不同的任务拥有不同的机制，Andy 对此有个深刻的见解：如果某个 prompts（anki 里的卡片、supermemo 中的元素）「见效」了，那不是碰巧，而是因为你对该任务的执行，用某种有用的方式「改变」了自己。根据这点，我们值得花一点时间去了解这些「改变」背后的机制。这样就能有针对性地编制任务，并设计你想产生的改变了<sup class=""footnotes-ref"" id=""footnotes-ref-39""><a href=""#footnotes-def-39"">39</a></sup>。</p>
<p>例如：</p>
<ul>
<li>闪卡会生效是因为设计出来的任务引导我们进行了有效的提取练习</li>
<li>养成习惯的任务会有用是因为在设计时预构了事件，并强化我们在发生这种事件时“应该做什么”的行为</li>
<li>嵌入进文章的卡片会有效是因为它将读者的注意力重新引导回重点，就像一个专家向你共享了他的视角，告诉你“这是文章的脉络，这段文字中有价值的要点”、“这是必要的前置知识，不能错过”</li>
</ul>
<p>这些针对“未来自己”的任务设计才是 SRS 中的核心，也就是说 SRS 以两种方式编程使用者的注意力：</p>
<ul>
<li>自动排期——在时间线上的注意力管理，引导我们该将注意力放在当前发送过来的任务上</li>
<li>对任务的设计——接收任务提示，注意力被有效引导</li>
</ul>
<h3 id=""SuperMemo-中的渐进阅读-"">SuperMemo 中的渐进阅读：</h3>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320162038-o0ynxf0.png?imageView2/2/interlace/1/format/webp""></p>
<h4 id=""概括-"">概括：</h4>
<ul>
<li>渐进阅读的过程可以看作在不断地摘录和精炼文本，在最后一步将精炼后的文本挖空，进入主动学习。</li>
<li>不断地摘录和精炼文本可以概括为渐进地重新表述材料，它还有一个额外的好处，对文本的每一次编辑都需要进行一点自我解释，需要一点理解处理。如果沿着一个间隔的时间表进行，每一次编辑都会对理解力、知识凝聚力和长期记忆有一定的贡献<sup class=""footnotes-ref"" id=""footnotes-ref-40""><a href=""#footnotes-def-40"">40</a></sup>。</li>
</ul>
<h4 id=""导入材料"">导入材料</h4>
<p>我们可以将各种电子和非电子来源的材料导入进 SRS ，这样就变成了一个自动推送的阅读队列。</p>
<p>材料可以是一系列 PDF、网页、书籍、视频、音频、图片、电子邮件、评论、聊天记录、超链接等等任何你觉得有价值的内容。</p>
<h5 id=""导入策略-"">导入策略：</h5>
<h6 id=""勿要自动导入"">勿要自动导入</h6>
<ul>
<li>
<p>自主选择</p>
<ul>
<li>不应与 RSS 订阅混为一谈，渐进学习中<strong>自主选择</strong>是非常重要的，你要自己决定学什么、用什么策略，由于目前<strong>外界无法有效探测你大脑中的先验知识</strong>，所以最适合你的信息得由你自己选择，你觉得一篇文献有意思，那就手动加入阅读队列。</li>
</ul>
</li>
<li>
<p>情感动机</p>
<ul>
<li>自动导入会破坏你的情感动机：自动导入文章时，你会在阅读时看到很多与你不直接相关的内容。这些不相关的材料与那些你因为有强烈的情感联系而特意添加的内容混合在一起，冲淡了后者<sup class=""footnotes-ref"" id=""footnotes-ref-41""><a href=""#footnotes-def-41"">41</a></sup>。</li>
<li>自动导入文章时，阅读收件箱可能间歇地长得令人生畏。这使你不愿意打开它，从而让收件箱不那么可靠。</li>
</ul>
</li>
</ul>
<h6 id=""可以导入些快餐垃圾信息调节情绪"">可以导入些快餐垃圾信息调节情绪</h6>
<ul>
<li>
<p>什么是快餐垃圾信息？</p>
<ul>
<li>指那些一开始很吸引你，但是重复阅读几次之后发现没什么价值的信息。你可以把它看做阅读里的快餐短视频，满足下我们的信息饥渴症。</li>
</ul>
</li>
<li>
<p>为什么要这么做？</p>
<ul>
<li>SRS 里如果都是在排期旧卡片会让人感觉很枯燥，而提取练习又是个耗费情感动力的环节。很多新手会在初期制兴致满满制取大量新卡片，然后在复习环节被压倒，自此放弃使用 SRS。</li>
<li>在渐进学习环节，如果你在开荒一个新领域时情感动机消耗较大，而其它提供情感奖励的环节（创造性阐述）又没跟上导致动力不足，就可以刷些垃圾快餐信息调解下情绪。</li>
<li>在间隔重复记忆系统中，优化的关键是复习环节及其内容的情感联系<sup class=""footnotes-ref"" id=""footnotes-ref-42""><a href=""#footnotes-def-42"">42</a></sup>。</li>
</ul>
</li>
<li>
<p>会有严重后果吗？</p>
<ul>
<li>最坏的情况下就是会出现难点卡片提示，也就是 leech 提醒，对于 leech 正常建议就是改卡，次等建议是推迟，懒得思考 forget，寻思没用 dismiss，终极操作 delete<sup class=""footnotes-ref"" id=""footnotes-ref-43""><a href=""#footnotes-def-43"">43</a></sup>。</li>
</ul>
</li>
</ul>
<h6 id=""优先级处理"">优先级处理</h6>
<ul>
<li>在 supermemo 里导入时会有优先级处理，对知识进行一次重要性排序，使用 Alt+P 定义导入材料的优先级，摘录、挖空时会被继承。</li>
<li>使用百分比字段设定优先级，0% 是最高优先级，而 100% 是最低优先级。</li>
</ul>
<p>PS：在 supermemo 里进行摘录的元素会直接进入 SRS 开始排期，成为阅读队列里材料的一部分。在其它 SRS 里需要手动排期。</p>
<h4 id=""阅读"">阅读</h4>
<h5 id=""核心原则-"">核心原则：</h5>
<p><strong>渐进学习必须充满乐趣</strong>，一旦你感觉到任何无聊或分心的迹象，你就可以跳到下一篇材料，觉得材料难处理就可以先 <kbd>跳过</kbd>（搁置），<kbd>安排到队列末处理</kbd>，<kbd>重新安排复习日期</kbd>，一些 SRS 拥有这样的功能，在阅读时你也可以安排优先级。</p>
<h5 id=""速读策略-"">速读策略：</h5>
<p>SRS 能支持我们进行良好的速读，它能消除速读的最大瓶颈：丢失重要信息的恐惧<sup class=""footnotes-ref"" id=""footnotes-ref-44""><a href=""#footnotes-def-44"">44</a></sup>。</p>
<ul>
<li>SRS 阅读没有典型的随意速读所带来的负担。略读速度没有限制。你读得越多，读得越好。你越赶，浏览得就越多。渐进阅读强化了你对新事物的渴望，以及你吞噬知识的速度。</li>
</ul>
<p>Lain 对速读的经验<sup class=""footnotes-ref"" id=""footnotes-ref-45""><a href=""#footnotes-def-45"">45</a></sup>：</p>
<ul>
<li>快速把整个文章的重点框架先找出来，再细致的根据之前的决策阅读。</li>
<li>而由于普通人习惯线性阅读，这种阅读方式操作难度很大，因为你要一次性处理的东西特别多，对你的工作记忆和策略都是很大的考验。但渐进阅读由于可以让软件提示你和留存信息的缘故，实际上很容易实现了。</li>
<li>当你遇到跳过的章节，实际上你可以快速预览一遍，然后懂的话就直接操作，不懂就可以跳过，这样可以产生一些奇妙的化学作业，比如大脑对内容的预设，动机增强和对整体结构的另一种方向的理解。</li>
</ul>
<h5 id=""阅读策略总结-44-"">阅读策略总结<sup class=""footnotes-ref"" id=""footnotes-ref-44:2""><a href=""#footnotes-def-44"">44</a></sup>：</h5>
<h6 id=""根据自己的喜好平衡阅读速度和理解力"">根据自己的喜好平衡阅读速度和理解力</h6>
<ul>
<li>可以选择速读，去抓住知识的大纲。</li>
<li>可以在阅读时充分理解，同时留下复杂的细节或记忆巩固以备后用。</li>
<li>也可以专注于记忆，这随你高兴，一切都取决于你。</li>
</ul>
<p>在渐进阅读中，你可以快速浏览文本中不太重要的部分，而不用担心会漏掉一个细节。略读片段将安排在以后复习。您可以选择性地确定复习将在何时进行以及优先级。</p>
<p>你可以快速地从一个段落跳到另一个段落，得到整体的图景，摘录片段以便以后阅读，摘录片段以便详细研究，等等。</p>
<p>这种速读的方法，经过一些训练，是没有压力的。你将消除速读的最大瓶颈：对丢失重要信息的恐惧。当你将来回到浏览过的片段时，它们可能已经变得无关紧要或不那么重要了。</p>
<p>你总是把注意力集中在最重要的材料上，很少花时间去担心那些留给以后的事情。渐进阅读是一种没有理解障碍的速读。一旦你速读了整篇文章，你可以从一开始就慢慢地重新理解它。更多的时候，你会通过阅读最重要的片段来回顾它。</p>
<h4 id=""摘录"">摘录</h4>
<p>对你感兴趣的内容进行 <kbd>摘录</kbd>，摘录后的片段会继承原始文章的阅读算法。</p>
<p>摘录可以渐进进行<sup class=""footnotes-ref"" id=""footnotes-ref-45:2""><a href=""#footnotes-def-45"">45</a></sup>：</p>
<ol>
<li>阅读一段文本时先扫一眼，看到一整个自然段比较有用，就摘录（<kbd>Alt+X</kbd>）下来，然后分配一个优先级</li>
<li>等到下次遇到摘录的这一整个自然段，再细节地看看，决定先要哪段话，再摘录 <kbd>Alt+X</kbd></li>
<li>这个过程中进行了略读，可以粗略地了解整个文章的重点框架</li>
<li>再次遇到摘录的文本时可以决定要不要它，如果觉得有价值就可以进行挖空进行提取练习</li>
</ol>
<h4 id=""优化摘录措辞-重新表述文本"">优化摘录措辞，重新表述文本</h4>
<p>不断简化摘录的文本，以确保卡片能在最短的时间内让你大脑中的正确灯泡亮起来<sup class=""footnotes-ref"" id=""footnotes-ref-46""><a href=""#footnotes-def-46"">46</a></sup>，确保它们完全独立于上下文，没有冗余信息，易于阅读。</p>
<p>在这个过程中我建议每次处理时都尝试下自我解释，用自己的理解重新表述下内容，这样每次都能对知识建构做出一点贡献。</p>
<h4 id=""生成完形填空"">生成完形填空</h4>
<p>从这一步进入主动学习阶段，对简化后的文本使用 ALT+Z 进行挖空。</p>
<h4 id=""将完形填空转换为问答"">将完形填空转换为问答</h4>
<h4 id=""PS-supermemo-中摘录和问答排期不同"">PS：supermemo 中摘录和问答排期不同</h4>
<ul>
<li>挖空、问答等元素在的间隔重复记忆系统是依靠记忆算法驱动的排期。</li>
<li>其它元素（ topic ）则是单独一套排期，慢慢增加间隔。</li>
</ul>
<h4 id=""渐进处理"">渐进处理</h4>
<p>从阅读到摘录，再到生成完形填空和问答，每个过程都是渐进的。</p>
<p>新手可以遵循一记一动原则，每次重复只进行一个动作，或是优化文本，或是优先级制定，<strong>所有这些动作都可以分散在不同复习情景中</strong>，在繁重的复习任务中，某一条信息可能并不足够重要。如果这样的话，我们就不要再忙于设置格式和颜色了。这将节省大量的时间去干一些更重要的事情。</p>
<h5 id=""这种制卡是否会过于原子化-卡片太过孤立-"">这种制卡是否会过于原子化，卡片太过孤立？</h5>
<p>SuperMemo 中有四种上下文功能（类似于思源中的面包屑，提供上下文），所以可以利用上下文功能实现背景补充：</p>
<ul>
<li>
<p>摘录、挖空产生的知识树</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240311143047-gd2qyqt.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>引用来源</p>
<ul>
<li>
<blockquote>
<p><strong>在渐进阅读中，您总是需要快速回忆问题或文本的上下文。快速恢复上下文的最简单方法是添加引用。在摘录文本和制作完形填空时，引用</strong>会从一个元素传递到另一个元素。由于所有子级元素都是从同一个带有引用标记的给定文本生成的，因此您不必担心丢失上下文的问题。</p>
</blockquote>
</li>
<li>
<p>举例：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240311141905-7fu4ssr.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>返回父级</p>
</li>
<li>
<p>路径列表</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240311142359-nrm3mbt.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>当然，做提取练习的时候最有用的还是引用来源功能，有恰到好处的上下文提示。</p>
</li>
</ul>
<p>思源这类拥有列表大纲功能的双链软件则是利用面包屑实现上下文补充。</p>
<h4 id=""总览"">总览</h4>
<p>我们可以认为在书籍、文章中，作者表达的知识集合和读者脑中的知识集合存在着差值，我们将这个差值不严谨地命名为“语义距离”，用来指代知识集合之间的差距<sup class=""footnotes-ref"" id=""footnotes-ref-47""><a href=""#footnotes-def-47"">47</a></sup>。渐进阅读就是通过拆解材料将语义距离测量出来，划分为具体的学习步骤，类似于还原论。</p>
<p>而渐进阅读过程中的<strong>提取练习</strong>、<strong>自我解释</strong>和渐进写作中的<strong>创造性阐述</strong>则是其中要点，能帮助我们从先验知识上开始构建知识。</p>
<p>将 SRS 、阅读、处理材料、提取练习组合起来就是渐进阅读，它是由这几个步骤组成的：</p>
<ul>
<li>阅读文章</li>
<li>从文章中摘录关心的部分（topic）</li>
<li>优化摘录文本进行重新表述</li>
<li>生成完形填空（item，到这一步才是提取练习）</li>
<li>将完形填空（cloze）转换为问答（Q&amp;A）</li>
</ul>
<p>每个步骤都是在渐进处理，一旦感到无聊或注意力不集中，就立刻转到下个项目。根据我的经验这个过程会产生大量垃圾元素，只有少数被确定价值的内容会转变为问答：</p>
<ul>
<li>
<p>我有非常多想读的内容在 SRS 里</p>
</li>
<li>
<p>读这些内容时我生成了大量摘录（topic）</p>
</li>
<li>
<p>大多数摘录经过渐进后发现没什么价值，当作垃圾卡片删除或推迟</p>
<ul>
<li>一些单纯想记忆的摘录被直接制作为完形填空</li>
<li>一些摘录在渐进处理时触发“灵机一闪”，与我的先验知识发生联系，被制作为完形填空</li>
</ul>
</li>
<li>
<p>有些完形填空也在渐进优化措辞，部分感觉“有价值”的完形填空才会被我制作为问答。</p>
</li>
</ul>
<h3 id=""设计提取练习-retrieval-practice-的任务--Andy-的制卡经验分享"">设计提取练习（retrieval practice）的任务——Andy 的制卡经验分享</h3>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320162712-oj57v8k.png?imageView2/2/interlace/1/format/webp""></p>
<h4 id=""什么是提取练习-"">什么是提取练习？</h4>
<p>提取练习是指通过测试、自由回忆等方式从记忆中多次提取信息，因此提取练习效应(retrieval practice effect, RPE)也被称为测试效应(testing effect)。</p>
<p>提取练习是我们维护先验知识的重要策略，在渐进阅读里表现为完形填空和问答。</p>
<p>你可以将渐进阅读卡片（完形填空和问答）和“间隔复习卡片”区分看待，因为在渐进阅读里主动学习（提取练习）是最后一步，产生了些不一样的属性。不过它山之石可以攻玉，Andy 的经验我们也可以用在渐进阅读里。</p>
<h4 id=""提取练习有什么用-"">提取练习有什么用？</h4>
<p>提取练习促进了对学习材料的记忆，提高了再次回忆的能力。</p>
<h4 id=""提取练习有什么限制-"">提取练习有什么限制？</h4>
<ul>
<li>提取练习不受年龄限制，从学龄前儿童甚至到中老年人都有提取练习效应<sup class=""footnotes-ref"" id=""footnotes-ref-48""><a href=""#footnotes-def-48"">48</a></sup>。<sup class=""footnotes-ref"" id=""footnotes-ref-49""><a href=""#footnotes-def-49"">49</a></sup></li>
<li>提取练习对记忆的促进效应不是即时的，而是需要经过记忆巩固（比如睡眠）之后才会表现出来。</li>
<li>提取练习效应被证明适用于陈述性知识和概念性知识<sup class=""footnotes-ref"" id=""footnotes-ref-50""><a href=""#footnotes-def-50"">50</a></sup>。</li>
</ul>
<h5 id=""由于需要从记忆中提取-所以有个前提是先记忆"">由于需要从记忆中提取，所以有个前提是先记忆</h5>
<p>自然的学习是先理解再记忆，然后通过提取练习加强</p>
<p>关于这点，supermemo 的作者 woz 特别强调不理解就不要学习，要在记忆之前先学习<sup class=""footnotes-ref"" id=""footnotes-ref-51""><a href=""#footnotes-def-51"">51</a></sup>，这是因为提取练习可以看作是一种「维持状态」的方法——在你运用练习技巧之前，你必须处于足够好的状态<sup class=""footnotes-ref"" id=""footnotes-ref-52""><a href=""#footnotes-def-52"">52</a></sup>。</p>
<p>如果本身你的先验知识没有与内容发生联系，做提取练习的效果就会大打折扣，只是在孤立地强化你复习的细节。</p>
<p>这也是为什么直接使用别人的卡组进行记忆很困难，没有经过组织且孤立的卡片是糟糕的媒介，它无法激活你的先验知识来固定新的知识碎片，我们仍然需要良好且连贯的叙述材料<sup class=""footnotes-ref"" id=""footnotes-ref-53""><a href=""#footnotes-def-53"">53</a></sup>。</p>
<p>这时最好的选择是，我们使用先验知识与它发生联系加固它，记忆术、精细编码、自我解释等等都是可行的策略。</p>
<p>经过二十年的实践，在渐进阅读、渐进写作等新策略诞生后，woz 也修订了这点，认为<sup class=""footnotes-ref"" id=""footnotes-ref-46:2""><a href=""#footnotes-def-46"">46</a></sup>：</p>
<blockquote>
<p>随着渐进阅读的出现，规则已经被修改，并重新确定了优先级。渐进阅读中表述策略的改变：</p>
<p>建立理解可能是学习过程的一部分，在理解不充分的段落中挖空是可以接受的</p>
<p>对同一语句的不同表述进行多次挖空，往往可以替代记忆技巧（见：知识达尔文主义）。</p>
<p>为了实现个性化，在学习的文本中加入自己的故事，创造性地阐述。</p>
</blockquote>
<p>Andy 也认为可以翻转“先理解后记忆”的模式，先记忆后理解也是可行的，在此过程中记忆可以帮助创造某种理解<sup class=""footnotes-ref"" id=""footnotes-ref-54""><a href=""#footnotes-def-54"">54</a></sup>：</p>
<blockquote>
<p>当你尝试在一道简单的练习题中使用高斯定律时，感到很费劲。你不断地翻回去查看定义和示例。如果你能解决这个问题，以及其他几个问题，你会更深入地理解高斯定律。例如，你会直观地理解公式表面积分里点乘的结果。但是对材料的记忆不牢固，导致你很难解答这个习题。</p>
<p>如果你在几天内复习了相关的卡片，你就能将这些细节合并为更高层次的组块，并建立相关连接，这些连接会帮你在解决问题时以正确的时机提取到正确的知识细节。在做了一打习题后，你会对高斯定律的一些问题建立起解决过程上的自动化，这会使你更容易去解决更多问题，进而促进更多的理解。</p>
</blockquote>
<h4 id=""如何设计出有效的提取练习任务-"">如何设计出有效的提取练习任务？</h4>
<p>在设计提取练习的任务时，有两个要点：</p>
<ul>
<li>应能引导未来的你准确回忆起想要强化的细节</li>
<li>从材料中正确读出需要强化的知识</li>
</ul>
<h5 id=""设计出正确的提取提示"">设计出正确的提取提示</h5>
<ul>
<li>
<p>聚焦性：一次只聚焦一个细节</p>
<ul>
<li>
<p>例子：</p>
<ul>
<li>
<p>不够聚焦的任务提示 - 复杂且冗长</p>
<ul>
<li>
<blockquote>
<p>Q: 为什么间隔复习会有用？</p>
<p>A: 它利用了间隔效应和提取练习效应，通过主动回忆对记忆进行提取，提取的行为会强化记忆，并有策略地规划每次提取的时间间隔，有效地阻止遗忘。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>很多新手会做出这样的提示，对整段文字直接制作，这种提示关注的细节太多，无法准确提取记忆，其收益不如直接拆分为多张提示，虽然学习的数量增多了，但因为聚焦性容易提取，复习的总时间反而会变少，以致其益处远超于直接复习复杂的提示。</p>
</li>
<li>
<p>简化后的提示</p>
<ul>
<li>
<blockquote>
<p>Q：间隔复习利用了间隔效应和[...]？</p>
<p>A: 提取练习效应</p>
</blockquote>
</li>
<li>
<blockquote>
<p>Q：提取练习效应是怎么强化记忆的？</p>
<p>A: 提取记忆的行为会强化记忆</p>
</blockquote>
</li>
<li>
<blockquote>
<p>Q：间隔效应是如何帮助记忆的？</p>
<p>A: 接连的记忆强化可以让材料记得更牢</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>一致性：保证问题每次都能引导出相同的回忆</p>
<ul>
<li>
<p>例子：</p>
<ul>
<li>
<p>导致答案不一致的问题</p>
<ul>
<li>
<blockquote>
<p>Q：京剧演员张学敏出生于[...]年？</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>这个提示缺少了限制条件，实际上有两位名叫张学敏的京剧演员，我们在回答时会弄不清要提取的是哪个答案，解决方法也很简单，加上限制条件即可</p>
<ul>
<li>
<blockquote>
<p>Q：天津京剧院演员张学敏出生于[...]年？</p>
<p>A：1947</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Lain 对此的类比<sup class=""footnotes-ref"" id=""footnotes-ref-55""><a href=""#footnotes-def-55"">55</a></sup>：</p>
<ul>
<li>具有一致性的卡片一个问题只有一个答案，是标准的 I 字路。</li>
<li>当不一致时一个问题会有多个答案，从问题到答案会形成一个 Y 字型路，比如上面的例子。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>精确性：问题应能精确引导回忆，而非引起逻辑推理</p>
<ul>
<li>
<p>例子：</p>
<ul>
<li>
<p>不精确的问题</p>
<ul>
<li>
<blockquote>
<p>Q：为什么植物是绿色？</p>
</blockquote>
</li>
<li>
<blockquote>
<p>Q：糖醋排骨怎么做？</p>
</blockquote>
</li>
<li>
<blockquote>
<p>Q：思源怎么使用？</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>这样的问题太过模糊、笼统，同时要求提取的细节太多，所以想要加强的记忆不会全部被强力激活。它提取不出准确的记忆，有时答案只能根据已有记忆进行逻辑推理，而这种问题的答案也会随着回答者所处的时间、环境和思维方式变化而变化<sup class=""footnotes-ref"" id=""footnotes-ref-55:2""><a href=""#footnotes-def-55"">55</a></sup>。</p>
</li>
<li>
<p>不精确的问题就像是一个复杂的路网系统，没有清晰的指示。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id=""读出需要强化的知识"">读出需要强化的知识</h5>
<p>当你在某个领域具有丰富的先验知识时，阅读领域内的文章也会变得容易，你能轻松读出作者想要表达的意图，你只需要捕获其中你觉得有价值的内容。而当涉足不熟悉的领域时先验知识很难起作用，你会不知该如何下手。这里共享下 Andy 的策略，他是以刚接触某个领域完全没有基础知识的视角创作的，在某种程度上能帮到你<sup class=""footnotes-ref"" id=""footnotes-ref-39:2""><a href=""#footnotes-def-39"">39</a></sup>：</p>
<h6 id=""读出知识的结构"">读出知识的结构</h6>
<p>例如你想学会做一道菜，那么你应该：</p>
<ul>
<li>知道它的食材（主料、辅料、调料、火候）——事实性知识</li>
<li>知道如何它的做法步骤——程序性知识</li>
<li>知道其中的烹饪原理（例如糖色、焯水、腌制、酸甜平衡）——概念性知识</li>
</ul>
<h6 id=""对不同类型的知识使用不同的策略"">对不同类型的知识使用不同的策略</h6>
<h6 id=""事实类知识直接制卡-注意聚焦性-一致性和精确性"">事实类知识直接制卡，注意聚焦性、一致性和精确性</h6>
<blockquote>
<p>问：制作糖醋排骨时需要哪种「调味料」来提供酸味？</p>
<p>答：醋。</p>
</blockquote>
<h6 id=""清单-集合类知识卡片"">清单-集合类知识卡片</h6>
<p>避免直接提问集合，这类知识记忆成本很高，例如：</p>
<ul>
<li>
<blockquote>
<p>问：蒸发浓缩用到的主要仪器有？</p>
<p>答：蒸发皿、玻璃棒、烧杯、酒精灯、铁三角、坩埚钳</p>
</blockquote>
</li>
</ul>
<p>当做提取练习时，回忆的集合最怕变成无序，这样每次回忆都是不同的答案，不一致会导致记忆成本剧增。这类知识的对应策略是创建一组问题，并对选项分别挖空：</p>
<blockquote>
<p>问：蒸发浓缩用到的主要仪器有？</p>
<ul>
<li>？？？</li>
<li>玻璃棒</li>
<li>烧杯</li>
<li>酒精灯</li>
<li>铁三角</li>
<li>坩埚钳</li>
</ul>
<p>答：蒸发皿</p>
</blockquote>
<blockquote>
<p>问：蒸发浓缩用到的主要仪器有？</p>
<ul>
<li>蒸发皿</li>
<li>？？？</li>
<li>烧杯</li>
<li>酒精灯</li>
<li>铁三角</li>
<li>坩埚钳</li>
</ul>
<p>答：玻璃棒</p>
</blockquote>
<p>记得这种套卡不要动列表顺序，你应该总是让你的大脑以完全相同的方式来提取。</p>
<h6 id=""增强先验知识与知识的联系"">增强先验知识与知识的联系</h6>
<p>初次记忆时记不住怎么办？通过一些策略可以加强先验知识与内容的联系，使它更容易被记忆和回忆：</p>
<h6 id=""解释卡"">解释卡</h6>
<ul>
<li>在将事实类知识制卡后，有些时候我们会加入解释卡强化事实类知识，使其更有意义：</li>
<li>
<blockquote>
<p>问：为什么制作糖醋排骨要使用醋来提供酸味？</p>
<p>答：醋通过其酸性成分帮助软化肉质，使排骨更加嫩滑。</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：为什么蒸发浓缩需要用到玻璃棒？</p>
<p>答：玻璃棒用于搅拌溶液。</p>
</blockquote>
</li>
<li>在某些知识不容易记忆时可以考虑加入解释卡，它能避免你死记硬背，并帮你深入建立理解，比如在对程序性知识制卡时加入解释卡作用就很明显。</li>
<li>除了事实类，其它类型的知识也适用。</li>
</ul>
<h6 id=""精细编码-elaborative-"">精细编码（elaborative）</h6>
<p>常见的精细编码策略是记忆术，我常用的记忆术策略是故事法、缩写法、记忆桩法（数字桩、地点桩），例如：</p>
<p>故事法：</p>
<blockquote>
<p>问：蒸发浓缩用到的主要仪器有？</p>
<ul>
<li>蒸发皿</li>
<li>玻璃棒</li>
<li>烧杯</li>
<li>酒精灯</li>
<li>？？？</li>
<li>坩埚钳</li>
</ul>
<p>答：铁三角 助记-想象一个勇士用铁三角挡住了烈焰，而这烈焰来自一盏巨大的酒精灯。</p>
</blockquote>
<p>一次到位的数字桩：</p>
<p>假设你的 1~6 数字桩分别是火柴棒（1）、天鹅（2）、大山（3）、帆船（4）、钩子（5）、象鼻（6），那么记忆集合-清单类知识时就可以一次性将内容挂到桩上，然后排期进行提取，例如我是这么想象的：</p>
<ol>
<li><strong>蒸发皿</strong> - 想象一根直立的火柴棒下面放着一个蒸发皿，火柴棒正点燃下面的蒸发皿，蒸发皿里的液体开始冒烟。</li>
<li><strong>玻璃棒</strong> - 一只优雅的天鹅在嘴里叼着一根玻璃棒，它正在用玻璃棒轻轻搅动着湖中的水。</li>
<li><strong>烧杯</strong> - 想象一座巍峨的大山，山顶被雪覆盖，山脚下有一个小小的烧杯，就像是山脚下的一处秘密实验室。在这个实验室中，烧杯里正在进行着重要的化学反应，仿佛大山的力量都汇聚于此。</li>
<li><strong>酒精灯</strong> - 一只帆船在海上航行，它的动力来自于船底巨大的酒精灯，酒精灯的火焰让帆船前进。</li>
<li><strong>铁三角</strong> - 一把巨大的钩子挂着一个铁三角，铁三角在空中翻转，闪耀着光芒。</li>
<li><strong>坩埚钳</strong> - 一个巨大的象鼻卷起了一只坩埚钳，象鼻用坩埚钳轻轻夹起了一些神秘的物质。</li>
</ol>
<p>卡片则是这样：</p>
<blockquote>
<p>问：蒸发浓缩用到的主要仪器有？</p>
<p>答：</p>
<ul>
<li>蒸发皿</li>
<li>玻璃棒</li>
<li>烧杯</li>
<li>酒精灯</li>
<li>铁三角</li>
<li>坩埚钳</li>
</ul>
<p>助记 123456</p>
</blockquote>
<p>提取时按顺序数个 123456 回忆挂在上面的内容即可。</p>
<p>记忆术在之前又被称作艺造记忆<sup class=""footnotes-ref"" id=""footnotes-ref-56""><a href=""#footnotes-def-56"">56</a></sup>，可以视为一种人造联系，如果把先验知识看作一种框架能固定新的知识，那么记忆术就是一种伪框架<sup class=""footnotes-ref"" id=""footnotes-ref-57""><a href=""#footnotes-def-57"">57</a></sup>，在遇到完全无法联系的知识时使用记忆术能完成初次记忆，配合 SRS 进行提取练习就能记得持久。</p>
<p>PS：记得助记要写在卡背。</p>
<h6 id=""程序性知识卡片"">程序性知识卡片</h6>
<p>程序性知识列好步骤可以看作是清单-集合类知识卡片，我们可以使用对应的策略进行应对，例如下方是糖醋排骨的做法：</p>
<blockquote>
<p>问：</p>
<ol>
<li>锅洗净，加入少许食用油，下入冰糖开始熬糖色，用勺子背轻轻把冰糖敲碎，搅动冰糖，糖溶化后会出现白色的大泡泡。</li>
<li>用勺子背继续炒制，熬到出现小泡泡，由浅黄色变成深黄色。</li>
<li>？？？</li>
<li>下入排骨煸炒，炒到上色。</li>
<li>加入葱姜煸炒。</li>
<li>添入适量清水，没过排骨既可，盖上盖子炖煮。</li>
<li>炖到十分钟后拣出葱姜。</li>
<li>加入 50 克白砂糖，少许精盐，继续炖煮十五分钟。</li>
<li>最后收汁要开小点火，出锅前加少许陈醋闷三分钟。</li>
</ol>
<p>答：加入一大勺陈醋煸炒，小点火多炒一会，排骨上色会更好</p>
</blockquote>
<p>上面这张卡片是直接从菜谱上复制后制作的，你可以看到它细节冗余太多，以致不够聚焦，阻挡了核心动作，我们可以对其进行简化，并将重要的细节发送到新卡片上：</p>
<blockquote>
<p>问：</p>
<ol>
<li>炒糖色</li>
<li>？？？</li>
<li>下入排骨煸炒</li>
<li>加入葱姜煸炒</li>
<li>添入清水炖煮</li>
<li>十分钟后拣出葱姜</li>
<li>加入白砂糖、精盐，继续炖煮十五分钟。</li>
<li>收汁开小点火</li>
<li>出锅前加少许陈醋闷三分钟。</li>
</ol>
<p>答：加入陈醋煸炒</p>
</blockquote>
<p>一些细节卡片</p>
<ul>
<li>
<blockquote>
<p>问：糖醋排骨需要加入多少陈醋煸炒？</p>
<p>答：一大勺</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨炖排骨时加入多少清水合适？</p>
<p>答：没过排骨</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨糖放多少合适？</p>
<p>答：一斤排骨 50 克糖</p>
</blockquote>
</li>
</ul>
<p>对程序性知识的解释卡</p>
<ul>
<li>
<blockquote>
<p>问：为什么要捞出葱姜？</p>
<p>答：收汁会碎锅里</p>
</blockquote>
</li>
</ul>
<p>关键词制卡</p>
<p>对于程序性知识 Andy 还分享了“关键词制卡”策略：</p>
<blockquote>
<p>一个程序往往可以被分解为几个关键词：</p>
<p>重要动词是什么；</p>
<p>何时转移到下一个动作；</p>
<p>哪些是关键形容词、副词，以及关键的主语、宾语。</p>
</blockquote>
<p>他的意思是说对于常见的、已经熟知的动作可以不用关注，而应将注意力放在关键词上：</p>
<ul>
<li>关键动词</li>
<li>形容词</li>
<li>副词</li>
<li>关键主语宾语</li>
<li>动作之间跳转的条件</li>
<li>普遍的问题解决策略</li>
</ul>
<p>例如在糖醋排骨制作流程里，核心动词为“煸炒”和“炖煮”，而其他的词句则是围绕着这两个动作展开，这样我们就可以按照自己的理解重新设计出一套卡片：</p>
<ul>
<li>
<blockquote>
<p>问：糖醋排骨糖色炒至什么颜色时停止？</p>
<p>答：深黄色</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨在下排骨煸炒前还要煸炒什么？</p>
<p>答：糖色和陈醋</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨什么动作后加入清水开始炖煮？</p>
<p>答：煸炒完葱姜后</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨需要炖煮多少分钟？</p>
<p>答：25 分钟</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨在炖煮 10 分钟后应该做什么？</p>
<p>答：拣出葱姜</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：糖醋排骨收汁时是用大火还是小火？</p>
<p>答：开小点火</p>
</blockquote>
</li>
</ul>
<p>这套卡片强调了煸炒的原料（宾语）、煸炒糖色的要点、（普遍的问题解决策略：糖色炒到什么时候合适）什么时候炖煮（动作之间跳转的条件）。</p>
<p>在有些程序里，副词、形容词也很重要，比如在熬制高汤时“缓慢地加热”——副词“缓慢地”就要比动词“加热”重要。</p>
<p>Andy 还提到：</p>
<blockquote>
<p>有些程序相当线性，而更复杂的程序可能会有分支，包括特殊情况下的备选项。这样的谓词结构（<code>if (A&gt;B) {…}</code>，中的 <code>A&gt;B</code> 就是一个谓词，它决定了你走入下面哪一步） 往往值得写卡。</p>
<p>如果分支实在太多，你可以考虑画一个流程图。</p>
</blockquote>
<p>对于程序性知识，如果你是想要概括性的大纲，那么列个清单更方便。如果程序中的关键细节对你很重要，那么就用关键词制卡策略。</p>
<h6 id=""概念性知识卡片"">概念性知识卡片</h6>
<p>对于概念性知识，很多人喜欢直接对概念定义进行挖空，这样的卡片够简单也容易聚焦，但是这样的处理就是问题所在——我们并没有真正理解它，概念性知识并没有和我们的先验知识发生联系，我们找不到它的意义。</p>
<p>Andy 给出了处理概念性知识的一套模板视角，他认为：知道一个「概念」所指何物，与高中闪卡式的知识（例如「意大利语 “correre” 等于 “跑步” 」）不同。想要内化它，你需要了解组成概念的元素以及元素之间形成的结构。因此对于这类知识，我们的目标是设计一套卡片，联合起来，一起框定这个概念。</p>
<p>我个人感觉，跟在 RemNote 里使用概念描述符框架差不多，读者有兴趣的话可以去了解下。</p>
<p>Andy 以高汤这个概念举例：</p>
<ul>
<li>
<blockquote>
<p><strong>视角一：特性和倾向</strong>：什么让高汤之所以为「高汤」？对于高汤来说，哪些断言或描述「永远」/「有时」/ 「永不」为真？</p>
<blockquote>
<p>问：高汤通常是如何制作的？</p>
<p>答：在水中炖煮具有丰厚滋味的原料。</p>
</blockquote>
<blockquote>
<p>问：为什么高汤通常没有突出的味道？</p>
<p>答：为了使它们更广泛地兼容多种菜肴。</p>
</blockquote>
</blockquote>
</li>
<li>
<p><strong>视角二：辨析异同</strong>：要知道什么是高汤，就要知道它与其他近似概念的关系和区别。</p>
<blockquote>
<p>问：高汤与广义上的「汤」有什么不同？</p>
<p>答：普通的汤本身味道更完整；而高汤往往作为辅料。</p>
</blockquote>
</li>
<li>
<p><strong>视角三：部分和整体</strong>：有哪些高汤的具体例子？高汤是否有重要的「次级概念」？「高汤」是否是某类更广概念的次级概念？请想象一个概念和概念之间的韦恩图，虽然没有非常明确的边界。</p>
<blockquote>
<p>问：至少说出三个高汤的例子。</p>
<p>答：如鸡肉高汤、蔬菜高汤、蘑菇高汤、猪肉高汤。</p>
</blockquote>
<blockquote>
<p>问：高汤很少直接食用，它最好被认为是一种? （用乐高比喻）</p>
<p>答：积木。</p>
</blockquote>
</li>
<li>
<p><strong>视角四：原因和影响</strong>：高汤是「做什么」的？什么让它「实现那个效果」？它没有「做到什么」？「什么时候」用它？</p>
<blockquote>
<p>问：为什么餐馆使用高汤而不是水作为烹饪介质？（请说出两个原因）</p>
<p>答：增加味道，改善口感。</p>
</blockquote>
<blockquote>
<p>问：高汤是___的常见基础（至少说出两个）</p>
<p>答：e.g. 酱汁、汤、炖菜。</p>
</blockquote>
<blockquote>
<p>问：餐馆经常使用高汤作为烹饪媒介，而家庭厨师可能使用  <strong>？？？</strong> 。</p>
<p>答：水</p>
</blockquote>
</li>
<li>
<p><strong>视角五：意义和启示</strong>：「为什么」高汤很重要？它表示了什么？注意：请让这个概念对你有个人意义。</p>
<blockquote>
<p>问：哪种液体积木可以解释为什么简单的餐厅菜肴往往比家里的菜肴更美味？</p>
<p>答：高汤。</p>
</blockquote>
<blockquote>
<p>问：如果我注意到我在做料理时使用了水，我应该问自己什么？</p>
<p>答：「我应该用高汤代替吗？」</p>
</blockquote>
</li>
<li>
<p>注：最后这张卡是 Andy 用来改变行为的卡片，当获得有意义的知识时，如果从中获得了启示，产生了“或许我可以这么做会更好”的念头，那么就可以用 srs 尝试改变行为，这种用法在接下来中会详细介绍。</p>
</li>
</ul>
<h5 id=""改变习惯的卡片-58"">改变习惯的卡片<sup class=""footnotes-ref"" id=""footnotes-ref-58""><a href=""#footnotes-def-58"">58</a></sup></h5>
<p>设想下，你读到一篇文章，里面提出了具体的建议，在特定情况下非常有用，但当那一刻到来时你忘记了这个建议，还是依靠之前的习惯行动。</p>
<p>要解决这个问题，你可以使用 SRS 将这些思维模式安装到你的大脑中。这种方法通过创建特定情境下的提醒卡片来加强习惯，例如：</p>
<ul>
<li>
<p>我看到制作鸡蛋酱要加入生姜的建议，我想让我下次制作时想起这一点，那么我会这么写：</p>
<ul>
<li>
<blockquote>
<p>问：当我做鸡蛋酱时，我应该想到什么？</p>
<p>答：加入姜</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>当我做决定时，我想意识到我会有偏见，但当决定真正到来时，我完全忘记了它，于是我这样强化自己：</p>
<ul>
<li>
<blockquote>
<p>问：在哪些情况下我应该避免直接做出决定？</p>
<p>答：在未进行自我反问的情况下</p>
</blockquote>
</li>
<li>
<blockquote>
<p>问：在做决定前，我应该问自己什么？</p>
<p>答：我是否情绪激动？我是否存在偏见？</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>这种卡片要求我们设想具体的情况，然后针对具体情况进行设计，用以强化。</p>
<h4 id=""我们的视角"">我们的视角</h4>
<h5 id=""提取练习可以辅助开荒"">提取练习可以辅助开荒</h5>
<p>在世界知识的拼图游戏里，我们一般是通过大脑的嗅觉来猎取知识碎片，专注于建构自己的理解，不理解的内容处于较低优先级。但是也不免会出现涉足完全未知领域的情况，这种情况下我们的先验知识无法固定这些没有相同元素的碎片，这时提取练习就可以作为开荒的利器。</p>
<p>那些事实类知识的原文、术语、符号约定都可以利用 SRS + 提取练习进行记忆，为未来的学习奖励打下本钱。</p>
<h5 id=""提取练习可以拿来检测理解-维护先验知识"">提取练习可以拿来检测理解，维护先验知识</h5>
<p>在 SRS 里不理解的内容最后都会变为难点卡片，也就是 leech。这来自 SRS 的检测机制，当你无法通过卡片进行回忆时通常是两个原因<sup class=""footnotes-ref"" id=""footnotes-ref-55:3""><a href=""#footnotes-def-55"">55</a></sup>：</p>
<ol>
<li>单纯的记忆检索缺失，造成的原因通常是，该材料没有被输入过或者输入之后没有进行有效的处理造成了消散，比如材料与自己的先验知识没有任何联系。</li>
<li>产生了偏误，造成的原因通常是，处理的时候有问题，或者输出的时候有问题。而问题通常来自于干扰，干扰可能会导致竞争，导致被错误的记忆取而代之。</li>
</ol>
<p>当你多次提取错误的时候，一些 SRS 就会跳出提示，提醒你在某个“不合理”的卡片上浪费了大量的时间，造成了效率的浪费，这样我们就能通过提示注意到问题去找原因，是制卡信息不完善，还是先验知识不完善。</p>
<p>处理方式有：</p>
<ol>
<li>放置不管（不推荐）</li>
<li>觉得目前不适合学暂时先推迟</li>
<li>修改卡片让它更容易记</li>
<li>dismiss（取消排期），完全放弃不记</li>
</ol>
<p>这样难点卡片提示就像是自动运行的杀毒系统，每克服难点卡片一次，自己的理解或者是制卡策略就上升一次。</p>
<h5 id=""提取练习时可以发展有意义的联想-产生奖励"">提取练习时可以发展有意义的联想，产生奖励</h5>
<p>在 SRS 里进行提取练习的时候，大脑中某个先验知识会被激活放置在工作记忆里，这就容易产生有价值的联想：</p>
<ul>
<li>有时是将自己生活中有意义的事物与其联系起来</li>
<li>有时是之前激活的知识与目前激活的知识互相联系，在渐进学习里它被命名为创造性的阐述。</li>
</ul>
<p>这种方式使先验知识更紧密相连。</p>
<p>例如当我在提取出“注意力管理”这个想法时，突然意识到一直使用的列表大纲就是引导注意力的一种工具，我可以从这个角度来解释它。</p>
<p>这种创造性的联想是提取练习里仅有的情感奖励，在大多数情况下进行的提取练习是会耗费我们的动力。</p>
<h5 id=""提取练习可以作为情感义肢"">提取练习可以作为情感义肢</h5>
<p>学习新领域需要巨大的情感投入，没有足够的动机很难克服阅读无意义知识时的负面情绪，从某种意义上讲提取练习就像个情感义肢，帮我们创造实现理解所需的动力<sup class=""footnotes-ref"" id=""footnotes-ref-23:2""><a href=""#footnotes-def-23"">23</a></sup>。</p>
<p>当你走在渐进学习的路上，不断利用学习中的奖励驱动着自己前进，逐渐理解陌生的词句和概念，这样的经历会逐渐改变你的视角：挑战新领域、学习陌生的知识不再是长路漫漫，陌生的、无意义的词句不再代表负面情绪，它意味着学习的奖励就在其中，这是一种想要去理解的渴望。</p>
<h5 id=""在渐进学习中-通常不会直接制作提取练习的任务"">在渐进学习中，通常不会直接制作提取练习的任务</h5>
<p>在渐进学习里，“挖空”实际上是最后一步，如果我们直接将材料改写的话成本太高了，挖空的成本非常小，但是简化材料进行设计任务的成本太高。</p>
<p>新手经常遇到的情况是首次就想将制卡完成，付出巨大成本实现——然后隔段时间放弃。</p>
<p>所以最好渐进处理它，在机会成本与时间成本中尽可能找个平衡。</p>
<p>在渐进学习中有个原则是 one memory one action，也就是“一记一动”：每次复习都仅对知识的措辞进行少量修改，则可以实现最高的效率<sup class=""footnotes-ref"" id=""footnotes-ref-59""><a href=""#footnotes-def-59"">59</a></sup>。它要求每次遇到卡片只进行一步处理，不进行多次处理，这样就有缓和的余地了，我们的先验知识是在不断提升的，当前的知识水平不一定能让我们能圆满的执行任务，这时候和未来的自己达成平衡，主动让时间轴上的自己重复解决同一件任务是个优解。</p>
<p>例如在渐进阅读里是这么做的：</p>
<ol>
<li>阅读一段文本时先扫一眼，看到一整个自然段比较有用，就摘录（Alt+X）下来，然后分配一个优先级</li>
<li>等到下次遇到摘录的这一整个自然段，再细节地看看，决定先要哪段话，再摘录 Alt+X</li>
<li>这个过程中进行了略读，可以粗略地了解整个文章的重点框架</li>
<li>再次遇到摘录的文本时可以决定要不要它，如果觉得有价值就可以进行挖空进行提取练习</li>
</ol>
<p>这个过程代表你对这个知识的有效性经过时间沉淀可以认可，并开始转化成你自己的知识，渐进学习不是单纯的在于记忆卡片，而是在于给你的知识经过时间沉淀后，让你清楚地明白整个知识的架构后，再决定哪些是有价值的<sup class=""footnotes-ref"" id=""footnotes-ref-45:3""><a href=""#footnotes-def-45"">45</a></sup>。</p>
<p>Lain 对制卡的总结<sup class=""footnotes-ref"" id=""footnotes-ref-55:4""><a href=""#footnotes-def-55"">55</a></sup>：</p>
<p>总之，卡片的制作实际上包含了对知识的分解，提取和修改，本身就包含在学习和记忆的过程之中，当你试图“简单地”把卡片想当然地“批量化”、“模式化”时，就已经失去了一次深入学习和思考的机会了，只有当考虑不同个体，基于其自身的背景和思考方式，对知识通过不断的探索加深理解，在不断的修改卡片的内容和形式之后，当你作出了足够令自己满意的卡片时，其实也意味着你已经为最终记忆卡片内容打下了基础。</p>
<p>简单来说，制卡本身就是学习的一个过程，放弃对制卡的思考，就是放弃利用卡片学习本身。</p>
<h3 id=""渐进写作"">渐进写作</h3>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320162323-useiew2.png?imageView2/2/interlace/1/format/webp""></p>
<h4 id=""创造性阐述-Creative-elaboration-"">创造性阐述（Creative elaboration）</h4>
<h5 id=""什么是创造性阐述-"">什么是创造性阐述？</h5>
<p>创造性阐述一词始自 supermemowiki，在 2007 年 1 月，19 岁 的 Georgios Zonnios 在和 supermemo 开发者交流时首次用创造性阐述这个词来描述他自己使用渐进阅读的工作方式<sup class=""footnotes-ref"" id=""footnotes-ref-60""><a href=""#footnotes-def-60"">60</a></sup>：</p>
<ul>
<li>
<p>一些关键词</p>
<ul>
<li>topic：supermemo 中的元素，摘录卡片</li>
<li>SMIR：SuperMemo Incremental Reading，SM 渐进阅读</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>我在 SuperMemo 中输入我打算写的文章的要点作为 topic，然后提取它们为摘录。</li>
<li>当 SuperMemo 向我展示这些摘录时，我没有简化它们（就像你在尝试学习知识时所做的那样），而是使用我从 SMIR 中学到的新知识来阐述它们。</li>
<li>随着我知识的增长，我的文章也在增长，一些原始摘录可以进一步提取，以阐述各个观点。</li>
<li>当我满意时，我可以收集所有进行阐述的摘录（位于子项中）并将其带回父文章，从而产生一篇完善的文章。</li>
<li>问题是，我不希望单个片段的间隔增加到 200 或 300 天或更长时间，因为那样我可能永远无法完成这篇文章。所以我必须手动调整间隔。</li>
</ul>
<p>缓慢而渐进的方法来撰写文章（也可能在任何其他类型的创造性尝试中）的优点与常规 SMIR 相似。但是，由于创建过程在大多数方面与学习过程相反，我认为这个相反的过程可能需要自己的特征，尽管我不确定具体是什么，:)</p>
</blockquote>
<p>在 Georgios Zonnios 的语境里“阐述”是指使用新知识来解释旧知识，生成的新见解使新旧知识紧密相连。</p>
<p>你可以把创造性阐述当成自我解释的反面：</p>
<ul>
<li>
<p>创造性阐述是用新知识来解释旧的观点</p>
</li>
<li>
<p>自我解释是用先验知识来解释所学内容（新信息）</p>
</li>
<li>
<p>创造性阐述</p>
<ul>
<li>这个过程涉及将新获得的知识应用到已有的知识框架中，以解释或重新评估旧的观点、概念或信息。</li>
<li>它强调的是新知识对旧知识的影响和重新整合，可能会导致对旧知识的修正或扩展。</li>
<li>这种方式促进了创新思维和深层次学习，因为它要求个体不仅仅接受新信息，而且要主动地将这些新信息整合到现有的认知结构中。</li>
</ul>
</li>
<li>
<p>自我解释</p>
<ul>
<li>自我解释是指使用已有的知识来解释新流入的信息或概念，以便更好地理解和吸收这些新知识。</li>
<li>这个过程更多地依赖于个体对既有知识的调用和应用，以便于新知识的融入和理解。</li>
<li>自我解释有助于加深对新信息的理解，通过与已有知识的联系来促进记忆的形成。</li>
</ul>
</li>
<li>
<p>关键区别在于它们各自侧重的方向不同。使用新知识来解释某个观点更多地关注于如何将新的理解和视角应用到旧的概念上，而自我解释则侧重于用先验知识来理解和吸收新的信息。</p>
</li>
</ul>
<p>我们设计提取练习时也涉及到对原文的解读，这个过程也可以看做是自我解释。</p>
<p>它们的有效性都可以用生成效应（Generation effect）和精细编码（Elaborative encoding）来理解它为何有效。</p>
<p>它们都是我们进行知识建构的大方向策略。</p>
<h5 id=""创造性阐述有什么用-"">创造性阐述有什么用？</h5>
<p>创造性阐述会对先验知识进行组织，扩展了知识的使用场景。</p>
<p>当然最重要的是，它能在知识与知识给生活带来的价值之间找到明确的联系，也就是建构了意义，如此学习的奖励也会被提高，知识的渴望也就随之而来，你知道的越多，你就想知道更多。</p>
<p>例子：当你把本文提到的认知知识与自身经验相结合时，便能更有效地监控并管理自己的认知过程，从而做出更明智的决策。</p>
<h5 id=""如何进行创造性阐述-"">如何进行创造性阐述？</h5>
<h6 id=""思考"">思考</h6>
<p>SuperMemo 开发者 woz 在之后总结了和 Georgios Zonnios 的交流，将其命名为“创造性阐述”<sup class=""footnotes-ref"" id=""footnotes-ref-61""><a href=""#footnotes-def-61"">61</a></sup>：</p>
<blockquote>
<p>创造性阐述这一过程利用创造力来产生新想法从而扩展知识，其中不需要输入新信息。</p>
<p>在创造性阐述中，新知识是有益的，但并不是必须的。新知识可以渐渐流入，为被阐述的语义框架带来新的见解。</p>
<p>我们思考时便无时无刻不在进行创造性阐述，而我们睡觉时也是。这一过程是概念化过程的关键一环。</p>
<p>在渐进阅读时可以把创造性阐述记录下来，可以是对现有元素的笔记和批注，也可以是单独条目。</p>
</blockquote>
<p>创造性阐述发生在思考中，通过内在的思考过程，重新组合和解释已有信息来创造新的理解和概念。</p>
<h6 id=""写作促进我们进行创造性阐述"">写作促进我们进行创造性阐述</h6>
<p>Georgios Zonnios 所描述的步骤是渐进写作的雏形，而写作这种形式能促使我们进行阐述，它像一种推力，促使我们使用先验知识去“解释”要表达的观点，其本质在于解释。</p>
<h6 id=""提取练习时适合进行创造性阐述"">提取练习时适合进行创造性阐述</h6>
<ul>
<li>
<p>提取记忆时产生联系</p>
<ul>
<li>
<p>在 SRS 中进行提取练习时非常适合进行创造性阐述，被激活的知识与之前被激活还没消散的知识在工作记忆中碰面，触发灵机一闪，产生新的见解。</p>
</li>
<li>
<p>Andy 也注意到了这点，在他的笔记中提到<sup class=""footnotes-ref"" id=""footnotes-ref-62""><a href=""#footnotes-def-62"">62</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>当你在间隔重复记忆系统中复习卡片时，你给自己一个机会，根据你当前的上下文和复习过程中产生的不同想法形成新的联系。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>自动化记忆帮助思考</p>
<ul>
<li>从另一个角度讲，SRS + 提取练习组成的间隔重复记忆系统能让记忆更加自动化，从而有助于更深入的琢磨思考。它们有效地将学习中基础但需要死记硬背的知识自动化，以便你可以专注于更有趣、有意义或概念性的知识。<sup class=""footnotes-ref"" id=""footnotes-ref-63""><a href=""#footnotes-def-63"">63</a></sup>。</li>
</ul>
</li>
</ul>
<h6 id=""而相应的-渐进阅读时容易进行自我解释"">而相应的，渐进阅读时容易进行自我解释</h6>
<ul>
<li>
<p>渐进处理材料时进行自我解释</p>
<ul>
<li>渐进的重新表述材料还有一个额外的好处，对文本的每一次编辑都需要进行一点理解处理。如果沿着一个间隔的时间表进行，每一次编辑都会对理解力、知识凝聚力和长期记忆有一定的贡献<sup class=""footnotes-ref"" id=""footnotes-ref-40:2""><a href=""#footnotes-def-40"">40</a></sup>。</li>
</ul>
</li>
<li>
<p>设计提取练习任务是在进行自我解释</p>
<ul>
<li>编写卡片实际上是一种自我解释的行为。深入而有意义的编写卡片通常有助于更深层次地加工文本内容。它通常包括构建过程，比如当卡片中包含文本中没有直接表述的推理时。它也可能涉及到整合过程，例如当卡片把文本的不同部分联系起来，或者将文本内容与先前的知识相连时<sup class=""footnotes-ref"" id=""footnotes-ref-64""><a href=""#footnotes-def-64"">64</a></sup>。</li>
</ul>
</li>
</ul>
<p>创造性阐述是渐进写作的核心，能创造性地扩展所获得的知识。</p>
<h4 id=""什么渐进写作-"">什么渐进写作？</h4>
<p>Georgios Zonnios 所描述的步骤是渐进写作的雏形，揭示了核心步骤：</p>
<ul>
<li>编写文本</li>
<li>创造性阐述</li>
<li>渐进处理</li>
</ul>
<p>渐进式写作的核心是随时间推进而逐步强化先验知识与文章结构。</p>
<p>在本文里，我将渐进写作拆分为定向写作和非定向写作。</p>
<h4 id=""supermemo-里的渐进定向写作"">supermemo 里的渐进定向写作</h4>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320164515-djjfsfs.png?imageView2/2/interlace/1/format/webp""></p>
<p>woz 后来将 Georgios Zonnios 所描述的步骤完善，在 supermemo 里实现渐进定向写作：</p>
<ol>
<li>
<p>导入</p>
<ol>
<li>
<p>将所有补充材料导入进集合</p>
</li>
<li>
<p>在集合根目录下创建一个分支，用自己的文章结构命名</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313092930-tn043ch.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>将所有补充材料保存在一个单独的分支中（例如 TODO)</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313093046-1l9al8h.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ol>
</li>
<li>
<p>发展文本逻辑结构</p>
<ol>
<li>
<p>以渐进方式查看编写的文章分支，重写、改进和重建文章结构以组织整体逻辑</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313095146-3s1ib2j.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>添加图表、引文、链接等</p>
</li>
<li>
<p>以渐进方式查看、处理 TODO 分支。</p>
<ul>
<li>通过复制、粘贴、移动的方式将渐进处理的文本从 TODO 分支移动到知识树中的“文章”分支。将摘录附加到树状结构中的正确分支。重新安排和重新确定较不相关文本的 <kbd>优先级</kbd>。删除在最终文章中将无用的文本。</li>
</ul>
</li>
</ol>
</li>
<li>
<p>进入排期</p>
<ul>
<li>
<p>使用渐进学习，进入排期，完善先验知识和创作结构。</p>
<ul>
<li>创作的文章分支和 TODO 分支中的元素会自动排期到你眼前，排期顺序只受材料 <kbd>优先级</kbd>的限制。专注于一张摘录卡片时，只进行有必要的操作，或者你喜欢的操作。可以一次性完成摘录卡片的处理，或者你只处理其中的一句话，然后再下一次再处理其他的。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>管理排期</p>
<ol>
<li>使用 <kbd>Mercy</kbd> 将多余的材料重新分配到可管理的部分（Mercy 是 SuperMemo 中重定排期计划的功能，比如可以设定 300 张卡片在 10 天内完成）</li>
<li>使用 <kbd>模板</kbd>直观地标记文章各个部分的状态（例如，“要编写”、“要展开”、“要重写”、“要复习”、“已完成”等）</li>
<li>超出可管理性的分支可以用与整篇文章相同的方式处理，包括 <kbd>筛选组复习</kbd>、<kbd>知识树重组</kbd>、<kbd>摘录卡片的提取和合并</kbd>等。</li>
</ol>
</li>
<li>
<p>导出</p>
<ul>
<li>一旦工作基本完成，或者期限逼近，使用 export &gt;&gt; Document（在 contents 菜单上）导出文章分支，它会自动添加一个目录。</li>
</ul>
</li>
</ol>
<p>如果说渐进阅读是提供了新知识的流入，那么渐进写作就是促进先验知识进行重组，我们可以这么看：</p>
<ul>
<li>渐进阅读——分析，自我解释，提供新知识流入</li>
<li>渐进写作——综合，创造性阐述，重组先验知识</li>
<li>渐进式写作的核心是：随时间推进而逐步强化模型（先验知识）与文章结构。其完善形态可以概括为四个步骤：写作、回顾、学习与创造性阐述<sup class=""footnotes-ref"" id=""footnotes-ref-65""><a href=""#footnotes-def-65"">65</a></sup>。</li>
<li>woz 所给出的写作流程是<strong>定向</strong>的，也就是有一个具体“写作对象”，已经有了写作目标。在双链的写作流程里有自然生长的<strong>非定向写作</strong>，我们的写作目标是会从日常思考里有机地涌现，在初期是没有写作大纲。</li>
<li>SuperMemo 里写作功能较为传统，但 SRS 的功能又是第一完善，所以在这里会重点介绍下 SRS 结合双链发展非定向写作的流程。</li>
</ul>
<h4 id=""SRS---双链---渐进非定向写作"">SRS + 双链 = 渐进非定向写作</h4>
<h5 id=""序言"">序言</h5>
<ul>
<li>roam 开创的双链流程非常有趣，但我在分享时发现一个矛盾，<strong>大多数人用双链做信息之间的链接</strong>，这完全没什么作用，专注于关键词、知识点的互相关联挺累人且看不出有何益处，这或许是目前笔记社区的矛盾：热衷于一些短视的、生活黑客式框架，聚焦于这些类似的问题：「我应该如何组织我的笔记？」，「我应该使用什么样的笔记本？」，「我怎样才能更容易提取我所读的片段到笔记？」等等<sup class=""footnotes-ref"" id=""footnotes-ref-34:2""><a href=""#footnotes-def-34"">34</a></sup>。</li>
<li>如果你的目标是追求拥有“卓越的洞察力”、“深邃的思想”、“强大的动机”，那么就不要耗费动力维护在软件里的信息，它们只是我们维护先验知识时的副产物。</li>
<li>在第一次漫游<sup class=""footnotes-ref"" id=""footnotes-ref-5:3""><a href=""#footnotes-def-5"">5</a></sup>里我们探讨了双链流程中的渐进特性，这一特性更贴合我们的思维模式和先验知识，有助于我们轻松地进行思考。也就是说，要使双链流程发挥作用，首要任务是思考。</li>
</ul>
<h5 id=""双链的非定向渐进流程--自由发展先验知识"">双链的非定向渐进流程——自由发展先验知识</h5>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320165110-u6vcfn8.png?imageView2/2/interlace/1/format/webp""></p>
<h6 id=""每日的思考空间-DailyNotes-66"">每日的思考空间 DailyNotes<sup class=""footnotes-ref"" id=""footnotes-ref-66""><a href=""#footnotes-def-66"">66</a></sup></h6>
<ul>
<li>
<p>什么是 DailyNotes？</p>
<ul>
<li>DailyNote 是双链软件中以日期命名的页面，双链的用户会在这里开始写笔记，在思源里用 <kbd>ALT+5</kbd> 打开。</li>
</ul>
</li>
<li>
<p>DailyNotes 有什么用？</p>
<ul>
<li>
<p>思考空间</p>
<ul>
<li>
<p>它可以用来记录一天的思考、临时工作等，你可以将它看作一个大型草稿纸，一个有意的倾倒场，一个释放阀，它是笔记中的最底层，时可以无阻力存放任何内容的空间。</p>
</li>
<li>
<p>当我们将一天的思考记录在里面时，当天的事件记录就会自然形成一种索引，例如：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313172100-57j7zd8.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>它的事件索引特性也导致了即使我们要创建一个新的文档块，也应该在 DailyNotes 里进行，这样能通过上下文线索回想起当时为何创建它。</p>
</li>
<li>
<p>进入别的文档块进行写作时也同理，喜欢的话可以留下个事件记录，例如：</p>
<ul>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313175328-vdos3q1.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>当产生琐碎的想法就可以写在事件下面，而非再找个地方进行记录：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313175440-4s617lp.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>这些事件记录可以当做一种锚点，它能激活我们的先验知识，这衍生出两个用处：</p>
<ol>
<li>
<p>能让我们利用事件记忆来检索内容，例如我记得思源社区进行的几个有趣的讨论，当我想寻找与之有关系的人物资源时，我会从这些“讨论事件”着手。</p>
<ul>
<li>例如我想找思源社区 Clouder 老铁开发的 anki 小工具，但是我当时又没有记录具体地址，于是就通过之前的讨论事件<a href=""https://ld246.com/article/1636729600143"">哈桑式 DailyNote 工作流整理之难</a> 入手找到他的账号，通过翻阅发布的帖子找到了这个小工具 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fclouder0%2Fsiyuan%2F20210725174248-ypq60fb"" target=""_blank"" rel=""nofollow ugc"">AnkiLink 对接思源开发笔记</a></li>
<li>在这个过程中，“事件”就变成了先验知识锚点。</li>
</ul>
</li>
<li>
<p>能激活当时思考的上下文，延续之前的思考并进一步增强了理解。</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>从中提取有用的想法进行完善：</p>
<ul>
<li>
<p>当有些想法看起来有趣想对其进行完善时，可以使用双链将它们发送至写作收件箱，例如：</p>
<ul>
<li>
<blockquote>
<p>* 读 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Ffunctoreality.github.io%2Fblog-pkm%2Fcontents%2FMOC%25E7%259A%2584%25E7%25BB%2584%25E7%25BB%2587%2F"" target=""_blank"" rel=""nofollow ugc"">MOC 的组织 | 笔记系统？方法论？</a></p>
<ul>
<li>[[写作收件箱]]</li>
<li>某些长文直接导出思源的源文件进行分享似乎更好</li>
<li>线性阅读得考虑读者的工作记忆</li>
<li>设计出适合阅读的思源源文件分享</li>
<li>[[列表大纲]]的折叠功能辅助阅读</li>
<li>直接分享工作空间，将闪卡分享过去？</li>
</ul>
</blockquote>
</li>
<li>
<p>上面是源码模式，在思源里它是这样的：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240313175440-4s617lp.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h6 id=""空白节点-67"">空白节点<sup class=""footnotes-ref"" id=""footnotes-ref-67""><a href=""#footnotes-def-67"">67</a></sup></h6>
<h6 id=""什么是空白节点-"">什么是空白节点？</h6>
<ul>
<li>在双链里有很多空白的文档块，虽然正文没有任何内容，但是其上下文反链有很多妙用。</li>
</ul>
<h6 id=""空白节点有什么用-"">空白节点有什么用？</h6>
<ol>
<li>
<p>隐式定义节点——理解的发展</p>
<ul>
<li>
<p>在双链里，由于上下文反链的特性诞生了一种新用法：我们在理解和定义一个概念时，不必从其内涵性定义着手，而是可以借助于反向链接的集合来进行，也就是外延定义——通过列举所有被定义事物的实例或案例来进行定义。</p>
</li>
<li>
<p>内涵定义则是通过描述事物的内在特性或属性来定义。</p>
</li>
<li>
<p>举个例子：</p>
<ol>
<li>
<p>创建概念节点但不直接定义</p>
<ul>
<li>我在刚接触对战游戏时，“节奏”这个词经常被提到，但是我并不理解它是什么意思，即使有人向我解释我也无法理解它有什么意义，对我有什么用。</li>
<li>于是我创建了名为“节奏”的文档块，在这个阶段，我没有对它进行任何直接的、内涵上的定义，即不写下“节奏是……”这样的描述，它是完全空白的。</li>
</ul>
</li>
<li>
<p>通过链接进行外延定义</p>
<ul>
<li>随后，每当我遇到任何能触发对“节奏”概念的思考的信息时——无论是看到格斗游戏中的攻防节奏、立回，星际争霸比赛中的 timing，DOTA 比赛中的视野控制和抓人时机，还是 <kbd>渐进学习</kbd>时产生的想法，我都会在 DailyNotes 里向“节奏”这个空白节点创建链接，以此记录下我当时的思考和具体上下文。</li>
</ul>
</li>
<li>
<p>反链的积累</p>
<ul>
<li>
<p>随着时间的推移，我记录了过去大量的思考和思考的上下文，例如：</p>
<ul>
<li>“雪碧战队通过视野避战放缓节奏”</li>
<li>“早期的小规模团战可以加快游戏节奏”</li>
<li>“通过控制地图视野资源来减缓节奏”</li>
<li>“1V1 对战时加速进攻可以打乱对手的节奏，不让其进入舒适区”</li>
</ul>
</li>
</ul>
</li>
<li>
<p>隐式定义的形成</p>
<ul>
<li>通过这些不同情境下对“节奏”的提及，我开始形成对“节奏”这一概念的隐式理解。即使最开始我没有给“节奏”一个明确的定义，通过查看所有提到“节奏”的笔记（即反向链接），我可以看到“节奏”在游戏中如何通过控制战斗频率、经济发展、地图控制等方面影响游戏的进程。</li>
</ul>
</li>
</ol>
</li>
<li>
<p>上下文反链的重要性</p>
<ul>
<li>在这个过程中上下文反链是非常重要的设计，单纯的反向链接列表对于隐式定义节点不够有效，能查看反向链接的上下文是有必要的，因为需要理解暗指的内容<sup class=""footnotes-ref"" id=""footnotes-ref-67:2""><a href=""#footnotes-def-67"">67</a></sup>。</li>
<li>上下文反链可以看到这些链接出现的具体上下文，这意味着我可以看到每个链接在其原始笔记中的具体内容和位置，从而理解该链接是如何与“节奏”这个概念相关联的。</li>
<li>比如某个笔记可能详细描述了一次成功的抓人行动如何帮助团队加快了中期游戏的节奏，从而获得了地图控制权和资源优势。这样的具体实例提供了关于“节奏”如何在实际游戏中操作的上下文信息，激活了我的先验知识，进一步增强了对其的理解。</li>
<li>从这也可以看出，学习并非仅仅基于对概念和事实的定义，而是基于学习者对知识和意义的构建，我们的先验知识是通过在不同情境中构建知识而形成的。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>先验知识锚点</p>
<ul>
<li>
<p>一些专业术语、书籍名、人物名、文献标题名可以用空白节点，也可以利用 <kbd>列表大纲</kbd>简单写一点东西。它们基本上不会随理解而发展，多数是提供信息给其它笔记，它们有两个作用：</p>
<ul>
<li>
<p>提供汇总信息的空间，以便能查看反链，例如：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240315135927-ltcib0c.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>提供反链筛选的信息，方便激活先验知识进行定位，例如下图里的 <kbd>John Sweller</kbd>：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240315133002-n82sbmm.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h6 id=""空白节点块注意事项"">空白节点块注意事项</h6>
<p>无需整理，向上发展</p>
<ul>
<li>
<p>通过表达促进学习，不一定要输出发表。</p>
</li>
<li>
<p><strong>大多数人没有写作成文输出发表的需求</strong>，我们也只是利用写作中解释、表达的推力来促进思考，那么大多数情况下的操作是这样的：</p>
<ul>
<li>思考后产生了新的理解</li>
<li>链接到空白节点</li>
<li>时不时点进去查看反链，汇总之前的思考和上下文</li>
</ul>
</li>
<li>
<p>当你有确切的写作目标，比如年终总结、教程分享之类的，到时候再列大纲引用之前的思考，组织成文。但是没必要去分类整理，这种过程会损耗你的学习动机，你会遇到大家已经踩过的矛盾：对目标的理解随着尝试完成而不断发展，执行整理就像提前关闭了这些想法，失去了发展它们的机会<sup class=""footnotes-ref"" id=""footnotes-ref-5:4""><a href=""#footnotes-def-5"">5</a></sup>。</p>
</li>
<li>
<p>Andy 对此的看法<sup class=""footnotes-ref"" id=""footnotes-ref-68""><a href=""#footnotes-def-68"">68</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>更糟的是，如果预先明确划分类别，这些类别之间的边界必然是模糊的。不是所有事情都能<strong>精准地</strong>归类。也许一旦积累足够多的新想法，新的类别又冒出来了......只是你看不到它的新形状，因为一切都已经被分类了。此时，进一步的分类需要拆现有的结构。</p>
<p>最好是让关联的想法所形成的网络逐渐涌现，不加任何标签：让思想和信念有机地涌现。一旦你能看到形状，那么你就可以思考它的特征了。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>FLY 的评论：</p>
<ul>
<li>
<blockquote>
<p>对第一个问题，首先我觉得要思考：为什么要整理？要整理什么内容？视频里面的笔记方法是自底向上的，和传统的自顶向下的笔记方法是完全不同的思路，最底下的“碎片”这一层肯定是非常乱的，而且没有整理的必要的，放在原处就好，我们需要做的是以这一层为起点，向上走进行发展。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>和 zhangzz 的对话：</p>
<ul>
<li>
<blockquote>
<p>哈桑是输出比较多，和我们不一样。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h6 id=""页内反链和筛选"">页内反链和筛选</h6>
<ul>
<li>有了<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2FWetoria%2Fsy-plugin-enhance"" target=""_blank"" rel=""nofollow ugc"">思源笔记增强插件</a>之后，思源终于有了页内反链，页内反链对于空白节点的用法来说非常好使，并且能通过锚文本来进行筛选。</li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240315120612-9hx5k5u.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
<h6 id=""写作收件箱--非定向写作-从无到有"">写作收件箱——非定向写作，从无到有</h6>
<p>什么是写作收件箱？</p>
<ul>
<li>在思源里一个名为“写作收件箱”的空白文档块，只有标题，可以用来接收一些有趣的、有雏形的思考。</li>
</ul>
<p>写作收件箱怎么用？</p>
<ul>
<li>
<p>搭配 SRS 实现渐进思考</p>
<ol>
<li>
<p>收集想法</p>
<ol>
<li>
<p>在阅读、谈话、散步时产生了有趣的想法、灵光一闪就可以使用双链将其发送到 <code>[[写作收件箱]]</code></p>
<ul>
<li>出门在外时我会记录到手机备忘录里，Andy 是携带了口袋便签和笔来记录这些<sup class=""footnotes-ref"" id=""footnotes-ref-69""><a href=""#footnotes-def-69"">69</a></sup>，等回到家时再转移到 <code>[[写作收件箱]]</code>。</li>
</ul>
</li>
<li>
<p>如果你想进行一些表达，打开“写作收件箱”文档块查看其反链，找到有趣的、触动你的想法进行完善，添加你对它的思考</p>
<ul>
<li>在反链里使用 <kbd>ALT+ 拖拽</kbd> 块引用到当天的 DailyNotes 里，在 DailyNotes 里对其进行完善</li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/拖拽为块引用_1-20240320104538-wfwapf9.gif""></li>
<li>感觉表达吃力了就停下，一般这时候积累的思考已经表达完了，可以等思考成熟了再来。</li>
</ul>
</li>
</ol>
</li>
<li>
<p>将想法加入 SRS 进行完善</p>
<ol>
<li>
<p>完成第一次完善后的想法加入 SRS</p>
<ul>
<li>我会复制块超链接加入 supermemo 里，渐进学习时会使用<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgetquicker.net%2FSharedaction%3Fcode%3Def170835-2df5-4f25-c72a-08d980c1360f"" target=""_blank"" rel=""nofollow ugc"">这个动作自动打开超链接</a></li>
<li>思源里可以直接 Ctrl+alt+F 制卡</li>
</ul>
</li>
<li>
<p>如果某个想法你感觉有趣，但是当前积累的思考不足以完善它，也可以加入 SRS</p>
<ul>
<li>写作收件箱里的反链在加入 SRS 后，可以将 <code>[[写作收件箱]]</code> 的块引用转换为链接，这样就不会在反链里出现</li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314104519-yz4btfw.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>在 SRS 里遇到发送过来的想法后，如果有新的理解，继续使用 <kbd>ALT+ 拖拽</kbd> 块引用到当天的 DailyNotes 里，在 DailyNotes 里对其进行完善</p>
</li>
</ol>
</li>
<li>
<p>想法成熟后建立页面</p>
<ol>
<li>
<p>在 SRS 里对发送过来的想法进行完善后，可以转换为页面，将它变成文档块，以便更好地进行发展</p>
<ul>
<li>
<p>想法阶段</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314110822-o4kk7pv.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>转换为文档块</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314113031-rd60068.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>在任何情景下（例如渐进阅读、渐进写作）产生相关的想法就可以直接使用 <kbd>双链</kbd>，链接到激活的想法</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314113900-gplxyld.png?imageView2/2/interlace/1/format/webp""></li>
<li>这种产生的新灵感我会使用列表大纲进行快速输入，不会特意组织成长句，组织成长句反而会丢失它们</li>
<li>这种发展出来的文档块笔记有个特性，标题通常需要是陈述句或者祈使句，以便明确地表达主张<sup class=""footnotes-ref"" id=""footnotes-ref-70""><a href=""#footnotes-def-70"">70</a></sup>，我们后续可以围绕标题进行分析，以支持标题提出的主张。</li>
</ul>
</li>
</ol>
</li>
<li>
<p>思考成熟后，可以建立推测性大纲</p>
<ol>
<li>
<p>利用 SRS 进行渐进思考的想法成熟之后，可以创建一个写作的大纲，例如：</p>
<ul>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314125411-1z2ysyh.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>你可以自己设计个标志，用以区分一般笔记和大纲，例如 Andy 是用“§+ 标题”</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314120540-dxzuv2v.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>每创建一个文档块级笔记时，可以把它添加到你正在维护的一个或多个大纲中，有必要的话也可以创建新的大纲。非常完整的写作项目会自然从中涌现<sup class=""footnotes-ref"" id=""footnotes-ref-71""><a href=""#footnotes-def-71"">71</a></sup>。</p>
<ul>
<li>通常情况下，当我们开启一个写作项目时，我们会先列大纲。这迫使我们从一张空白页开始。</li>
<li>相比之下，如果我们每天都写新的笔记，并留意它们之间的联系，这些笔记可以积累成潜在的写作项目。当感觉大纲「成熟 」时，我们就可以收获，把它变成手稿，这个过程不像从空白页开始写作那样需要付出巨大的努力才能启动。</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>你可以将加入 SRS 的想法看做一个磁石，不断出现在你眼前，将你的生活经验、思考吸附上去。</p>
</li>
<li>
<p>从写作收件箱到推测性大纲是非定向、非线性的写作，从无到有，本质过程是先验知识的不断发展，所以我们的首要任务就是思考，在思考的过程中这些“形式化步骤”就能自发地运用。</p>
</li>
</ul>
<p>经验：</p>
<ul>
<li>搭建一个“写作收件箱”的空白节点是为了有个筛选想法的过程，如果你喜欢你可以跳过这个写作收件箱节点，产生想法后直接将想法加入 SRS。</li>
</ul>
<h6 id=""列表大纲"">列表大纲</h6>
<p>什么是列表大纲？</p>
<ul>
<li>在思源里利用 markdown 的列表模拟出的大纲结构，在操作逻辑上借鉴了成熟的大纲软件。</li>
<li>如果你想使用块引用，想拥有更好地写作和组织体验，来用列表大纲。块引用结合列表大纲后，你将拥有天然的上下文、好用的传递层级以及锚文本筛选（需要安装思源增强插件）。</li>
<li>在思源里，我的笔记只有在组织成文发表时才会转换为文档模式，如果你没有写文章发表的需求，完全可以全程使用列表大纲模式。</li>
</ul>
<p>它有什么用？</p>
<ol>
<li>
<p>快速输入</p>
<ul>
<li>
<p>大纲视图在一定程度上“模拟和承担”了您脑中的父子语义结构，不断地利用视图表达的父子层级关系<strong>提示</strong>您组织内容，它能解放您的工作记忆，专注在对想法的记录上。</p>
</li>
<li>
<p>我的大部分笔记是对自己想法的快速输入，并不是组织好的长句，例如：</p>
<ul>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314162318-qdc5pu3.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>这是由于将自己的想法组装成长句时，需要经过组织结构和逻辑处理，就像锻铁一样，所以才会说：</p>
<ul>
<li>事实上最好的学习方式就是，学习者在知识尚未成型之时就尝试对其进行表达，并将这种表达贯穿于整个学习过程。表达与学习在反馈中得以相互加强，携手并进。在不少情况下，学习者只有在尝试表达某个知识时，才真正开始了学习的过程<sup class=""footnotes-ref"" id=""footnotes-ref-17:2""><a href=""#footnotes-def-17"">17</a></sup>。</li>
</ul>
</li>
<li>
<p>在将想法发展为正式笔记严肃对待时，我会进行这种组装为长句的表达。</p>
</li>
<li>
<p>在捕捉自己的想法，想要爽快地进行思考时，我会面对自己写作，进行快速输入。</p>
</li>
<li>
<p>这时候会想到什么写什么，有时出现另一个主题相关的想法，会快速记录下来，然后打上 <code>[[块引用]]</code> 发送过去，不一定要链接到你已经写过的笔记，在双链中反向链接可以用来隐式定义节点，链接到只有标题的空白文档块则感觉毫无拘束<sup class=""footnotes-ref"" id=""footnotes-ref-72""><a href=""#footnotes-def-72"">72</a></sup>，换句话说，非线性思维的释放阀可能支持改善线性输出<sup class=""footnotes-ref"" id=""footnotes-ref-73""><a href=""#footnotes-def-73"">73</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>通过为正在进行的工作提供非线性结构，你可以为偏离主题的思维创建一个释放阀——这反过来又可以让作者更专注于他们的“主要”思路。</p>
<p>例如，在白板或笔记本上，如果你正在制作一个“主要”的项目符号列表或图表，突然想到了一些不太适合当前主题的内容，你可以简单地将其写在旁边，并可能画上一个箭头。</p>
<p>杂乱的想法可以被有效地捕捉和关联起来，以便以后注意，而不会干扰一个人的主要注意力。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>与 Lain 的对话<sup class=""footnotes-ref"" id=""footnotes-ref-43:2""><a href=""#footnotes-def-43"">43</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>“我在学习或者记忆方面的习惯，就挺希腊人的，口语和思考大于写作，记忆大于记录，所以不怎么做笔记。”</p>
</blockquote>
</li>
<li>
<blockquote>
<p>“我觉得两句话就搞定的事情，讲给别人都要仔仔细细斟酌半天，还要附加一堆补充条件，不太行，打字真的好烦人，因为你得组合你的观点，加上修辞，至少成为书面语，甚至还要考虑观众的理解接受度，更别说讲给 20 天后的我了.jpg”</p>
</blockquote>
</li>
<li>
<blockquote>
<p>“正是因为打字的速度跟不上思考的速度我才不想做笔记，经常我都开始思考南鱼座北落师门的事情了，我的笔记还停留在半人马座比邻星，因为思维是抽象化的，多线程的，可跳跃的，组成语言（包括语音）是线性的，逻辑性强的，有组织的结构，等我组织成语言，我的思维早就比红移星体飞的还远了！”</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>组织您的笔记</p>
<ul>
<li>大纲便捷的结构调整功能使得组织笔记更有效率，只要您习惯了它就一定会喜欢上这种井井有条感——因为它本质上是文档树、标题这一类层级结构的延伸。</li>
</ul>
</li>
<li>
<p>模拟文档树的索引功能</p>
<ul>
<li>列表大纲的层级结构 + 超链接可以覆盖文档树的功能</li>
<li>手动建立的索引结构是一种缓冲区，它只会展示您想关注的内容。</li>
</ul>
</li>
<li>
<p>聚焦某个想法</p>
<ul>
<li>在列表大纲中点击<img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314134017-mb98maf.png?imageView2/2/interlace/1/format/webp"">标志即可聚焦，点击相同位置可返回上一层级。</li>
</ul>
</li>
</ol>
<p>如何在思源里使用？</p>
<ul>
<li>
<p>使用列表大纲进行快速输入，固定想法</p>
<ol>
<li>
<p>唤出斜杠菜单里的 <kbd>/无序列表</kbd>块</p>
<ul>
<li>
<p>斜杠菜单搜索支持中文、拼音、拼音缩写、英文、别名，比如 <kbd>/无序列表</kbd> <kbd>/wuxuliebiao</kbd> <kbd>/wxlb</kbd>  <kbd>/unordered list</kbd> 都能搜索出无序列表块</p>
</li>
<li>
<p>其它的生成方式：</p>
<ul>
<li><kbd>-</kbd>+<kbd>空格键</kbd></li>
<li><code>*</code>+<kbd>空格键</kbd></li>
</ul>
</li>
</ul>
</li>
<li>
<p>在父块输入收集到的知识碎片、想法</p>
</li>
<li>
<p>在父块按下 <kbd>Enter</kbd>键会生成同级块</p>
</li>
<li>
<p>在同级块按下 <kbd>TAB</kbd>键会将同级块变成子级块</p>
</li>
<li>
<p>按下 <kbd>ALT+→</kbd>聚焦当前块（<kbd>ALT+←</kbd>是聚焦到上一级块）</p>
<ul>
<li>
<p>其它聚焦的方法：</p>
<ul>
<li>
<p>鼠标左键点击面包屑这些区域可以聚焦到目标块</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320105001-160ycns.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p><kbd>Ctrl+ 左键</kbd>点击块标或者大纲图标会聚焦到目标块</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320105012-2dlw6qe.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>点击大纲标志会聚焦到目标块</p>
<ul>
<li>这时再点击一次会返回上级</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>左键点击折叠图标会折叠/展开当前块的子级块</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320105034-db386kh.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p><kbd>ALT+ 左键</kbd>点击列表项块 <kbd>块标</kbd>和 <kbd>大纲图标</kbd>是折叠/展开当前块的同级块（需要在同一个列表块内）</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320105012-2dlw6qe.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p><kbd>ALT+ 左键</kbd>点击折叠图标是折叠/展开当前块的子级块</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320105034-db386kh.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ol>
<ul>
<li>
<p>演示：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/GIF_2023-5-5_3-39-11-20230505034153-rbt5gex-20240320105317-o3st7e1.gif""></li>
</ul>
</li>
<li>
<p>可选项：有快速输入的需求可使用 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgetquicker.net%2FSharedaction%3Fcode%3Dce7dff82-e740-429f-b753-08d9e81e226b"" target=""_blank"" rel=""nofollow ugc"">QuickAdd</a> 发送到思源</p>
<ul>
<li>在 QuickAdd 输入框里，按下 TAB 键位会生成列表子级</li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用列表大纲拆解信息为基本命题（在 supermemo 里表现为渐进优化文本）</p>
<ul>
<li>
<p>当你摘录一段文本想对其进行分析时，可以在我们每天的 DailyNotes 里进行，当作草稿纸来用，除此之外还可以留下当天的日期和事件线索。</p>
</li>
<li>
<p>例如：</p>
<ul>
<li>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314133544-t47zheu.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>实践中并不需要完全拆解，也可以利用大纲的层次结构帮助拆解。Conor 的用法：对于拆解出的命题，在其中使用块引用与大脑中的先验知识链接——没有触动先验知识就不要链<sup class=""footnotes-ref"" id=""footnotes-ref-74""><a href=""#footnotes-def-74"">74</a></sup>：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240314133756-8f6cxor.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>在大纲中使用块引用，将猎取到的知识碎片与激活的先验知识链接</p>
<ul>
<li>
<p>使用 <code>[[</code>+ 关键词链接到已有文档块，或者新建文档块</p>
</li>
<li>
<p>对关键词使用 <code>ALT+[</code></p>
</li>
<li>
<p>常见的记录形式有：</p>
<ol>
<li>
<p>时间 + 笔记：</p>
<blockquote>
<ul>
<li>14:47:55 间隔重复系统与编程注意力</li>
</ul>
</blockquote>
</li>
<li>
<p>时间 + 事件：</p>
<blockquote>
<ul>
<li>
<p>14:51:18 开始构思 <code>[[学习时的矛盾]]</code></p>
</li>
<li>
<p>16:23:29 出门买菜</p>
<ul>
<li>
<p><code>[[5.结合过程类似于尝试新的思维方式。]]</code></p>
<ul>
<li>
<p>单纯的记忆材料</p>
<ul>
<li>
<p>如何确保在合适的场景下记忆的内容被激活，发生联系？</p>
<ul>
<li>间隔重复系统</li>
<li>提取练习</li>
<li>变式练习</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li>
<p>时间 + 事件 + 事件中产生的笔记：</p>
<blockquote>
<ul>
<li>
<p>18:33:11 阅读 <code>[[穿越时间的文本]]</code></p>
<ul>
<li>
<p>类似 <code>[[语义距离]]</code></p>
<ul>
<li><code>[[7.作者的文字固定在纸上，难以引导读者构建持续的感性认识。]]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li>
<p>笔记和时间、事件无关，突然来了灵感直接记：</p>
<blockquote>
<ul>
<li>
<p><code>[[反链]]</code> 可以用 <kbd>转换为链接</kbd>处理</p>
</li>
<li>
<p><code>[[基于双链的自由学习]]</code> <code>[[基于间隔重复的注意力编程]]</code></p>
<ul>
<li>
<p>注意力有两条通道</p>
<ul>
<li>
<p>自上而下</p>
<ul>
<li>
<p>先验知识控制</p>
<ul>
<li>
<p>双链</p>
<ul>
<li>知识碎片</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>自下而上</p>
<ul>
<li>
<p>外部信息控制</p>
<ul>
<li>编程注意力</li>
</ul>
</li>
</ul>
</li>
<li>
<p>结合</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>[[认知负荷]]</code></p>
<ul>
<li>
<p>启示：</p>
<ul>
<li>
<p>文章作者</p>
<ul>
<li>
<p>组织材料</p>
<ul>
<li>总分总</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>[[记忆能减轻认知负荷吗？]]</code></p>
</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li>
<p>在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fffqk2e"" target=""_blank"" rel=""nofollow ugc"">双向链接时代的快速无压记录</a>里常见的是在列表大纲第一层使用块引用，在下面的讲解里我们会遇到对想法的固定和对材料的拆解，在这种情况下多少层都可以去使用块引用</p>
</li>
</ul>
</li>
</ul>
<p>列表大纲里的常见问题：</p>
<ul>
<li>
<p>如何合并多个列表块？</p>
<ul>
<li>
<p>两种方法：</p>
<ol>
<li>
<p>将某个列表块变成另一个列表块的子级，然后按 <kbd>Shift+TAB</kbd> 进行反向缩进实现合并：</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/合并多个断开的列表块-20230505181410-y6u3rx8-20240314131952-mcmv9xe.gif""></li>
</ul>
</li>
<li>
<p>使用 quicker 动作 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgetquicker.net%2FSharedaction%3Fcode%3D0b2e49a9-eb6a-46f0-5f92-08db2f870242"" target=""_blank"" rel=""nofollow ugc"">合并多个列表块 </a>，来自思源社区的浅沧老铁</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h6 id=""中转站"">中转站</h6>
<p>什么是中转站？</p>
<ul>
<li>Roam Research 里的右侧栏（ Right Sidebar）可以实现块的中转，虽然思源里没有此功能，但可以用其它功能模拟一下中转，所以我随便取了个“中转站”的名字。</li>
</ul>
<p>中转站有什么用？</p>
<ul>
<li>你可以将它看成去超市购物时的推车，在思源里漫游不同页面的正文与反链时，可以将看中的块置入中转站，之后再到目标页面一起使用，在定向写作成文的时候最方便。</li>
</ul>
<p>如何在思源里使用中转站？</p>
<ol>
<li>
<p>随便找个容器块分屏当作中转站，再将目标块（正文反链都可以）进行引用、嵌入到容器块即可。</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240315083433-kvaod2b.png?imageView2/2/interlace/1/format/webp""></li>
<li>用块嵌入、块引用是为了保留原块，直接拖拽会丢失原块的上下文</li>
</ul>
</li>
<li>
<p>到目标页面直接拖拽至合适位置</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240315083814-e4ehma6.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ol>
<h6 id=""随思考而发展的笔记"">随思考而发展的笔记</h6>
<ul>
<li>
<p>在双链的笔记可分为两大类：</p>
<ul>
<li>DailyNotes 中的草稿</li>
<li>Page（文档块级）</li>
</ul>
</li>
<li>
<p>细分下可分为：</p>
<ul>
<li>
<p>DailyNotes 中的草稿，一天中想法的捕捉</p>
<ul>
<li>发送至写作收件箱的草稿</li>
</ul>
</li>
<li>
<p>Page（文档块级）</p>
<ul>
<li>
<p>空白节点</p>
<ul>
<li>
<p>Roam-like 里最常见的用法，在我刚接触思源时，当时社区的 zhangzz 老铁就分享了这种用法，我的双链笔记大多都是这种形态，其中又可细分为：</p>
<ul>
<li>隐式定义节点</li>
<li>先验知识锚点</li>
</ul>
</li>
</ul>
</li>
<li>
<p>不断发展的陈述性笔记（或者问题）</p>
</li>
<li>
<p>推测性大纲</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>我们可以看到这些不断发展的笔记是实际上是思考的副产物，我们的先验知识在不断增强，注意力随之增强，对同一事物的看法也会跟着改变，于是在促进思考的过程中，笔记也随之发展。</p>
</li>
</ul>
<h5 id=""结合-SRS-后的定向渐进写作"">结合 SRS 后的定向渐进写作</h5>
<ul>
<li>当有了目标的大致轮廓就可以进行定向的渐进写作，我们可以将文章大纲写进 supermemo 里，每个文章大纲的元素上填入对应的思源块超链接，例如：</li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240315152238-hfrycna.png?imageView2/2/interlace/1/format/webp""></li>
<li>通过<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgetquicker.net%2FSharedaction%3Fcode%3Def170835-2df5-4f25-c72a-08d980c1360f"" target=""_blank"" rel=""nofollow ugc"">自动打开外链（网页\\笔记等） </a>跳转进思源进行文本的编辑。</li>
</ul>
<h2 id=""渐进学习总览"">渐进学习总览</h2>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320112239-u78gerl.png?imageView2/2/interlace/1/format/webp""></p>
<p>将上面的策略组合后，就是 woz 所提出的渐进学习，也就是由这几个步骤构成<sup class=""footnotes-ref"" id=""footnotes-ref-60:2""><a href=""#footnotes-def-60"">60</a></sup>：</p>
<ol>
<li>
<p>导入材料</p>
<ul>
<li>从各种电子和非电子来源（如网上文章、视频、音频、图片、电子邮件、扫描的文档等）导入 SRS。</li>
</ul>
</li>
<li>
<p>渐进处理</p>
<ul>
<li>对知识进行优先级排序，以进行渐进处理（例如，物理优先级高，电影琐事优先级低等）。渐进方法是指蚕食知识而不是鲸吞。</li>
</ul>
</li>
<li>
<p>提取练习</p>
<ul>
<li>逐渐地把学习材料转化为可以持久记忆的知识。这种转换也可以额外（不需要成为学习过程的一部分，也不需要额外付出）生成一个易于检索和备注的电子知识数据库。</li>
</ul>
</li>
<li>
<p>创造性的阐述</p>
<ul>
<li>创造性地扩展所获得的知识（例如，在渐进写作、解决问题等过程中）。</li>
</ul>
</li>
</ol>
<p>在渐进学习里，有两个构成：</p>
<ul>
<li>渐进阅读</li>
<li>渐进写作</li>
</ul>
<p>有两个大方向策略，它们促进了知识的建构：</p>
<ul>
<li>渐进阅读时对文本的自我解释</li>
<li>渐进写作时扩展所获得知识的创造性阐述</li>
</ul>
<p>有两个维持动机的策略：</p>
<ul>
<li>导入材料、提取练习、创造性阐述的过程也要进行渐进处理</li>
<li>感觉到任何无聊或分心的迹象就可以跳到下个 SRS 任务</li>
</ul>
<p>动机维持：</p>
<ul>
<li>
<p>SRS 有些过程需要耗费巨大的情感动机：</p>
<ul>
<li>开荒一个陌生的新领域</li>
<li>重复处理无聊的旧材料</li>
<li>制作提取练习任务</li>
<li>进行无聊的提取练习</li>
</ul>
</li>
</ul>
<p>这让使用 SRS 变成了一种负担，但在这些过程里又实实在在出现了学习的奖励：</p>
<ul>
<li>新的材料流入</li>
<li>进行自我解释时为新知识找到意义</li>
<li>创造性阐述时产生了新的理解</li>
</ul>
<p>这些奖励是我们维持学习所必须的，因为我们进行的不是短时间的考前突击，而是终生的学习，所以渐进处理和<strong>感觉无聊就跳过</strong>对于我们来说是可以接受的。</p>
<p>与 Lain 的对话<sup class=""footnotes-ref"" id=""footnotes-ref-43:3""><a href=""#footnotes-def-43"">43</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>说这么多都不如培养成生活习惯，你一个方法再牛逼，但是特别无聊还没有实践性。</p>
</blockquote>
</li>
<li>
<blockquote>
<p>你找个比较向往的目标，然后找一种你比较能接受不是很痛苦的方式，把外语培养成一种生活习惯，不要焦躁，慢慢就会了。</p>
</blockquote>
</li>
</ul>
<h2 id=""我的渐进学习流程-"">我的渐进学习流程：</h2>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20240320111854-j7psesz.png?imageView2/2/interlace/1/format/webp""></p>
<p>每天我会打开 supermemo 接收过去发送过来的任务，主要分为提取练习、处理材料和发展想法。</p>
<ul>
<li>
<p>提取练习</p>
<ul>
<li>提取练习的任务有时会日清，刷完当天的队列，有时时间不够就自动推迟。</li>
</ul>
</li>
<li>
<p>处理材料</p>
<ul>
<li>
<p>在处理感兴趣的材料时，主要任务是摘录、重新表述和确定优先级，一次只进行一步动作，最后再进行挖空。</p>
<ul>
<li>大多数摘录是垃圾卡片，重复个两三次就放弃了</li>
<li>少数经过挖空变成了完形填空。</li>
<li>完形填空再经过选择最终会变成问答卡。</li>
<li>感觉有些难处理的内容会跳过，安排至队列末尾（<kbd>ctrl+shift+j</kbd>），有些则会安排至其他日期（<kbd>ctrl+j</kbd>），这俩功能很爽。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>发展想法</p>
<ul>
<li>
<p>接收到感兴趣的想法时，会用目前的知识尝试完善一下，没有表达欲望了就继续进行队列。</p>
<ul>
<li>
<p>这个过程是在 supermemo 里放超链接</p>
<ul>
<li>
<p>因为是发展想法，不涉及在 supermemo 里摘录挖空，所以这种用法还挺舒服</p>
</li>
<li>
<p>这些想法在复习中发现间隔过大时，会重置学习进度 <kbd>ctrl+m</kbd> ，变成新元素重新开始复习，这是为了避免间隔越来越大捕捉不到它</p>
<ul>
<li>当然你也可以用 <kbd>ctrl+j</kbd> 手动安排复习时间</li>
</ul>
</li>
<li>
<p>由于是放超链接进去，所以可以使用查找关键词“siyuan”进行筛选</p>
<ul>
<li>筛选出来后可以进行批量操作：<kbd>右键</kbd>→<kbd>选择</kbd>→<kbd>所有元素</kbd>→<kbd>右键</kbd>→<kbd>处理分支</kbd></li>
<li>可以进行提前复习、重定计划、排除、取消排除、随机浏览等等</li>
</ul>
</li>
</ul>
</li>
<li>
<p>在思源里完善想法，通过表达进行创造性阐述</p>
<ul>
<li>当知识的建构出现时，我会在当天的草稿空间 DailyNotes 里直接使用双链，传递给某个空白节点。</li>
<li>因为有时会频繁触动多个灵光一闪，在 DailyNotes 里进行记录最舒服，不用频繁切换页面。</li>
<li>这种多是利用列表大纲对想法进行快速记录，很少会有逻辑的长句出现，如果耗费注意力进行组织，反而会限制思考。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在渐进学习的过程中新知识、旧知识被不断激活，有助于进行自我解释和创造性阐述，当发生知识的建构时，我会将产生的这些新理解进行链接（在思源里）。</p>
<ul>
<li>
<p>比如我在渐进阅读“形式化被认为是有害的”这篇资料时看到里面提到<sup class=""footnotes-ref"" id=""footnotes-ref-75""><a href=""#footnotes-def-75"">75</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>用户对任何重要任务（例如执行分析或完成设计）的理解随着他们尝试完成任务而不断发展</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>这让我想起我每次在尝试完成一篇文章时，睡过一觉后第二天总会有新的见解出现，再去看昨天的草稿就想全删掉，比如这篇文章在思源里已经迭代了三次。</p>
</li>
<li>
<p>在进行文章结构的调整时，我又想起 Conor 说的演讲公式<sup class=""footnotes-ref"" id=""footnotes-ref-76""><a href=""#footnotes-def-76"">76</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>Tell them what you\'re going to tell them</p>
<p>Tell them</p>
<p>Tell them what you told them</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>不得不说虽然他在吐槽这个公式，但挺好使的，学生时代写作文时就在用这个总分总结构，想到这点，我又想起之前读过叶秀山先生在评论京剧有说时<sup class=""footnotes-ref"" id=""footnotes-ref-77""><a href=""#footnotes-def-77"">77</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>艺术创造最根本的问题就在于为一定的内容找寻（创造）最恰当的形式</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>之前我只是利用提取练习记住这句话，当做欣赏京剧的指导，但现在想起它让我产生新的见解：</p>
<ul>
<li>
<blockquote>
<p>即使是解释性文本也是有最恰当的形式。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>这个新见解被我发送至 SRS 里进行完善，在进行新的阅读时我又注意到 Mayer 写的《应用学习科学》结构非常好，举例、图表、图示直观又易懂。</p>
</li>
<li>
<p>在我去了解工作记忆的时候，我才明白过于冗长的文本会导致读者过载，对于解释性文本来说最恰当的形式应该具有“紧抓读者注意力”这一属性。</p>
<ul>
<li>我当时还想到网文创作时多换行这一经验。</li>
</ul>
</li>
<li>
<p>在读到 Andy 的“助记媒介”时，他是想通过在文中嵌入间隔重复卡片来实现作者和读者跨时间的交流，从某种意义上讲是想实现长久的“注意力指导”，这或许是解释性文本新的可行形式。</p>
</li>
<li>
<p>在开始读更多关于先验知识的资料时，我意识到“解释性文本”应能激活读者的生活经验，为文字找到意义，我结合自己阅读的经验来看，解释性文本应少生词，多举例。</p>
</li>
</ul>
<p>你可以看到在 SRS 里，对某个想法进行完善就像给我自己施展了“远距术”，扩展了视野范围，我能看见的更多、更广，将生活中的经验、阅读到材料进行捕获，然后完善自己的理解。</p>
<p>在思源里，我大多数时间只用到这些功能：</p>
<ul>
<li>DailyNotes</li>
<li>列表大纲</li>
<li>块引用</li>
<li>空白节点</li>
<li>上下文反链</li>
</ul>
<p>由于是面对自己写作，所有排版元素、样式、标签都用不到，多级标题、文档树、MOC、代码块、数据库之类的也在里面，因为它们对思考实在没什么作用，用起来太累了。</p>
<p>渐进写作里也只用到非定向写作，逐渐发展想法，像定向写作一年也未必有一次，写好解释性文本太累了。</p>
<p>思源里文档块大多数是空白节点，有了思源增强插件后连反链也不需要移动到正文，整理反链这个操作太累了，而且它不想其它操作一样会触发知识建构，让我产生内在动力。</p>
<p>当你的想法得到发展时，你能像我一样，轻松地访问与之关联的材料，即使思源不在你手边你也能很自信地调用这些材料，因为我们走的路不会把笔记和先验知识混为一谈。</p>
<p>在渐进学习里，你的大部分时间被用来思考，没有比这个更重要，这些策略的目的为了更好地进行思考，以及维持思考的动力，以最小的动力损耗，实现最大的探索。</p>
<p>从我的经验来看，大多数人都不能坚持使用 SRS，这是因为他们低估了情感的作用，有些策略的研究看上去效果很好，但使用时或许更花费时间，有更多的阻力。</p>
<p>我一开始在渐进阅读时总想把一切都获取，逐字逐句地分析，后来根本没坚持多久就放弃，这个过程压力太大。</p>
<p>后来我尝试着只处理文章我能理解的那一部分，不会对未来的自己产生太大的压力，这样做之后我反而更积极，在未来某天我对它产生了新的理解之后，就像发现一片富矿，总想着返回原文再去挖掘它。</p>
<p>对我来说最快乐的时候就是渐进学习时的灵感轰炸，过去发送的材料与我目前关心的主题产生美妙的关联：“喔，原来可以这样想”、“他是个天才！”、“这不跟我想一块去了吗”、“我明白了！”</p>
<p>自此，我开始将老师、书籍和社区进行的交流等等视作完善自己理解的养分，我将关心的重点转移到自己的先验知识上。</p>
<p>当你进入了学习的奖励循环之后，就可以尝试在循环里加一些开荒期的材料进行记忆。多开荒意味着多开主题，就像多开矿场，这个矿场快乐不够就靠另一个矿场维持学习这个行动。</p>
<p>最后谨记，没有快乐就没有好的学习。</p>
<h2 id=""本文缺少的部分-"">本文缺少的部分：</h2>
<ul>
<li>
<p>RemNote</p>
<ul>
<li>RemNote 的 CDF（概念描述符框架）和它的 AI 提示描述符、AI 制卡很有趣，但是由于时间问题我没能进一步深度体验，AI 提示描述符的功能类似思源小助手插件里的动作表触发，在你输入的同时会根据上下文提示你使用什么样的模版制卡、思考。</li>
<li>CDF 框架还提供了信息组织，使得制卡时会有上下文，记忆时也更容易，或许更适合学生。</li>
</ul>
</li>
<li>
<p>逻辑推理</p>
<ul>
<li>
<p>我有读到：</p>
<ul>
<li>
<blockquote>
<p>推理是纵贯人一生学习的决定因素，具有高推理能力的人一生所获得的知识要比同龄人更多，特别是他们在追逐自我兴趣的境脉中的推理，来终其一生发展自身的知识</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>看起来推理是学习中的重要因素，但是由于我本身没有深入学过逻辑推理，由于时间问题在本文完成前也没法去了解，所以只能留给你们去探索了。</p>
</li>
</ul>
</li>
<li>
<p>神经学习</p>
<ul>
<li>
<p>神经学习是 supermemo18 里新增的一个功能，当你产生知识的建构时，大脑中先验知识和材料之间发生了关联，你就可以使用 supermemo 里的链接将元素与概念、元素与元素进行关联，手动搭建信息网络。</p>
</li>
<li>
<p>之后在进行神经学习时，它会按照信息网络链接来进行复习，有助于你产生灵光一闪。</p>
</li>
<li>
<p>据作者 woz 描述<sup class=""footnotes-ref"" id=""footnotes-ref-78""><a href=""#footnotes-def-78"">78</a></sup>：</p>
<ul>
<li>
<blockquote>
<p>在研究、解决问题、创造性写作、探索性学习等方面特别有用,换句话说，你可能不会发现神经学习在掌握物理课程方面特别有用，但是，如果你是一个物理学家，正在研究一个复杂的问题，需要把来自不同物理领域和其他领域的知识联系起来，你会注意到这种学习形式对你的创造性生产力有着惊人的影响。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>大概意思就是通过人工搭建的信息网络促进创造发生，能使知识之间紧密相连，与渐进写作有相同作用。我是觉得和思源里沿着引用和反链漫游差不多，认真使用段时间后我再来分享。</p>
</li>
<li>
<p>由于篇幅问题无法在本文里详细描述，只能留给你去探索了。</p>
</li>
</ul>
</li>
<li>
<p>渐进学习的其他组成</p>
<ul>
<li>本篇只介绍了渐进阅读和渐进写作，因为时间问题其它的组成并没有提及，只能留给你们去探索了。</li>
</ul>
</li>
</ul>
<h2 id=""推荐-"">推荐：</h2>
<ul>
<li>
<p>用法：</p>
<ul>
<li>
<p>如果你目前并没有感受到过学习的奖励，没有内在的渴望驱动，那么我建议先从渐进阅读开始：</p>
<ul>
<li>导入你喜欢材料开始阅读，无聊就跳</li>
<li>在渐进表述和挖空主动学习期间不断进行一点自我解释</li>
<li>解释你感兴趣的内容，或者用你感兴趣的内容来解释自己的生活经验</li>
<li>做提取练习会耗费巨大的动机，所以你需要多读、多想，通过不断激活先验知识让其与你正在思考的上下文进行交互，产生建构知识的奖励</li>
</ul>
</li>
<li>
<p>当你获得了奖励，有了内在驱动力，就可以步入进阶，例如开始尝试精心设计提取练习任务，将 SRS 用于多种用途，比如灌输一些思维模式、进行渐进写作。</p>
</li>
<li>
<p>在思源里进行渐进非定向写作很轻松，思源这边没有什么进阶使用手册，上手即是毕业，你只需要这几个功能：</p>
<ul>
<li>DailyNotes</li>
<li>列表大纲</li>
<li>块引用</li>
<li>空白节点</li>
<li>上下文反链</li>
</ul>
</li>
<li>
<p>我从 0.2.0 版本开始使用思源，每个版本都会追更，到现在为了创作这篇文章停在 2.11.2 版本，重度使用的也只有这些功能，也只有这些功能确实帮助了思考。</p>
</li>
</ul>
</li>
<li>
<p>插件：</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2FWetoria%2Fsy-plugin-enhance"" target=""_blank"" rel=""nofollow ugc"">思源增强插件</a>：提供了页内反链、反链锚文本过滤等功能，这对一个双链软件是必须要有的。</li>
<li>闪卡增强插件：增加了思源的闪卡功能，提供了标识符制卡、图片制卡、一键制卡等功能，在思源里使用 SRS 必备。</li>
<li>今日笔记：自动打开 DailyNotes</li>
<li>自定义块样式：导图视图很好用</li>
<li>思源小助手：融合小功能、AI 助手战未来的插件</li>
</ul>
</li>
<li>
<p>阅读：</p>
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsupermemo%2Fwiki%2Fincremental_learning"" target=""_blank"" rel=""nofollow ugc"">渐进学习 (yuque.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F434074509"" target=""_blank"" rel=""nofollow ugc"">如何写出好卡片：利用间隔重复创造理解 - 知乎 (zhihu.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F602150910"" target=""_blank"" rel=""nofollow ugc"">学习的乐趣 - 知乎 (zhihu.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgeorgios.blog%2Fposts%2Fbuilding-big-picture"" target=""_blank"" rel=""nofollow ugc"">Building the Big Picture</a></li>
</ul>
</li>
</ul>
<h2 id=""感谢"">感谢</h2>
<p>感谢感谢兔大哥的审稿和建议，我才得以将这篇手册完善。</p>
<p>感谢间隔重复社区的叶哥、Lain 哥、兔子哥，双链社区的哈桑老师、FLY 老哥、zhangzz 老哥、咸鱼老哥、D，在和他们的交流中我将那些令我心动的部分综合成了这篇文章，没有他们也就没有这篇文章，也算是将社区的经验延续下去，承上启下了。</p>
<p>如果您有任何问题，可以在评论区留言或者加入下方社群与我进行讨论：</p>
<p>思源笔记三群：538155062</p>
<p>渐进学习交流群：262568947</p>
<div><hr>
<ol><li id=""footnotes-def-1""><p>Piotr Wozniak, <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F303204832"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/303204832</a>. <a href=""#footnotes-ref-1"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-2""><p>Andy Matuschak, <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fandymatuschak.org%2F"" target=""_blank"" rel=""nofollow ugc"">https://andymatuschak.org/</a>. <a href=""#footnotes-ref-2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-3""><p>Michael Nielsen, <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmichaelnielsen.org%2F"" target=""_blank"" rel=""nofollow ugc"">https://michaelnielsen.org/</a>. <a href=""#footnotes-ref-3"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-4""><p>Thoughts Memo, <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2FL.M.Sherlock"" target=""_blank"" rel=""nofollow ugc"">https://www.zhihu.com/people/L.M.Sherlock</a>. <a href=""#footnotes-ref-4"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-5""><p>Dammy, \""一次漫游，学习中的快乐与束缚\"",  <a href=""https://ld246.com/article/1681801981651"">一次漫游：学习中的快乐与束缚</a> . <a href=""#footnotes-ref-5"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""3"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""4"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-6""><p>Woolfolk, A. (2016). Educational psychology. <a href=""#footnotes-ref-6"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-7""><p>John Hattie, Gregory C. R. Yates. 可见的学习与学习科学[M]. 教育科学出版社, 2018：148. <a href=""#footnotes-ref-7"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-8""><p>Andy, \""人们经常难以回忆起文本的细节，原因在于他们起初就根本没有加工文本\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F677786105"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/677786105</a>. <a href=""#footnotes-ref-8"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-9""><p>Piotr Wozniak, \""Pleasure_of_learning\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fsupermemo.guru%2Fwiki%2FPleasure_of_learning"" target=""_blank"" rel=""nofollow ugc"">https://supermemo.guru/wiki/Pleasure_of_learning</a>, (2017).<br>
中文翻译：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F602150910"" target=""_blank"" rel=""nofollow ugc"">学习的乐趣 </a><a href=""#footnotes-ref-9"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-10""><p>耗子领袖, \""好奇的生物学意义是什么?\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F418677540%2Fanswer%2F1478725039"" target=""_blank"" rel=""nofollow ugc"">https://www.zhihu.com/question/418677540/answer/1478725039 </a><a href=""#footnotes-ref-10"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-11""><p>Murayama, K. (2022). A reward-learning framework of knowledge acquisition: An integrated account of curiosity, interest, and intrinsic–extrinsic rewards. <em>Psychological Review</em>, <em>129</em>(1), 175–198. <a href=""#footnotes-ref-11"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-12""><p>Loewenstein, G. (1994). The psychology of curiosity: A review and reinterpretation. Psychological Bulletin. <a href=""#footnotes-ref-12"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-13""><p>Renninger, K. A. (2000). Chapter 13 - Individual interest and its implications for understanding intrinsic motivation. In C. Sansone &amp; J. M. Harackiewicz (Eds.), Intrinsic and Extrinsic Motivation (pp.373-404). San Diego: Academic Press. <a href=""#footnotes-ref-13"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-14""><p>Prenzel, M. (1992). Selective persistence of interest. In K. A. Renninger, S. Hidi, &amp; A. Krapp (Eds.), The role of interest in learning and development. (pp. 71-98). Hillsdale, NJ: Erlbaum. <a href=""#footnotes-ref-14"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-15""><p>Lepper, M.R., Corpus, J.H., &amp; Iyengar, S. (2005). Intrinsic and Extrinsic Motivational Orientations in the Classroom: Age Differences and Academic Correlates. <em>Journal of Educational Psychology, 97</em>, 184-196. <a href=""#footnotes-ref-15"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-16""><p>Bransford, J. D., Brown, A. L., &amp; Cocking, R. R. (2000). <em>How people learn</em> (Vol. 11). Washington, DC: National academy press. <a href=""#footnotes-ref-16"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""3"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-17""><p>[美]R. 基思·索耶 (Ed.). (2021). <em>剑桥学习科学手册</em> (徐晓东, 杨刚, 阮高峰, &amp; 刘海华, Trans.; 2nd ed.). 教育科学出版社. <a href=""#footnotes-ref-17"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-18""><p>Andy Matuschak, \""自学，间隔重复，以及为什么书本不起作用 - 知乎\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F643871124"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/643871124</a>. <a href=""#footnotes-ref-18"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-19""><p>Sciences, E., and Medicine National Academies of. (2018). <em>How People Learn II: Learners, Contexts, and Cultures</em>. National Academies Press. <a href=""#footnotes-ref-19"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-20""><p>Chi, Michelene T. H. ; Feltovich, Paul J. &amp; Glaser, Robert (1981). Categorization and representation of physics problems by experts and novices. Cognitive Science 5 (2):121-52. <a href=""#footnotes-ref-20"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-21""><p>东华君, \""注意力的认知神经机制是什么？\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F33183603"" target=""_blank"" rel=""nofollow ugc"">https://www.zhihu.com/question/33183603</a>. <a href=""#footnotes-ref-21"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-22""><p>Mourey, J. A., Lam, B. C. P., &amp; Oyserman, D. (2015). Consequences of Cultural Fluency. <em>Social Cognition</em>, <em>33</em>(4), 308–344. <a href=""#footnotes-ref-22"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-23""><p>Michael Nielsen, \""增强长期记忆\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Faugmentingcognition.com%2Fltm.html"" target=""_blank"" rel=""nofollow ugc"">https://augmentingcognition.com/ltm.html</a><br>
中文翻译：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F65131722"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/65131722 </a><a href=""#footnotes-ref-23"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-24""><p>Andy Matuschak, \""How to write good prompts: using spaced repetition to create understanding\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fandymatuschak.org%2Fprompts"" target=""_blank"" rel=""nofollow ugc"">https://andymatuschak.org/prompts</a>, San Francisco (2020).<br>
中文翻译：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F434074509"" target=""_blank"" rel=""nofollow ugc"">如何写出好卡片：利用间隔重复创造理解 </a><a href=""#footnotes-ref-24"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-25""><p>Andy Matuschak, \""可编程注意力\"",  <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F514626691"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/514626691</a>. <a href=""#footnotes-ref-25"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-26""><p>Sweller, J., van Merrienboer, J. J. G., &amp; Paas, F. G. W. C. (1998). Cognitive Architecture and Instructional Design. <em>Educational Psychology Review</em>, <em>10</em>(3), 251–296. <a href=""#footnotes-ref-26"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-27""><p>Cowan, N., The magical number 4 in short-term memory: a reconsideration of mental storage capacity. Behav Brain Sci, 2001. 24(1): p. 87-114; discussion 114-85. <a href=""#footnotes-ref-27"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-28""><p>Moors, A., &amp; De Houwer, J. (2006). Automaticity: A Theoretical and Conceptual Analysis. <em>Psychological Bulletin</em>, <em>132</em>(2), 297–326. <a href=""#footnotes-ref-28"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-29""><p>Gobet, F., Lane, P. C. R., Croker, S., Cheng, P. C.-H., Jones, G., Oliver, I., &amp; Pine, J. M. (2001). Chunking mechanisms in human learning. <em>Trends in Cognitive Sciences</em>, <em>5</em>(6), 236–243. <a href=""#footnotes-ref-29"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-30""><p>Kim, J. W., Ritter, F. E., &amp; Koubek, R. J. (2013). An integrated theory for improved skill acquisition and retention in the three stages of learning. Theoretical Issues in Ergonomics Science, 14(1), 22–37. <a href=""#footnotes-ref-30"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-31""><p>Mayer, R. E. (2012). Information processing. In K. R. Harris, S. Graham, T. Urdan, C. B. McCormick, G. M. Sinatra, &amp; J. Sweller (Eds.), <em>APA educational psychology handbook, Vol. 1. Theories, constructs, and critical issues</em> (pp. 85–99). American Psychological Association. <a href=""#footnotes-ref-31"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-32""><p>Van Merriënboer, J. J. G., &amp; Sweller, J. (2005). Cognitive Load Theory and Complex Learning: Recent Developments and Future Directions. <em>Educational Psychology Review</em>, <em>17</em>(2), 147–177. <a href=""#footnotes-ref-32"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-33""><p>Georgios Zonnios, \""橙汁类比渐进阅读\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgeorgios.blog%2Fposts%2Forange-juice-analogy"" target=""_blank"" rel=""nofollow ugc"">https://georgios.blog/posts/orange-juice-analogy</a>. <a href=""#footnotes-ref-33"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-34""><p>Andy Matuschak, \""\'Better note-taking\' misses the point; what matters is \'better thinking\'\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fnotes.andymatuschak.org%2Fz7kEFe6NfUSgtaDuUjST1oczKKzQQeQWk4Dbc"" target=""_blank"" rel=""nofollow ugc"">https://notes.andymatuschak.org/z7kEFe6NfUSgtaDuUjST1oczKKzQQeQWk4Dbc</a><br>
中文翻译：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F427460683"" target=""_blank"" rel=""nofollow ugc"">「更好地记笔记」这个描述太过流于表面；核心在于「更好地思考」 </a><a href=""#footnotes-ref-34"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-35""><p>Andy Matuschak, \""将想法送入你的轨道（Orbit）\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F524446794"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/524446794</a>. <a href=""#footnotes-ref-35"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-36""><p>Andy Matuschak, \""为有潜在价值的参考引用建立一个阅读收件箱 \"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F440328209"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/440328209</a>. <a href=""#footnotes-ref-36"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-37""><p>Andy Matuschak, \""间隔重复对于逐步完善灵光一闪可能有用\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F415857130"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/415857130</a>. <a href=""#footnotes-ref-37"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-38""><p>Andy Matuschak, \""间隔重复可能是培养或改变习惯的有用工具\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F417187329"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/417187329</a>. <a href=""#footnotes-ref-38"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-39""><p>Andy Matuschak, \""如何写出好卡片：利用间隔重复创造理解\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F434074509"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/434074509</a>, San Francisco (2020). <a href=""#footnotes-ref-39"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-40""><p>Piotr Wozniak, \""间隔重复中的简化与冗余\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F283017134"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/283017134</a>. <a href=""#footnotes-ref-40"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-41""><p>Andy Matuschak, \""谨防自动导入阅读收件箱\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F504979464"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/504979464</a>. <a href=""#footnotes-ref-41"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-42""><p>Andy Matuschak, \""在间隔重复记忆系统中，优化的关键是复习环节及其内容的情感联系\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F399811533"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/399811533</a>. <a href=""#footnotes-ref-42"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-43""><p>Lain(2021). <a href=""#footnotes-ref-43"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""3"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-44""><p>Piotr Wozniak, \""我怎样才能读得更快？\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F256212819"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/256212819</a>. <a href=""#footnotes-ref-44"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-45""><p>Lain(2022). <a href=""#footnotes-ref-45"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""3"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-46""><p>Piotr Wozniak, \""20 条知识表述规则（20 周年版）\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F269997143"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/269997143</a>. <a href=""#footnotes-ref-46"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-47""><p>Piotr Wozniak, \""Semantic distance\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fsupermemo.guru%2Fwiki%2FSemantic_distance"" target=""_blank"" rel=""nofollow ugc"">https://supermemo.guru/wiki/Semantic_distance</a>, (2017).<br>
中文翻译：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F436727078"" target=""_blank"" rel=""nofollow ugc"">语义距离 </a><a href=""#footnotes-ref-47"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-48""><p>Karpicke, J. D., Blunt, J. R., &amp; Smith, M. A. (2016). Retrieval-Based Learning: Positive Effects of Retrieval Practice in Elementary School Children. Frontiers in Psychology, 7, Article No. 350. <a href=""#footnotes-ref-48"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-49""><p>Meyer, A. N. D., &amp; Logan, J. M. (2013). Taking the Testing Effect beyond the College Freshman: Benefits for Lifelong  Learning. Psychology &amp; Aging, 28, 142-147. <a href=""#footnotes-ref-49"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-50""><p>Karpicke, J. D., &amp; Blunt, J. R. (2011). Retrieval practice produces more learning than elaborative studying with concept mapping. Science (New York, N.Y.), 331(6018), 772–775. <a href=""#footnotes-ref-50"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-51""><p>\""有效的学习：处理知识的 20 条规则[直译版]\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsupermemo%2Farticles%2F20rules"" target=""_blank"" rel=""nofollow ugc"">https://www.yuque.com/supermemo/articles/20rules</a>. <a href=""#footnotes-ref-51"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-52""><p>Andy Matuschak, \""先学再记\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F550695797"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/550695797</a>. <a href=""#footnotes-ref-52"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-53""><p>Andy Matuschak, \""学习别人的间隔重复记忆卡片通常是无效的\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F397271029"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/397271029</a>. <a href=""#footnotes-ref-53"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-54""><p>Andy Matuschak, \""阅读理解与记忆系统\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F653174197"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/653174197</a>. <a href=""#footnotes-ref-54"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-55""><p>Lain, \""制作渐进阅读卡片的个人经验\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F453606080"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/453606080</a>. <a href=""#footnotes-ref-55"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""3"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""4"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-56""><p>[英]弗朗西斯·叶芝. (2018). <em>记忆的艺术</em> (钱彦 &amp; 姚了了, 译). 人民文学出版社. <a href=""#footnotes-ref-56"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-57""><p>Piotr Wozniak, \""语义学习\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F266922623"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/266922623</a>. <a href=""#footnotes-ref-57"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-58""><p>Alexey Guzey, \""Instilling Novel Thought Patterns and Making Your Long-Term Memory Accountable with Anki\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fguzey.com%2Fthings%2Fsoftware%2Fanki%2F%23instilling-novel-thought-patterns-with-anki"" target=""_blank"" rel=""nofollow ugc"">https://guzey.com/things/software/anki/#instilling-novel-thought-patterns-with-anki</a>. <a href=""#footnotes-ref-58"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-59""><p>Piotr Wozniak, \""渐进学习中的其它技能\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsupermemo%2Fwiki%2Fadditional"" target=""_blank"" rel=""nofollow ugc"">https://www.yuque.com/supermemo/wiki/additional</a>_skills_in_il. <a href=""#footnotes-ref-59"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-60""><p>Piotr Wozniak, \""渐进学习\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhelp.supermemo.org%2Fwiki%2FIncremental"" target=""_blank"" rel=""nofollow ugc"">https://help.supermemo.org/wiki/Incremental</a>_learning#What_is_incremental_learning. <a href=""#footnotes-ref-60"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-61""><p>Piotr Wozniak, \""创造性阐述\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F655902449"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/655902449</a>. <a href=""#footnotes-ref-61"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-62""><p>Andy Matuschak, \""Karpicke, J. D., &amp; Smith, M. A. (2012). Separate mnemonic effects of retrieval practice and elaborative encoding. Journal of Memory and Language, 67(1), 17–29\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fnotes.andymatuschak.org%2Fz799fHyRM3qXFTLeEXUZQV7"" target=""_blank"" rel=""nofollow ugc"">https://notes.andymatuschak.org/z799fHyRM3qXFTLeEXUZQV7</a>. <a href=""#footnotes-ref-62"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-63""><p>Andy Matuschak, \""间隔重复记忆系统让记忆更加自动化，从而有助于更深入的琢磨思考\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F468172742"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/468172742</a>. <a href=""#footnotes-ref-63"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-64""><p>Andy Matuschak, \""编写卡片有助于阅读理解\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F678936570"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/678936570</a>. <a href=""#footnotes-ref-64"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-65""><p>Piotr Wozniak, \""如何解决任何问题？\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F351779186"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/351779186</a>. <a href=""#footnotes-ref-65"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-66""><p>Andy Matuschak, \""每日工作日志\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F526326964"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/526326964</a>. <a href=""#footnotes-ref-66"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-67""><p>Andy Matuschak, \""反向链接可以用来隐式定义知识管理系统中的节点\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F443475039"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/443475039</a>. <a href=""#footnotes-ref-67"" class=""vditor-footnotes__goto-ref"">↩</a> <a href=""2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-68""><p>Andy Matuschak, \""优先建立信息间的关联本体，而非使用层级式分类法\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F433087599"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/433087599</a>. <a href=""#footnotes-ref-68"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-69""><p>Andy Matuschak, \""外出时方便抓住灵感的口袋便笺\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F532646217"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/532646217</a>. <a href=""#footnotes-ref-69"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-70""><p>Andy Matuschak, \""笔记标题建议使用完整的句子，避免模糊主张\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F422262632"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/422262632</a>. <a href=""#footnotes-ref-70"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-71""><p>Andy Matuschak, \""在写作时创建推测性大纲\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F446450875"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/446450875</a>. <a href=""#footnotes-ref-71"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-72""><p>Andy Matuschak, \""常青笔记之间应该建立大量链接\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F426450021"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/426450021</a>. <a href=""#footnotes-ref-72"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-73""><p>Andy Matuschak, \""Release valves for non-linear thought may support improved linear output\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fnotes.andymatuschak.org%2FzDGk8tvVDD1mbTgpMMB5UGh"" target=""_blank"" rel=""nofollow ugc"">https://notes.andymatuschak.org/zDGk8tvVDD1mbTgpMMB5UGh</a>. <a href=""#footnotes-ref-73"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-74""><p>Conor White-Sullivan, <a href=""https://ld246.com/forward?goto=https%3A%2F%2Ftwitter.com%2FConaw%2Fstatus%2F1439310711000207365"" target=""_blank"" rel=""nofollow ugc"">https://twitter.com/Conaw/status/1439310711000207365</a>. <a href=""#footnotes-ref-74"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-75""><p>Shipman, F. M., &amp; Marshall, C. C. (1999). Formality Considered Harmful: Experiences, Emerging Themes, and Directions on the Use of Formal Representations in Interactive Systems. <em>Computer Supported Cooperative Work (CSCW)</em> , <em>8</em>(4), 333–352. <a href=""#footnotes-ref-75"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-76""><p>Conor White-Sullivan, <a href=""https://ld246.com/forward?goto=https%3A%2F%2Ftwitter.com%2FConaw%2Fstatus%2F1099184479464185861"" target=""_blank"" rel=""nofollow ugc"">https://twitter.com/Conaw/status/1099184479464185861</a>. <a href=""#footnotes-ref-76"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-77""><p>叶秀山. 古中国的歌：—叶秀山京剧论札[M]. 中国人民大学出版社 <a href=""#footnotes-ref-77"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-78""><p>Piotr Wozniak, \""使用 SuperMemo 进行神经学习\"", <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsupermemo%2Fwiki%2Fneural"" target=""_blank"" rel=""nofollow ugc"">https://www.yuque.com/supermemo/wiki/neural</a>_learning_with_supermemo. <a href=""#footnotes-ref-78"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
</ol></div>
                

作者：dammy
链接：https://ld246.com/article/1711024416183
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",dammy,思源笔记,链滴优选
724,闪卡功能改进的意见征求 - 链滴,Sat Mar 09 2024 14:12:19 GMT+0000 (Coordinated Universal Time),"
                    <p>目前闪卡的改进，无论是官方改进还是第三方改进都已经达到了一定的瓶颈，必须考虑是需要基于现在的闪卡结构进行改进，还是开始考虑重构闪卡系统以支持更多的功能，所以现在需要征求意见。</p>
<p>注意，要是优先实现不重构的功能，那么重构就会变得更加难实现，甚至会直接放弃。</p>
<p>不需要重构就能实现的功能：</p>
<ul>
<li class=""vditor-task"">  抽认卡审核界面添加卡片审核时间、状态等信息</li>
<li class=""vditor-task"">  抽认卡支持自定义复习时间</li>
<li class=""vditor-task"">  改进抽认卡审查计数显示</li>
<li class=""vditor-task"">  抽认卡支持 flag</li>
<li class=""vditor-task"">  抽认卡支持标签</li>
<li class=""vditor-task"">  抽认卡支持暂停</li>
<li class=""vditor-task"">  支持在复习时删除当前抽认卡</li>
<li class=""vditor-task"">  抽认卡支持多种设置</li>
</ul>
<p>需要前后端重构才能实现的</p>
<ul>
<li class=""vditor-task"">  动态更新复习时的闪卡列表（1min 后的闪卡不用复习完一轮或重新打开就能在 1min 后见到）</li>
<li class=""vditor-task"">  支持键盘输入答案、多选题、database 闪卡等非块遮挡闪卡</li>
<li class=""vditor-task"">  支持一块制多卡（双向闪卡和标记分组）</li>
<li class=""vditor-task"">  支持一张闪卡对应多个块</li>
</ul>
<p><div class=""articlePoll"">
    <h3>重构还是功能</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            109 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1709964668133"">
            <div class=""poll__percent"" style=""width: 94%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    支持优先重构
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    94%
                    <span class=""ft__fade"">•</span>
                    103 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1709964668184"">
            <div class=""poll__percent"" style=""width: 5%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    支持优先功能
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    5%
                    <span class=""ft__fade"">•</span>
                    6 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
                

作者：zxhd86
链接：https://ld246.com/article/1709964739844
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
664,思源出现启动卡死、内核丢失的用户请注意！ - 链滴,Mon Mar 04 2024 00:31:14 GMT+0000 (Coordinated Universal Time),"
                    <p>近期论坛内和群里面都出现有大量用户反映启动页面卡死、出现「内核丢失」的情况。</p>
<blockquote>
<p>这个问题我其实几周之前就在论坛里面提过了，但是这几天突然又高发，所以再次提醒一下。</p>
</blockquote>
<h3 id=""问题主要表现为"">问题主要表现为</h3>
<ol>
<li>
<p>卡死在启动界面无法动弹</p>
<p><img src=""https://b3logfile.com/file/2024/03/7cc1af04cc33129ce4f91ba39c29e6bf-m78G7gN.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>出现「内核丢失」的警告页面</p>
<p><img src=""https://b3logfile.com/file/2024/03/image-RmQR1Y5.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<blockquote>
<p>论坛内的相关报错帖子</p>
<ul>
<li><a href=""https://ld246.com/article/1709474050711"">求助页面卡死强退后无法重新打开</a></li>
<li><a href=""https://ld246.com/article/1709458323166"">内核程序丢失 Kernel program is missing</a></li>
</ul>
</blockquote>
<p>如果你不能确定自己是不是这个问题，可以看一下思源的安装目录下，resources/kernel 里面的 exe 文件是否还在，如果不再，基本可以肯定就是思源内核文件被杀毒软件干掉了。</p>
<p><img src=""https://b3logfile.com/file/2024/03/c71c8c4223c1efd5af302347688cd434-PniT43p.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""问题的大致原因"">问题的大致原因</h3>
<p>这个情况我在几周之前就提到过了，主要 defender 发癫，把思源程序识别成了病毒，所以误杀了。</p>
<p>详情见这个帖子： <a href=""https://ld246.com/article/1707326088452"">如何让 Defender 将思源加入排除项，以防止误杀</a></p>
<h3 id=""解决方案"">解决方案</h3>
<p>先加白名单，然后重装。否则如果直接重装会再次被 defender 干掉。</p>
<p>还没被 defender 干掉的也可以防御性地设置一下白名单。</p>
<ol>
<li>将思源加入 defender 白名单
<ul>
<li>详情见： <a href=""https://ld246.com/article/1707326088452"">如何让 Defender 将思源加入排除项，以防止误杀</a></li>
<li>注意：建议直接把<strong>整个安装目录</strong>加入白名单，否则思源更新后 defender 可能翻脸不认人</li>
</ul>
</li>
<li>重新安装思源
<ul>
<li>如果用户是开启了自动更新功能，可以在自己的工作空间目录的 temp\\install 目录下找到最新版的安装文件</li>
<li><img src=""https://b3logfile.com/file/2024/03/65fb3589c178e352981578711d32dee1-aOwscqM.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ol>
<p>defender 的名声一直是毁誉参半，大家如果不信任他也可以选择弃用 defender，采用火绒之类的比较“文静”的防护软件。</p>
                

作者：Frostime
链接：https://ld246.com/article/1709483475015
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
698,思源出现启动卡死、内核丢失的用户请注意！ - 链滴,Mon Mar 04 2024 00:31:14 GMT+0000 (Coordinated Universal Time),"
                    <p>近期论坛内和群里面都出现有大量用户反映启动页面卡死、出现「内核丢失」的情况。</p>
<blockquote>
<p>这个问题我其实几周之前就在论坛里面提过了，但是这几天突然又高发，所以再次提醒一下。</p>
</blockquote>
<h3 id=""问题主要表现为"">问题主要表现为</h3>
<ol>
<li>
<p>卡死在启动界面无法动弹</p>
<p><img src=""https://b3logfile.com/file/2024/03/7cc1af04cc33129ce4f91ba39c29e6bf-m78G7gN.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>出现「内核丢失」的警告页面</p>
<p><img src=""https://b3logfile.com/file/2024/03/image-RmQR1Y5.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<blockquote>
<p>论坛内的相关报错帖子</p>
<ul>
<li><a href=""https://ld246.com/article/1709474050711"">求助页面卡死强退后无法重新打开</a></li>
<li><a href=""https://ld246.com/article/1709458323166"">内核程序丢失 Kernel program is missing</a></li>
</ul>
</blockquote>
<p>如果你不能确定自己是不是这个问题，可以看一下思源的安装目录下，resources/kernel 里面的 exe 文件是否还在，如果不再，基本可以肯定就是思源内核文件被杀毒软件干掉了。</p>
<p><img src=""https://b3logfile.com/file/2024/03/c71c8c4223c1efd5af302347688cd434-PniT43p.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""问题的大致原因"">问题的大致原因</h3>
<p>这个情况我在几周之前就提到过了，主要 defender 发癫，把思源程序识别成了病毒，所以误杀了。</p>
<p>详情见这个帖子： <a href=""https://ld246.com/article/1707326088452"">如何让 Defender 将思源加入排除项，以防止误杀</a></p>
<h3 id=""解决方案"">解决方案</h3>
<p>先加白名单，然后重装。否则如果直接重装会再次被 defender 干掉。</p>
<p>还没被 defender 干掉的也可以防御性地设置一下白名单。</p>
<ol>
<li>将思源加入 defender 白名单
<ul>
<li>详情见： <a href=""https://ld246.com/article/1707326088452"">如何让 Defender 将思源加入排除项，以防止误杀</a></li>
<li>注意：建议直接把<strong>整个安装目录</strong>加入白名单，否则思源更新后 defender 可能翻脸不认人</li>
</ul>
</li>
<li>重新安装思源
<ul>
<li>如果用户是开启了自动更新功能，可以在自己的工作空间目录的 temp\\install 目录下找到最新版的安装文件</li>
<li><img src=""https://b3logfile.com/file/2024/03/65fb3589c178e352981578711d32dee1-aOwscqM.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ol>
<p>defender 的名声一直是毁誉参半，大家如果不信任他也可以选择弃用 defender，采用火绒之类的比较“文静”的防护软件。</p>
                

作者：Frostime
链接：https://ld246.com/article/1709483475015
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
666,Notion 的本地平替！思源笔记 v3.0 发布! - 链滴,Wed Feb 21 2024 23:43:09 GMT+0000 (Coordinated Universal Time),"
                    <p>我的主力笔记软件是思源笔记，从思源笔记内测就开始使用，已经使用了将近三年了，我用思源笔记搭建起了个人的知识体系，记录了从本科的课程笔记、本科毕业论文草稿，到研究生的专业笔记、各类课程论文稿子（我探索出思源笔记直接导出规范学术文档 word 的方法），再到个人的各种兴趣爱好笔记，从某方面而言，思源笔记上记录的那些笔记，或许就是我当下最宝贵的财富吧！</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/思源笔记主页-20240222000010-o92k0ev.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/思源笔记主页-20240222014217-84qo4dr.webp""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/思源笔记主页摄影-20240222014216-pjlr9cc.webp""></p>
<p>自思源笔记从 2021.07.15 发布 v1.2 版废弃 Markdown 编辑器，改用 notion 类编辑器以来，就一直期待着什么时候在思源笔记也能使用上 notion 的 database 功能，而现在！经过两年半的漫长迭代，在思源笔记 v3.0，database 功能中终于登场了！！！完全免费！本地即可使用！</p>
<p>database，或者中文叫数据库、多维表，如果你是一个重度的 PKM 者，应该并不陌生，简单介绍下，就是高级的表格，这个表格可以有不同的数据类型的列，如单选列、多选列、日期列、数字列、勾选列，还能进行排序、过滤、计算、关联其他数据库字段等功能。数据库还有多种视图，表格视图、画廊视图、日历视图、时间线视图等等，使用数据库可以对项目笔记进行很好的管理。</p>
<p>目前思源笔记的列类型有</p>
<ul>
<li>文本</li>
<li>数字</li>
<li>单选</li>
<li>日期</li>
<li>资源（即文件类型）</li>
<li>勾选框</li>
<li>链接</li>
<li>邮箱</li>
<li>电话</li>
<li>创建时间</li>
<li>更新时间</li>
<li>模板</li>
<li>关联和汇总列</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-21_22-51-19-20240221225148-cdyd6u3.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""数据库功能有何应用场景"">数据库功能有何应用场景</h2>
<h3 id=""常见使用场景"">常见使用场景</h3>
<p>如果在 B 站、小红书等平台搜索 notion、flowus 等教程，其实很多博主都会花很大的篇幅介绍数据库功能。</p>
<p>在网上，最常见的数据库应用场景主要有：</p>
<ul>
<li>
<p>作为高级表格，可以进行排序、过滤、计算，信息一目了然！，比如记账、比较不同产品</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/image-20240101190205-knsgxx8.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-22_00-49-10-20240222004920-oqp76s1.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>整理书影音、文献笔记，打造个人图书馆</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-21_23-08-08-20240221230810-9cifhm1.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-21_23-07-28-20240221230744-vpfpoql.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>制作 TODO list，进行简单的待办事项管理、习惯打卡</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/image-20240101190231-gjglnl2.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-22_09-22-19-20240222092232-yxm2ypd.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ul>
<p>下面是我自己用思源笔记制作的博客笔记数据库，由于我个人兴趣爱好比较多，之前没数据库功能之前，都是管理文章的块引链接，但是类别多，管理是很困难的。</p>
<p>如今使用数据库功能就方便多了，</p>
<ul>
<li>可以给每篇文章添加类别、表情、摘要、创建时间、更新时间等信息</li>
<li>可以根据需要进行筛选和排序</li>
<li>可以建立不同的视图，在某个视图内指定特定的筛选、排序条件，比如我就根据文章类别创建了不同类别的视图，直接点击就可以看到对应类别的所有文章</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-21_22-43-11-20240221224318-yvw4ni6.png?imageView2/2/interlace/1/format/webp""></p>
<p>因为数据库是新功能，我目前用的还不多，笔记也不够完善</p>
<p>比如再举一个用数据库管理文献笔记</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-21_22-55-27-20240221225532-2h5nqwd.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""使用-MOC-和数据库来管理笔记冲突吗-"">使用 MOC 和数据库来管理笔记冲突吗？</h3>
<p>需要注意的是<strong>使用 MOC 和数据库来管理笔记并不冲突，甚至互补</strong>。MOC 非常适合整理某个领域笔记，使用列表、表格等方式辅以各级标题来梳理内容，可以具备树形层级结构，而数据库则倾向于并列管理项目笔记，没有强层级关系，如读书、读文献、写文章、项目待办事项，可能属于不同的类别、有明确的起始和截止时间等特征。使用 MOC+ 数据库可以从自上而下的角度来管理笔记，加之思源本身就很完备的 dailynote 从自下而上的角度积累笔记，使得思源笔记的笔记管理功能更加完善！<strong>自上而下 + 自下而上</strong>的 INKP 笔记法，这也是我阅读完 L 先生的《打开心智》一书之后，所推崇的笔记方法。（这本书很推荐，对搭建个人知识体系感兴趣的朋友们建议阅读，有机会我再介绍我现在的笔记方法和理念）</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-22_00-13-36-20240222001423-5bwpc3f.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-22_00-14-59-20240222001505-4ssfgl0.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""思源笔记数据库功能的独特之处"">思源笔记数据库功能的独特之处</h2>
<ul>
<li><strong>数据库添加行可以不是文档</strong>：数据库的一行可以是文档、任何一个块，还可以是一个普通文本，创建非常省心，没有强制把数据库和文档绑定。</li>
<li><strong>数据库可以块引搜索来绑定文档和内容块</strong>：思源笔记的数据库不仅可以在数据库中绑定新建的文档，还能块引绑定过去创建的文档/内容块，这样不会在使用数据库的过程中创建过多冗余的文档。</li>
<li><strong>镜像数据库</strong>：复制数据库块后粘贴将形成镜像数据库，这些数据库块共享相同的数据库数据，修改任何一个数据库块的数据会同步到其他所有镜像中，可以在不同的笔记放置数据库，便于维护数据库</li>
</ul>
<h2 id=""思源笔记数据库的基本使用笔记"">思源笔记数据库的基本使用笔记</h2>
<ul>
<li>
<p>如何新建条目</p>
<p>有两个新建条目按钮，一个可以在前面添加条目，一个可以在后面添加条目</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/image-20231216142550-ksqh4tb.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>如何使用多视图功能</p>
<p>可以建立<strong>多个视图</strong>来管理复杂数据，不同视图使用不同的条件来排序、筛选</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/image-20231216142459-9f6fkvh.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p><strong>如何对多视图功能进行排序</strong></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/image-20231217122547-lmoj6z0.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p><strong>数据库关联列和汇总列怎么使用</strong></p>
<p>两个数据库之间可以通过 <kbd>关联</kbd> 建立联系，以便联动管理。比如 <code>作者</code> 和 <code>书籍</code> 两个数据库之间的关联：</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1610205759005/assets/Clip_2024-02-22_01-00-37-20240222010041-93c86s9.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p><strong>数据库的模板列怎么使用</strong></p>
<ul>
<li>比较复杂，需要一点代码，一般人不建议使用</li>
<li>可以参考<a href=""https://ld246.com/article/1704882883131"">模板列代码分享【新】 - 链滴 (ld246.com)</a></li>
</ul>
</li>
</ul>
<h2 id=""思源笔记数据库的未来展望"">思源笔记数据库的未来展望</h2>
<p>v3.0 目前只推出了最实用的表格视图，官方表示下一个视图会是看板视图，可以期待下，思源在不远的未来上线更多的数据库视图！</p>
<p>‍</p>
<h2 id=""相关参考链接"">相关参考链接</h2>
<ul>
<li><a href=""https://ld246.com/article/1708493218325"">数据库功能简介 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1695732053015"">数据库（属性视图）公测反馈 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1704882883131"">模板列代码分享【新】 - 链滴 (ld246.com)</a></li>
</ul>
<p>‍</p>
                

作者：Achuan-2
链接：https://ld246.com/article/1708530190182
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",Achuan-2,思源笔记,链滴优选
672,尽管不想扫兴，但我还是憋不住了！ - 链滴,Wed Feb 21 2024 20:04:49 GMT+0000 (Coordinated Universal Time),"
                    <p>思源更新到 3.0 了，我的心里也很高兴，我最近正在拿思源写少数派年度征文的投稿，心情极佳。</p>
<p>但我心里也有一片阴云，那就是我对思源目前的路线感到非常的担忧。不过我还是有充足的信心，所以我又充了 2 年。</p>
<hr>
<p>现在是思源最最最危险的时刻，甚至 2.0 以前的不良反链体验时代都没这么危险！</p>
<p>原因只有一点：<strong>数据库是一种好东西，但以个人的力量去做数据库不是一个好选择。</strong></p>
<p>如果说一个清醒的成年人大脑，每天提供的心智力量可以结算成 100 能量币。</p>
<p>那么数据库就是一种启动容易，维护难的东西。换句话说，数据库里的数据量较少的时候，它的成本极低，我们不妨设此时的开支为：5 能量币。</p>
<p>但是，随着数据量的增长，维护其的成本会逐渐逐渐增加，因为当今的世界变化很快，一个与现实世界不符的数据是没有意义的，甚至还有误导作用。所以只要你制作了数据库，为了让它发挥作用，你就必须保障你有能力维护它跟进变化。</p>
<p>也就是说，一个数据库刚创建的那一刻，其实开销很低，但是它会“5 能量币”、“10 能量币”、“15 能量币”...这样，在后期开始吞噬心智资源，消耗巨量能量币。</p>
<p>而因为这笔开支并不直观，所以往往用户都会体现出一个特征：</p>
<p><strong>1.很轻易的创建了数个数据库，好像贷款买东西一样大手大脚。</strong></p>
<p><strong>2.饶有兴致的维护数据库，扩大数据库规模。</strong></p>
<p><strong>3.无力支付能量币开销，开始停用部分数据库。</strong></p>
<p><strong>4.维护数据库已经严重耽搁学习或生产，弃坑。</strong></p>
<hr>
<p>除了心智开销，第二个隐患地雷是：<strong>思源笔记是由 D 和 V 这两个个人开发者承担的。</strong></p>
<p>数据库和白板，这两个功能是 Bug 重灾区。不信的可以去看看 Ipad 上各种白班软件和 notion、flowus 之类的更新记录，看看是不是这样。</p>
<p>数据库不仅对用户造成压力，而且对于开发者来说也是压力重重！数据库功能出 bug 了，要不要修？不修，用户数据库没了~</p>
<p>现在还只是做了数据库功能，等白板再一落地，两条路线上的各种 bug 不会给情面，呼啸而至的那天，D 和 V 天天修 bug 玩？链滴社区里吐槽 bug 的会不会越来越多？会不会因为数据库和白板的 bug，影响到只是想用用双链和编辑器的用户？劝退新人......</p>
<p>问题太多了！</p>
<hr>
<p>再提一下接下来的一记绝杀：<strong>白板是一种比数据库心智消耗还恐怖的功能，绝对不应该乱加！就算加，也一定要以可关闭取消形态出现！（我把话放在这里）</strong></p>
<p>我在之前的回答中也解释了白板的弊病，这里不再赘述：</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F639608415%2Fanswer%2F3364440413%3Futm_psn%3D1743720476248256512"" target=""_blank"" rel=""nofollow ugc""></a></p>
<p>一旦白板落地，每个人的大脑每天 100 能量币，数据库 + 白板起码吃掉 90 块能量币！什么都做不了，天天手搓数据库玩。</p>
<hr>
<p>**建立在个人层面上的数据库维护工作是极为无力的。**不信的可以多去知网看看，看看知网的数据库。</p>
<p>就像我之前说个人笔记的所谓“知识图谱”做 100 年都赶不上现成的知识图谱一样。</p>
<p>因为人家是一个公司！一个集团！甚至一个国家之力打造的！</p>
<p>点开知网或者谷歌学术的知识图谱，看一看，那是**TB 级别的信息量，一个人每分钟看一条，40 年都看不完！**为什么不用现成的呢？</p>
<p>我花 60 块进学术信息库逛一天，捞出来的信息一个礼拜都消化不完，真的，有那时间当“数据库匠人”，都不如拿这比时间多赚点，开几个内参会员。</p>
<hr>
<p><strong>Obsidian 是很火，但火不代表路一定正确。</strong></p>
<p>Obsidian 百花齐放的插件市场养活了无数效率教练，自媒体博主，假学习小子。但 Obsidian 用户群体除了在效率工具和笔记法领域频频出场外，真的没有什么切实的产出。</p>
<p>思源笔记本身通过出色的编辑器和可结构可大纲的存储结构、本地化安全性等等，在写作与对外输出上本身是建立了一个很难比拟的优势的。</p>
<p>不客气的说，思源笔记的写作舒适度，比一些华而不实的诸如 Effie、小黑屋等软件强了不知道多少倍！</p>
<p>但思源现在明显被社区小白绑架太深太深，导致许多功能上都没有办法往“深度”上去靠拢，就好像地上有 100 口土坑和一口深井那样的区别。大，却不精。</p>
<p>单举例说一个闪卡，目前也就处于“能用，但不好用”这样一个水平。</p>
<hr>
<p>这样下去，大而全，结果每个功能都不深的形态，像不像逝去的印象笔记？！</p>
<p>大家因为什么逃离的印象笔记，才几年呐？忘啦！</p>
<p>我是真心劝链滴社区和 D、V 姐，找时间好好想想。</p>
<hr>
<p>我这人，话可能很难听，但我确实从 3 年前，一直用思源，我在思源上写了几乎所有知乎文章，光是纯文本就积累了 120mb，都是我一个字一个字敲出来的。</p>
<p>我真的很喜欢思源笔记，不希望它走上“精力快速消费机”的路。思源本可以在：输入 → 结构化 → 输出发布这条路线上大有作为，完全没必要和别人去比数据的存储性。<strong>坦白说，我不认为目前有什么写作软件能同时在数据收集、建立索引、结构化、文档编辑与数据安全上同时与思源打擂台。</strong>  就连专业写作软件 Sc 和写拉松目前都很难掰掰手腕。思源完全可以走些护城河极高的路出来。</p>
<p>最后一句：</p>
<blockquote>
<p>如果一个系统只专注于内部整理，那么最好的结果也不过是赛博朋克。</p>
</blockquote>
                

作者：NishikigiReeves
链接：https://ld246.com/article/1708517089764
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",NishikigiReeves,思源笔记,链滴优选
669,数据库功能简介 - 链滴,Wed Feb 21 2024 13:26:57 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>阅读本帖时打开思源笔记并打开帮助文档效果更佳，部分链接会跳转到思源帮助文档</p>
</blockquote>
<p>思源笔记 3.0 版面向所有用户正式推出了数据库功能。本文将对数据库功能进行介绍。</p>
<h2 id=""数据库可以用来干嘛-"">数据库可以用来干嘛？</h2>
<p>主要用途是对信息进行汇总，比如可以做一个影视库。</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240221132549-a4k6ib9.png?imageView2/2/interlace/1/format/webp""><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240221132623-zxviycx.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""思源的数据库和其他软件的区别"">思源的数据库和其他软件的区别</h2>
<p>在我之前的帖子 <a href=""https://ld246.com/article/1695732053015"">数据库（属性视图）公测反馈 - 链滴 (ld246.com)</a> 中，将数据库功能划分成了多维表格、notion 数据库、属性视图三大类，目前思源的数据库功能是多维表格 +notion 数据库的结合体，数据库主键既可以是纯文本，也可以是页面，不过目前仅有表格视图，画廊视图、日历视图等还未开发。</p>
<h2 id=""插入数据库块"">插入数据库块</h2>
<p>在文档中插入数据库：按 <code>/</code> 键，然后输入 <code>sjk</code>，回车。</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/插入数据库-20240220210059-nluhkkd.gif""></p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240220234306-5u6k048.png?imageView2/2/interlace/1/format/webp""></p>
<p>数据库块的结构如上图，表格的第一列是主键列，主键既可以是文本，也可以是块引用，在主键单元格内双击 <code>[</code> 键就能对块进行引用。</p>
<h2 id=""数据库列类型"">数据库列类型</h2>
<p>数据库的列类型有：</p>
<ul>
<li>文本</li>
<li>数字</li>
<li>单选</li>
<li>多选</li>
<li>日期（和时间）</li>
<li>创建时间。当前行的创建时间。</li>
<li>更新时间。当前行的更新时间。</li>
<li>资源。可以插入各种文件</li>
<li>勾选框</li>
<li>链接</li>
<li>邮箱</li>
<li>电话</li>
<li>关联</li>
<li>汇总</li>
<li>模板</li>
</ul>
<p>前面的类型都比较好理解，关联、汇总、模板算是进阶的列类型。</p>
<h2 id=""关联列与汇总列"">关联列与汇总列</h2>
<p>关联列是用来在两个数据库间建立联系的，关联列关联的是另一个数据库的主键。</p>
<p>关联列相较于文本列的好处在于：</p>
<ol>
<li>可以在两个数据库间建立联系，数据库 A 修改后，数据库 B 中的相关列也会同步修改。</li>
<li>可以使用汇总列对所关联的数据库信息进行汇总。</li>
<li>@<a href=""https://ld246.com/member/88250"" class=""tooltipped__user"" target=""_blank"">88250</a> ，希望增加跳转到关联数据库的功能，最好能跳转到具体的行。</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/关联列-20240221130320-5lihyqc.gif""></p>
<p>汇总列是与关联列配套使用的，举个栗子，前文的<strong>电影</strong>数据库的<strong>导演</strong>、<strong>演员</strong>列关联了<strong>人员</strong>数据库的主键（由于是双向关联，所以自动在<strong>人员</strong>数据库生成了<strong>电影导演</strong>和<strong>电影演员</strong>列），在人员数据库中增加一个汇总列，则可以用汇总列在人员数据库中对电影数据库中的信息进行汇总，比如汇总当前人员担任导演的电影总票房。</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/汇总列-20240221124333-4c5wsi9.gif""></p>
<h2 id=""模板列"">模板列</h2>
<p>请查看模板的终极教程：<a href=""https://ld246.com/article/1715065433237"">思源模板功能新人指南：模板语法 + 函数 + md 块语法 - 链滴 (ld246.com)</a></p>
<p>下面这些也可以参考：</p>
<ul>
<li>官方帮助文档 <a href=""https://ld246.com/forward?goto=siyuan%3A%2F%2Fblocks%2F20240208120846-72y7j0d"" target=""_blank"" rel=""nofollow ugc"">模板</a></li>
<li><a href=""https://ld246.com/article/1703040304584"">数据库模板列简单使用指南 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1704882883131"">模板列代码分享【新】 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1713177507282"">数据库进度条模板 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1709866964464"">分享数据库模板列的一些有趣实现 - 链滴 (ld246.com)</a></li>
</ul>
<h2 id=""数据库的保存与显示"">数据库的保存与显示</h2>
<p>数据库的数据在 <code>工作空间\\data\\storage\\av</code> 文件夹下以 json 格式保存。</p>
<blockquote>
<p>av, attribute view, 属性视图。</p>
<p>数据库功能最早是叫属性视图，后来随着功能的变化，改叫数据库了。</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240220192406-6xmpdh6.png?imageView2/2/interlace/1/format/webp""></p>
<p>上图是帮助文档中的一个<a href=""https://ld246.com/forward?goto=siyuan%3A%2F%2Fblocks%2F20240208163916-efx3nkg"" target=""_blank"" rel=""nofollow ugc"">数据库</a>，在 av 文件夹中的 json 文件内容为：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""spec\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-rxu3llx\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""账单\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""keyValues\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""key\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-odyw3i7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""成员\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""block\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""icon\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""numberFormat\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""template\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""values\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163921-wnf3fqx\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""keyID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-odyw3i7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""blockID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163920-51nyfyp\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""block\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""isDetached\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""block\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163920-51nyfyp\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""Daniel\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""created\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1707381561387</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""updated\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1707381900674</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164408-fwrlt7q\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""keyID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-odyw3i7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""blockID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164407-q5jgzt1\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""block\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""isDetached\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""block\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164407-q5jgzt1\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""Vanessa\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""created\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1707381848145</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""updated\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1707381890239</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""key\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164200-aoez2h2\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""餐饮\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""number\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""icon\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""numberFormat\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""template\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""values\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164415-frgrrdi\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""keyID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164200-aoez2h2\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""blockID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164407-q5jgzt1\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""number\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""number\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">200</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""isNotEmpty\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""format\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""formattedContent\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164450-ssb7h5h\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""keyID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164200-aoez2h2\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""blockID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163920-51nyfyp\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""number\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""number\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">100</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""isNotEmpty\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""format\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""formattedContent\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""key\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164420-mwu0h5t\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""服装\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""number\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""icon\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""numberFormat\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""template\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""values\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164441-woggrha\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""keyID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164420-mwu0h5t\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""blockID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164407-q5jgzt1\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""number\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""number\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">200</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""isNotEmpty\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""format\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""formattedContent\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164457-fzglttu\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""keyID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164420-mwu0h5t\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""blockID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163920-51nyfyp\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""number\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""number\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""content\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">100</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""isNotEmpty\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""format\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""formattedContent\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""key\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164505-39qizr5\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""模板\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""template\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""icon\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""numberFormat\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""template\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\"".action{ addf .餐饮 .服装 }\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""viewID\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-47rg4d7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""views\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-47rg4d7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""icon\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""表格\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""type\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""table\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""table\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""spec\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-o93ff8j\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""columns\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208163918-odyw3i7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""wrap\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""hidden\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""pin\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""152px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164200-aoez2h2\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""wrap\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""hidden\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""pin\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""97px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164420-mwu0h5t\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""wrap\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""hidden\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""pin\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""126px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">},</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""id\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""20240208164505-39qizr5\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""wrap\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""hidden\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""pin\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">				<span class=""highlight-nt"">\""width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""129px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-p"">}],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""rowIds\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[</span><span class=""highlight-s2"">\""20240208164407-q5jgzt1\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s2"">\""20240208163920-51nyfyp\""</span><span class=""highlight-p"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""filters\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""sorts\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">[],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""pageSize\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">50</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">}]</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>我们在文档中插入一个数据库块，实际上只是引用了这个数据库的 ID，数据并没有保存在这个文档的.sy 文件中，上图数据库块实际内容为：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""NodeAttributeView\""</span> <span class=""highlight-na"">data-av-id</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""20240208163918-rxu3llx\""</span> <span class=""highlight-na"">data-av-type</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""table\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>所以我们复制、粘贴数据库块的时候得到的是一个<a href=""https://ld246.com/forward?goto=siyuan%3A%2F%2Fblocks%2F20240208115420-4440x2c"" target=""_blank"" rel=""nofollow ugc"">镜像数据库</a>，新旧数据库块均引用了同一个数据库 json 文件，操作不同的镜像数据库块实际上是在操作同一个 json 文件，所以数据会在镜像数据库块中同步。数据库的视图配置也是保存在 json 文件中的，所以镜像数据库会拥有一样的视图。</p>
<p><del>@<a href=""https://ld246.com/member/88250"" class=""tooltipped__user"" target=""_blank"">88250</a>  镜像数据库显示同样的视图这个设定是不合理的，数据库块显示的视图 ID 应该保存在数据库块中，这样不同的块就能显示不同的视图。</del></p>
<p>如果说数据库是一座房子，视图就是房子的窗户，透过不同的窗户可以看到不同的房间、不同的内容。目前数据库块已经能够通过 ial 属性指定视图 ID。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""NodeAttributeView\""</span> <span class=""highlight-na"">data-av-id</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""20240320162849-h7ft87i\""</span> <span class=""highlight-na"">data-av-type</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""table\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: id=\""20240328185202-s4wb423\"" updated=\""20240328185202\"" custom-sy-av-view=\""20240412114213-t3jq34i\""}
</span></span></code></pre>
<p>我们可以总结：</p>
<ul>
<li>数据库：实质是 <code>工作空间\\data\\storage\\av</code> 文件夹下某个 json 文件。</li>
<li>数据库块：编辑器中用来显示、编辑数据库的块，实际是对数据库的引用，并不包含数据库内容。</li>
<li>镜像数据库：引用同个数据库的多个数据库块互为镜像数据库。</li>
</ul>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240220200039-5ruqae9.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>经测试，删除所有数据库块，数据库的 json 文件也不会被删除，数据库并不会因为删除数据库块而丢失。后续有需要的话可以手动引用数据库。</p>
</blockquote>
<h2 id=""数据库的深度复制"">数据库的深度复制</h2>
<p>从上个章节可以知道，直接复制数据库块只会得到镜像数据库，并不会得到数据库的副本。</p>
<p>要对数据库进行深度复制，需要使用块标菜单中的 <strong>复制 → 复制为完整副本</strong> 功能，如果没有此功能，需要升级一下思源笔记。</p>
<p>得到完整副本后，将其剪切、粘贴到需要的位置即可。</p>
<p><img src=""https://b3logfile.com/file/2024/06/数据库副本-8ntZ3SN.gif""></p>
<h2 id=""数据库与块"">数据库与块</h2>
<p>数据库的主键可以是块，在主键单元格内双击 <code>[</code> 键就能对块进行引用。数据库的属性会在块的属性面板—数据库页签中显示，可以在这个页签中对数据库进行修改。</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240221130743-hp2t98s.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击页面上的数据库名称后，会显示引用该数据库的数据库块</p>
<p><img src=""https://b3logfile.com/file/2024/02/siyuan/1647830922497/assets/image-20240221131115-o5cko7k.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""-文档原文"">‍文档原文</h2>
<p>可通过思源笔记本或文档的右键菜单导入下面的 .sy.zip 文件查看包含数据库的原文。</p>
<p><a href=""https://b3logfile.com/file/2024/02/数据库功能简介-e6Mv9TZ.sy.zip"">数据库功能简介.sy.zip</a></p>
<p><img src=""https://b3logfile.com/file/2024/02/image-tCIstx0.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：qiancang
链接：https://ld246.com/article/1708493218325
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",qiancang,思源笔记,链滴优选
667,基于思源笔记的写作、管理和分发流程 - 链滴,Thu Feb 15 2024 21:32:30 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""1--前言"">1. 前言</h2>
<p>去年初入了思源笔记的坑，使用一年体验十分优秀，基本上满足了我对知识库、笔记库的所有诉求。本地优先、优秀的编辑器、强大的扩展性和简单的同步方案，再配合上发展迅速的插件系统，已经有了相当流畅的使用体验。</p>
<p>今年年初突然重拾文青博客梦，立下了周更的 flag，在前两周实践的过程中，我发现了两个问题：</p>
<ol>
<li>集中在周日去写当周的周刊会有些吃力，记忆力的确是一日不如一日。</li>
<li>多平台发布会有一定的迁移和维护成本。</li>
</ol>
<p>因此，本着理科男能偷懒则偷偷懒的终级理念，基于思源笔记和现有的插件系统，初步解决了这两个问题，再加上能沉淀则沉淀的思路，春节期间理了一下现在的写作流程，希望能给小伙伴一些思路，更好的使用这个强大的工具。</p>
<h2 id=""2--架构总览图"">2. 架构总览图</h2>
<p>二话不说，被我司培训一年，上来不画两张麻将图怎么行。</p>
<h3 id=""2-1-数据架构图"">2.1 数据架构图</h3>
<p>数据架构图主要用来说明笔记/信息的来源、输入和输出之间的关系，体现信息流向和处理规则。</p>
<p>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240214145324-iwe9pqr.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>我日常的信息输入主要分为个人原创内容、第三方网页和个人标注内容：</p>
<ul>
<li>个人原创内容：主要记录日常的想法、事实、感受、闲言碎语，也会用于快速收集一些周刊相关的素材。</li>
<li>第三方网页：一些感兴趣或有相关的知识的网页。</li>
<li>个人标注内容：主要是我日常使用 kindle 读书的时候做的一些书摘标注，通过纸间书摘统一管理。</li>
</ul>
<p>原始素材的采集输入，按照是否碎片化采用不同的记录方式，碎片内容（非体系化的文档）直接记录在当日的 DailyNotes 中，通过双链传递，日后使用的时候，在对应的领域/专题文档的反链面板即可看到，润色、修改、重新改写都可以快速处理。非碎片化内容直接记录在领域或专题的文档中。</p>
<p>写作过程中，直接新建主题文章的文档，在新文档中将大纲列好，之后通过反链面板和提及功能，将前期整理的素材、相关文档进行重组、合并、改写、润色。</p>
<h3 id=""2-2-应用架构图"">2.2 应用架构图</h3>
<p>应用架构图主要用于描述软件应用程序的结构和组件以及它们之间的相互关系，说明承载数据架构图中涉及信息流的工具和实体。</p>
<p>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215180729-fu978mn.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>首先对架构图中涉及到的工具简单介绍：</p>
<ul>
<li>
<p>思源笔记：</p>
<ul>
<li>思源笔记在本文（我目前的写作工具流）中，是一个承前启后的关键存在。类似于大数据架构中的数据仓库，存储原始的输入，基于双链进行各主题素材的笔记重组与合并，基于素材进行领域写作与润色加工，最终作为统一输出口对接各种发布平台。</li>
</ul>
</li>
<li>
<p>采集工具</p>
<ul>
<li>
<p>Memos：</p>
<ul>
<li>Memos 是一个源端输入，主要用于收集个人原创素材，包含但不限于个人日记、感受、想法、事实、流水账等，使用 Memos 的原因是数据在自己手上，无需有隐私、安全方面的担心，有较大的自主权，不会被各种莫名其妙的原因触发删除。</li>
<li>通过 memos，可以在网页、手机 app、tg 机器人、浏览器插件快速收集内容。<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240214140149-2n37dk8.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
<li>
<p>思源小助手：思源会员特性，可以在微信快速将数据收集至思源笔记的收集箱，后期可以快速的从收集箱移动至笔记本中。小助手最大的优势是可以微信内容一键转发，并且支持将接受到的网址进行剪藏，配合思源的“下载网络图片至本地功能”，可以在手机端方便的将网页内容剪藏至本地。</p>
<ul>
<li><img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215181450-39h6k2n.png?imageView2/2/interlace/1/format/webp"">​</li>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215181741-tzjetcx.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
<li>
<p>浏览器插件：这是一个集合，包括 Siyuan、WebClipper、五彩助手（思源已有同步插件）、剪悦等等，主要用于将网页剪藏，避免 404 风险。</p>
</li>
<li>
<p>纸间书摘：一个优秀的阅读管理软件，有一揽子阅读管理相关的功能，我主要用于管理 kindle 阅读的标注，官方提供了导出至思源笔记的功能，导出的效果极优秀。</p>
<ul>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215182310-8xrx1df.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
</ul>
</li>
<li>
<p>存储工具</p>
<ul>
<li>
<p>minio</p>
<ul>
<li>minio 的作用是为发布平台提供图床，配合思源的发布插件可以实现一处写作，多处发布。</li>
<li>minio 的搭建可参考：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.xuezhao.space%2Ftech%2Fyunyuan-object-storageminio-service-deployment-z1d0saj-1.html"" target=""_blank"" rel=""nofollow ugc"">云远程对象存储-MinIO 服务部署 - XueZhao 的博客</a> 。</li>
</ul>
</li>
<li>
<p>思源 Assets：思源笔记自带的存储功能，“本地优先”的保证，所有的插入的附件都会在 Assets 中保存一份。</p>
</li>
</ul>
</li>
<li>
<p>思源插件</p>
<ul>
<li>
<p>发布工具插件</p>
<ul>
<li>
<p>思源的一款插件，可以快速将思源本地的文章统一分发到不同的平台，并且可以配合 PIGCO 插件生成本地图片到图床的映射，实现“本地使用本地图片、发布使用图床”的理想搭配。</p>
<ul>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240214141049-yk00o0f.png?imageView2/2/interlace/1/format/webp"">​</li>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240214141254-wjxk48h.png?imageView2/2/interlace/1/format/webp"">​</li>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240205223741-ktmic4k.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
</ul>
</li>
<li>
<p>PIGCO 插件</p>
<ul>
<li>
<p>思源的一款插件，可以配置图床，与发布工具搭配使用体验极佳。</p>
<ul>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240205220358-94ic3uc.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Memos 同步插件：Memos 同步插件是用于将自部署的 Memos 内容同步至思源笔记，它支持识别双链，通过打上(())的标识，可以实现关联已有的文档、新建不存在的文档。</p>
</li>
</ul>
</li>
<li>
<p>typecho、知乎、语雀、微信公众号等</p>
<ul>
<li>作为最终对外提供输出服务的出口。</li>
</ul>
</li>
</ul>
<p>通过应用架构图和工具介绍，可以说明这套本地写作的两个优点：</p>
<ol>
<li>
<p>数据安全：</p>
<ol>
<li>所有的内容和数据都在本地，配合思源的快照功能和多端同步功能，可以有相当强的容灾能力，并且有端到端加密的同步数据，隐私也无需担心。</li>
<li>本地文章使用本地图片，发布使用图床图片，实现了一个理想的搭配。</li>
</ol>
</li>
<li>
<p>统一出口，减少烟囱：多平台发布的一大难点就是难以维护</p>
<ol>
<li>
<p>多处编辑，分散发布，耗费相当大的精力，且维护困难，需要一处一处修改、订正</p>
</li>
<li>
<p>一处编辑，同时发布，后期的修改也在原本的文档基础上进行多平台更新</p>
<p>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215184357-0qm59dk.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
</ol>
</li>
</ol>
<p>‍</p>
<h2 id=""3--周刊的半自动化写作发布实践"">3. 周刊的半自动化写作发布实践</h2>
<p>周刊是我本年初立的一个 FLAG，与月总结相比，更注重生活的记录，包含小想法、感受、值得分享的学习内容、值得记录的生活趣事。在最初的写作过程中，我集中在周日花两个小时去回忆、书写本周周刊，但很快我就发现，有点煎熬。一是太考验记忆力了，需要慢慢回顾一周的事情，很容易遗忘。二是事后记录其实会遗忘当时的一些想法，失去了“记录”和分享本身，变成了总结。于是我基于思源笔记把这件事情拆解为两件事情：</p>
<ol>
<li>日常周刊相关内容的收集</li>
<li>周日的重组、合并、改写、润色</li>
</ol>
<h3 id=""3-1-收集-写作和分发流程"">3.1 收集、写作和分发流程</h3>
<ol>
<li>
<p>我采用 Memos 来进行周刊内容的收集，我会在有想法的瞬间通过手机应用、浏览器插件或者网页写下一小段内容，并且通过在开头增加((周刊))的标志来区分，这个标志可以在同步到思源的时候自动新建文档：周刊，然后将本段内容记录在当日的 DailyNotes 中，增加双链：</p>
<p>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215202600-drvw8bv.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>在每天晚上我会在思源内部（手机 APP/PC 客户端/docker 版），点击 Memos 同步，最终获得以下效果：</p>
<p>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215202531-8bdt3t7.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>此时周刊页面中，反链面板可以看到所有的相关内容。通过思源的反链相关操作进行内容的组织和润色改写。我通常是复制过来直接更改，不必担心 DailyNotes 中留存双链文本的污染，下文的操作会解决这个问题。</p>
<ol>
<li>
<p>tips1:可以在文档属性面板添加书签“写作中”，快速管理目前的写作文档</p>
</li>
<li>
<p>tips2:通过添加以下代码为模板，可以快速插入下图中“2024-02 Week 7”的标题，摘抄自集市中的模板</p>
<ul>
<li>
<pre><code class=""language-go highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">anchorSunday</span> <span class=""highlight-o"">:=</span> <span class=""highlight-s"">\""2022-12-25\""</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">yearStartDate</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">now</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">Year</span> <span class=""highlight-p"">|</span> <span class=""highlight-nx"">printf</span> <span class=""highlight-s"">\""%d-01-01\""</span> <span class=""highlight-p"">|</span> <span class=""highlight-nx"">toDate</span> <span class=""highlight-s"">\""2006-01-02\""</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">ysDateDuration</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">div</span> <span class=""highlight-p"">(</span><span class=""highlight-err"">$</span><span class=""highlight-nx"">yearStartDate</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sub</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">toDate</span> <span class=""highlight-s"">\""2006-01-02\""</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">anchorSunday</span><span class=""highlight-p"">)).</span><span class=""highlight-nx"">Hours</span> <span class=""highlight-mi"">24</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">ysWeekDay</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">mod</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">ysDateDuration</span> <span class=""highlight-mi"">7</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">yearStartWeek</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">add</span> <span class=""highlight-p"">(</span><span class=""highlight-nf"">div</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">sub</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">ysDateDuration</span> <span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">7</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">1</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-k"">if</span> <span class=""highlight-nf"">or</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">eq</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">ysWeekDay</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">gt</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">ysWeekDay</span> <span class=""highlight-mi"">4</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">yearStartWeek</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nx"">add</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">yearStartWeek</span> <span class=""highlight-mi"">1</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-nx"">end</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">nowWeek</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">add</span> <span class=""highlight-p"">(</span><span class=""highlight-nf"">div</span> <span class=""highlight-p"">(</span><span class=""highlight-nf"">div</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">now</span><span class=""highlight-p"">.</span><span class=""highlight-nf"">Sub</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">toDate</span> <span class=""highlight-s"">\""2006-01-02\""</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">anchorSunday</span><span class=""highlight-p"">)).</span><span class=""highlight-nx"">Hours</span> <span class=""highlight-mi"">24</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">7</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">1</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">week</span> <span class=""highlight-o"">:=</span> <span class=""highlight-nf"">add</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">sub</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">nowWeek</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">yearStartWeek</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">1</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span><span class=""highlight-err"">$</span><span class=""highlight-nx"">today</span><span class=""highlight-o"">:=</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">now</span> <span class=""highlight-p"">|</span> <span class=""highlight-nx"">date</span> <span class=""highlight-s"">\""2006-01\""</span><span class=""highlight-p"">)}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span><span class=""highlight-err"">$</span><span class=""highlight-nx"">weekResult</span><span class=""highlight-o"">:=</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">list</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">today</span> <span class=""highlight-s"">\""Week\""</span> <span class=""highlight-err"">$</span><span class=""highlight-nx"">week</span><span class=""highlight-p"">|</span> <span class=""highlight-nx"">join</span> <span class=""highlight-s"">\"" \""</span><span class=""highlight-p"">)}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">action</span><span class=""highlight-p"">{</span><span class=""highlight-err"">$</span><span class=""highlight-nx"">weekResult</span><span class=""highlight-p"">}</span>
</span></span></code></pre>
</li>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215202736-zsqgtwf.png?imageView2/2/interlace/1/format/webp""></li>
<li><img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215203347-q2llpy9.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
</ol>
</li>
<li>
<p>改写完成后，剪切第 3 步中生成的标题作为文档标题，通过发布插件进行发布。此时 DailyNotes 中留存的双链动态锚文本会自动变为更改后的标题，在新的一周的周刊收集时，又会生成新的《周刊》文档，此时的反链只会有与本周相关的内容，不受其他双链的污染。</p>
<ul>
<li>​<img src=""https://b3logfile.com/file/2024/02/siyuan/1685403337365/assets/image-20240215203928-hweqdgt.png?imageView2/2/interlace/1/format/webp"">​</li>
</ul>
</li>
</ol>
<p>最终效果：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.xuezhao.space%2Flife%2Fweekly-02.html"" target=""_blank"" rel=""nofollow ugc"">02.春节返程与阅读感悟 - XueZhao 的博客</a></p>
<h2 id=""附-参考文献"">附：参考文献</h2>
<ol>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fmozhux.com%2Fsi-yuan-bi-ji-fa-bu-gong-ju-pei-zhi-typechoshi-xian-yi-jian-tong-bu-fa-bu-z2ib4yq.html%2Fcomment-page-1%3FreplyTo%3D34%23respond-post-37"" target=""_blank"" rel=""nofollow ugc"">思源笔记配置 Typecho 实现一键同步发布 - 墨竹 - 自留地 (mozhux.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F665094700"" target=""_blank"" rel=""nofollow ugc"">在思源笔记中实现渐进阅读 - 知乎 (zhihu.com)</a></li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fffqk2e"" target=""_blank"" rel=""nofollow ugc"">双向链接时代的快速无压记录 (yuque.com)</a></li>
</ol>
                

作者：submartingale
链接：https://ld246.com/article/1708003951171
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",submartingale,思源笔记,链滴优选
700,如何让 Defender 将思源加入排除项，以防止误杀 - 链滴,Thu Feb 08 2024 01:14:47 GMT+0000 (Coordinated Universal Time),"
                    <p>近期有大量用户思源内核被 Defender 误杀。目前原因不明，可能是思源某些软件特点被误判为病毒软件。</p>
<p>现在最简单的方案是在 defender 中将思源加入排除选项，步骤如下</p>
<ol>
<li>打开「Defender 设置」的「病毒和威胁防护」</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/02/image-8lGOPQ1.png?imageView2/2/interlace/1/format/webp""></p>
<ol start=""2"">
<li>添加排除项</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/02/image-up1ScB3.png?imageView2/2/interlace/1/format/webp""></p>
<ol start=""3"">
<li>将思源软件的整个目录添加到排除项中（只添加 siyuan-kernel.exe 可能更新后被 defender 翻脸不认人）</li>
</ol>
<p><img src=""https://b3logfile.com/file/2024/02/image-HXRdXls.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：Frostime
链接：https://ld246.com/article/1707326088452
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
670,基于渐进学习插件的思源笔记渐进阅读流程（已添加闪卡优先级、闪卡暂停） - 链滴,Sun Jan 07 2024 11:55:51 GMT+0000 (Coordinated Universal Time),"
                    <p>阅读是一件简单又困难的事情。目的不同，需要采用的策略也会随之改变。例如当阅读小说类的内容，目的在于休息娱乐，这种目的下，阅读的要求只在于掌握大致的故事情节，对于其细则无需刻意记忆，因此少有人尝试背诵小说。而当需要学习一些专业性知识的时候，就不能采取同样策略，小说可以以极快的速度浏览完成，这个过程当中无需做笔记，无需思考，只需要专注于阅读本身；而专业性知识则需要细嚼慢咽，步步为营，思考以及基于思考而制作出来的笔记必不可少，最终达到记忆知识、理解知识。因此需要一种能够提高效率且流程顺畅的方法来予以辅助。渐进阅读就是这样的一种方法。</p>
<p>渐进阅读是 Supermemo 软件（后文使用 SM）引入的一种阅读文本的方法，其内核在于世界上最好的间隔重复算法（“<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F671340049"" target=""_blank"" rel=""nofollow ugc"">现已是 FSRS v4 算法</a>”<a href=""#_edn1"">[①]</a>）为核心创建的阅读流程。Piotr Wozniak 称之为“渐进学习是学生在当下（2013 年）最快、最全面的学习方式。”<a href=""#_edn2"">[②]</a>渐进阅读是不断产生和形成的过程，是一种不断进化的阅读状态。根据  的说明可以了解到，渐进阅读是为了解决传统低效率线性阅读的一种方法，它能够去线性化，是一系列细分为段落和单个句子的部分，并对其进行处理、制卡。</p>
<h3 id=""一-------渐进阅读流程"">一、      渐进阅读流程</h3>
<p>在渐进学习插件出现之前，基于闪卡增强插件的思源笔记（后文使用 SY）的渐进阅读流程只是对于 SM 的模仿，并没有展现出 SY 的优势。而渐进学习插件完全不同，它结合了 SY 在文档编辑上的优势，使整个过程更加的易用，流程也更加的顺畅。</p>
<p>要在 SY 中阅读，首先要做的是文本的导入，SY 在这方面优势显著，对于网页文本的内容可以使用“SiYuan 插件”<a href=""#_edn3"">[③]</a>来导入。而书籍可以在 SY 集市当中下载“导入工具”<a href=""#_edn4"">[④]</a>插件来完成。其过程并不困难，就不加以讨论。</p>
<p>其整个阅读流程以“<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F52369009"" target=""_blank"" rel=""nofollow ugc"">Anki 高考的 20 条原则(1-5)—来自《有效的学习：组织知识的 20 条原则》</a>”<a href=""#_edn5"">[⑤]</a>为例。</p>
<p>开始之前有个必读项，这是这篇文章中最最最最最重要的部分，<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F219996956"" target=""_blank"" rel=""nofollow ugc"">Anki 高考的 20 条原则—来自《有效的学习：组织知识的 20 条原则》</a>，标题里有高考字样，实际上这是提取自 SM 作者 Piotr Wozniak 的论文<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F297790034"" target=""_blank"" rel=""nofollow ugc"">基于主动回忆的学习中的知识结构与表述</a>，是做渐进阅读必须遵循的原则。</p>
<p>必看！！！！必看！！！！必看！！！！</p>
<p>必看！！！！必看！！！！必看！！！！</p>
<p>必看！！！！必看！！！！必看！！！！</p>
<p>必看！！！！必看！！！！必看！！！！</p>
<h4 id=""准备阶段"">准备阶段</h4>
<p>下载好 SiYuan 的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fchromewebstore.google.com%2Fdetail%2Fsiyuan%2Fhkcgjbeblifaincobbcfiffbpgoafepk"" target=""_blank"" rel=""nofollow ugc"">浏览器插件</a>之后，打开文章：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-7Krvrcz.png?imageView2/2/interlace/1/format/webp""></p>
<p>网页完整刷新出来之后，点击 SiYuan 插件：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-94GFbHu.png?imageView2/2/interlace/1/format/webp""></p>
<p>在出现的窗口当中，在第二行填入 SY 设置—关于—API token 中的字符后，选择文章想要保留到的文档树，再点击 Send to SiYuan 即可将当前文章剪藏进 SY 中。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-yUxCaSH.png?imageView2/2/interlace/1/format/webp""></p>
<p>如果需要导入的是电子书籍，那么请参考这篇文章：<a href=""https://ld246.com/article/1699103223806"">在思源笔记中实现渐进阅读 - 链滴 (ld246.com)</a></p>
<p>导入了文档，那么下一步就是使用“渐进学习插件”，可以在“SY 设置—集市—插件”中下载：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-Oz27I3U.png?imageView2/2/interlace/1/format/webp""></p>
<p>下载完成后，重启 SY 后在窗口的右上角看见图标<img src=""https://b3logfile.com/file/2024/01/image-ZPiJZbq.png?imageView2/2/interlace/1/format/webp"">，表示插件安装成功。本文的介绍主要围绕所使用的必要功能，插件的详细功能介绍可以阅读<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgitee.com%2FTokenzQdBN%2Fsy-plugins%2Fblob%2Fmain%2Fsy-progressive-plugin%2FREADME_zh_CN.md"" target=""_blank"" rel=""nofollow ugc"">渐进学习插件帮助文档</a>”<a href=""#_edn6"">[⑥]</a>。</p>
<p>在选择好渐进阅读的文章后，点击<img src=""https://b3logfile.com/file/2024/01/image-ZPiJZbq.png?imageView2/2/interlace/1/format/webp"">图标，在弹出来的窗口当中，点击“添加当前文档”。</p>
<p>!</p>
<p><a href=""https://b3logfile.com/file/2024/01/image-IJC0OWA.png"">image.png</a></p>
<p>在随后出现的窗口当中选择拆分文章的方式，插件提供了三种拆分方式：标题拆分、块数量拆分、字数拆分。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-ljNkoLi.png?imageView2/2/interlace/1/format/webp""></p>
<p>这里的拆分指的是将一篇完整的文章根据不同的标准拆分为不同数量的子文档，同时保持源文档不受影响。在这里如果选择标题拆分，则在这个页面无需做任何更改，点击最后的添加文档按钮即可，如果想以其他的方式来拆分，则在相应的对话框填入意愿的数字即可。</p>
<p>拆分后的文档，称之为分片，分片会出现在源文档的下级：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-mb7DPj1.png?imageView2/2/interlace/1/format/webp""></p>
<p>分片是阅读的最小单位，并且对分片的任何修改都不会影响源文档，也因此可以把分片看作一个白板，在上面尽情挥洒创意。标题前有序号的则是分片，每个分片的段落末尾都有一个*符号，点击此符号可以快速返回源文档的相应部分。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-ixPGrnp.png?imageView2/2/interlace/1/format/webp""></p>
<p>可以发现在文档的末尾有着一排按钮：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-GmResme.png?imageView2/2/interlace/1/format/webp""></p>
<p>这些按钮分别代表不同的功能：</p>
<ul>
<li>（文件夹图标）：打开书籍的目录，可以从目录定位要看的分片。</li>
<li>⬅（左箭头图标）：当前段的笔记保留，看上一个分片的内容。</li>
<li>➡（右箭头图标）：当前段的笔记保留，看下一个分片的内容。</li>
<li>⬇（下箭头图标）：插入原文对应的分片内容。</li>
<li>?（扫帚图标）：被修改过的原文会保留，没被修改过的，会被删除。</li>
<li>⬅ ?（左箭头 + 垃圾箱图标）：删除当前段的笔记，继续看上一个分片。</li>
<li>? ➡（垃圾箱 + 右箭头图标）：删除当前段的笔记，继续看下一个分片。</li>
<li>? ?（垃圾箱 + 跑步图标）：删除当前段的笔记。</li>
<li>➕?（加号 + 箱子图标）：把当前文档制为闪卡。</li>
<li>➖?（减号 + 箱子图标）：删除当前文档本身的闪卡，不影响文档内的闪卡。</li>
<li>?（跑步图标）：当前段的笔记保留。退出学习。</li>
<li>??（书籍 + 打开的书籍图标）：当前段的笔记保留。看其他也加入到渐进学习插件的文档。</li>
<li>?（禁止图标）：不再推送本书，可在查看所有渐进学习文档中重新打开。</li>
<li>⚡（闪电图标）：以 tab 的方式打开闪卡，只打开，在本书中或者在本书的子文件中的闪卡。</li>
<li>✂?（剪刀 + 纸张图标）：按照标点断句，形成段落块。</li>
<li>✂?✅（剪刀 + 纸张 + 勾选图标）：按标点断句，形成任务列表(可以 ctrl+enter 勾选任务)。</li>
<li>✂??（剪刀 + 纸张 + 大头针图标）：按标点断句，形成列表，不同大段的断句不属于同一列表块。</li>
</ul>
<p>值得一提的是，插件不会将分片一次性全部呈现，而是只会默认呈现第一个分片，当阅读完第一个分片后，点击文档下的 ➡ 按钮则会出现下一部分，直至文章全部阅读完成。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-UpZt35G.png?imageView2/2/interlace/1/format/webp""></p>
<p>在渐进学习插件菜单中点击“查看所有渐进学习文档”，可以查看所有渐进学习的文档，并且在窗口中可以进行多项操作，点击窗口中的删除也只会删除记录而不会删除分片文档。</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-XZ7LmNE.png?imageView2/2/interlace/1/format/webp""></p>
<p>以上是阅读的准备阶段，完成后，则开始渐进阅读。</p>
<h4 id=""开始渐进阅读"">开始渐进阅读</h4>
<p><img src=""https://b3logfile.com/file/2024/01/image-IpjQJJg.png?imageView2/2/interlace/1/format/webp""></p>
<p>在分片当中，有两种断句方式，一种是点击最后一个按钮 ✂??，依据标点对当前分片断句并且形成列表：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-jFAEkSY.png?imageView2/2/interlace/1/format/webp""></p>
<p>在这个过程中，可以使用 TAB 和 SHIFT+TAB 实现列表中的层级，让阅读起来更为直观。在之后的阅读中要完成两个操作，一是对于文章中的重点内容制卡；二是对非重点内容使用 CTRL+SHIFT+S 删除线。</p>
<p>如果使用的是 ✂?✅ 按钮所断句的任务列表样式，那么第二步则为鼠标点击或者 ctrl+enter 勾选任务。</p>
<p>断句的优点在于把自己的阅读过程分解为一个个的小任务，阅读的每一句话心里权衡是否需要制卡，这样提高了阅读的效率同时也让自己更专注于阅读，就像阅读纸质读物时，用笔跟随自己阅读位置的方式。</p>
<p>也可以删除文章中的不重要部分，但是需要明确，对于重点 OR 非重点的理解是基于当前认知的，也因此需要为以后再次阅读留有退路，使用删除线，可以在不影响阅读制卡的基础上最大程度的保留原文。</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-Iw5rplR.png?imageView2/2/interlace/1/format/webp""></p>
<p>制卡，插件提供了三种方式，一种是使用 ALT+E，一种是使用 CTRL+`，还有一种则是使用 ALT+S。三种方式各有优劣，但无论使用何种方式，挖空部分会被加上粉色背景（如果不想挖空，只是摘录制卡，那么将光标留在相应断句后按下相应快捷键即可）。第一种是正常制作挖空闪卡，闪卡内容会在源文档下级创建名称带 cards-的文档集中储存 ，在按下制卡快捷键后，会在编辑器右边打开 cards-的文档，这样的好处缩窄了编辑器的宽度，使得在阅读过程中有着更好的体验。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-KZqOymE.png?imageView2/2/interlace/1/format/webp""></p>
<p>其他两种方式制卡，所有的卡片数据都会存储在独立于源文档的 daily card 文档中集中保存，也会在编辑器右边打开闪卡文档，不同点在于打开的是具体日期 daily card 文档：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-yas9rjS.png?imageView2/2/interlace/1/format/webp""></p>
<p>在这儿还能注意到第三种制卡方式里面有提到不引用原文，这事实上是渐进学习插件的亮点之一，每次对原文挖空制卡，制出来的卡片末尾都会带有两个符号 @*，这两个符号分别有不同的含义：点击 @ 符号，可以跳转到源文档的相应部分；点击*则是跳转到分片的相应部分（@*符号的此种含义仅限于闪卡中）。也因此当你在复习卡片的时候想浏览自己的笔记以及原文上下文都十分简单。第三种制卡方式中，不引用原文的意思是：只保留跳转源文档的*，不保留跳转分片的符号。</p>
<p><strong>需要强调的是，@ 和*符号在不同的场景，其含义不同。</strong></p>
<p><img src=""https://b3logfile.com/file/2024/01/image-82k03P5.png?imageView2/2/interlace/1/format/webp""></p>
<p>可以依据自身喜好选择适合的制卡方式，通常阅读完的分片是这个样子：</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-cBfbWMn.png?imageView2/2/interlace/1/format/webp""></p>
<p>当制卡完成后，则是对于卡片的复习了，相较于使用 ALT+0 快捷键出现的全局复习，更推荐右键源文档或者使用 ALT+F 复习当前文档，当然也可以在分片中点击 ⚡ 符号来复习当前文档内容。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-rB3qYXK.png?imageView2/2/interlace/1/format/webp""></p>
<p>能够看见在正常的复习文本下还有一个引述块，这是渐进学习插件的另一亮点，这一部分的作用在于，可以即时添加对于当前卡片的理解，这部分只会存在于当前卡片内容当中。</p>
<p>此功能在渐进学习插件的设置中开启，默认关闭。</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-TJo91Rr.png?imageView2/2/interlace/1/format/webp""></p>
<p>设置中还可以关闭自己使用不到的按钮以简洁分片，也可以按需开启自己需要的其他功能，在此就不一一赘述。</p>
<h4 id=""使用SY做渐进阅读的优势"">使用 SY 做渐进阅读的优势</h4>
<p>SM 的渐进阅读名声在外，确实也是效果显著，但这不意味着 SM 的渐进阅读是完美的，里面充斥着大量上个世纪的设计，使得学习使用 SM 是一件非常困难的事情，并且 SM 只存在于 WINDOWS，其他平台想要使用非常困难，过往迫于 SM 优秀的间隔重复算法，就算再难用也得用下去，但现在有了 FSRS V4 后，一切都不一样了，其不逊色与 SM 的算法，使得在其他搭载该算法的软件有了长期使用的可能性。而思源就搭载了这样的算法。</p>
<p>其次在于平台上，思源是一个全平台应用，并且可以多端同步，这意味你在电脑上制卡后，后续通过手机可以在地铁上、公交上、排队过程中等等场景完成刷卡这样的操作，也使得不同平台的使用者能够感受到渐进阅读的魅力。</p>
<p>还有，SM 的渐进阅读流程里面包含有很多违反直觉的操作，而这些都在渐进学习插件上得到了改善，使得渐进阅读的流程更加的顺畅。</p>
<p><del>使用 SY 做渐进阅读相较于 SM 有着大量的优势，但是这也不意味 SY 上的渐进阅读全面领先 SM，至少 SM 的优先级队列目前思源就没办法实现。但是，渐进学习插件的作者目前正在做这部分！！！也就是说 SY 上的优先级队列在路上了！！！！</del></p>
<p>思源的优先级队列来啦！！！<strong>可在当前文章的“给闪卡增加优先级”部分来了解。</strong></p>
<p>鉴于部分同志还不了解优先级的作用，那么请移步：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F364351955"" target=""_blank"" rel=""nofollow ugc"">渐进阅读：卡片刷不完？拥抱优先级！ - 知乎 (zhihu.com)</a></p>
<p>太长不看版：<strong>优先级的作用在于，当每天复习的闪卡数量极多时，利用优先级先复习对自己来说重要性更高的内容。例如快考试时就调整考试相关内容的优先级，使时间有限的情况下，该内容优先被复习。</strong></p>
<p>对于优先级导致的卡片堆积的问题，可以通过暂停卡片来解决，具体可以阅读本文的“<strong>解决卡片堆积——闪卡暂停</strong>”部分。</p>
<p>综上所述，当前基于渐进学习插件于 SY 的渐进阅读，在算法上、易用性上、多平台上、刷卡便捷上都是优于 SM，但是仍然存在不足，不过这个不足是暂时的，随着 SY 的发展以及各种插件的接踵而至，在 SY 上做渐进阅读优于 SM 是可能的。</p>
<h4 id=""渐进学习插件分片的优点"">渐进学习插件分片的优点</h4>
<ul>
<li>一来是对分片修改不会影响原文，可以在分片上无所顾忌的做修改、做笔记；</li>
<li>还有则是增加学习次数，分片的设定，要求使用者阅读文章至少两次，一次是在原文中根据内容设定标题，再次是在分片中做相关标题内容的精细阅读；</li>
<li>三来实现精细的渐进阅读，明确阅读进度。长文章由多个部分组成，每个部分说明的内容不同，自己设定好标题后阅读相关分片部分也能有主题有方向的思考；</li>
<li>再就是分片里可以通过分片下的按钮进行多项操作，这没办法在一篇很长的文章里面完成；</li>
<li>最后则是分片可以作为虚拟引用的材料，可以以此来拓充自己的专业数据库。</li>
</ul>
<p>以上就是基于渐进学习插件在思源笔记中的渐进阅读流程。还没完，还有一些提升闪卡效率的额外 tips。</p>
<h3 id=""二-------提升效率的TIPS"">二、      提升效率的 TIPS</h3>
<h4 id=""删除当前复习卡片"">删除当前复习卡片</h4>
<p>在 SY 设置—集市—插件中，下载插件“番茄工具箱”，这个工具是渐进学习插件作者的另一作品，包含大量的功能，例如复习卡片时删除当前卡片，亦或是一键删除失效卡片。都是一些非常实用的功能。</p>
<p>在番茄工具箱插件设置当中打开闪卡工具后，在闪卡背面可以发现多了一个删除按钮，点击后即可删除当前复习卡片</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-KMGWjKp.png?imageView2/2/interlace/1/format/webp""></p>
<p>有一点要注意，因为 SY 本身限制，删除卡片后不会默认呈现下一张卡片，需要自己手动点击其他五个按钮才可出现下一张卡片，毋庸置疑的是，点击删除的卡片已经被删除了。</p>
<p>其次是删除失效卡片功能，在安装该插件之后，点击窗口右上角的插件图标![image.png</p>
<p>](<a href=""https://b3logfile.com/file/2024/01/image-S6zx1vt.png)%EF%BC%8C%E5%86%8D%E7%82%B9%E5%87%BB%E5%91%BD%E4%BB%A4%E9%9D%A2%E6%9D%BF"">https://b3logfile.com/file/2024/01/image-S6zx1vt.png)，再点击命令面板</a></p>
<p><img src=""https://b3logfile.com/file/2024/01/image-BAEbclN.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2024/01/image-YMw9jpR.png?imageView2/2/interlace/1/format/webp""></p>
<p>在弹出的页面当中点击清理所有失效闪卡，右上角弹出通知，则意味着成功删除。<strong>但是必须要注意的是，删除功能必须在全部笔记本打开的情况下才能正常运作，不然会删除大量正常闪卡。</strong></p>
<p><img src=""https://b3logfile.com/file/2024/01/image-gWCirTm.png?imageView2/2/interlace/1/format/webp""></p>
<h4 id=""改善阅读挖空样式"">改善阅读挖空样式</h4>
<p>目前的闪卡页面会使用[…]来表示被挖空的部分，但辨识度不高，</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-DSZ2K7o.png?imageView2/2/interlace/1/format/webp""></p>
<p>可以通过在 SY 设置—外观—代码片段 中加入以下代码来实现挖空部位增强</p>
<p>.card__block--hidemark span[data-type~=mark]::before{background-color:yellow;color:red!important;border-radius: 3px;</p>
<p>}</p>
<p>.card__block--hidemark span[data-type~=mark]::before {</p>
<p>content: \"" [...] \"";</p>
<p>color: var(--b3-theme-on-background); font-size:13px;font-weight: lighter;}</p>
<p>.card__block--hidemark span[data-type~=mark] {font-size: 0px;}</p>
<p>:root {</p>
<p>--b3-font-family-emoji:   \""Twemoji Mozilla\"", \""Segoe UI Emoji\"", \""Segoe UI Symbol\"", \""Segoe UI\"", \""Apple Color Emoji\"", \""Noto Color Emoji\"", \""Android Emoji\"";</p>
<p>}</p>
<p>使用后，挖空样式如图</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-qrXJX2X.png?imageView2/2/interlace/1/format/webp""></p>
<p>在群内大佬 @<a href=""https://ld246.com/member/chenshinshi"" class=""tooltipped__user"" target=""_blank"">chenshinshi</a> 提供的代码片段基础上做了一定美化。</p>
<h4 id=""给闪卡增加优先级"">给闪卡增加优先级</h4>
<p>闪卡的优先级功能一直都是 SM 的一大杀器，在“番茄工具箱”作者的辛劳开发下，已经成功加上此功能！！</p>
<p>使用方法很简单，在集市上下载好“番茄工具箱”插件——打开插件设置——打开闪卡优先级功能：</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-9uTE2j1.png?imageView2/2/interlace/1/format/webp""></p>
<p>打开此选项后，闪卡复习页面如图：</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-54A7uVS.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>此功能下，闪卡优先级的调整范围为 0-100，所有闪卡默认优先级为 50，可以调整单张闪卡的优先级，也可在父文档下“右键——插件”，可批量调整该文档下所有闪卡的优先级，复习顺序在于先出现优先级高的闪卡（数字越大优先级越高），再依据优先级排序出现次一级优先的闪卡，并且在复习高优先级闪卡过程中能低概率出现低优先级闪卡。</strong>**</p>
<p>在闪卡的上半部分能发现多出一些按钮，“50”指的是当前闪卡的优先级为 50，通过加减符号来快捷的调整当前闪卡的优先级，或者通过拖动进度条来更改。</p>
<p>如果想要查找优先级低于 50 或者某个数字的闪卡，可以通过 SQL 命令来查找：</p>
<p>select * from blocks where id in</p>
<p>(select block_id id from attributes</p>
<p>where name = \""custom-card-priority\""</p>
<p>and value &lt; \""50\"" limit 200);</p>
<p>想要查找哪一个优先级的闪卡，那就将以上代码中的“50”改为意愿数字即可。</p>
<p>还能发现多了两个红色的按钮，从左到右的第一个红色按钮是取消当前闪卡的制卡，与删除当前闪卡功能一致；第二个按钮则是暂停当前闪卡。（暂停闪卡的功能请看下一节。）</p>
<h4 id=""解决卡片堆积--闪卡暂停"">解决卡片堆积——闪卡暂停</h4>
<p>闪卡优先级会导致一些问题，例如复习完重要的闪卡后，剩余的有必要复习但不重要的闪卡，因复习时间不够从而没办法复习，因而慢慢的就堆积起来了。这个问题在 SM 中，能够通过自动延期功能来无感解决；在 anki 中，通过 FSRS 插件的推迟卡片功能也能解决，在过往的思源当中这问题是仍然存在的。</p>
<p>但现在通过“番茄工具箱”作者的辛劳开发，此功能已经初现雏形！</p>
<p>闪卡暂停！！！顾名思义，能够暂停卡片，打开“番茄工具箱”的闪卡优先级功能后，在闪卡复习页面会出现两个红色按钮，第一个是取消当前制卡，第二个就是暂停当前卡片。</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-8SQ9Yvo.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击后弹出对话框，可以输入想暂停的具体天数。</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-UPWyP7N.png?imageView2/2/interlace/1/format/webp""></p>
<p>如果某一个文档下的闪卡暂时都不想复习的话，那么可以再该文档的父文档下，右键—插件—当前文档与子文档的闪卡全部暂停。这样可以对于短期内不重要的闪卡做到批量暂停处理，可以设定到一段时间后再开始复习，<strong>这也是解决卡片堆积的一个迂回方案。</strong></p>
<p><strong>暂停的闪卡其回答按钮功能不会改变，暂停前该闪卡对应的回答按钮是几天，那么恢复暂停后也是相应的天数。</strong></p>
<p>暂停后的卡片会被加上书签，在思源主页面左下角的书签中可以看见：</p>
<p><img src=""https://b3logfile.com/file/2024/02/image-0F3clcr.png?imageView2/2/interlace/1/format/webp""></p>
<p>也可以通过 SQL 命令在思源中搜索所有已暂停闪卡：</p>
<p>select * from blocks where id in</p>
<p>(select block_id id from attributes</p>
<p>where name = \""custom-card-priority-stop\"" limit 1000) limit 1000;</p>
<p>想知道具体哪一个文档下有哪些暂停的闪卡，可在思源搜索中选定文档后使用此代码查询。</p>
<p>若想取消暂停，只需重新点击一次暂停按钮即可。</p>
<p>（后续或许能够在闪卡页面一键暂停所有剩余闪卡、根据复习频率自动决定暂停的天数、闪卡优先级也能根据复习的频率自动调整等等，随着思源闪卡的不断优化、“番茄工具箱”的进一步开发，思源的渐进学习超过 SM 将不再是梦想，而是能够映照到现实的具体目标）</p>
<h4 id=""使用键盘or鼠标宏"">使用键盘 or 鼠标宏</h4>
<p>渐进阅读过程中要使用大量的快捷键，极其繁琐，但这并不是没有高效使用的方法。可以使用鼠标或者键盘的宏来实现一键操作。例如我在鼠标宏设置以下步骤实现一键加上删除线。</p>
<p><img src=""https://b3logfile.com/file/2024/01/image-jHqtQQD.png?imageView2/2/interlace/1/format/webp""></p>
<p>其他快捷键也可以如此实现，由于设备不同，不一一说明。</p>
<p>以上就是这篇文章的全部内容，文章中提到的所有插件都是免费的，大家可尽情尝试。</p>
<p>如果觉得插件好用，请给插件作者发电！</p>
<p><strong>插件作者爱发电主页</strong>：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fafdian.net%2Fa%2Fplayerv5"" target=""_blank"" rel=""nofollow ugc"">[https://afdian.net/a/playerv5] (https://afdian.net/a/playerv5)</a></p>
<p>文章可以任意转载，但务必保留插件作者的爱发电主页链接，致谢！</p>
<p>（思源笔记渐进学习插件交流群：263961482）</p>
<h3 id=""提及文章"">提及文章</h3>
<hr>
<p><a href=""#_ednref1"">[①]</a> [FSRS 现已成为世界上最精确的间隔重复算法]（ <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F671340049"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/671340049</a> ）</p>
<p><a href=""#_ednref2"">[②]</a> [SuperMemo 18 帮助文档]（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsupermemo%2Fwiki%2Fwhat"" target=""_blank"" rel=""nofollow ugc"">https://www.yuque.com/supermemo/wiki/what</a>_is_incremental_learning）</p>
<p><a href=""#_ednref3"">[③]</a> [SiYuan 插件下载地址]（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fchromewebstore.google.com%2Fdetail%2Fsiyuan%2Fhkcgjbeblifaincobbcfiffbpgoafepk%25EF%25BC%2589"" target=""_blank"" rel=""nofollow ugc"">https://chromewebstore.google.com/detail/siyuan/hkcgjbeblifaincobbcfiffbpgoafepk）</a></p>
<p><a href=""#_ednref4"">[④]</a> [siyuan-plugin-importer]（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fterwer%2Fsiyuan-plugin-importer%25EF%25BC%2589"" target=""_blank"" rel=""nofollow ugc"">https://github.com/terwer/siyuan-plugin-importer）</a></p>
<p><a href=""#_ednref5"">[⑤]</a> [Anki 高考的 20 条原则(1-5)—来自《有效的学习：组织知识的 20 条原则》]（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F52369009%25EF%25BC%2589"" target=""_blank"" rel=""nofollow ugc"">https://zhuanlan.zhihu.com/p/52369009）</a></p>
<p><a href=""#_ednref6"">[⑥]</a> [渐进学习插件帮助文档]（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgitee.com%2FTokenzQdBN%2Fsy-plugins%2Fblob%2Fmain%2Fsy-progressive-plugin%2FREADME"" target=""_blank"" rel=""nofollow ugc"">https://gitee.com/TokenzQdBN/sy-plugins/blob/main/sy-progressive-plugin/README</a>_zh_CN.md）</p>
                

作者：QQQorange
链接：https://ld246.com/article/1704599752251
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",QQQorange,"SuperMemo,思源笔记,闪卡,阅读",链滴优选
721,关于改进 database 新建和打开文档操作的改进提议 - 链滴,Tue Jan 02 2024 17:26:52 GMT+0000 (Coordinated Universal Time),"
                    <p>issue 见于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F10053"" target=""_blank"" rel=""nofollow ugc"">Issue #10053 · siyuan-note/siyuan</a></p>
<p>大概意图如下：</p>
<p>使用 ctrl 按键来辅助区分点击 <code>更多</code>  按钮时实现的功能。</p>
<ol>
<li>直接点击按钮，假如已经绑定到块就直接打开块，没有就新建子文档后打开文档。</li>
<li>ctrl+ 点击按钮，假如未绑定到块就进行绑定，已有绑定就更新绑定。</li>
</ol>
<p>这会带来一些问题，比如说在移动端的实现会较为复杂一点，具体可能的解决方案可以看一下 issue。</p>
<p>现在需要社区进行投票来辅助 D 判断是否需要实现这个改进，以及如何实现</p>
<hr>
<p>更新了一下投票，如评论区所说，感觉左右键点击的形式会更简洁一点</p>
<p><div class=""articlePoll"">
    <h3>是否需要实现这个改进</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            7 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1704187315359"">
            <div class=""poll__percent"" style=""width: 28%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    需要这个改进
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    28%
                    <span class=""ft__fade"">•</span>
                    2 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1704187315459"">
            <div class=""poll__percent"" style=""width: 28%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    不需要这个改变
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    28%
                    <span class=""ft__fade"">•</span>
                    2 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1704187315510"">
            <div class=""poll__percent"" style=""width: 42%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    有其他想法并在评论区提出
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    42%
                    <span class=""ft__fade"">•</span>
                    3 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
<p><div class=""articlePoll"">
    <h3>怎么实现这个改进</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            4 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1704189551302"">
            <div class=""poll__percent"" style=""width: 25%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    使用 ctrl 来区分
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    25%
                    <span class=""ft__fade"">•</span>
                    1 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1704189551352"">
            <div class=""poll__percent"" style=""width: 75%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    使用左右键点击来区分
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    75%
                    <span class=""ft__fade"">•</span>
                    3 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1704189551403"">
            <div class=""poll__percent"" style=""width: 0%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    有其他想法，并在评论区提出
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    0%
                    <span class=""ft__fade"">•</span>
                    0 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
<p><div class=""articlePoll"">
    <h3>如果实现了这个改进，那么需要实现为哪种点击形式？</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            3 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1704187449662"">
            <div class=""poll__percent"" style=""width: 66%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    直接点击打开文档，ctrl+ 点击更新绑定
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    66%
                    <span class=""ft__fade"">•</span>
                    2 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1704187449713"">
            <div class=""poll__percent"" style=""width: 33%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    ctrl+ 点击打开文档，直接点击更新绑定
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    33%
                    <span class=""ft__fade"">•</span>
                    1 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1704187449764"">
            <div class=""poll__percent"" style=""width: 0%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    实现为可设置项（这会使得这个功能出来的更慢，并提高被拒绝率）
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    0%
                    <span class=""ft__fade"">•</span>
                    0 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
                

作者：zxhd86
链接：https://ld246.com/article/1704187613018
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
701,思源 2.11.1 版本后，模板支持对星期的解析了 - 链滴,Tue Dec 05 2023 15:35:20 GMT+0000 (Coordinated Universal Time),"
                    <p>思源在 2.11.1 之后更新了三个和周相关的模板函数：</p>
<ul>
<li>
<p>Weekday ：输入  Date 对象，返回给定日期的星期数，返回值为 0 ~ 6，分别对应了星期日、星期一到星期六</p>
</li>
<li>
<p>WeekdayCN ：输入  Date 对象，返回中文汉字[日、一 ~ 六]</p>
</li>
<li>
<p>ISOWeek ：输入  Date 对象，返回一个数字，代表当前日期正处于当年的第多少个星期</p>
</li>
<li>
<p>使用案例</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-o"">/</span><span class=""highlight-err"">{{</span><span class=""highlight-n"">now</span><span class=""highlight-w""> </span><span class=""highlight-o"">|</span><span class=""highlight-w""> </span><span class=""highlight-nb"">date</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""2006\""</span><span class=""highlight-err"">}}</span><span class=""highlight-o"">/</span><span class=""highlight-err"">第{{</span><span class=""highlight-n"">now</span><span class=""highlight-w""> </span><span class=""highlight-o"">|</span><span class=""highlight-w""> </span><span class=""highlight-n"">ISOWeek</span><span class=""highlight-err"">}}周</span><span class=""highlight-o"">/</span><span class=""highlight-err"">星期{{</span><span class=""highlight-n"">now</span><span class=""highlight-w""> </span><span class=""highlight-o"">|</span><span class=""highlight-w""> </span><span class=""highlight-n"">WeekdayCN</span><span class=""highlight-w""> </span><span class=""highlight-err"">}}</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>最后可能会被渲染为：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-o"">/</span><span class=""highlight-mi"">2023</span><span class=""highlight-o"">/</span><span class=""highlight-err"">第</span><span class=""highlight-mi"">49</span><span class=""highlight-err"">周</span><span class=""highlight-o"">/</span><span class=""highlight-err"">星期一</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/12/image-qjIRXBS.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：Frostime
链接：https://ld246.com/article/1701761721195
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
703,思源 2.11.1 版本后对 daily note 的重要更新 - 链滴,Tue Dec 05 2023 15:31:06 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>注意：如果你只打算写写日记，对一些查询等的高级功能没有兴趣，可以<strong>不用关心</strong>这篇文章提到的内容。</p>
<p>如果你不在意的话，那么 2.11.1 版的更新对你旧有的 daily note 写作<strong>不会构成任何干扰</strong>，完全可以无视。</p>
</blockquote>
<h2 id=""新的-daily-note-属性"">新的 daily note 属性</h2>
<p>从 2.11.1 开始, 思源在创建日记的时候会自动为文档添加 <code>custom-dailynote-yyyymmdd</code> 属性, 以方便将日记文档同普通文档区分。</p>
<blockquote>
<p>详情请见 Github Issue #9807</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F9807"" target=""_blank"" rel=""nofollow ugc"">Add the <code>custom-dailynote-yyyyMMdd</code> attribute when creating a dailynote doc · Issue #9807 · siyuan-note/siyuan · GitHub</a></p>
</blockquote>
<p>具体来说，你现在每次点击菜单或者按下 Alt + 5 创建 daily note 后，都会在文档中添加一个标识属性</p>
<p><img src=""https://b3logfile.com/file/2023/12/image-OE0AQEz.png?imageView2/2/interlace/1/format/webp""></p>
<p>例如这里 dailynote-20231205 属性就代表了这篇文档是 2023 年 12 月 05 日的日记。</p>
<p>本方案对于月记、周记等把好几天的日记写在一个文档里有有一定的适配性。比如对于一个写月记的人来说，最后他的月文档里会有从 dailynote-20231001 到 dailynote-20231031 一整个月的时间标识（前提是你天天写日记）。</p>
<h2 id=""这个属性有什么用-"">这个属性有什么用？</h2>
<p>增加这个属性，带来而最直接的好处就是，以后你可以用非常简单的方式来查找指定日期的日记了，比如如下的 SQL 代码：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-k"">distinct</span><span class=""highlight-w""> </span><span class=""highlight-n"">B</span><span class=""highlight-p"">.</span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">as</span><span class=""highlight-w""> </span><span class=""highlight-n"">B</span><span class=""highlight-w""> </span><span class=""highlight-k"">join</span><span class=""highlight-w""> </span><span class=""highlight-n"">attributes</span><span class=""highlight-w""> </span><span class=""highlight-k"">as</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">on</span><span class=""highlight-w""> </span><span class=""highlight-n"">B</span><span class=""highlight-p"">.</span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">block_id</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">name</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'custom-dailynote-202312%\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">order</span><span class=""highlight-w""> </span><span class=""highlight-k"">by</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">value</span><span class=""highlight-w""> </span><span class=""highlight-k"">desc</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>使用 <code>custom-dailynote-202312%</code> 就能匹配到 2023 年 12 月所有的日记，又或者你想要匹配 2023 年 10 月 10 号到 13 号的日记，可以这么查询</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-k"">distinct</span><span class=""highlight-w""> </span><span class=""highlight-n"">B</span><span class=""highlight-p"">.</span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">as</span><span class=""highlight-w""> </span><span class=""highlight-n"">B</span><span class=""highlight-w""> </span><span class=""highlight-k"">join</span><span class=""highlight-w""> </span><span class=""highlight-n"">attributes</span><span class=""highlight-w""> </span><span class=""highlight-k"">as</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">on</span><span class=""highlight-w""> </span><span class=""highlight-n"">B</span><span class=""highlight-p"">.</span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">block_id</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">name</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'custom-dailynote-%\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">value</span><span class=""highlight-w""> </span><span class=""highlight-o"">&gt;=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'20231010\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">value</span><span class=""highlight-w""> </span><span class=""highlight-o"">&lt;=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'20231013\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">order</span><span class=""highlight-w""> </span><span class=""highlight-k"">by</span><span class=""highlight-w""> </span><span class=""highlight-n"">A</span><span class=""highlight-p"">.</span><span class=""highlight-n"">value</span><span class=""highlight-w""> </span><span class=""highlight-k"">desc</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>更进一步的好处是，此后关于日记相关的插件开发起来会简单不少。</p>
<blockquote>
<p>注：用户自定义属性会有一个隐藏的 custom- 前缀，比如在自定义面板里，你看到一个名叫 X 的属性，实际上在底层这个属性的名称是 custom-X</p>
</blockquote>
<h2 id=""如何兼容过去的日记"">如何兼容过去的日记</h2>
<p>目前，这个新的属性只会在 2.11.1 版后的思源中生效——也就意味着你之前的日记是没有这个属性的。</p>
<p>为了兼容过去的日记，本人在今日笔记插件中开发了为过去的日记添加日记属性的功能。源代码在这里 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Ffrostime%2Fsiyuan-dailynote-today%2Fblob%2Fv1.3.0%2Fsrc%2Ffunc%2Fdailynote%2Fpast-dn.ts"" target=""_blank"" rel=""nofollow ugc"">https://github.com/frostime/siyuan-dailynote-today/blob/v1.3.0/src/func/dailynote/past-dn.ts</a>。如果有插件开发者需要，可以参考这里的代码。</p>
<p>在插件本体中，你也可以在「设置-日记」一栏点击「为过去的 Daily Note 补充文档属性」按钮</p>
<p><img src=""https://b3logfile.com/file/2023/12/image-hkJCLoh.png?imageView2/2/interlace/1/format/webp""></p>
<p>当弹窗提示「ALL Done」的时候，就说明已经完成了。</p>
<p><img src=""https://b3logfile.com/file/2023/12/6b6229036c5c406ab9ea90cae272c77c.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""开发者守则"">开发者守则</h2>
<ul>
<li>打开日记并自动添加属性的功能，是在后端接口 <code>/api/filetree/createDailyNote</code> 当中内置实现的，也就是说如果你调用了这个接口，那么文档就会自动添加这个属性</li>
<li>如果开发者要通过别的方法，例如 <code>createDocWithMd</code> 接口创建日记 （例如日历插件），请手动为文档添加该属性，参考代码如下
<pre><code class=""language-ts highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/*
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * Copyright (c) 2023 by frostime. All Rights Reserved.
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @Author       : frostime
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @Url          : https://github.com/frostime/siyuan-dailynote-today/blob/v1.3.0/src/func/dailynote/dn-attr.ts
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">export</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">formatDate</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">date?</span>: <span class=""highlight-kt"">Date</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">sep</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'\'</span><span class=""highlight-p"">)</span><span class=""highlight-o"">:</span> <span class=""highlight-kt"">string</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">date</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">date</span> <span class=""highlight-o"">===</span> <span class=""highlight-kc"">undefined</span> <span class=""highlight-o"">?</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Date</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">:</span> <span class=""highlight-nx"">date</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">year</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">date</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getFullYear</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">month</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">date</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getMonth</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">+</span> <span class=""highlight-mi"">1</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">day</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">date</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getDate</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-sb"">`</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">year</span><span class=""highlight-si"">}${</span><span class=""highlight-nx"">sep</span><span class=""highlight-si"">}${</span><span class=""highlight-nx"">month</span> <span class=""highlight-o"">&lt;</span> <span class=""highlight-mi"">10</span> <span class=""highlight-o"">?</span> <span class=""highlight-s1"">\'0\'</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">month</span> : <span class=""highlight-kt"">month</span><span class=""highlight-si"">}${</span><span class=""highlight-nx"">sep</span><span class=""highlight-si"">}${</span><span class=""highlight-nx"">day</span> <span class=""highlight-o"">&lt;</span> <span class=""highlight-mi"">10</span> <span class=""highlight-o"">?</span> <span class=""highlight-s1"">\'0\'</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">day</span> : <span class=""highlight-kt"">day</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/**
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * 对 DailyNote 的自定义属性进行设置, custom-dailynote-yyyyMMdd: yyyyMMdd
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * https://github.com/siyuan-note/siyuan/issues/9807
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @param doc_id 日记的 id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">export</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">setCustomDNAttr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">doc_id</span>: <span class=""highlight-kt"">string</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">date?</span>: <span class=""highlight-kt"">Date</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">td</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">formatDate</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">date</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">attr</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`custom-dailynote-</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">td</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 构建 attr: td
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">attrs</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-p"">[</span><span class=""highlight-nx"">key</span>: <span class=""highlight-kt"">string</span><span class=""highlight-p"">]</span><span class=""highlight-o"">:</span> <span class=""highlight-kt"">string</span> <span class=""highlight-p"">}</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">attrs</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">attr</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">td</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">serverApi</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">setBlockAttrs</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">doc_id</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">attrs</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
</li>
</ul>
                

作者：Frostime
链接：https://ld246.com/article/1701761466782
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
702,利用 CSS 代码片段限制块的高度 - 链滴,Tue Dec 05 2023 12:28:45 GMT+0000 (Coordinated Universal Time),"
                    <p>思源的嵌入块还有表格块有一个常见的问题：高度太高，翻起来很累人。</p>
<p>为了解决这一问题，我写了一段 CSS 代码片段如下所示，其中 --custom-max-height 指定了块的最大高度，30em 代表行高。</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">:</span><span class=""highlight-nd"">root</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-nv"">--custom-max-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">30</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-nt"">div</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">custom-clip-max-height</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">max-height</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">custom</span><span class=""highlight-o"">-</span><span class=""highlight-n"">max</span><span class=""highlight-o"">-</span><span class=""highlight-n"">height</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">overflow-y</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">scroll</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>用法是为想要限制高度的块添加自定义属性 clip-max-height，超出范围后，可以上下滚动查看</p>
<p>为了方便使用，可以配合「快速添加块属性插件」，</p>
<p><img src=""https://b3logfile.com/file/2023/12/image-nDzFvQe.png?imageView2/2/interlace/1/format/webp""></p>
<p>在设置中添加配置：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nt"">\""限制高度-滚动\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nt"">\""clip-max-height\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""scroll\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nt"">\""限制高度-取消\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nt"">\""clip-max-height\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/12/image-WgIPVTm.png?imageView2/2/interlace/1/format/webp""></p>
<p>现在我们点击过长的块的图标就可以看到菜单按钮了。</p>
<p><img src=""https://b3logfile.com/file/2023/12/image-J0iZf7M.png?imageView2/2/interlace/1/format/webp""></p>
<p>最终效果如下：</p>
<p><img src=""https://b3logfile.com/file/2023/12/image-7qaaL8i.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：Frostime
链接：https://ld246.com/article/1701750525821
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
671,五分钟学会开发自己的挂件 - 链滴,Mon Dec 04 2023 17:07:45 GMT+0000 (Coordinated Universal Time),"
                    <blockquote>
<p>插件开发上手太难？不如先来开发一个挂件练练手！</p>
</blockquote>
<h2 id=""挂件是什么"">挂件是什么</h2>
<p>挂件是以可调整大小的 html 网页块儿形式展示在笔记正文里面的元素，可以通过快捷指令快速插入到笔记中，实现一些交互，记录，同时可以引入第三方 js，以及调用本地思源的 API 来实现更多功能，例如实现与思源笔记数据的交互。</p>
<h2 id=""挂件文件内容"">挂件文件内容</h2>
<h3 id=""语法-HTML"">语法：HTML</h3>
<p>HTML（HyperText Markup Language）是一种用于创建网页的标记语言。它由一系列的标签（tag）组成，这些标签用于描述网页的结构和内容。HTML 标记语言使用尖括号（&lt;&gt;）将标签包围起来，标签通常成对出现，分为开始标签和结束标签。</p>
<p>HTML 通过使用不同的标签来定义网页的结构，包括标题、段落、链接、图像、表格等元素。标签可以包含属性，用于提供关于元素的额外信息，如颜色、大小、链接目标等。</p>
<p>HTML 是构建网页的基础，它与 CSS（层叠样式表）和 JavaScript 等技术一起使用，可以实现丰富的网页交互和样式效果。通过编写 HTML 代码，开发人员可以创建具有文本、图像、链接和多媒体等内容的网页，并将其发布到互联网上供用户访问。<br>
当创建网页时，使用 HTML 可以定义页面的结构和内容。下面是一些常用的 HTML 标签和它们的作用：</p>
<ol>
<li><code>&lt;html&gt;</code>：定义 HTML 文档的根元素。</li>
<li><code>&lt;head&gt;</code>：定义文档的头部，包含了一些元数据和链接引用。</li>
<li><code>&lt;title&gt;</code>：定义网页的标题，显示在浏览器的标题栏或标签页上。</li>
<li><code>&lt;body&gt;</code>：定义文档的主体部分，包含了网页的实际内容。</li>
<li><code>&lt;h1&gt;</code> 到 <code>&lt;h6&gt;</code>：定义标题，从大到小依次递减，用于显示不同级别的标题。</li>
<li><code>&lt;p&gt;</code>：定义段落，用于显示一段文本。</li>
<li><code>&lt;a&gt;</code>：定义超链接，用于创建指向其他页面或资源的链接。</li>
<li><code>&lt;img&gt;</code>：定义图像，用于显示图片。</li>
<li><code>&lt;ul&gt;</code> 和 <code>&lt;li&gt;</code>：定义无序列表，用于显示项目列表。</li>
<li><code>&lt;ol&gt;</code> 和 <code>&lt;li&gt;</code>：定义有序列表，用于显示按顺序排列的项目列表。</li>
<li><code>&lt;table&gt;</code>、<code>&lt;tr&gt;</code> 和 <code>&lt;td&gt;</code>：定义表格，用于显示数据表格。</li>
<li><code>&lt;div&gt;</code>：定义文档中的一个区块，用于组织和样式化内容。</li>
<li><code>&lt;span&gt;</code>：定义文档中的一个内联元素，用于样式化文本的一部分。</li>
</ol>
<p>以下是一个简单的 HTML 示例，展示了如何使用上述标签来创建一个网页：</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cp"">&lt;!DOCTYPE html&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">html</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">head</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">title</span><span class=""highlight-p"">&gt;</span>我的网页<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">title</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">head</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">body</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">h1</span><span class=""highlight-p"">&gt;</span>欢迎来到我的网页<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">h1</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">p</span><span class=""highlight-p"">&gt;</span>这是一个示例网页，用于演示HTML标记语言的基本用法。<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">p</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>链接示例<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">a</span> <span class=""highlight-na"">href</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""https://www.example.com\""</span><span class=""highlight-p"">&gt;</span>点击这里<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">a</span><span class=""highlight-p"">&gt;</span>访问示例网站。
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>图像示例<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">img</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""image.jpg\""</span> <span class=""highlight-na"">alt</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""示例图片\""</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>列表示例<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">&gt;</span>项目1<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">&gt;</span>项目2<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">&gt;</span>项目3<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">ul</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>表格示例<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">h2</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">table</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">tr</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>姓名<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>年龄<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">tr</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">tr</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>张三<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>25<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">tr</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">tr</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>李四<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>30<span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">td</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">tr</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">table</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">body</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">html</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>在上面的示例中，<code>&lt;!DOCTYPE html&gt;</code> 声明了文档类型为 HTML5，<code>&lt;html&gt;</code> 标签是根元素，包含了整个 HTML 文档。<code>&lt;head&gt;</code> 标签内部定义了文档的头部信息，包括标题等。<code>&lt;body&gt;</code> 标签内部是文档的主体部分，包含了网页的实际内容。</p>
<p>这只是一个简单的示例，HTML 标记语言非常丰富，还有更多的标签和属性可用于创建更复杂和交互性的网页。开发人员可以根据需要使用不同的标签和属性来实现所需的效果。</p>
<h3 id=""核心文件"">核心文件</h3>
<h4 id=""index-html"">index.html</h4>
<p>index.html 是挂件插入时会首先加载的界面，入口文件，通常作为主界面出现。</p>
<h4 id=""widget-json"">widget.json</h4>
<p>挂件在集市里的信息，俗称商品描述，不能缺少，否则无法上架（如果你打算上架集市），<br>
该文件内容的描述可见。</p>
<h2 id=""开发步骤"">开发步骤</h2>
<h3 id=""UI"">UI</h3>
<p>可以通过不同的框架进行开发，例如 vue 和其他的模板语言，但最后都要编译为 HTML。</p>
<h3 id=""后端"">后端</h3>
<p>后端的交互通过 js 实现，引入 js 或者自行编写 js，思源允许在 html 内执行 js。</p>
<h3 id=""数据的存储"">数据的存储</h3>
<p>目前挂件没有专属的很好的储存数据的 API，以下是一个储存数据的思路。</p>
<h4 id=""获取数据唯一性标识"">获取数据唯一性标识</h4>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 获取当前挂件的块id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">id</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">window</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">frameElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span></code></pre>
<p>这里获取到的 <code>id</code> 是当前挂件所在的块 id，可以用来给数据加上唯一性标识，并和它所在的块儿联系起来。<br>
示意图：<br>
<img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204153852-20231204170630-udanr7n.png?imageView2/2/interlace/1/format/webp""><br>
如图，成功让挂件在自己的界面输出了自己所在的块 id。</p>
<h4 id=""储存数据"">储存数据</h4>
<p>获得了可以作为数据唯一键对值的 id，下一步就是想办法储存数据，我们可以借助官方给出的 API 文档中的写入文件的 API 来进行数据存储。<br>
<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fblob%2Fmaster%2FAPI_zh_CN.md%23%25E5%2586%2599%25E5%2585%25A5%25E6%2596%2587%25E4%25BB%25B6"" target=""_blank"" rel=""nofollow ugc"">思源后台写入文件 API</a></p>
<h5 id=""写入文件的API"">写入文件的 API</h5>
<ul>
<li>
<p><code>/api/file/putFile</code></p>
</li>
<li>
<p>参数为 HTTP Multipart 表单</p>
<ul>
<li><code>path</code>：工作空间路径下的文件路径</li>
<li><code>isDir</code>：是否为创建文件夹，为&nbsp;<code>true</code>&nbsp;时仅创建文件夹，忽略&nbsp;<code>file</code></li>
<li><code>modTime</code>：最近访问和修改时间，Unix time</li>
<li><code>file</code>：上传的文件</li>
<li>返回值</li>
</ul>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""code\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""msg\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""data\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">null</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
</li>
</ul>
<h5 id=""将数据写入文件的示例"">将数据写入文件的示例</h5>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 写入文件内容
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">putFileContent</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">path</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">content</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-kr"">const</span> <span class=""highlight-nx"">formData</span> <span class=""highlight-o"">=</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">FormData</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">formData</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">append</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""path\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">formData</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">append</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""file\""</span><span class=""highlight-p"">,</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Blob</span><span class=""highlight-p"">([</span><span class=""highlight-nx"">content</span><span class=""highlight-p"">]));</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">return</span> <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/file/putFile\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">formData</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}).</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">response</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">response</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ok</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">              <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""File saved successfully\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">              <span class=""highlight-k"">throw</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""Failed to save file\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>这个函数接受两个参数，path 和 content，其中 path 就是数据文件的路径，而 content 则是数据的内容，每次调用这个函数，都会将 content 的内容通过 api 接口追加到指定数据文件里面。</p>
<h5 id=""数据的储存格式"">数据的储存格式</h5>
<p>我个人比较推荐 json 的键对值储存方式，下面的这个示例也是用的 json 格式储存数据。</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">     <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">saveIdCityMap</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">city</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">idCityMap</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getIdCityMap</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">idCityMap</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">city</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 将 idCityMap 写入文件
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">putFileContent</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-s2"">\""/data/widgets/Simple-weather-forecast/data/data.json\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">idCityMap</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">}</span>
</span></span></code></pre>
<p><code>saveIdCityMap</code> 函数接受两个参数：<code>id</code> 和 <code>city</code>，的目的是将 <code>id</code> 和 <code>city</code> 的映射保存到一个文件中。 <code>getIdCityMap</code> 函数用来获取一个名为 <code>idCityMap</code> 的对象，这个对象包含了已经存在的 ID 和城市的映射，具体定义看下面的<a href=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/#执行数据读取后的操作"">实例</a>。将新的 <code>id</code> 和 <code>city</code> 映射添加到 <code>idCityMap</code> 对象中，将更新后的 <code>idCityMap</code> 对象转换成 JSON 格式的字符串，并将其写入名为 <code>data.json</code> 的文件中（假设 <code>putFileContent</code> 函数可以成功执行）。</p>
<h4 id=""读取数据"">读取数据</h4>
<p>我们同样可以直接使用后端 API 来获取数据<br>
<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fblob%2Fmaster%2FAPI_zh_CN.md%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%2587%25E4%25BB%25B6"" target=""_blank"" rel=""nofollow ugc"">后端获取文件 API</a></p>
<h5 id=""获取文件"">获取文件</h5>
<ul>
<li>
<p><code>/api/file/getFile</code></p>
</li>
<li>
<p>参数</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""path\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""/data/20210808180117-6v0mkxr/20200923234011-ieuun1p.sy\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<ul>
<li><code>path</code>：工作空间路径下的文件路径</li>
</ul>
</li>
<li>
<p>返回值</p>
<ul>
<li>响应状态码&nbsp;<code>200</code>: 文件内容</li>
<li>响应状态码&nbsp;<code>202</code>: 异常信息
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""code\""</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">404</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""msg\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nt"">\""data\""</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">null</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
</li>
</ul>
</li>
</ul>
<h5 id=""获取数据函数实例"">获取数据函数实例</h5>
<p>通过这个 API 我们来构建读取数据的函数，同样是解析 json 的格式：</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-c1"">// 获取文件内容
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>      <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getFileContent</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">path</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/file/getFile\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">path</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">path</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">}),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">response</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">response</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ok</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">              <span class=""highlight-k"">return</span> <span class=""highlight-nx"">response</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">text</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">              <span class=""highlight-k"">throw</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""Failed to get file content\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>这时候我们就可以在其他地方通过调用这个函数，通过判断返回结果，来判断执行我们需要的响应。</p>
<h5 id=""执行数据读取后的操作"">执行数据读取后的操作</h5>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">      <span class=""highlight-nx"">getIdCityMap</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span><span class=""highlight-kd"">function</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">idCityMap</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">idCityMapJ</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-c1"">// 使用正则表达式提取键值对中的键和值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>          <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">regex</span> <span class=""highlight-o"">=</span> <span class=""highlight-sr"">/\""([^\""]+)\"":\""([^\""]+)\""/g</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">match</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-k"">while</span> <span class=""highlight-p"">((</span><span class=""highlight-nx"">match</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">regex</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">exec</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">idCityMap</span><span class=""highlight-p"">))</span> <span class=""highlight-o"">!==</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">key</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">match</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">value</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">match</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">2</span><span class=""highlight-p"">];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">idCityMapJ</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">key</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">value</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">city</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">idCityMapJ</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">city</span><span class=""highlight-p"">);</span> <span class=""highlight-c1"">// 检查 city 变量的值是否正确获取到
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">city</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-c1"">//执行自定义函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">loadWeatherWidget</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">city</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">}</span> <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-c1"">//执行自定义函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">showInputBox</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">(</span><span class=""highlight-kd"">function</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">          <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""获取 idCityMap 出错:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">});</span>
</span></span></code></pre>
<p>这里通过寻找有没有 id 对应的 city，来返回结果，可以自定义在两种情况下进行什么自定义操作。</p>
<h3 id=""与插件联通"">与插件联通</h3>
<p>一些插件提供了可供前台调用的插件 API，我们可以通过调用这些 API 来实现更多功能，例如<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Ffrostime%2Fsy-run-js"" target=""_blank"" rel=""nofollow ugc"">运行 javascript</a> 插件就为我们开放了几乎所有的 api 端口：<br>
<img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204161953-20231204170630-1ipj0gm.png?imageView2/2/interlace/1/format/webp""><br>
当然，我们也可以在外部编写 js，通过该插件提供的接口，将代码片段传入，来运行我们的 js 脚本：<br>
详情请见<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Ffrostime%2Fsy-run-js%2Fcommit%2Fd002c4a5e70b929cfd19e5113208cc447f5e77df"" target=""_blank"" rel=""nofollow ugc"">添加 run-js-code 的 api</a><br>
<img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204162145-20231204170630-kmy8e5t.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""发布到集市"">发布到集市</h2>
<h3 id=""注册github并发布版本"">注册 github 并发布版本</h3>
<p>集市的挂件系统通过对 github 仓库的发布版本进行定时抓取来更新插件，实际抓取的是 package.zip 这个压缩包，这个压缩包里面应该至少有 index.html，widget.json，README.md（英文说明），README_zh_CN.md（中文说明）这四个文件，如果你的挂件还需要引用外部资源（js，png，svg 等等），可以用相对路径进行引用，然后一块儿压缩到 package.zip 里面，通过 release 来发布这个 package.zip，一定要用版本号作为 tag，否则不予索引，例如下图，版本号是 0.4.0<br>
<img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204162525-20231204170630-ksti278.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""第一次发布"">第一次发布</h3>
<p>第一次发布首先要占坑，也就是署名索引，需要到集市仓库地址的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fbazaar%2Fblob%2Fmain%2Fwidgets.json"" target=""_blank"" rel=""nofollow ugc"">挂件索引</a>位置，点击编辑，在最后一行添加你的 <code>github用户名/挂件仓库名</code>，然后可能会提示你需要 fork 本仓库才能编辑，fork 即可，写完直接 commit，然后 creat pull request，等待开发者审核收录即可，可以在 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fbazaar%2Fpulls"" target=""_blank"" rel=""nofollow ugc"">pull request</a> 查看收录情况。<br>
<strong>例如</strong><br>
将末尾：<br>
<img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204162655-20231204170630-t6gy0gz.png?imageView2/2/interlace/1/format/webp""><br>
修改为：<br>
<img src=""https://b3logfile.com/file/2023/12/siyuan/1687070401463/assets/Pasted_image_20231204163237-20231204170630-2y2ajmf.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""后续版本更新"">后续版本更新</h3>
<p>后续修改完挂件代码后，只需要更改 widget 里面的 version 为更高的版本，然后打包成 package.zip，在 github 上发布 release，tag 和更新的 version 统一即可，集市会隔一段时间自动收录。</p>
<p>‍</p>
                

作者：muhanstudio
链接：https://ld246.com/article/1701680866482
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",muhanstudio,思源笔记,链滴优选
674,是否提供文档级“加密”以保护隐私？（含投票） - 链滴,Mon Nov 27 2023 17:22:00 GMT+0000 (Coordinated Universal Time),"
                    <p>注：以下的“文档” = 某笔记本 / 某文档及其子文档 / 某文档</p>
<h3 id=""需求"">需求</h3>
<p>要求提供文档“加密”功能的需求帖一直源源不断，我观察到，大家需要的功能主要有几点：</p>
<ol>
<li>打开文档时需要先输入访问密码，且文档内容不在搜索结果中显示</li>
<li>文档名不在搜索结果中显示（可选）</li>
<li>文档在文档树中隐藏（需要讨论如何实现）
<ul>
<li>例如：文档名脱敏，变为一串星号：************ / 变为默认名称：Untitled / 自定义</li>
</ul>
</li>
<li>文档一段时间内无操作则自动锁定</li>
</ol>
<h3 id=""场景"">场景</h3>
<p>有但不仅有以下场景：</p>
<ol>
<li>记录了包含隐私内容的文档（<a href=""https://ld246.com/article/1689224966405?r=a2930610542"">密码</a>、<a href=""https://ld246.com/article/1684809573741?r=a2930610542"">日记</a>、<a href=""https://ld246.com/article/1627186421351?r=a2930610542"">个人信息、高价值信息</a>等）</li>
<li>需要展示一部分笔记给别人看（工作党刚需）
<ol>
<li><a href=""https://ld246.com/article/1683175249927?r=a2930610542"">电脑投屏做知识分享 / 电脑前有人，此时全局检索，需要避免显示隐私内容。</a></li>
<li><a href=""https://ld246.com/article/1683175249927/comment/1695829538295?r=a2930610542#comments"">通过伺服在局域网内共享给同事，需要避免同事打开包含隐私内容的文档。</a></li>
<li>启动思源时正好打开了包含隐私内容的文档，需要隐藏。</li>
</ol>
</li>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fta1oz1%23TE7nq"" target=""_blank"" rel=""nofollow ugc"">临时借出设备给他人使用，需要避免他人私自打开包含隐私内容的文档</a></li>
<li>离开电脑时忘记关闭文档 / <a href=""https://ld246.com/article/1668348986548/comment/1668424896483?r=a2930610542#comments"">忘记锁屏</a></li>
</ol>
<h3 id=""-加密-的方式"">“加密”的方式</h3>
<p>官方原生支持端到端加密，已经防住了云服务厂商，接下来就要防住身边的人了。</p>
<p>之前提出的两种“加密”方式：</p>
<ol>
<li>在前端实现（锁定文档的界面），不需要修改文件，避免文档损坏。</li>
<li>本地数据加密，每次使用时解密。但由于<a href=""https://ld246.com/article/1668348986548/comment/1668350173469?r=a2930610542#comments"">需要整个工作空间都加密才能确保没有泄漏</a>，所以不太可能实现，因此不考虑了。</li>
</ol>
<p>在前端实现“加密”，本质上是为了避免他人轻易看到隐私信息，避免尴尬社死（<a href=""https://ld246.com/article/1683175249927?r=a2930610542"">至暗时刻</a>）。身边的普通人一般不会专门想办法去偷看被你加密的文档，<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F1139%23issuecomment-763288224"" target=""_blank"" rel=""nofollow ugc"">所以我们只是需要把界面锁一锁，能挡住身边绝大多数不懂技术的人就行了。</a></p>
<p><a href=""https://ld246.com/article/1627186421351/comment/1627192219670?r=a2930610542#comments"">思源的本地存储格式是 .sy 而非 .md，别人看到了也不知道是啥，用编辑器打开也是 json 文件，基本没有可读性。</a></p>
<blockquote>
<p>对此 <a href=""https://ld246.com/member/8V9q7V"">@</a><a href=""https://ld246.com/member/8V9q7V"" class=""tooltipped__user"" target=""_blank"">8V9q7V</a> 提出异议：“界面加密，如果有人往里面存财务密码，而源文件是明文保存的，被人把密码扫出来了造成损失。思源会不会有法律纠纷？别人可不管你‘界面’加密”</p>
</blockquote>
<p>当然，面对窃取数据的人，目前的访问授权码也一样是摆设：如果有人拿到了你的电脑，想偷偷打开你设置了访问授权码的工作空间，根本防不住，他直接在 工作空间/conf/conf.json 文件里找 accessAuthCode 字段就能拿到访问授权码。</p>
<p>虽然同样是“摆设”，但大家就是需要。我的看法是：思源负责防君子，用户负责防小人。但为了以防万一也许可以在用户启用这个功能时就明确说明：这个功能并非对本地数据加密，因此有需要的用户应自行采取其他保密措施。思源只需要尽到提醒的责任，怎么使用这个功能是用户的事情。</p>
<blockquote>
<p>可以像 <a href=""https://ld246.com/member/muxue"">@</a><a href=""https://ld246.com/member/muxue"" class=""tooltipped__user"" target=""_blank"">muxue</a> 说的那样：“在启用这个功能的时候，来个巨大弹窗告诉他这只是一个开启密码，然后弄个免责声明什么的”</p>
</blockquote>
<h5 id=""设置密码的方式"">设置密码的方式</h5>
<ol>
<li>每个加密的文档单独设置密码，并可自定义默认填写的密码</li>
<li>配置了访问授权码的用户则可以统一使用访问授权码</li>
</ol>
<h3 id=""回答一些疑问"">回答一些疑问</h3>
<h5 id=""为什么不使用多个工作空间-其中一个设置访问授权码-"">为什么不使用多个工作空间，其中一个设置访问授权码？</h5>
<ol>
<li>两个工作空间来回切换使用，操作繁琐。</li>
<li>不同的工作空间内容不互通，但有在加密笔记与非加密笔记间双链引用的需求。</li>
<li>需要加密的往往只是单一的文档，这些文档可能出现在任何目录下，单独将需要加密的文档移动到另一个工作空间会破坏笔记的目录结构。</li>
</ol>
<h5 id=""为什么需要官方原生支持而非制作社区插件实现-"">为什么需要官方原生支持而非制作社区插件实现？</h5>
<ol>
<li>价值观
<ul>
<li><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2F"" target=""_blank"" rel=""nofollow ugc"">思源笔记官网</a>上写着「加密同步 隐私优先」，是「隐私优先的个人知识管理系统」。隐私优先，但只有云同步不会泄漏数据，这感觉就好像门口有两扇门却只关了半边一样难受，肯定得是一扇在云端挡服务厂商，一扇在线下挡人才完整。既然现在已经实现了端到端加密，那就应该更进一步，实现文档级的“加密”。</li>
</ul>
</li>
<li>维护
<ol>
<li>保证功能随时可用，否则关闭插件就能解除加密 / 出 BUG 需要等待插件作者更新</li>
<li>同时维护桌面端和移动端</li>
</ol>
</li>
</ol>
<h5 id=""这是一个真实的需求吗-"">这是一个真实的需求吗？</h5>
<p>有人说过：“<a href=""https://ld246.com/article/1668348986548/comment/1668403392143?r=a2930610542#comments"">有部分用户提需求，证明他真的有需求。不能因为自己没有需求而否定别人的需求。</a>”这里附上我随手找的相关需求帖和 issues ：</p>
<p><a href=""https://ld246.com/article/1689224966405?r=a2930610542"">思源笔记可以增加目录或文章的加密功能吗？</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F8747"" target=""_blank"" rel=""nofollow ugc"">希望增加目录或文档的加密功能</a></p>
<p><a href=""https://ld246.com/article/1684809573741?r=a2930610542"">[建议] 思源是否增加给文档加锁的功能</a></p>
<p><a href=""https://ld246.com/article/1683175249927?r=a2930610542"">功能建议：隐私锁功能，弱加密的锁就行</a></p>
<p><a href=""https://ld246.com/article/1670173554692?r=a2930610542"">关于实现笔记本地加密的再思考</a></p>
<p><a href=""https://ld246.com/article/1668348986548?r=a2930610542"">关于使用软链接特性实现思源笔记本加密的一些思考</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F6548"" target=""_blank"" rel=""nofollow ugc"">关于对思源笔记本进行加密的一种解决方案，但需要思源增加支持对 data 文件夹中的笔记本文件夹的软链接的识别，期望能添加这一特性</a></p>
<p><a href=""https://ld246.com/article/1664114220571?r=a2930610542"">什么时候可以加上笔记本、文档加密功能呀</a></p>
<p><a href=""https://ld246.com/article/1646245939387?r=a2930610542"">思源笔记能否针对单个笔记本做密码保护？</a></p>
<p><a href=""https://ld246.com/article/1627186421351?r=a2930610542"">希望能增加笔记本加密或隐藏功能</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F8185"" target=""_blank"" rel=""nofollow ugc"">有考虑增加目录加密和单个文章加密功能吗</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F6089"" target=""_blank"" rel=""nofollow ugc"">可否加入功能：可以为文档添加密码访问</a></p>
<h3 id=""原投票-请在下面的-新投票-里投票-"">原投票（请在下面的「新投票」里投票）</h3>
<p><div class=""articlePoll"">
    <h3>是否支持加密（多选）</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            多选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            261 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1701076789219"">
            <div class=""poll__percent"" style=""width: 36%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    功能：界面加密，文件不加密
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    36%
                    <span class=""ft__fade"">•</span>
                    95 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701076789269"">
            <div class=""poll__percent"" style=""width: 33%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    功能：文件也加密
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    33%
                    <span class=""ft__fade"">•</span>
                    87 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701076789320"">
            <div class=""poll__percent"" style=""width: 15%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    需求：急需
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    15%
                    <span class=""ft__fade"">•</span>
                    41 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701076789370"">
            <div class=""poll__percent"" style=""width: 14%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    需求：无所谓，我还用不着
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    14%
                    <span class=""ft__fade"">•</span>
                    38 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
<p>原来的选项设置得不好，大部分人都把多选当作单选，现在分清楚一些，重新投票：</p>
<h3 id=""新投票-两个-"">新投票（两个）</h3>
<p><div class=""articlePoll"">
    <h3>是否支持提供文档级加密？（多选）</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            多选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            212 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1701113645369"">
            <div class=""poll__percent"" style=""width: 71%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    支持提供文档级“加密”
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    71%
                    <span class=""ft__fade"">•</span>
                    152 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701113645419"">
            <div class=""poll__percent"" style=""width: 26%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    同时期待本地数据加密
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    26%
                    <span class=""ft__fade"">•</span>
                    56 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701113645470"">
            <div class=""poll__percent"" style=""width: 1%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    可能需要其他方式来加密
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    1%
                    <span class=""ft__fade"">•</span>
                    4 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
<p><div class=""articlePoll"">
    <h3>你对文档级“加密”的需求如何？（单选）</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            184 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1701113642208"">
            <div class=""poll__percent"" style=""width: 40%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    迫切需要，刚需啊刚需！
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    40%
                    <span class=""ft__fade"">•</span>
                    74 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701113642259"">
            <div class=""poll__percent"" style=""width: 57%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    有了我就用，没出我也不急
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    57%
                    <span class=""ft__fade"">•</span>
                    105 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1701113642309"">
            <div class=""poll__percent"" style=""width: 2%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    打死都不在思源里记录隐私信息
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    2%
                    <span class=""ft__fade"">•</span>
                    5 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
                

作者：JeffreyChen
链接：https://ld246.com/article/1701076921619
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",JeffreyChen,思源笔记,链滴优选
675,【代码片段分享】思源笔记用到现在积累的所有代码片段 - 链滴,Tue Nov 21 2023 15:32:13 GMT+0000 (Coordinated Universal Time),"
                    <h3 id=""方法"">方法</h3>
<p>自制 CSS 片段的一种方法：<a href=""https://ld246.com/article/1692378977189/comment/1692586377622#comments"">标题字形的加粗和字号怎么修改？</a></p>
<h3 id=""片段"">片段</h3>
<h4 id=""在用-"">在用：</h4>
<h5 id=""去除图片后的多余空行-CSS片段"">去除图片后的多余空行 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1692254723415"">链滴：代码片段解决图片插入后默认新增一行以输入文字的问题</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 去除图片后的多余空行 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">img</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">style</span><span class=""highlight-o"">]),</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">img</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">style</span><span class=""highlight-o"">])</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">inline-block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""类似-logseq-的层次子弹线-CSS片段"">类似 logseq 的层次子弹线 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1693238082034/comment/1693238385329#comments"">链滴：有没有大佬能写一个类似 logseq 的层次子弹线 css 片段</a></p>
<p>配套：类似 logseq 的层次子弹线 JS 片段</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 类似 logseq 的层次子弹线 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* REF https://github.com/svchord/Rem-Craft */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgb</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">70</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">110</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">220</span><span class=""highlight-p"">);;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">16</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">16</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">content</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">absolute</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-n"">pointer-events</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">34</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-18</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-style</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">solid</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgb</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">70</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">110</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">220</span><span class=""highlight-p"">);;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">))</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">bottom</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-2</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">38</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">8</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)~</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">))</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">o</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">24</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">t</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">28</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">content</span><span class=""highlight-p"">:</span><span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">absolute</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-n"">pointer-events</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">34</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-18</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-style</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">solid</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgb</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">70</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">110</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">220</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">calc</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">100</span><span class=""highlight-kt"">%</span> <span class=""highlight-o"">+</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(+</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">auto</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">bottom</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">][</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">NodeHeading</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">185</span><span class=""highlight-kt"">%</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)~[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">bq</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">bq</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)~[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)~[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">fold</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""1\""</span><span class=""highlight-o"">]&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">o</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-10</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">o</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">28</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">t</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgb</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">70</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">110</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">220</span><span class=""highlight-p"">);;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">t</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">14</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">14</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">t</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">-14</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">t</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">32</span><span class=""highlight-kt"">px</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-nt"">t</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-task--done</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">list</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">139</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">139</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">139</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""类似-logseq-的层次子弹线-JS片段"">类似 logseq 的层次子弹线 JS 片段</h5>
<p><a href=""https://ld246.com/article/1693238082034/comment/1693238385329#comments"">链滴：有没有大佬能写一个类似 logseq 的层次子弹线 css 片段</a></p>
<p>配套：类似 logseq 的层次子弹线 CSS 片段</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/* 类似 logseq 的层次子弹线 JS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/**
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * 获得指定块位于的编辑区
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @params {HTMLElement}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @return {HTMLElement} 光标所在块位于的编辑区
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @return {null} 光标不在块内
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getTargetEditor</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">block</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">while</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">block</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">null</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-o"">!</span><span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'protyle-wysiwyg\'</span><span class=""highlight-p"">))</span> <span class=""highlight-nx"">block</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-nx"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/**
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * 获得焦点所在的块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @return {HTMLElement} 光标所在块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> * @return {null} 光标不在块内
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm""> */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getFocusedBlock</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">activeElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'protyle-wysiwyg\'</span><span class=""highlight-p"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">block</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">window</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getSelection</span><span class=""highlight-p"">()</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">focusNode</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">;</span> <span class=""highlight-c1"">// 当前光标
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-k"">while</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">block</span> <span class=""highlight-o"">!=</span> <span class=""highlight-kc"">null</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">dataset</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">nodeId</span> <span class=""highlight-o"">==</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">)</span> <span class=""highlight-nx"">block</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">focusHandler</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-cm"">/* 获取当前编辑区 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">block</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getFocusedBlock</span><span class=""highlight-p"">();</span> <span class=""highlight-c1"">// 当前光标所在块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-cm"">/* 当前块已经设置焦点 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">block</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`block-focus`</span><span class=""highlight-p"">))</span> <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-cm"">/* 当前块未设置焦点 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">editor</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getTargetEditor</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">block</span><span class=""highlight-p"">);</span> <span class=""highlight-c1"">// 当前光标所在块位于的编辑区
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">editor</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">editor</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`.block-focus`</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">element</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">element</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">remove</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`block-focus`</span><span class=""highlight-p"">));</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">block</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">add</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`block-focus`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// setSelector(block);
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">bulletMain</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 跟踪当前所在块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-nb"">window</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'mouseup\'</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">focusHandler</span><span class=""highlight-p"">,</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nb"">window</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'keyup\'</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">focusHandler</span><span class=""highlight-p"">,</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">(</span><span class=""highlight-kr"">async</span> <span class=""highlight-p"">()</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">bulletMain</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'加载子弹线成功\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})();</span>
</span></span></code></pre>
<h5 id=""文件树缩进线-笔记本区隔-CSS片段"">文件树缩进线&amp;笔记本区隔 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1693619190119"">链滴：【求代码片段】如何为文件树添加缩进线</a></p>
<p><a href=""https://ld246.com/article/1693634937721"">链滴：[分享] 文件树缩进线（Cliff-Dark 主题中的部分 CSS 片段）</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 文件树缩进线&amp;笔记本区隔 CSS片段*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__file</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">padding-left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">8</span><span class=""highlight-kt"">px</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">padding-right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-mh"">#899fad</span><span class=""highlight-p"">;</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__file</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__icon</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">margin-right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">transform</span><span class=""highlight-p"">:</span><span class=""highlight-nb"">scale</span><span class=""highlight-p"">(</span><span class=""highlight-mf"">0.7</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__file</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">border-left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">dotted</span> <span class=""highlight-mh"">#c5d2db</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mf"">16.5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__file</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-1</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">padding-right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout--float</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">margin-right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-1</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__file</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 笔记本 区隔 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__file</span> <span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.3</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">12</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">outline</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">1.5</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">double</span> <span class=""highlight-mh"">#5f7a8c</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">overflow</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">hidden</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""调整文档树字体大小-CSS片段"">调整文档树字体大小 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1693727644291/comment/1693728381976#comments"">链滴：建议新增功能：文档树字体大小可单独设置，正文可滚动缩放大小</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 调整文档树字体大小 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">font-size</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">12</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 设置合适的字体大小，可以根据需要调整 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""多彩层级大纲-CSS片段"">多彩层级大纲 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1655740026659"">链滴：【CSS 片段】多彩大纲层级</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 多彩层级大纲 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 相关代码来自于dark+主题作者zuoqiu-yingyi和starDust主题作者，特别感谢notion主题作者Roy，灵感来源于\""思源群友\"" */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background1</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background2</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background3</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background4</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background5</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background6</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background7</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background8</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>目前在用（暗黑模式）：</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 多彩层级大纲 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 相关代码来自于dark+主题作者zuoqiu-yingyi和starDust主题作者，特别感谢notion主题作者Roy，灵感来源于\""思源群友\"" */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#051214</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#0d2d33</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#174d57</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#206875</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#278696</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#56878f</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#69878c</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#87999c</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""浮动显示大纲块标记-H1-H2---CSS片段"">浮动显示大纲块标记(H1、H2…) CSS 片段</h5>
<p><a href=""https://ld246.com/article/1670253216830"">链滴：【 代码片段】啊哈哈哈代码来咯 ~~ 那你们先吃我就不打扰了哈 ~~</a></p>
<p><a href=""https://ld246.com/article/1669695054006/comment/1669709383716#comments"">链滴：请问大纲中的「H2」有没有办法隐藏掉呢？</a></p>
<p>跟 隐藏大纲块标记(H1、H2…) CSS 片段 二选一</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 浮动显示大纲块标记(H1、H2…) CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 大纲块标隐藏样式 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 为大纲块标和折叠按钮调整位置 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h1\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h2\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h3\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h4\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h5\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h6\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__toggle</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h1\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h2\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h3\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h4\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h5\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h6\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">opacity</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">all</span> <span class=""highlight-mi"">300</span><span class=""highlight-kt"">ms</span> <span class=""highlight-kc"">ease-out</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*----------------------*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 为大纲块标添加悬停显示效果 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">popover__block</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">opacity</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h1\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h2\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h3\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h4\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h5\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""h6\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">red</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*----------------------*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 为大纲标题项添加背景过渡效果 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list--background</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">all</span> <span class=""highlight-mi"">300</span><span class=""highlight-kt"">ms</span> <span class=""highlight-kc"">ease-out</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""自定义标记颜色-CSS片段"">自定义标记颜色 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1690940786180"">链滴：请问在思源笔记中，如何自定义 \""标记\"" 功能的字体颜色?</a></p>
<p><a href=""https://ld246.com/article/1693747371783"">链滴：标记功能怎么改外观啊</a></p>
<p>颜色在这里选：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fc.runoob.com%2Ffront-end%2F6214%2F"">图片取色器/拾色器 - 菜鸟工具</a> 可以调节透明度</p>
<p><img src=""https://b3logfile.com/file/2023/11/siyuan/1672108273034/assets/net-img-image-yyU1szD-20230903215450-wrx3rcm.png?imageView2/2/interlace/1/format/webp""></p>
<p>透明的淡蓝色：#5E8CD35C</p>
<p>透明的淡黄色：#F9FC093B</p>
<p>==透明颜色的字母要大写 ↑==</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 自定义标记颜色 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">:</span><span class=""highlight-nd"">root</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nv"">--b3-protyle-inline-mark-background</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#F9FC09</span><span class=""highlight-mi"">3</span><span class=""highlight-n"">B</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""自定义随机头图-JS片段"">自定义随机头图 JS 片段</h5>
<p><a href=""https://ld246.com/article/1694612740828"">链滴：【教程】把随机题头图换成自己的图片，让思源笔记更加赏心悦目</a></p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/* 自定义随机头图 JS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">(()</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">生成随机背景链接</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">请求响应</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'/snippets/assets/backgrounds/\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">临时dom</span> <span class=""highlight-o"">=</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">DOMParser</span><span class=""highlight-p"">().</span><span class=""highlight-nx"">parseFromString</span><span class=""highlight-p"">(</span><span class=""highlight-kr"">await</span> <span class=""highlight-nx"">请求响应</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">text</span><span class=""highlight-p"">(),</span> <span class=""highlight-s2"">\""text/html\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">图片链接数组</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">临时dom</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'a\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">随机链接</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">图片链接数组</span><span class=""highlight-p"">[</span><span class=""highlight-nb"">Math</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">floor</span><span class=""highlight-p"">(</span><span class=""highlight-nb"">Math</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">random</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">*</span> <span class=""highlight-nx"">图片链接数组</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span><span class=""highlight-p"">)].</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""href\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">随机链接</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""/snippets/assets/backgrounds/\""</span> <span class=""highlight-o"">+</span> <span class=""highlight-nx"">随机链接</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">随机链接</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'contextmenu\'</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">更换随机背景图</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">更换随机背景图</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">元素</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">触发目标</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">元素</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">触发目标</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">元素</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">tagName</span> <span class=""highlight-o"">==</span> <span class=""highlight-s1"">\'svg\'</span> <span class=""highlight-o"">||</span> <span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">tagName</span> <span class=""highlight-o"">==</span> <span class=""highlight-s1"">\'use\'</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">更换随机背景图</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">value</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""protyle-icon b3-tooltips b3-tooltips__sw\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">随机链接</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">生成随机背景链接</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">               <span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'img\'</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">setAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""style\""</span><span class=""highlight-p"">,</span> <span class=""highlight-s1"">\'\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">               <span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'img\'</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">setAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""src\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">随机链接</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'/api/attr/setBlockAttrs\'</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s1"">\'post\'</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">id</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">触发目标</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">attrs</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s1"">\'title-img\'</span><span class=""highlight-o"">:</span> <span class=""highlight-sb"">`background-image:url(</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">随机链接</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">)`</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})()</span>
</span></span></code></pre>
<h5 id=""左右移动标题位置-CSS片段"">左右移动标题位置 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1694699145984"">链滴：【代码片段】突出标题</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 左右移动标题位置 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h1</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h1</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-35</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 负值可以根据需要进行调整 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h2</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h3</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h4</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h5</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h6</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h2</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h3</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h4</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h5</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">h6</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 负值可以根据需要进行调整 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""Savor-主题的多行搜索展示-CSS片段"">Savor 主题的多行搜索展示 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1695053726062/comment/1695091416549#comments"">链滴：吹爆 savor 主题</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Froyc01%2Fnotion-theme%2Fblob%2Fc3f75464be71e222e98c9a08dfb1a2757f2a1f3e%2Fstyle%2Fcustom%2Fctrlp.css"" target=""_blank"" rel=""nofollow ugc"">GitHub：notion-theme/style/custom/ctrlp.css</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* Savor 主题的多行搜索展示 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">search__layout--row</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-top</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">search__layout</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-bottom</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">surface</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">lighter</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding-bottom</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__meta</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">list-item</span><span class=""highlight-o"">--</span><span class=""highlight-n"">meta</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">font-size</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">.7</span><span class=""highlight-kt"">rem</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">line-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">bottom</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">8</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">8</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">max-width</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">34</span><span class=""highlight-kt"">vw</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">position</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">absolute</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">white-space</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">nowrap</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">overflow</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">hidden</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">text-overflow</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">ellipsis</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__meta</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__meta</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">font-size</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">line-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin-right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">content</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""?\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">+</span><span class=""highlight-nt"">div</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">])</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-new\""</span><span class=""highlight-o"">])</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding-left</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">dockright</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">])</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(+</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__none</span><span class=""highlight-o"">)</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">,</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span> <span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">])+</span><span class=""highlight-nt"">div</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-p"">,</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">-1</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">30</span><span class=""highlight-kt"">px</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">32</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span> <span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">])+</span><span class=""highlight-nt"">div</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'search-item\'</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">last-child</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-p"">,</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">-1</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">,</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">,</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">15</span><span class=""highlight-p"">,</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-p"">)</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*.fn__flex-column #searchList&gt;.b3-list-item:not([data-type=\'search-item\'])+div [data-type=\'search-item\']&gt;.b3-list-item__text{
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    margin-left: 20px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    max-height: 89px ;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    padding:6px 0px 5px 5px;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    overflow-y: auto !important;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    text-overflow: ellipsis !important;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    line-height: 1.3;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">    -webkit-box-orient: inherit;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">}*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-item\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding-right</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-item\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">absolute</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-item\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">+</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">absolute</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-item\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">+</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span><span class=""highlight-o"">+</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__text</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">40</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">searchList</span><span class=""highlight-o"">&gt;[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-item\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__text</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">20</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">overflow-y</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">auto</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">text-overflow</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">ellipsis</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">line-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">1.3</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">inline-block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">search__list</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding-top</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-new\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">40</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">16</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">bq</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background13</span><span class=""highlight-p"">)</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background13</span><span class=""highlight-p"">)</span> <span class=""highlight-kc"">inset</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""search-new\""</span><span class=""highlight-o"">]</span> <span class=""highlight-nt"">kbd</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">font-family</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">sans-serif</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">criteria</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-chips</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-chip</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">criteria</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-button--small</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">8</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">font-size</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">14</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">#</span><span class=""highlight-nn"">criteria</span><span class=""highlight-o"">+</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block__icons</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">min-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">36</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">0</span> <span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">6</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-n"">hover</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-dialog__body</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">switch-doc</span><span class=""highlight-o"">)</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">search__tip</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">30</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">-</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">*[</span><span class=""highlight-nt"">custom-f</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""dt\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""u\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span> <span class=""highlight-nt"">svg</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">unset</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">search__tip</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">color</span><span class=""highlight-p"">:</span><span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">search__tip</span> <span class=""highlight-nt"">kbd</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">border</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-o"">-</span><span class=""highlight-n"">focus</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""更改分割线样式-CSS片段"">更改分割线样式 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1695131669084"">链滴：【代码片段分享】改一下分割线，拯救你的眼睛（颜色、粗细）</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 更改分割线样式 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">hr</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">border</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">hr</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">content</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">absolute</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">50</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">left</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">right</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 粗细 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">yellow</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 颜色 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">transform</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">translateY</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">-50</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""中键点击展开文档树-JS片段"">中键点击展开文档树 JS 片段</h5>
<p><a href=""https://ld246.com/article/1682480146495"">链滴：可以通过 JS 代码实现鼠标中键展开文档吗？</a></p>
<p>跟 文档树点击文档自动展开下级 JS 片段 有冲突，不能同时启用</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/* 中键点击展开文档树 JS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">(</span><span class=""highlight-kd"">function</span><span class=""highlight-p"">(){</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">g_reset</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">setInterval</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">main</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">2000</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">main</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.sy__file\'</span><span class=""highlight-p"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">clearInterval</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">g_reset</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span><span class=""highlight-k"">else</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.sy__file\'</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'mousedown\'</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">event</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">button</span> <span class=""highlight-o"">!=</span> <span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span> <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">notTitleFlag</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-o"">!</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'b3-list-item__text\'</span><span class=""highlight-p"">))</span> <span class=""highlight-nx"">notTitleFlag</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">target</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentNode</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">temp</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""0426\""</span><span class=""highlight-p"">,</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-kd"">let</span> <span class=""highlight-nx"">i</span> <span class=""highlight-o"">=</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span> <span class=""highlight-nx"">i</span> <span class=""highlight-o"">&lt;</span> <span class=""highlight-mi"">4</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">temp</span><span class=""highlight-p"">;</span> <span class=""highlight-nx"">i</span><span class=""highlight-o"">++</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">temp</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-type\""</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""navigation-file\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-o"">||</span> <span class=""highlight-nx"">temp</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-type\""</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""navigation-root\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">target</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">temp</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-k"">break</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">temp</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">temp</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentNode</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""0426target\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">target</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">target</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-type\""</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""navigation-file\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">              <span class=""highlight-o"">||</span> <span class=""highlight-nx"">target</span><span class=""highlight-o"">?</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-type\""</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""navigation-root\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">b3ListItemToggle</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.b3-list-item__toggle\'</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">title</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.b3-list-item__text\'</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">b3ListItemToggle</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'fn__hidden\'</span><span class=""highlight-p"">))</span> <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">b3ListItemToggle</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">click</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">ctrlKey</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">title</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">click</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">},</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})();</span>
</span></span></code></pre>
<h5 id=""钉住的同时显示-icon-和标题-CSS片段"">钉住的同时显示 icon 和标题 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1695731777807"">链滴：求助求助 钉住效果如何同时显示 icon 和标题</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 钉住的同时显示 icon 和标题 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">item--pin</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">item__text</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">auto</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">max-width</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">flex</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""图片透明通道添加背景色-CSS片段"">图片透明通道添加背景色 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1693574107912/comment/1693581942259#comments"">链滴：[功能建议] 图片区域增加可选底色</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 图片透明通道添加背景色 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">img</span> <span class=""highlight-nt"">img</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#f0f0f0</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 设置背景色，可以根据需要修改颜色值 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-o"">//</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span> <span class=""highlight-p"">{</span> <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""禁用浮窗过渡动画-CSS片段"">禁用浮窗过渡动画 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1696031675148/comment/1696060559833#comments"">链滴：浮窗动画</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 禁用浮窗过渡动画 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">:</span><span class=""highlight-nd"">root</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nv"">--b3-transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nv"">--b3-width-transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-background</span><span class=""highlight-err"">\\</span><span class=""highlight-nt"">_</span><span class=""highlight-err"">\\</span><span class=""highlight-nt"">_iconw</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-content--transition</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""闪卡的标记转挖空-CSS片段"">闪卡的标记转挖空 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1697164153040"">链滴：希望支持单个挖空答案显示</a></p>
<p>关联：标记转挖空 CSS 片段</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 闪卡的标记转挖空 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">card__block</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">card__block</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">transparent</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">transparent</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-image</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-bottom</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">all</span> <span class=""highlight-mi"">300</span><span class=""highlight-kt"">ms</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">card__block</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">card__block</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">card__block</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">all</span> <span class=""highlight-mi"">300</span><span class=""highlight-kt"">ms</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""图片居中-CSS片段"">图片居中 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1697610476975/comment/1697689371368#comments"">链滴：我希望拷贝图片到思源中时，默认都是居中的，有什么方式处理吗？</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 图片居中 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">span</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">img</span><span class=""highlight-o"">)</span> <span class=""highlight-p"">{</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">text-align</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">center</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""反链-提及面板固定文档名称-CSS片段"">反链&amp;提及面板固定文档名称 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1699535322926"">链滴：代码片段 ｜ 反链 &amp; 提及面板，固定文档名称</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 反链&amp;提及面板固定文档名称 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">backlinkMList</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">backlinkList</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nv"">--b3-theme-primary-lightest</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">rgba</span><span class=""highlight-p"">(</span><span class=""highlight-mi"">53</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">115</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">240</span><span class=""highlight-p"">,</span> <span class=""highlight-mi"">1</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">sticky</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">z-index</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-n"">hover</span><span class=""highlight-p"">,</span> <span class=""highlight-mh"">#363636</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""滚动条样式-CSS片段"">滚动条样式 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1700634574875/comment/1700640322833#comments"">链滴：建议 [滚动条] 静默时隐藏，滚动时再出现</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 滚动条样式 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">::</span><span class=""highlight-nd"">-webkit-scrollbar</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 粗细 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">::</span><span class=""highlight-nd"">-webkit-scrollbar-thumb</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     <span class=""highlight-k"">border</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-mh"">#808080</span><span class=""highlight-mi"">4</span><span class=""highlight-n"">a</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 边框颜色 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#696969</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 颜色 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     <span class=""highlight-k"">box-sizing</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">content-box</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> 	<span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">10</span><span class=""highlight-kt"">px</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 粗细 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 在鼠标悬停时的样式 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">::</span><span class=""highlight-nd"">-webkit-scrollbar-thumb</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">     <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-mh"">#B5B5B5</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 颜色 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-p"">}</span>
</span></span></code></pre>
<h4 id=""toc_h4_23""></h4>
<hr>
<h4 id=""偶尔用-"">偶尔用：</h4>
<h5 id=""文档树和大纲自动换行-CSS片段"">文档树和大纲自动换行 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1693302653132/comment/1693628408169#comments"">链滴：建议 - 大纲标题隔行展示</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 文档树和大纲自动换行 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__text</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">overflow</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">visible</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kp"">-webkit-</span><span class=""highlight-n"">line-clamp</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">unset</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">height</span><span class=""highlight-p"">:</span><span class=""highlight-n"">fit-content</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""标记转挖空-CSS片段"">标记转挖空 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1694219995629/comment/1694238151673#comments"">链滴：分享常用的思源笔记插件</a></p>
<p>关联：闪卡的标记转挖空 CSS 片段</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 标记转挖空 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">],</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">transparent</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">transparent</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-image</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-bottom</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">all</span> <span class=""highlight-mi"">300</span><span class=""highlight-kt"">ms</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span><span class=""highlight-o"">,</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">block-focus</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-s2"">\""mark\""</span><span class=""highlight-o"">]</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">all</span> <span class=""highlight-mi"">300</span><span class=""highlight-kt"">ms</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""在任务列表前带有序号-JS片段"">在任务列表前带有序号 JS 片段</h5>
<p><a href=""https://ld246.com/article/1676314389274"">链滴：思源笔记折腾记录 - 任务列表的序号</a></p>
<p>任务列表多一点就会导致思源卡死，慎用</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/* 在任务列表前带有序号 JS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">生成任务列表序号</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">setTimeout</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">生成任务列表序号</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">1000</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">head</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s2"">\""beforeEnd\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-sb"">`&lt;style&gt;
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">    .protyle-wysiwyg [data-node-id].li[data-subtype=\""t\""] .protyle-action.protyle-action--task:before {
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">        content:var(--custom-index) ;  
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">    }
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-sb"">    &lt;/style&gt;`</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">生成任务列表序号</span><span class=""highlight-p"">(){</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">任务列表元素数组</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.protyle-wysiwyg [data-type=\""NodeList\""]:has([data-subtype=\""t\""])\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">任务列表元素数组</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">任务列表元素</span><span class=""highlight-p"">)=&gt;{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">同步生成序号</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">任务列表元素</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">聚焦任务列表项元素数组</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.protyle-wysiwyg [data-subtype=\""t\""]:not(.list .li)\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">聚焦任务列表项元素数组</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">任务列表项元素</span><span class=""highlight-p"">=&gt;{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">异步生成序号</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">任务列表项元素</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">)</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">setTimeout</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">生成任务列表序号</span><span class=""highlight-p"">,</span><span class=""highlight-mi"">1000</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">同步生成序号</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">任务列表元素</span><span class=""highlight-p"">){</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">元素id</span><span class=""highlight-o"">=</span> <span class=""highlight-nx"">任务列表元素</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'data-node-id\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">任务选框数组</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">任务列表元素</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`[data-node-id=\""</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">元素id</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">\""]&gt;div&gt;.protyle-action.protyle-action--task`</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">任务选框数组</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">任务选框</span><span class=""highlight-p"">,</span><span class=""highlight-nx"">下标</span><span class=""highlight-p"">)=&gt;{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">任务选框</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">setAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""style\""</span><span class=""highlight-p"">,</span> <span class=""highlight-sb"">`--custom-index :\""</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">下标</span><span class=""highlight-o"">+</span><span class=""highlight-mi"">1</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">.\""`</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">异步生成序号</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">任务列表项元素</span><span class=""highlight-p"">){</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">元素id</span><span class=""highlight-o"">=</span> <span class=""highlight-nx"">任务列表项元素</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'data-node-id\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">响应</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'/api/query/sql\'</span><span class=""highlight-p"">,{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span><span class=""highlight-s1"">\'post\'</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span><span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">stmt</span><span class=""highlight-o"">:</span><span class=""highlight-sb"">`select * from blocks where id = (select parent_id from blocks where id =\'</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">元素id</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">\') `</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">响应</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">父块内容</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span><span class=""highlight-p"">(</span><span class=""highlight-kr"">await</span> <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'/api/filetree/getDoc\'</span><span class=""highlight-p"">,{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span><span class=""highlight-s1"">\'post\'</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span><span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">({</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">id</span><span class=""highlight-o"">:</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-mi"">0</span><span class=""highlight-p"">].</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">size</span><span class=""highlight-o"">:</span><span class=""highlight-mi"">102400</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">})).</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">div</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">createElement</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'div\'</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span><span class=""highlight-o"">=</span><span class=""highlight-nx"">父块内容</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">content</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.li\'</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">元素</span><span class=""highlight-p"">,</span><span class=""highlight-nx"">下标</span><span class=""highlight-p"">)=&gt;{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">元素</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'data-node-id\'</span><span class=""highlight-p"">)</span><span class=""highlight-o"">===</span><span class=""highlight-nx"">元素id</span><span class=""highlight-p"">){</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">任务列表项元素</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.protyle-action.protyle-action--task\'</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">setAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""style\""</span><span class=""highlight-p"">,</span> <span class=""highlight-sb"">`--custom-index :\""</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">下标</span><span class=""highlight-o"">+</span><span class=""highlight-mi"">1</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">.\""`</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""多行页签-CSS片段"">多行页签 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1699374925407"">链滴：一个多行页签的 css</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 多行页签 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-o"">,</span> <span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">flex-wrap</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">wrap</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-1</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span><span class=""highlight-o"">)</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">max-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">100</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""tab-header\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">icon</span><span class=""highlight-o"">-</span><span class=""highlight-n"">hover</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h4 id=""-""></h4>
<hr>
<h4 id=""不在用-"">不在用：</h4>
<h5 id=""调整行距-CSS片段-选择性使用-"">调整行距 CSS 片段（选择性使用）</h5>
<p><a href=""https://ld246.com/article/1693913131852"">链滴：行间距调试问题</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 调整行距（选择性使用） CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> 	<span class=""highlight-k"">line-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.8</span><span class=""highlight-p"">;</span>  <span class=""highlight-c"">/* 普通文本块的行间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.5</span><span class=""highlight-p"">;</span>  <span class=""highlight-c"">/* 段间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span> <span class=""highlight-p"">{</span> <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-p"">}</span>  <span class=""highlight-c"">/* 列表块的间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span> <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-p"">}</span>  <span class=""highlight-c"">/* 各种块的间距 */</span>
</span></span></code></pre>
<p><a href=""https://ld246.com/article/1694680072808/comment/1694683970981#comments"">链滴：怎么设置段间距</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 普通文本块的行间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">px</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""超级块边框-CSS片段"">超级块边框 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1670253216830"">链滴：【 代码片段】啊哈哈哈代码来咯 ~~ 那你们先吃我就不打扰了哈 ~~</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 超级块边框 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 为超级块的添加边框 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span> 
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 调整超级块的子块 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-sb-layout</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""col\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-sb-layout</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""row\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c"">/* box-shadow: none; */</span> <span class=""highlight-c"">/* 如果觉得子块线条太多可以加入这个声明 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 调整子块间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 调整圆角 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-sb-layout</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""col\""</span><span class=""highlight-o"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-sb-layout</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""row\""</span><span class=""highlight-o"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-sb-layout</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""col\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-sb-layout</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""row\""</span><span class=""highlight-o"">]&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-radius</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">4</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 超级块悬停显示边框 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">outline</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">dashed</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">surface</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 为超级块拖拽调整显眼的颜色 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__top</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">color8</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__bottom</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">color8</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__left</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">-5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">color9</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__right</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">0</span> <span class=""highlight-mi"">3</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">-1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">font</span><span class=""highlight-o"">-</span><span class=""highlight-n"">color9</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__top</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__bottom</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__left</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">dragover__right</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">transition</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""文档标题居中显示-CSS片段"">文档标题居中显示 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1693376456233/comment/1693391330169#comments"">链滴：文档标题置中是可能的吗？</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 文档标题居中显示 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title__input</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">text-align</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">center</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""隐藏大纲块标记-H1-H2---CSS片段"">隐藏大纲块标记(H1、H2…) CSS 片段</h5>
<p><a href=""https://ld246.com/article/1682480401807/comment/1682503518700#comments"">链滴：文档树和大纲，1)宽度缩进自由问题，2) 简洁显示问题</a></p>
<p>跟 浮动显示大纲块标记(H1、H2…) CSS 片段 二选一</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 隐藏大纲块标记(H1、H2…) CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">sy__outline</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item__graphic</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""渐变色的标记-CSS片段"">渐变色的标记 CSS 片段</h5>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 渐变色的标记 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-nt"">mark</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-nt"">span</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-nt"">mark</span><span class=""highlight-o"">],</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-nt"">mark</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-nt"">span</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">~=</span><span class=""highlight-nt"">mark</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">inherit</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">background-image</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">linear-gradient</span><span class=""highlight-p"">(</span><span class=""highlight-kc"">to</span> <span class=""highlight-kc"">bottom</span><span class=""highlight-p"">,</span> <span class=""highlight-kc"">transparent</span> <span class=""highlight-mi"">20</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">,</span> <span class=""highlight-mh"">#fff29d</span><span class=""highlight-mi"">1</span><span class=""highlight-n"">a</span> <span class=""highlight-mi"">30</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">,</span> <span class=""highlight-mh"">#fff29d</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h5 id=""文档树点击文档自动展开下级-JS片段"">文档树点击文档自动展开下级 JS 片段</h5>
<p><a href=""https://ld246.com/article/1680874816476"">链滴：代码片段：文件树点击标题自动展开</a></p>
<p><a href=""https://ld246.com/article/1682476267736/comment/1682479365610#comments"">链滴：一个小建议：能否在打开页面的同时，自动展开该页面的子页面</a></p>
<p>跟 中键点击展开文档树 JS 片段 有冲突，不能同时启用</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-cm"">/* 文档树点击文档自动展开下级 JS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">log</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""加载代码片段：自动展开文件树\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.sy__file\'</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'mousedown\'</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">event</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-o"">!</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'b3-list-item__text\'</span><span class=""highlight-p"">))</span> <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentNode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-type\""</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">!==</span> <span class=""highlight-s2"">\""navigation-file\""</span><span class=""highlight-p"">)</span> <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">b3ListItemToggle</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">event</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">target</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentNode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'.b3-list-item__toggle\'</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">b3ListItemToggle</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">classList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">contains</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'fn__hidden\'</span><span class=""highlight-p"">))</span> <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-nx"">b3ListItemToggle</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">click</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">});</span>
</span></span></code></pre>
<h5 id=""调整块间距-CSS片段"">调整块间距 CSS 片段</h5>
<p><a href=""https://ld246.com/article/1695626396087/comment/1695700186041#comments"">链滴：如何调整快间距</a></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 调整块间距 CSS片段 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*  正文字体占比  */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-nt"">p</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-typography</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-nt"">p</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">line-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">1.7</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>  <span class=""highlight-c"">/* 调整行高 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">2.3</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-mf"">1.5</span><span class=""highlight-kt"">px</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 调整内边距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">margin-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">.3</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 调整上外边距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">margin-bottom</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">.3</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>  <span class=""highlight-c"">/* 调整下外边距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* h1~6标题间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">h1</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">h2</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">h3</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">h4</span><span class=""highlight-o"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">h5</span><span class=""highlight-o"">,</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">h6</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">font-weight</span><span class=""highlight-p"">:</span><span class=""highlight-mi"">700</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 标题字体粗细 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">margin-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">.8</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 标题上间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-bottom</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">.4</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span> <span class=""highlight-c"">/* 标题下间距 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
                

作者：JeffreyChen
链接：https://ld246.com/article/1700551933609
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",JeffreyChen,"代码,分享,思源笔记",链滴优选
722,是否需要自动清理过长时间的快照？ - 链滴,Thu Nov 09 2023 16:57:00 GMT+0000 (Coordinated Universal Time),"
                    <p>GitHub 上一个的新的特性正在讨论，即需不需要自动清理过长时间以前的快照，目前这个时间暂定为默认 30 天，但可以自己设置。链接在此：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F9613"" target=""_blank"" rel=""nofollow ugc"">Issue #9613 · siyuan-note/siyuan</a></p>
<p>不清理快照的好处：</p>
<ul>
<li>安全性，数据丢失了之后再久，只要快照存在就能完美回滚。</li>
</ul>
<p>自动清理快照的好处：</p>
<ul>
<li>数据快照过多的话会影响启动速度。</li>
</ul>
<blockquote>
<p>我个人暂时没感受到这一点，可能在性能较差的设备上会比较明显。</p>
</blockquote>
<p>备选方案：</p>
<ul>
<li>可以控制自动清理的力度，即可以控制为 30 天以外的快照每天只保留一个，这个频率最好可以自己设置。但是这个实现难度相对较大，也没有完全不清理的模式安全。</li>
</ul>
<hr>
<p>投票能说一下自己的看法最好不过了。</p>
<p><div class=""articlePoll"">
    <h3>是否需要自动清理快照的特性</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            39 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1699520255777"">
            <div class=""poll__percent"" style=""width: 20%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    自动清理
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    20%
                    <span class=""ft__fade"">•</span>
                    8 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1699520255828"">
            <div class=""poll__percent"" style=""width: 12%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    不自动清理
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    12%
                    <span class=""ft__fade"">•</span>
                    5 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1699520255878"">
            <div class=""poll__percent"" style=""width: 66%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    备选方案
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    66%
                    <span class=""ft__fade"">•</span>
                    26 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
                

作者：zxhd86
链接：https://ld246.com/article/1699520221020
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,"Q&amp;A,思源笔记",链滴优选
673,破除知识管理迷信 - 链滴,Thu Nov 09 2023 13:06:40 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""阅读提醒"">阅读提醒</h2>
<blockquote>
<p>全文总共 8000 字，需要阅读时间极长，且内容前言不搭后语，跨度极大。</p>
<p>如果要搞某些小知识资本主义者的调调，我应该说这是我文字功底不够扎实，行文不够简练，来提升我的逼格。但我不是这样的性格。</p>
<p>以下大部分内容，如果激起了读者的反感，那么主要是因为这些段落往往都取自某本书或某几本书，我把一本书级的数据量压缩到一个段落的数据量，丢失了大量的细节与补充资料，读起来自然觉得不够细腻。</p>
<p>对此我会在每一个段落的末尾列出我引用的书籍与作者名称，我是如何使用软件的某些功能写下这段文字的,通过这种方式,方便大家获得更直观的体会。</p>
</blockquote>
<h2 id=""从纸质笔记说起"">从纸质笔记说起</h2>
<p>在我父亲小时候，纸张和书籍还是极为昂贵的物资。我父亲曾经向我描绘过一种金属管，用来套在铅笔上延长铅笔的使用寿命。</p>
<p>当然了，这对于从小一学期能弄丢三四支钢笔的我来说肯定是无法理解的。这也不是这篇教程的重点。</p>
<p>重点是，既然技术与思想随着生产力环境而改变，那么有没有这么一种可能？就是在自己的“笔记本”里誊抄资料，摘录句子，是一种书籍较为稀缺的年代特有的技术呢？</p>
<p>很多“生产力博主”在带货某些学习法或软件的时候，总要拉上几个名人，讲述他们年轻的时候，是多么多么爱学习，每每读书，都要抱一大摞笔记从图书馆回来。</p>
<p>让我们换个凡尔赛一点的视角来重新看待这个问题：有没有一种可能？我是说可能啊。是因为那个年代的老前辈们家里没有图书馆，才造成了这种需要抱着笔记本的情况？</p>
<p>长在新千年之后的我，从小过的都是“想要什么书，买就完了”的日子。便宜的十几块，贵的几十，就是豪华限量精装版也不过数百块。藏书铁架每一层才 29.9，我摆六层就堆了一小面墙那么多的书籍。想看哪一本我拿就是了啊！为什么我还要把这些书上的内容抄到一个本子上，然后再像看书一样的看这个本子呢？</p>
<p>新千年之后有了电脑和网络，获取书籍就更加方便了，甚至在家里上个网络大学也不是没可能。</p>
<p>好的，说到这里，肯定已经有不少读者开始应激反应了。别急，后面有的是你应激的时候~</p>
<p>很正常，从心理学上来讲，人不愿意接受自己资产上的损失，愿意花时间研究所谓智识生产技术的人，想必或多或少都有自己的资料库，我这样大放厥词，必定引起反感。</p>
<p>反击的话我也料到了，大概就是以下几点：</p>
<ol>
<li>把需要的资料集合到笔记里，更加方便查阅。</li>
<li>我有很多资料是一般人找不到的哦！都是宝贝！</li>
<li>笔记才不是摘录与誊抄，是自己的话转写巴拉巴拉......</li>
<li>老兄，我是靠教别人写笔记吃饭的诶，你这样叫我怎么混？</li>
<li>避免被怀疑水字数，就不一一列举了，反正大概都能猜到。</li>
</ol>
<p>先别忙着转到评论区开喷，针对这些问题，给我点时间，我们先继续往下看吧~</p>
<h2 id=""我们到底应该积累些什么-"">我们到底应该积累些什么？</h2>
<h2 id=""能力圈"">能力圈</h2>
<blockquote>
<p>海皇.陈鹤皋：“永远不要到他人的领域里去挑衅，在他人的领域里，我们非常陌生，一无所知，充满劣势。”</p>
</blockquote>
<p>“能力圈”：圈内是你精通的技能，而圈外的东西，你却只是一知半解，甚至完全不懂。<sup class=""footnotes-ref"" id=""footnotes-ref-1""><a href=""#footnotes-def-1"">1</a></sup></p>
<p>能力圈为什么重要呢？因为在现今的世界里，除了极其少数的例外，你几乎只能在一种领域因专业而成功。一个人关于某项专长的知识愈丰富、能力愈强，就会愈成功。<sup class=""footnotes-ref"" id=""footnotes-ref-2""><a href=""#footnotes-def-2"">2</a></sup></p>
<p>我们每个人都有自己的能力圈，如果没有，那大概率说明你的人生正处于灾难性的无能之中，往往职业生涯极为平淡。</p>
<p>你该确认自己的能力圈。关于专长，与其求广，不如求深。<sup class=""footnotes-ref"" id=""footnotes-ref-3""><a href=""#footnotes-def-3"">3</a></sup></p>
<p>一项杰出的技能将会抵消无数个弱点。在能力圈内投入 1 小时，胜过在能力圈外投入 100 小时。如果你试图在能力圈外取得成功，那么你的人生将会非常痛苦。<sup class=""footnotes-ref"" id=""footnotes-ref-4""><a href=""#footnotes-def-4"">4</a></sup></p>
<p>所以在研究所谓的“智识生产技术”“学习法”“笔记法”之前，你应该先想想更重要的问题——你的能力圈是什么，你打算培养什么领域的才能。想清楚这个问题比掌握某种技术更重要！</p>
<p>说到这里，必然有人反驳我：</p>
<ol>
<li>我是一个天才，我身具多种能力圈。</li>
<li>我可以通过某种方法，拥有多个能力圈。</li>
<li>XXX 推荐大家做“斜杠青年”，并为此出了一本书。</li>
<li>我早就在我自己的领域登峰造极了！</li>
<li>这样会让我目光狭隘的！我可是个理性又博学的人才！国家智库也不过如此~</li>
</ol>
<p>别急，在应激之前，不妨再给我一些时间，让我们往下读一读。</p>
<blockquote>
<p>实用技巧：</p>
<p>这个段落的内容，来自于</p>
<ol>
<li>《清醒思考的艺术》一书。我将整本电子书导入了我的思源笔记中，在此之前我已经读完了它，导入笔记软件是为了使用块引用来迅速的提取段落插入我自己的文章。</li>
<li>陈鹤皋老师的视频号，我在学习了陈海皇的武术思想后，用手机客户端迅速的记录了这段话，并搭上了一个传递型双链[能力圈]。今天我通过反链找到了它，并引用到这篇文章。</li>
</ol>
</blockquote>
<h2 id=""全才-全面的庸才-专业白痴-冠军"">全才=全面的庸才，专业白痴=冠军</h2>
<p>「专业白痴」乍听很可怕，不过你当然也可以称它为「冠军」。听起来有吸引力多了，不是吗？贝多芬是个专业白痴，不过他可是全世界交响乐扛把子级的专业白痴！然而在他的能力圈之外，他没有任何杰出之处。毕加...<sup class=""footnotes-ref"" id=""footnotes-ref-5""><a href=""#footnotes-def-5"">5</a></sup></p>
<p>但话说回来，自认为“博览群书”，“博学多才”的我们好像还不如专业白痴？</p>
<p>所以，在挑选称心应手的笔记软件，学习那些眼花缭乱的花哨学习法，或是认定自己需要进行“知识管理”前，不妨先想想自己需要什么样的能力圈，给自己的人生多少有点追求吧？</p>
<blockquote>
<p>使用技巧：</p>
<p>这个段落，来自于《拒看新闻的生活艺术》一书。我通过嵌入块（快捷键{ }）技巧插入了大量段落，随后改写成我自己的话。<br>
这本书原本只有繁体纸质版，我在读完后，有人扫描了电子版，于是我索要了一份将其整本丢进我的思源笔记（转成 MD 丢进 Obsidian 或者任何软件都一样的）。<br>
这里我要讲解一种技巧：既然现在的软件已经支持如此巨大的云空间与数据加载，那么我们为什么要费劲心力的从这些电子书上再去截取下一段段摘录或写下笔记？我认认真真读完，吸收它的思想，记住作者的教导。并保留“未经压缩的数据”不好吗？</p>
</blockquote>
<h2 id=""学历爆炸时代找人永远比找资料快"">学历爆炸时代找人永远比找资料快</h2>
<p>好的，就算上面的话也不能让你放弃管理自己那点比特财富。</p>
<p>那不如我们换个解题方向？</p>
<p>大家在网上聊内卷这个问题聊的挺火热的，好像各行各业都已经堆满了营销不出去的人才？</p>
<p>既然人这么多，在线即时通讯又如此的方便，那不如？我们找个人问问？</p>
<p>很多人认为自己足够聪明，是全才。遇到问题，总是忘记去请教真正的内行，而是妄图通过阅读等严格意义上很低效的手段，试图自己掌握主动权。<sup class=""footnotes-ref"" id=""footnotes-ref-6""><a href=""#footnotes-def-6"">6</a></sup></p>
<p>为什么我们就不能放下那点小农一样喜欢在自己的一亩三分地里精耕细作的习惯，走出去跟别人好好的请教请教呢？</p>
<p>什么？你说没有人可以请教？网上一直在吵人才过多，内卷太重欸！这样岂不是前后矛盾？一边抱怨各个领域的知识分子都太多了，一边觉得满社会都找不到人可以帮自己解答一点普通人的问题？这不矛盾吗？</p>
<blockquote>
<p>拜托！我在购物网站上找律师帮忙写了份协议，才花了 50 块！为此我省下了大把搜索模板，然后自己迅速吃透法律条文并绞尽脑汁地填写文档的痛苦。</p>
</blockquote>
<p>我本人从未认真学习过数学，有次考试只得了 6 分（满分 100），但就算在知乎这样所谓“水平日渐下滑”的网站上，我也能找到像 @ 樱桃味美咕噜 这样的数学专业研究生。<br>
我绞尽脑汁也看不懂的问题，在她眼里就像撒泡尿后擦一擦一样简单~</p>
<p>人类社会就是这样运作的，不是吗？大家彼此交换自己的技能，于是大家也都享受到了不用什么都亲历亲为的生活。</p>
<p>放心大胆的待在自己的能力圈里吧，在外面，你一无是处，当心像牛顿一样，因为自己在某个领域有点小聪明，就到股市里输个精光。</p>
<blockquote>
<p>使用技巧：</p>
<p>这段内容来自</p>
<ol>
<li>《清醒思考（全三册）》，含有大量块引用。</li>
<li>《马督工教你做自媒体》网课，我在看视频时记下笔记，并用块引用（快捷键[ ]）将我看网课时做的笔记插入这篇文章。</li>
</ol>
<p>块引用：超文本的一种应用技术。<br>
这种技术，给了我们组织语言，编写文章全新的工作方式。记下来！</p>
</blockquote>
<h2 id=""重新定义我们所用的新一代工具"">重新定义我们所用的新一代工具</h2>
<p>经过上面对能力圈的简单讲解，我想我们可以在开始下面的内容前，先对今天我们主要讨论的双链笔记，Anki，Supermemo 等软件做一个定义，那就是——帮助我们更快更有效的发展能力圈的工具。</p>
<p>这样做定义是为了明确读这篇文章主要要学习什么，同时，网上大部分人谈效率工具，学习方法的时候，总是喜欢用一些概念性的词还来忽悠大众。</p>
<p>比如“更好”“极致”“高效”“外脑”“清醒”“迅速”“积累”等等。</p>
<p>这些博主言必称这些一听就好像很厉害的词汇，但是每当谈到具体落实的时候就开始含糊其辞，不愿意给出如何一步步掌握先进工具的具体流程。</p>
<p>这有点像大儒辩经，只要说出来的话让人听不懂就可以显得很厉害。而且无法反驳，因为他们会用你还没懂来回击你。</p>
<p>比如他们向你灌输一种思想叫“标签体系”，但等你问他们怎么才能建立这个该死的“标签体系”的时候，他们又会说：每个人都有自己的标签体系（摇头晃脑）。</p>
<p>事实上，他们最喜欢的事情就是你们永远也不要懂，这样他们的教程和工具才有人读，有人付费。</p>
<p>（当然，其中也有一部分原因是这些人可能自己水平也有限。）</p>
<blockquote>
<p>这个内容来自于：</p>
<p>我自己的 Newsletter 文章，内容均为我的原创，我通过块引用（快捷键[ ]）将这一整篇 Newsletter 直接插入这篇文章中，只添加了开头的几个字以使文章可读性更好，这就是许多双链笔记教程中所提到的“提升笔记复用率”。</p>
</blockquote>
<h2 id=""我们应该怎么管理笔记-"">我们应该怎么管理笔记？</h2>
<h2 id=""纸笔时代的一-二阶秩序"">纸笔时代的一、二阶秩序</h2>
<p>秩序共有三种，一阶秩序中，我们整理的是事物本身——比如上文讲到的书，只能在图书馆的书架上占据一个位置（除非你有好几本，可以放在其他合适的地方）。又比如纸质相册里的照片，必须按照某种线性理由加以...<sup class=""footnotes-ref"" id=""footnotes-ref-7""><a href=""#footnotes-def-7"">7</a></sup></p>
<p>而二阶秩序，则是以目录和索引卡为代表，这些工具指向一阶秩序的某个具体位置。通过这样做，我们把信息和事物分开，为事物创造了元数据。元数据允许我们用多个指针指向一个物理位置，所以我们可以同时在作者...<sup class=""footnotes-ref"" id=""footnotes-ref-8""><a href=""#footnotes-def-8"">8</a></sup></p>
<p>网络上非常火爆的“卢曼卡片盒”，“卡片笔记写作法”其实就是一种二阶秩序上开发出的技术。<sup class=""footnotes-ref"" id=""footnotes-ref-9""><a href=""#footnotes-def-9"">9</a></sup></p>
<p>一阶和二阶秩序都是原子化的，请注意，这里我们需要复习一下物理学。</p>
<p>“由原子构成的事物，随着时间的流逝，会越来越不稳定。”</p>
<p>不管是纸质笔记本还是卢曼卡片盒，都会随着时间的流逝越发的不稳定(维护困难，消耗巨量精力)，不管我们如何设计“笔记流程”，“标签体系”，“管理方法”，请大声的跟我念：“<strong>由于一二阶秩序的物理性质，这样的系统最终是要崩溃的！</strong> ”</p>
<p>这就是很多人在像模像样的更换了很多次“笔记系统”后最终还是一次次崩溃删库的真正原因。</p>
<p>好在，如今我们有了超文本与双链笔记，这让我们有了构建三阶秩序的办法。</p>
<h2 id=""数字时代的三阶秩序"">数字时代的三阶秩序</h2>
<p>在数字化时代，文本的混乱并不是失序的标志。相反，它是成功秩序的标志。<sup class=""footnotes-ref"" id=""footnotes-ref-10""><a href=""#footnotes-def-10"">10</a></sup></p>
<blockquote>
<p>混乱是一种美德。<sup class=""footnotes-ref"" id=""footnotes-ref-11""><a href=""#footnotes-def-11"">11</a></sup></p>
</blockquote>
<p>在超文本所构建的三阶秩序中，一切都不需要一个固定的“顺序”或是“目录”。我们有搜索，有存储空间，我们最近甚至拥有了 AI！</p>
<p>想象一下，原本我要从满满一墙的书里找到某句话，我需要踮起脚来一本一本的拿取，翻阅它们。或是打开牛皮纸资料夹，在我的索引卡片里一行一行的浏览，通过大类-子类-书籍-章节-段落的方式找到它们。又或是打开笔记本，祈祷我有摘录过这句话。</p>
<p>但在今天，这一切都不再重要了，因为我把书整本整本的放进我的“电子书架”里。我并没有给它们编制分组，修订目录或是制作索引卡之类的，因为现在的计算机和电子书软件已经先进到可以在几十万本书里同时搜索出我想要的那段话了（感谢计算机科学的努力）。</p>
<p>建立在超文本上的三阶秩序提供了一种全新的形态：你不再需要投入精力在管理上，因为混沌本就不接受管理。<strong>任何的管理都是在折腾自己并浪费本来可以用在学更多知识，做更多事上的时间。</strong></p>
<p>随便把那些该死的笔记丢在软件的某个地方吧，就像进门随手把脱下来的衣服丢在沙发上一样~</p>
<p>反正大部分时间你也没有重新阅读过它们不是吗？</p>
<blockquote>
<p>这段内容来自于《万物皆无序》，我在市立图书馆花一下午读完了这本书。在读书的时候我手边仅有一瓶矿泉水和一部手机。</p>
<p>我读完觉得这本书相当好，于是我用手机拍下封皮照片，回家按照书名与作者名下载了 Epub 电子书，整本的塞进了我的笔记软件。好的，对我来说笔记已经做完了~</p>
<p>我没有花时间在阅读过程中一边看一边摘录，事实上我觉得这种技术是在糊弄自己（具体下面说）。</p>
</blockquote>
<h2 id=""在三阶秩序中彻底放弃管理"">在三阶秩序中彻底放弃管理</h2>
<p>三阶秩序从一开始就没有秩序。</p>
<p>你的笔记在注入 Roam，Obsidian，Log，思源等等软件中，从一开始就不需要一个固定的存储位置。别像个傻子一样花一下午的时间给笔记软件中的笔记编制目录，或是精心的排列他们。</p>
<p>你应该学会使用搜索和反链面板，用提及，出链等功能来在另一种秩序下串联它们。</p>
<p>管理不会带来增长，那么我们不做管理，由该做些什么呢？</p>
<p>答案是：我们为了追求能力圈的深度，应该追求“增量信息”。</p>
<h2 id=""只有增量信息才能带来优势"">只有增量信息才能带来优势</h2>
<p>只有增量信息才能创造领先别人的优势。<sup class=""footnotes-ref"" id=""footnotes-ref-12""><a href=""#footnotes-def-12"">12</a></sup></p>
<p>增量，就是平均水平上突出的量。行业里 90% 的人都不懂，都缺失了这部分信息，而你有，那你就毫无疑问的是行业内的前 10%。</p>
<p>单纯的积累信息有用吗？显然没有。<sup class=""footnotes-ref"" id=""footnotes-ref-14""><a href=""#footnotes-def-14"">14</a></sup></p>
<p>能轻而易举积累起的信息都是“大路货”，你有我有人人有，你可以按它行动，别人也可以。<sup class=""footnotes-ref"" id=""footnotes-ref-15""><a href=""#footnotes-def-15"">15</a></sup> 你也有，我也有，那这部分信息就没什么能给自己带来优势的地方。 （谁会拿人手一本的初中生课堂笔记当宝贝吗？）</p>
<p>更何况信息多了，还会产生噪音，有时还不如没有。<sup class=""footnotes-ref"" id=""footnotes-ref-16""><a href=""#footnotes-def-16"">16</a></sup></p>
<blockquote>
<p>注意！如果说你的笔记软件里有什么信息是值得珍重的，值得花时间研究保密性，安全性 ，做备份的，那一定是这些“增量信息”。<br>
这些市面上没有的信息，是独属于你的宝贵财富，它们代表着你对事物独有的一份理解。<br>
也许就是这些信息令你变成一个与众不同的人。我们对着荧幕阅读，敲击键盘，归根结底追求的就是这些增量信息。切记切记。</p>
</blockquote>
<h2 id=""别糊弄自己"">别糊弄自己</h2>
<p>如果说在笔记中记录增量信息是令人欣慰的正确的事情。那么对着句子画线然后再折腾地把它们“导入”各种地方就是真正的愚蠢了......</p>
<p>别费心思去做愚蠢的事情，比如在书上划线或高亮显示文字。 没有证据表明它有效。 它只是让你看起来像是在学习。你需要做的是阅读并且理解。 读一点，然后写下你所学的内容或你脑海中出现的任何问题。 永...<sup class=""footnotes-ref"" id=""footnotes-ref-17""><a href=""#footnotes-def-17"">17</a></sup></p>
<p>记住，我们追求增量信息，我们打造自己的能力圈深度。一切要回归真正有意义的方向。</p>
<blockquote>
<p>这段内容来自网红心理学家乔丹.彼得森的 &lt;Jordan B. Peterson 的写作指导 &gt;,软件里的页签显示我是通过网页剪藏保存它的,但我记住了它.</p>
<p>事实上,我真正意义上的\""学习了乔丹.彼得森关于写作的教诲\"",我把他说的话记在脑子里,所以我在写这篇文章的时候第一时间想到了它。</p>
<p>我引用它不是通过某种“技术”，在写文章的时候如果你本身就想不起来这些内容，那么没有任何技术能够帮的到你。</p>
<p>这是很多使用双链笔记进行写作的人的一个误区——他们认为自己写不出来东西是自己没有打好传递型双向链接，或是没有建立足够好的“标签体系”等等原因。</p>
<p>不是的，只是你写东西菜罢了，跟技术没关系~</p>
</blockquote>
<h2 id=""知识资本主义者"">知识资本主义者</h2>
<p>好的，我曾经试图用上面这些内容说服过许多人，结果却不太理想。大部分人对这套源自沃伦.巴菲特的理论嗤之以鼻。</p>
<p>好的，那么原谅我适度的提高一些攻击性。</p>
<p>在生活中，我们可以见到很多的“小资”，他们明明没有许多财富，但在消费上却时常能见到一种对富裕阶层的模拟。好像自己已经通过某些外显的装扮，行为，证明自己是梦想中的阶层。</p>
<p>今天，知识资本主义下的“知识小资”们，也非常喜欢获得那种“知识资产带来增值”的“比特资本家”快感。知识管理作为一种企业管理下的财富增值手段，被一些“生产力博主”精心包装，变成了一种所谓“帮你积累数字财富并进行增值”的个人技术。</p>
<p>一旦掌握了这些技术，就好像自己已经“超越了大众阶级”，进入了“智识生产”的全新阶级，有一种好像王大锤幻想自己即将出任 CEO，迎娶白富美，走上人生巅峰一样的快感~</p>
<p>让我们正视现实吧——太注重记笔记是一种高级的拖延症。</p>
<h2 id=""注重记笔记是一种高级的拖延症"">注重记笔记是一种高级的拖延症</h2>
<p>记笔记这件事之所以危险，恰恰是因为“记笔记是一件正确的事”。</p>
<p>因为它正确，所以我们就可以一直做。</p>
<p>就像一个小孩拿着一堆识字卡片，在书桌上摆弄，身为一个家长，你很难在这种情况下指责孩子——毕竟看起来孩子是在“干正事儿”。</p>
<p>干正事儿就意味着我们每天可以在记笔记这件事上投入无限量的时间。对着电脑摆弄 8 小时数字小卡片，也可以用“我是在学习”一句话轻轻松松的打消自己的所有拖延负罪感。</p>
<p>但是只有在三次元的行动，才能够真正的改变现实生活，对真实的世界产生影响！</p>
<p>只要我们记笔记，就可以不去做实验了，毕竟笔记还没做完嘛~</p>
<p>这种行为有一个明确的名词，叫“过度研究”，而过度研究是无效的。</p>
<h2 id=""过度的研究是无效的"">过度的研究是无效的</h2>
<p>正确的思想，要从实践中获得。如果理论偏离了现实，那指责现实不按规矩来的人往往是蠢蛋。</p>
<p>事实上，研究和分析本身就具备极大的局限性。不是什么东西都可以研究和分析出来的。<sup class=""footnotes-ref"" id=""footnotes-ref-18""><a href=""#footnotes-def-18"">18</a></sup></p>
<p>否则，二百年前的人们就应该预见今天会有互联网，希特勒早就应该能分析出第三帝国覆灭的命运。那么多口吐莲花的经济学家，那么多的诺贝尔经济学奖的获得者，咋金融海啸还是照样发生呢？<sup class=""footnotes-ref"" id=""footnotes-ref-19""><a href=""#footnotes-def-19"">19</a></sup></p>
<p>如果分析研究特别有用，就不会有改朝换代，就不会有黑天鹅事件了。<sup class=""footnotes-ref"" id=""footnotes-ref-20""><a href=""#footnotes-def-20"">20</a></sup></p>
<p>如果分析研究特别有用，你半年前看好的股票就根本不应该下跌。并且你应该融资 + 众筹 10 个亿，全压在这只股票上，不出三两年，你就会超过巴菲特。<sup class=""footnotes-ref"" id=""footnotes-ref-21""><a href=""#footnotes-def-21"">21</a></sup></p>
<p>但我们无法放下研究的执念，归根结底，研究提供了一种不用去动手也能获得增长幻觉的安定感。</p>
<p>做笔记，不管使用任何软件，使用什么学习方法，这件事有多么“学术化”，都要严格的控制时长。避免堕入无效的研究，浪费时间与精力。</p>
<blockquote>
<p>这段内容来自著名黑嘴（bushi）盛京剑客的公众号，我通过：转发 → 复制链接 → 剪藏 → 保存到笔记。</p>
<p>把这篇文章保存到了笔记软件里，我其实在保存的当天就做了一些小小的工作，比如我把它加入了渐进阅读，反复的读了好几次，在文章末尾写下了一些心理学方面的批注。</p>
<p>今天我用块引用(快捷键[ ])把这篇文章里的三句话插入本文，随后在这三句话前面写下引子，后面写下总结。</p>
<p>这就是用双向链接写作的一种技巧。</p>
</blockquote>
<h2 id=""打破知识组织方式的唯一性"">打破知识组织方式的唯一性</h2>
<h2 id=""把你的软件变成写作空间"">把你的软件变成写作空间</h2>
<p>写作向来是知识的主要源泉之一。<sup class=""footnotes-ref"" id=""footnotes-ref-22""><a href=""#footnotes-def-22"">22</a></sup></p>
<p>美国文学教授杰·戴维·波尔特提出了“写作空间”（writing space）的概念。他认为，数字技术通过把读者变为作者，极大地缩减了两者之间的距离。超文本所构建的网络文章总是处在“未完成的状态”。</p>
<p>我们可以修订，重写，更改，文章的版本可以从 V0.1 变成 V8.0，这在纸质时代是难以想象的。“写作空间”的产生，颠覆了古老的写作传统，带来了崭新的表达主体和表达方式、角度，丰富了文本的内容。文本的价值，现在不仅仅来自于文本所包含的内容本身，而且包括文本所联系的内容。<sup class=""footnotes-ref"" id=""footnotes-ref-23""><a href=""#footnotes-def-23"">23</a></sup></p>
<p>我们可以在笔记软件中构建这样一个“写作空间”，我们将数本乃至数十本书的内容，通过双向链接打开的“传送门”巧妙地整合到一起。</p>
<p>这是我们对信息的独有观点，可能同样的几本书，在别人的编撰与文章里表达出来又是另一种观点。</p>
<p>而双链笔记提供了迅速组织起观点的技术基础。</p>
<blockquote>
<p>这段内容来自《万物皆无序》，我只是偶然想起了“写作空间”这个词，就随手打了“[[”这个快捷键，搜索写作空间四个字。</p>
<p>结果还真弹出了相关的一堆段落，但我其实早就忘了。于是我通过弹出来的窗口跳转到对应的文章，重新学习了一遍。</p>
<p>我重新学习的方式就是把它们整理成上面这段内容。</p>
</blockquote>
<h2 id=""大道争锋-道心越辩越明"">大道争锋：道心越辩越明</h2>
<p>整理好了内容，我们就不应该让它们继续待在笔记软件里。</p>
<p>因为：待在私人笔记软件里 → 没人看到它们 → 没人批评它们 → 最终我们还是不知道它是不是对的。</p>
<p><strong>注意！有人批评也许会令人很难过，但比起被批评，更可怕的是连批评的人都没有！</strong></p>
<p>很多人误以为写作就是为了发布出去，获得称赞，这是一种错误的思想——越是希望得到称赞，最终写作就越会走形，变成讨好读者，怕被批评的“滑头式写作”。</p>
<p>我们写东西出来，就是为了有人骂，你骂的不对，我跟你对骂！你骂的对，我改。</p>
<p>这就是大道争锋的魅力，参加过实战，受到大众检验的武器更值得相信。</p>
<h2 id=""输出后收集反馈"">输出后收集反馈</h2>
<p>反复不断地“输入 → 输出 → 反馈”，就能实现自我成长。<sup class=""footnotes-ref"" id=""footnotes-ref-24""><a href=""#footnotes-def-24"">24</a></sup></p>
<p>把自己的笔记变成文章发布出去后，绝对不要忘了把读者们的反馈收集回到笔记里。</p>
<p>这可是活生生的人与你产生的互动，它们比僵死的比特信息要生动得多。如果一个人不相信互联网上活生生的读者们给自己的建议，反而转头继续去读那些所谓的“写作法”“写作学问”。想必再过更久也没办法成为一个能获得大家认可水平的人。</p>
<p>在自己的数字小天地里搞闭门造车，试图“关起门来憋大招”，最后一定只会落得一个在自行榴弹炮满地走的时代，拉出一门自己精心研制的“红衣大炮”的下场。</p>
<blockquote>
<p>本段内容来自《桦泽紫苑学习法》，我从未对这本书做过“笔记”。</p>
<p>事实上我对这本书评价极低，但是恰恰它的内容放在这很合适，于是我花了大概 10 分钟，去电子书站下载了整本 epub，丢尽了我的软件中，我的软件只是又多了 8mb 左右的云存储负担。</p>
<p>随后我新建了一个页面叫“反馈”，并通过反馈这个页面的反链面板查询有“提及反馈这个词的段落”。</p>
<p>我把它们拖动到反馈这个文档里，快速的学习了它们，完成了这个段落的写作。这也是一种使用技巧。</p>
</blockquote>
<h2 id=""能力圈可视化-绝非无用的关系图谱"">能力圈可视化：绝非无用的关系图谱</h2>
<p>很多人说双链笔记软件的关系图谱没用。因为笔记多了，关系图谱就会眼花缭乱，从中得不到什么有用的信息。</p>
<p>在这里我要提出反对意见：<strong>关系图谱非常有用，只是大部分人都没有能力圈思维。</strong></p>
<p>能力圈思维告诉我们：没人能完全了解这个世界。对于某个个体的大脑来说，世界太复杂了。<sup class=""footnotes-ref"" id=""footnotes-ref-25""><a href=""#footnotes-def-25"">25</a></sup> 即使你是受过高等教育的人，也只能理解世界的一个小小的方面<sup class=""footnotes-ref"" id=""footnotes-ref-26""><a href=""#footnotes-def-26"">26</a></sup></p>
<p>在关系图谱中，一定会有某些链接较多，图标较大的“重要节点”。盯紧这些重要节点，它们有很大概率就是我们能力圈的“可视化”。</p>
<p>拿我自己距离，在我的双链笔记软件中，“能力圈”这个文档链接到了 59 个文档，从名人巴菲特，到海皇陈鹤皋，从国外书籍，到国内黑嘴的公众号。</p>
<p>这意味着我已经对这个概念积累了一定的学习历程，下过相当的苦工。</p>
<p>如果你的笔记软件打开关系图谱，屏幕上呈现出密密麻麻的节点，却没有多少一眼令人瞩目的中心。那大概率意味着：你并没有针对某个概念进行大量的研究，相反，你只是在一直向笔记软件内存储信息。</p>
<p>这里回到前文提到的“增量信息”概念，一直存储大路货信息是没有用的，我们必须凝结出自己的“增量信息”，才能给自己带来优势。</p>
<p>所以关系图谱，某种意义上可以当作一份可视化的研究方向指南。</p>
<p><strong>不是技术不好用，只是技术背后欠缺了驾驭它的思想。</strong></p>
<h2 id=""暂时完结"">暂时完结</h2>
<p>讲了一大堆笔记不重要，放下记笔记的执念，如何看待我们的软件等等内容，其实主要就是想让大家能摆脱被“知识管理”这个词忽悠的困境。</p>
<p>真正的清醒过来，下苦功在真正有用的地方，而不是在令人眼花缭乱的“知识管理”技术里折腾自己。</p>
<p>大家要清楚的意识到：在自媒体时代，有相当大一部分人是靠传授某种技术或是为某些产品带货而生存的。</p>
<p>他们为了自身的利益，必须将某种技术吹捧成改变世界，天下无双，人人必备的东西。要知道，挖金矿的淘金者未必能捞到什么，但卖镐头和铁锹的人却总是稳赚不赔的。</p>
<p>如今“知识管理”这个词已经形成了一门生意，前往不要被有心人套路其中。知识管理本就是一种企业管理下的概念，与个人没太大关系。知识不受你管理，它只会被你学会~</p>
<p>写到这里，我的蓝牙键盘恰好没电了，我把这当成是某种信号。这篇文章就先以这种形态发出吧，反正联系上文：超文本时代的写作，总是未完成的。不是吗？</p>
<div><hr>
<ol><li id=""footnotes-def-1""><blockquote>
<p>“能力圈”：圈内是你精通的技能，而圈外的东西，你却只是一知半解，甚至完全不懂。 <a href=""#footnotes-ref-1"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</blockquote>
</li>
<li id=""footnotes-def-2""><p>能力圈为什么重要呢？因为在现今的世界里，除了极其少数的例外，你几乎只能在一种领域因专业而成功。一个人关于某项专长的知识愈丰富、能力愈强，就会愈成功。 <a href=""#footnotes-ref-2"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-3""><p>你该确认自己的能力圈。关于专长，与其求广，不如求深。 <a href=""#footnotes-ref-3"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-4""><blockquote>
<p>一项杰出的技能将会抵消无数个弱点。在能力圈内投入 1 小时，胜过在能力圈外投入 100 小时。<br>
如果你试图在能力圈外取得成功，那么你的人生将会非常痛苦。 <a href=""#footnotes-ref-4"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</blockquote>
</li>
<li id=""footnotes-def-5""><p>「专业白痴」乍听很可怕，不过你当然也可以称它为「冠军」。听起来有吸引力多了，不是吗？<br>
贝多芬是个专业白痴，不过他可是全世界交响乐扛把子级的专业白痴！然而在他的能力圈之外，他没有任何杰出之处。<br>
毕加索也是专业白痴，他在能力圈外甚至私生活都照料不好。<br>
牛顿也是专业白痴。他在科学领域的能力圈并没能在股票市场帮上什么忙，赔了个精光。 <a href=""#footnotes-ref-5"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-6""><p>很多人认为自己足够聪明，是全才。遇到问题，总是忘记去请教真正的内行，而是妄图通过阅读等严格意义上很低效的手段，试图自己掌握主动权。 <a href=""#footnotes-ref-6"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-7""><p>秩序共有三种，一阶秩序中，我们整理的是事物本身——比如上文讲到的书，只能在图书馆的书架上占据一个位置（除非你有好几本，可以放在其他合适的地方）。又比如纸质相册里的照片，必须按照某种线性理由加以排列，否则数量多了以后将难以找到。 <a href=""#footnotes-ref-7"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-8""><p>而二阶秩序，则是以目录和索引卡为代表，这些工具指向一阶秩序的某个具体位置。通过这样做，我们把信息和事物分开，为事物创造了元数据。元数据允许我们用多个指针指向一个物理位置，所以我们可以同时在作者卡和书名卡下指定一本书。 <a href=""#footnotes-ref-8"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-9""><p>网络上非常火爆的“卢曼卡片盒”，“卡片笔记写作法”其实就是一种二阶秩序上开发出的技术。 <a href=""#footnotes-ref-9"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-10""><p>在数字化时代，文本的混乱并不是失序的标志。相反，它是成功秩序的标志。 <a href=""#footnotes-ref-10"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-11""><p>混乱是一种美德。 <a href=""#footnotes-ref-11"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-12""><p>只有增量信息<sup class=""footnotes-ref"" id=""footnotes-ref-13""><a href=""#footnotes-def-1"">1</a></sup>才能创造领先别人的优势。 <a href=""#footnotes-ref-12"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-13""><h2 id=""只有增量信息才能获得超额收益"">只有增量信息才能获得超额收益</h2>
<blockquote>
<p>只有增量信息才能获得收益。</p>
<p>别人到某一步，你要比他们更进一步，比他们更多一些视野，更多一些信息。你才具有相对的优势。</p>
<p>单纯的积累信息有用吗？显然没有。</p>
<p>能轻而易举积累起的信息都是“大路货”，你有我有人人有，你可以按它行动，别人也可以。</p>
<p>信息多了，还会产生噪音，有时还不如没有。 <a href=""#footnotes-ref-13"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</blockquote>
</li>
<li id=""footnotes-def-14""><p>单纯的积累信息有用吗？显然没有。</p>
<p>能轻而易举积累起的信息都是“大路货”，你有我有人人有，你可以按它行动，别人也可以。</p>
<p>信息多了，还会产生噪音，有时还不如没有。 <a href=""#footnotes-ref-14"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-15""><p>能轻而易举积累起的信息都是“大路货”，你有我有人人有，你可以按它行动，别人也可以。 <a href=""#footnotes-ref-15"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-16""><p>信息多了，还会产生噪音，有时还不如没有。 <a href=""#footnotes-ref-16"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-17""><p>别费心思去做愚蠢的事情，比如==在书上划线==或==高亮显示文字==。 没有证据表明它有效。 它只是让你看起来像是在学习。你需要做的是阅读并且理解。 读一点，然后写下你所学的内容或你脑海中出现的任何问题。 **永远不要原封不动地复制原文。**  学习和记忆的最重要部分是你必须重新组织自己的语言去写东西。 这并不是简单的 “用你自己的话”。 这是你与作者之间的对话。 这是你试图对作者说：“这是我对你的理解”， 从这里你可以提取写作要点。 <a href=""#footnotes-ref-17"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-18""><p><strong>事实上，研究和分析本身就具备极大的局限性。不是什么东西都可以研究和分析出来的。</strong> <a href=""#footnotes-ref-18"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-19""><p>否则，二百年前的人们就应该预见今天会有互联网，希特勒早就应该能分析出第三帝国覆灭的命运。那么多口吐莲花的经济学家，那么多的诺贝尔经济学奖的获得者，咋金融海啸还是照样发生呢？ <a href=""#footnotes-ref-19"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-20""><p>如果分析研究特别有用，就不会有改朝换代，就不会有黑天鹅事件了。 <a href=""#footnotes-ref-20"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-21""><p>如果分析研究特别有用，你半年前看好的股票就根本不应该下跌。并且你应该融资 + 众筹 10 个亿，全压在这只股票上，不出三两年，你就会超过巴菲特。 <a href=""#footnotes-ref-21"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-22""><p>写作向来是知识的主要源泉之一。 <a href=""#footnotes-ref-22"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-23""><p>“写作空间”的产生，颠覆了古老的写作传统，带来了崭新的表达主体和表达方式、角度，丰富了文本的内容。文本的价值，现在不仅仅来自于文本所包含的内容本身，而且包括文本所联系的内容。 <a href=""#footnotes-ref-23"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-24""><p>反复不断地“输入 → 输出 → 反馈”，就能实现自我成长。 <a href=""#footnotes-ref-24"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
<li id=""footnotes-def-25""><blockquote>
<p>没人能完全了解这个世界。对于某个个体的大脑来说，世界太复杂了。 <a href=""#footnotes-ref-25"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</blockquote>
</li>
<li id=""footnotes-def-26""><blockquote>
<p>即使你是受过高等教育的人，也只能理解世界的一个小小的方面 <a href=""#footnotes-ref-26"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</blockquote>
</li>
</ol></div>
                

作者：NishikigiReeves
链接：https://ld246.com/article/1699506401607
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",NishikigiReeves,"思源笔记,知识管理",链滴优选
723,属性视图是否应用文档宽度比较好？ - 链滴,Wed Nov 08 2023 20:22:49 GMT+0000 (Coordinated Universal Time),"
                    <p>在 github 上有一个功能特性正在商量，即对属性视图应用文档的宽度。</p>
<blockquote>
<p>之前使用 js 实现的属性视图宽度与边距调整会导致其在不同主题下与其他块宽度与样式不一致, 并导致在块菜单设置的块样式失效</p>
<p>现参考 Airtable 样式, 将其可视宽度调整为与编辑器内容等宽</p>
</blockquote>
<p>效果见下：</p>
<p><img src=""https://b3logfile.com/file/2023/11/10a896ddd3de452cab40cd348cbb8629.png?imageView2/2/interlace/1/format/webp""></p>
<p>原效果：</p>
<p><img src=""https://b3logfile.com/file/2023/11/图片-v5yTFn6.png?imageView2/2/interlace/1/format/webp""></p>
<hr>
<p>补充更新效果见下：</p>
<ul>
<li>块宽度与其他块保持一致<img src=""https://b3logfile.com/file/2023/11/bd68a305fdfd48c4b372e374671bd718.png?imageView2/2/interlace/1/format/webp""></li>
<li>使用 CSS 实现横向滚动时冻结首列 + 资源列启用换行时全宽显示图片 + 右键菜单添加 <code>在上方/下方插入一下</code> <img src=""https://b3logfile.com/file/2023/11/63c3de1ca8104bf281979a85cfb1b9f7.gif""></li>
<li>优化块右键菜单-布局样式 <img src=""https://b3logfile.com/file/2023/11/281400875-4a831006-ed69-404a-9649-9a83a8b94b4b-cpWrwVn.gif""></li>
</ul>
<p><div class=""articlePoll"">
    <h3>database 是否使用文档宽度</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            33 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1699446082012"">
            <div class=""poll__percent"" style=""width: 78%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    database 使用文档宽度
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    78%
                    <span class=""ft__fade"">•</span>
                    26 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1699446082064"">
            <div class=""poll__percent"" style=""width: 12%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    database 保存原状
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    12%
                    <span class=""ft__fade"">•</span>
                    4 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1699446082114"">
            <div class=""poll__percent"" style=""width: 9%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    其他方案
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    9%
                    <span class=""ft__fade"">•</span>
                    3 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
                

作者：zxhd86
链接：https://ld246.com/article/1699446169420
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,"Q&amp;A,思源笔记",链滴优选
726,一个多行页签的 css - 链滴,Wed Nov 08 2023 00:35:25 GMT+0000 (Coordinated Universal Time),"
                    <pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-o"">,</span> <span class=""highlight-nt"">ul</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">flex-wrap</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">wrap</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-column</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex-1</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">fn__flex</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span><span class=""highlight-o"">)</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-k"">max-height</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">100</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">layout-tab-bar</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">item</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-type</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""tab-header\""</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">px</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">list</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">icon</span><span class=""highlight-o"">-</span><span class=""highlight-n"">hover</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>效果如图：</p>
<p><img src=""https://b3logfile.com/file/2023/11/图片-8VnuR9E.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：zxhd86
链接：https://ld246.com/article/1699374925407
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
679,在思源笔记中实现渐进阅读 - 链滴,Sat Nov 04 2023 21:07:02 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""前言-对Supermemo19的无情批判"">前言：对 Supermemo19 的无情批判</h2>
<p>以下纯属写教程前的发泄情绪，因为不写这段吐槽，我就没有心情写这个教程，读者们请直接跳跃至流程一，无视我的发癫。</p>
<blockquote>
<p>woz 啊 woz，</p>
<p>我等了三年！三年！你知道我这三年是怎么过的吗？！</p>
<p>我每天都在期待 SM19~</p>
<p>40 刀你就给我一个 Edge 导入（中文还有 bug）和把 PDF 还原成 txt 的神奇升级？</p>
<p>欧洲有极简风我知道，欧洲软件更新都有极简风我是真不知道啊！woz！</p>
<p>我太失望了！我好恨！</p>
<p>要不是有小叶写教程、有汉化组、有 A 佬搞 quicker 动作包，这日子我是真过不下去了~</p>
<p>你悔改吧（我知道这是不可能的），你就在内疚中渡过晚年吧（我知道这是不可能的）。</p>
<p>上上个月我拿装着 sm18 的 U 盘插了个 win7 的机子，一下又把库插爆了。</p>
<p>我的心要碎了，各种文档交到我的手里，却搞成了这个样子。我是痛心疾首，我有罪于 Epub，愧对祖宗，愧对天地，我恨不能插爆自己！</p>
</blockquote>
<p>发癫到此结束。</p>
<h2 id=""思源笔记与Supermemo目前的实力对比"">思源笔记与 Supermemo 目前的实力对比</h2>
<table>
<thead>
<tr>
<th></th>
<th>思源笔记</th>
<th>Supermemo18</th>
<th>对比</th>
</tr>
</thead>
<tbody>
<tr>
<td>算法</td>
<td>小叶宝贝的 FSRS（复习有点频说实话）</td>
<td>SM-18，蝎子的粑粑——独一份</td>
<td>sm18 胜</td>
</tr>
<tr>
<td>导入材料</td>
<td>支持 Epub、网页、word 和 MD 等多种材料</td>
<td>支持网页、Epub、靠复制粘贴能实现多种材料</td>
<td>思源依靠插件，体验更好</td>
</tr>
<tr>
<td>材料拆分</td>
<td>通过插件支持，时灵时不灵水平</td>
<td>原生支持，quicker 也有对应动作，但也失灵时不灵</td>
<td>奇迹般的战平！</td>
</tr>
<tr>
<td>加入间隔重复</td>
<td>需要手动将文档一个个加入间隔重复</td>
<td>导入后就不用管了，替你安排学习</td>
<td>在思源有插件能上帮忙前，<br>sm 无可置疑的胜利。</td>
</tr>
<tr>
<td>学习界面</td>
<td>有插件，但经常因为软件更新而令人难过</td>
<td>该有的都有，包括 bug......</td>
<td>在思源有插件作者愿意为<br>渐进阅读奋力一搏前，还是<br>sm18 更稳定。</td>
</tr>
<tr>
<td>优先级排序</td>
<td>无</td>
<td>有</td>
<td>sm18 胜</td>
</tr>
<tr>
<td>移动端</td>
<td>有，但不能渐进阅读，只能刷卡</td>
<td>没有，且永远也不会有</td>
<td>手机党来说思源胜</td>
</tr>
</tbody>
</table>
<h2 id=""流程一-在思源笔记中导入材料"">流程一：在思源笔记中导入材料</h2>
<h2 id=""安装导入插件"">安装导入插件</h2>
<h3 id=""首先我们打开思源笔记设置界面-"">首先我们打开思源笔记设置界面：</h3>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/QQ图片20231104111831-20231104111908-2mci0fr.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""在集市搜索框中搜索-导入"">在集市搜索框中搜索：导入</h3>
<p>此时会弹出两个导入插件，我们可以两个都装上。（因为我不是 Markdown 爱好者，所以我只装了后面那个。）</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104112022-fwkfj9c.png?imageView2/2/interlace/1/format/webp"">​</p>
<h3 id=""安装好后我们去找点资源-就先搞本电子书吧-"">安装好后我们去找点资源，就先搞本电子书吧！</h3>
<p>这里我就随便挑一本《认知行为疗法入门》</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104192647-01o3xo6.png?imageView2/2/interlace/1/format/webp"">​</p>
<h3 id=""将这本书通过导入插件导入思源笔记"">将这本书通过导入插件导入思源笔记</h3>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104192400-0ixy05z.png?imageView2/2/interlace/1/format/webp"">​</p>
<h2 id=""流程二-对导入的材料进行拆分"">流程二：对导入的材料进行拆分</h2>
<h2 id=""下载重构助手插件"">下载重构助手插件</h2>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104192923-qo6a689.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""用重构助手对导入的电子书进行拆分"">用重构助手对导入的电子书进行拆分</h2>
<p>不把电子书进行分解，难道我们要一口气读完一整本书吗？</p>
<p>这当然是不可能的，所以我们要对导入的电子书进行拆分，然后把拆分好的章节依次加入间隔重复。</p>
<ol>
<li>
<p>在电子书标题处点击菜单，找到重构助手插件</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104193300-uoxb67d.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>用插件对材料进行拆分，为了方便我们吸收材料中的知识，就尽量拆的越细越好吧！</p>
</li>
<li>
<p>将拆分后的文档加入间隔重复，以便后续算法持续的推荐它们给我们进行阅读。<br>
​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104193807-lw9x828.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
</ol>
<h2 id=""流程三-安装闪卡增强插件-启用渐进阅读功能"">流程三：安装闪卡增强插件，启用渐进阅读功能</h2>
<ol>
<li>
<p>打开集市，找到闪卡增强插件。</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104194228-9pdvqdd.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>启用插件的渐进阅读功能，不会的建议直接抄我的按钮就好。</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104194323-74bitid.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<h2 id=""关于PDF及冷门电子书怎么办-"">关于 PDF 及冷门电子书怎么办？</h2>
<p>PDF 的渐进阅读一直是个难题，而且自从 Kindle 寄了之后，电子书其实已经不怎么发行各种 Mobi 和 Epub 版本了，都是掌控在电子书平台手里，你下载不到。</p>
<p>不要紧，我们还有微信读书插件！</p>
<p>微信读书在最近的更新中支持了用户自己上传的 PDF 文档的阅读格式转换，以及冷门电子书它还算很全。</p>
<p>所以我们再次打开插件市场，找到微信读书插件：<br>
​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104194725-gdilx3m.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>将自己要读的 PDF 上传至微信读书，在微信读书中划线写批注，随后通过微信读书插件同步到思源笔记里面，再将这篇文档加入间隔重复就好啦！</p>
<h2 id=""流程四-开始渐进阅读-"">流程四：开始渐进阅读！</h2>
<p>按下 Alt+0，或手动点击闪卡：</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104195029-79aa893.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>我们就进入了复习界面：</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104195317-ne3g03f.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>我们可以在摘录卡片上选中一段文字，按下 Alt+Q 进行节选，创建一条卡片：</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104195454-qdxhc37.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>这部分内容，会在之后的间隔重复中与我们见面，我们可以把它们加工成问答卡片或者填空卡片：</p>
<p>​<img src=""https://b3logfile.com/file/2023/11/siyuan/1621691141504/assets/image-20231104195659-j1uy8nd.png?imageView2/2/interlace/1/format/webp"">​</p>
<h2 id=""心法一-为什么要渐进阅读-"">心法一：为什么要渐进阅读？</h2>
<p>关于渐进阅读，大部分教程的表述尚浅。</p>
<p>渐进阅读并不是把知识记住，让自己考个高分什么的这么简单~</p>
<h2 id=""能力圈原则"">能力圈原则</h2>
<p>“能力圈”：圈内是你精通的技能，而圈外的东西，你却只是一知半解，甚至完全不懂。<sup class=""footnotes-ref"" id=""footnotes-ref-1""><a href=""#footnotes-def-1"">1</a></sup></p>
<p>在现代社会，人几乎只能通过在某一种领域具有极高认知深度和能力水平，来获得世俗意义上的成功。每一个领域都发展到了几乎穷尽一生都无法问鼎的庞大。</p>
<p>而阅读和笔记会带来一种“能力圈幻觉”，说白了就是看完几本书就觉得自己是“懂王”，笔记越多，感觉上自己的能力圈好像是越发的宽广了，但实际上总觉得实践中自己“记不起来”，“用不出来”，“答不上来”。</p>
<p>因为笔记只是信息，你拥有一段比特，不代表你比别人真的强什么，说不定你硬盘里这段比特已经牢牢地烙印在了你对手的脑子里......</p>
<p>而伴随着渐进阅读，你会发现，当你选择的材料过于庞杂，且没有明确的“能力圈边界”的时候，你会无法负担超出上限的闪卡数量——这迫使你必须在众多材料中进行抉择。</p>
<p>你要选择真正有用的，真正高频输出的材料，并逐渐随着闪卡的回归而塑形自己的能力圈。</p>
<blockquote>
<p>一项杰出的技能将会抵消无数个弱点。在能力圈内投入 1 小时，胜过在能力圈外投入 100 小时。<br>
如果你试图在能力圈外取得成功，那么你的人生将会非常痛苦。</p>
</blockquote>
<h2 id=""心法二-笔记是正确的事-所以很危险"">心法二：笔记是正确的事，所以很危险</h2>
<p>这个世界上最危险的事情不是错误的事，而是正确的事。</p>
<p>做笔记，这件事没有什么可指责的，学习嘛~</p>
<p>这就意味着一个人可以在笔记软件前面耗上一天，摆弄摆弄这些比特卡片，给一些文档加入双链，或是打些标签......</p>
<p>反正是在学习，这是“正经事情”，那么不管做笔记耽误我多少时间，都不会有愧疚感和紧迫感。</p>
<p>没错，笔记之所以危险，就是因为它是一件正确的事！</p>
<p>正确的事就可以让人以它为借口无限的拖延下去！</p>
<p>而渐进阅读和闪卡则不同：渐进阅读有每天材料的上限（在 supermemo 中这是自然的，在思源里需要手动调节），闪卡有每天待复习的数量。</p>
<p>有量，就有时间。有时间，就意味着做完了就可以去真正的行动。</p>
<p>这就是为什么我一直使用渐进阅读与闪卡——我确保学习的时间不会大于实践与工作的时间。</p>
<h2 id=""关于用思源笔记进行渐进阅读的优势"">关于用思源笔记进行渐进阅读的优势</h2>
<p>思源的渐进阅读流程，比起渐进阅读的开创者 Super memo 来讲肯定相形见绌，有诸多的不足与缺失的功能。</p>
<p>但思源也有它独有的优势：</p>
<ol>
<li>思源再怎么差，也比 Dendero，极光，readwise 这些软件的渐进阅读功能要强一些。</li>
<li>Supermemo 实在太难以上手，而思源笔记则相对简单（相对）。</li>
<li>大 D 和 V 姐的更新速度能让欧洲程序员知道什么叫“中国速度”。</li>
<li>能在移动端刷卡，现代人可能会离开电脑，但现代人绝不离开手机。</li>
</ol>
<h2 id=""先写到这"">先写到这</h2>
<p>我刚换的联想 Legion go 掌机，各种 Quicker 快捷键和软件都还没配置好。</p>
<p>心里实在痒痒的紧，这期教程就先随性写到这吧，有什么问题再更新——互联网写作就这样。</p>
<p>祝大家渐进阅读愉快，享受渐进主义带来的进步吧！</p>
<div><hr>
<ol><li id=""footnotes-def-1""><p>“能力圈”：圈内是你精通的技能，而圈外的东西，你却只是一知半解，甚至完全不懂。 <a href=""#footnotes-ref-1"" class=""vditor-footnotes__goto-ref"">↩</a></p>
</li>
</ol></div>
                

作者：NishikigiReeves
链接：https://ld246.com/article/1699103223806
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",NishikigiReeves,"思源笔记,阅读",链滴优选
677,(硬核向) 自制思源笔记微信收集箱搭建教程 - 链滴,Thu Oct 19 2023 07:49:04 GMT+0000 (Coordinated Universal Time),"
                    <p>出门在外面不方便笔记？思源笔记和微信重度使用者？免费微信笔记收集箱？敏感消息不想经过别人的手？有很多不同的消息想收集？想完全自定义自己的微信工具箱？有服务器闲置没事干？</p>
<p>好的，那么你来对地方了！</p>
<p>本项目可以为你制作一个完全的属于自己的微信收集箱。</p>
<p>项目开源地址：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmuhanstudio%2Fsiyuan-wxbox"" target=""_blank"" rel=""nofollow ugc"">https://github.com/muhanstudio/siyuan-wxbox</a></p>
<h2 id=""演示图-"">演示图：</h2>
<p>文字：</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/Screenshot_2023-10-19-00-43-36-692_com.tencent.mm-20231019004425-544y7q5.jpg?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019004538-dswegt7.png?imageView2/2/interlace/1/format/webp""></p>
<p>图片：</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/Screenshot_2023-10-19-00-46-24-498_com.tencent.mm-20231019004644-dd5d11u.jpg?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019004743-758i233.png?imageView2/2/interlace/1/format/webp""></p>
<p>语音（自动识别成文字）：</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/Screenshot_2023-10-19-00-50-29-588_com.tencent.mm-20231019005058-m6xp5tf.jpg?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019005051-lux42c4.png?imageView2/2/interlace/1/format/webp""></p>
<p>位置信息：</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-DDlhDdt.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/image-iE5rFVR.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""那么这么方便的微信记笔记怎么才能实现呢-"">那么这么方便的微信记笔记怎么才能实现呢？</h3>
<h2 id=""拿起发财的小手-开干-"">拿起发财的小手，开干！</h2>
<h2 id=""详细搭建教程"">详细搭建教程</h2>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018235631-ee8lfsv.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击后会弹出文件管理器，data 后面紧跟着的就是你的笔记本 ID，如图，笔记本 ID 就是：20231018093815-glkj4gy</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018235759-f465r17.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后就可以开始我们的搭建了</p>
<h2 id=""搭建步骤-"">搭建步骤：</h2>
<h3 id=""1-安装宝塔"">1.安装宝塔</h3>
<p>（异常简单，省略，可以参考百度）</p>
<h3 id=""2-安装docker-并用docker部署思源笔记"">2.安装 docker，并用 docker 部署思源笔记</h3>
<p>（具体教程可以参考<a href=""https://ld246.com/article/1635558111871"">思源笔记 docker 搭建及后续使用优化（小白向） - 链滴 (ld246.com)</a>）</p>
<p>你也可以直接按照我的 docker 来配置，只需要安装最新版宝塔，然后点击</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018223602-3q24msz.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击后，如果你没有安装 docker，界面发白会提示让你安装 docker-compose up，安装即可。</p>
<p>安装完成后，把本项目的 docker-compose.yml 放到文件 →/www/SiYuan/下面</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018224057-06ptu8e.png?imageView2/2/interlace/1/format/webp""></p>
<p>修改其中的访问密码 123456 为你自己的密码</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019001109-fl66dv9.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后进入终端：</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018224729-dwo5a4f.png?imageView2/2/interlace/1/format/webp""></p>
<p>在终端运行以下命令：</p>
<pre><code class=""language-ssh highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">cd /www/SiYuan
</span></span><span class=""highlight-line""><span class=""highlight-cl"">docker-compose up
</span></span></code></pre>
<p>等待安装完成，思源笔记已经成功部署在 docker 中，工作空间在服务器的/www/SiYuan 中，你可以随时查看笔记的数据。</p>
<p>后续想要更新思源，进入终端运行以下命令即可更新思源：</p>
<pre><code class=""language-ssh highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">cd /www/SiYuan
</span></span><span class=""highlight-line""><span class=""highlight-cl"">docker-compose stop
</span></span><span class=""highlight-line""><span class=""highlight-cl"">docker-compose rm siyuan
</span></span><span class=""highlight-line""><span class=""highlight-cl"">docker rmi b3log/siyuan
</span></span><span class=""highlight-line""><span class=""highlight-cl"">docker-compose up
</span></span></code></pre>
<h3 id=""3-配置反向代理"">3.配置反向代理</h3>
<p>宝塔新建网站</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225027-q7rke04.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击设置</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225128-wx62nb7.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击反向代理，点击添加反向代理</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019000839-biqtca0.png?imageView2/2/interlace/1/format/webp""></p>
<p>创建如下两个反向代理：</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225245-zmnx6a6.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018225356-b62d9cu.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""4-获取思源笔记docker客户端的参数-以下操作均在思源笔记docker客户端中进行-不是本地思源-"">4.获取思源笔记 docker 客户端的参数(以下操作均在思源笔记 docker 客户端中进行，不是本地思源)</h3>
<p>访问 http://你的域名/siyuan，就可以进入到思源笔记 docker 客户端，然后输入密码，进入客户端</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019001530-t15s4eh.png?imageView2/2/interlace/1/format/webp""></p>
<p>登录你的账号，把自动同步打开，如果是订阅账号就别管其他的，查看 apitoken 就可以了，如果是非订阅的 S3 储存用户，则还需要配置你的云同步参数，然后打开自动云同步</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019001911-8kboezy.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后去设置里面看自己的 apitoken，保存，一会儿要用</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019002035-gs9yh7b.png?imageView2/2/interlace/1/format/webp""></p>
<p>之后一定要手动点击一次同步，一定一定要同步完成一次。</p>
<h3 id=""5-获取微信公众号参数"">5.获取微信公众号参数</h3>
<p>登录微信公众平台，获取这些参数：token,appid,aeskey</p>
<p>appid 在这里查看</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018231006-qnkgcl7.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后往下翻，有一个服务器配置，没有启用的话点击启用，启用了就点击修改</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018231220-1zkuu7l.png?imageView2/2/interlace/1/format/webp""></p>
<p>在这里填写你的收集箱机器人地址，并获取剩余的参数，token 随机填一串数字，建议复杂一点，AESKEY 随机生成，不要点击提交，保留这个页面，如图：</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-NdLuppj.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""6-上传项目"">6.上传项目</h3>
<p>将本项目的 config.py，robot.py，run.py 拷贝到服务器的某个目录下面，我这里的路径是/www/wwwroot/app/wxsh</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232232-su1pt41.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""7-修改参数"">7.修改参数</h3>
<p>修改 config.py 为你刚刚得到微信公众号中的参数</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233614-sth69wn.png?imageView2/2/interlace/1/format/webp""></p>
<p>修改 robot.py 中的参数为你的思源笔记参数，其中 openid 先不用管，后面我们会回来改</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019000050-x370hif.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""8-运行项目"">8.运行项目</h3>
<p>进入软件商店，应用搜索 python，安装 python 项目管理器</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232409-wgihmoh.png?imageView2/2/interlace/1/format/webp""></p>
<p>安装完成后点击设置</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232537-6iiy2r5.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击版本管理，安装一个你喜欢的版本，建议和我一样</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018232627-46euykg.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后点击项目管理，选择项目路径，找到你放 py 文件的地方，然后选择</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233009-8fdp1ne.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击启动文件/文件夹，选择 run.py</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233116-p9z2wjq.png?imageView2/2/interlace/1/format/webp""></p>
<p>最后应该如下图所示，然后点击确定就可以，我们的微信公众号监控就开始运行了，</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231018233222-wsdcsad.png?imageView2/2/interlace/1/format/webp""></p>
<p>点击然后不管报不报错，都点击模块</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019010252-6lrzabp.png?imageView2/2/interlace/1/format/webp""></p>
<p>需要安装两个模块，flask 和 werobot，输入模块名称然后点击添加就可以了，两个都要添加</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019010325-rzm46i5.png?imageView2/2/interlace/1/format/webp""></p>
<p>添加完成后，点击重启即可</p>
<p>此时，这个界面就可以点击提交了</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-M8AfaFE.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""9-获取openid-修改参数-重启项目"">9.获取 openid，修改参数，重启项目</h3>
<p>然后我们就可以去给公众号发消息了，第一次发消息，会回复你：此用户无权限：xxx，其中 xxx 就是你的 openid，复制下来，打开宝塔面板，找到你放 robot.py 的地方，修改里面的 openid 为你的 openid</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019002611-0twkbb6.png?imageView2/2/interlace/1/format/webp""></p>
<p>修改完成保存后，再次进入 python 项目管理器，项目管理，点击重启</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1687070401463/assets/image-20231019002716-7chwjgk.png?imageView2/2/interlace/1/format/webp""></p>
<p>等待重启完成，你就可以自由自在给自己的公众号发语音，图片，文字来达到随时随地记笔记的效果啦！</p>
<h2 id=""真棒-你居然做完了-你真的很努力也很认真-加油---"">真棒，你居然做完了，你真的很努力也很认真，加油！！！</h2>
                

作者：muhanstudio
链接：https://ld246.com/article/1697672944700
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",muhanstudio,思源笔记,链滴优选
707,Callout 插件上线 - 链滴,Wed Oct 18 2023 00:08:15 GMT+0000 (Coordinated Universal Time),"
                    <p>本插件来源于 Savor 提供的 callout 功能菜单，本人将其迁移到插件系统中。</p>
<blockquote>
<p>所谓的 callout，你可以把他理解为一个有标题、有类型、有颜色背景的容器块。</p>
<p>本插件里 callout 是使用引述块实现的。</p>
</blockquote>
<p>使用方法如下：</p>
<p>新建一个引述块后，点击引用块的图标，可以在插件栏目里将其转换为一个 callout 样式。其中，引述块当中的第一个块的内容会被当作标题显示。</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-NZ3DrXU.png?imageView2/2/interlace/1/format/webp""></p>
<p>这个插件从编写以来，我就一直高强度使用，对笔记的颜值有明显提升。同时 callout 样式自带「分区」的效果，也让一些信息显得更加突出，容易被捕获。</p>
<p>以下是我个人笔记中使用 callout 的案例，可以发现用上 callout 后，信息明显更加容易被捕捉。</p>
<p><img src=""https://b3logfile.com/file/2023/10/1e8e34bfe94867f93230bdf3fa8cd859-wwWm0mB.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/image-qsvlojH.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p><strong>特别强调</strong></p>
<p>本插件的原始贡献者为 Savor 主题，本人在其基础上做了简单的二次加工。感谢 Savor 主题的作者 Roy 先生。</p>
</blockquote>
                

作者：Frostime
链接：https://ld246.com/article/1697558895436
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
676,思源笔记用户常见问题（11 月 6 日更新） - 链滴,Sat Oct 14 2023 14:53:18 GMT+0000 (Coordinated Universal Time),"
                    <p>在论坛和 QQ 群回答问题发现大家都在重复问着好多随便一搜都能搜到的历史回答，这里做个常见的汇总吧，后面想到或者遇到了再更新。</p>
<p>11 月 6 日更新：</p>
<h3 id=""15-如何清理未引用的附件或图片-"">15、如何清理未引用的附件或图片？</h3>
<p>思源里直接删除文档的图片或者附件不会被立即删除，因为有可能其他文档也有引用，如果所有文档里都没有引用这些附件或图片，它们就会出现在设置-资源-未引用的资源文件中，点击删除即可批量删除，如果文件过多可以多次点击。</p>
<p>注意：这里的删除其实也不是完全删除，会生成历史文件在历史文件夹，通过历史文件夹还能复原或者永久删除。</p>
<p><img src=""https://b3logfile.com/file/2023/11/image-sKKcECz.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍11 月 2 日更新：</p>
<h3 id=""14-文档树如何添加子文件夹-"">14、文档树如何添加子文件夹？</h3>
<p>思源的设计是笔记本-父文档-子文档...不存在子文件夹，父子文档可以嵌套 7 层（超过了个别系统上不支持），所以想要子文件夹的，新建一个子笔记就行，如帮助文档这样。</p>
<p><img src=""https://b3logfile.com/file/2023/11/image-0XOauuV.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""13-帮助文档删了或者想复原怎么办-"">13、帮助文档删了或者想复原怎么办？</h3>
<p>重新点击帮助按钮即可。以下三个入口都可以重新打开。</p>
<p><img src=""https://b3logfile.com/file/2023/11/image-AEv71Is.png?imageView2/2/interlace/1/format/webp""></p>
<p>10 月 31 日更新：</p>
<h3 id=""12-Docker部署进入思源弹不要惊慌错误"">12、Docker 部署进入思源弹不要惊慌错误</h3>
<p>部分用户 docker 部署，进入就会一直弹窗“不要惊慌，你的数据应该是安全的……”，这个主要是反代没有设置好。</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-U1YSYJ4.png?imageView2/2/interlace/1/format/webp""></p>
<p>根据思源的官方教程，设置了反代的，要配置一下 websocket 协议的反代。配置可参考<a href=""https://ld246.com/article/1657460219441"">思源笔记 Docker 伺服 - 链滴 (ld246.com)</a></p>
<p><img src=""https://b3logfile.com/file/2023/10/image-2GD8HWi.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""11-如何调整行间距-"">11、如何调整行间距？</h3>
<p>思源自带没有这个功能，但插件集市上架了调整插件，名字叫<strong>行高调整</strong>，可自行下载使用调整。</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-DImNiKT.png?imageView2/2/interlace/1/format/webp""></p>
<hr>
<p>历史：</p>
<h3 id=""1-如何置顶某一篇文档-"">1、如何置顶某一篇文档？</h3>
<p>思源里的文档树排序有一定的规则，无法直接在文档树实现置顶，可以通过固定页签、添加书签实现。</p>
<h5 id=""固定页签"">固定页签</h5>
<p>页签栏右键需要固定的页签选择<kbd>钉住</kbd>即可，钉住的页签会不同于其他的样式，视主题样式而定。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014124734-u5jiof8.png?imageView2/2/interlace/1/format/webp""><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014124844-k9qjtgp.png?imageView2/2/interlace/1/format/webp""></p>
<h5 id=""书签置顶"">书签置顶</h5>
<p>点击想要置顶的文档的图标进入<kbd>属性</kbd>（快捷的方法是按 shift 点块图标），添加书签即可，书签可以命名一个新的，如“置顶“，</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014125012-adith7n.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014125117-yjex7xf.png?imageView2/2/interlace/1/format/webp""></p>
<p>设置好后即可在侧边书签栏看到置顶的文档，点击即可到达。（任意块都可以，不局限于文档）</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014125236-7u55m9k.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""2-如何快速调整大量笔记到不同笔记本-"">2、如何快速调整大量笔记到不同笔记本？</h3>
<p>思源笔记里笔记本是单独的一个层级，无法和里面的文档直接互换层级，如果某个笔记本不想独立了，笔记本想降级可以通过导出笔记本为.sy 格式，然后再导入到需要合并的笔记本中即可。</p>
<h5 id=""导出笔记本为-sy格式"">导出笔记本为.sy 格式</h5>
<p>点击文档树对应笔记本右侧的菜单，选择<kbd>导出-Siyuan.sy.zip</kbd>即可。导出.sy 格式可以保留原笔记本里的各种顺序、双链，方便导入的时候一键还原。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014125656-tbr4c7o.png?imageView2/2/interlace/1/format/webp""></p>
<p>导入同理，只是选择导出变成了导入了。</p>
<h3 id=""3-如何快速添加子文档目录-"">3、如何快速添加子文档目录？</h3>
<p>很多人习惯了 notion 等笔记自动在父文档新建子文档的设定，换到思源后虽然也是父子文档的设定，但没有自动生成子文档会有一点不习惯，这里是可以用插件或者挂件去解决的，自定义更高。</p>
<h5 id=""目录插件"">目录插件</h5>
<p>下载集市中的目录插件，然后设置一下需要插入目录的层级和列表样式即可。支持自动更新。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014140725-hqso53o.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014140738-mt9jhc9.png?imageView2/2/interlace/1/format/webp""></p>
<h5 id=""列出子文档挂件"">列出子文档挂件</h5>
<p>我本人更喜欢用这个挂件，它不仅可以列出本文档的、还支持笔记本、工作空间所有的目录，不局限于本身，只需要复制 id 即可。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014140859-cg8eq88.png?imageView2/2/interlace/1/format/webp""></p>
<p>使用方式很简单，斜杆菜单挂件里选择<kbd>listChilDocs</kbd>呼出，设置好自己需要的功能即可。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014141030-2nbqf2m.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""4-如何在文档底部查看反链-"">4、如何在文档底部查看反链？</h3>
<p>我一直不太理解为啥需要在文档底部反链，因为在底部你还得拉下来文章才能看到，有名的那几家笔记软件都提供了侧栏打开查看的功能，不然我也是觉得很难用的，如果一定要用，可以通过模版插入。</p>
<p>在集市中下载<kbd>乱七八糟的模版</kbd>，通过斜杆菜单呼出模版功能，使用其中的嵌入当前文档反链的模版即可。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014141418-zjmzdvu.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014141444-g7lo3i7.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""5-云端目录忘记密码了怎么办-"">5、云端目录忘记密码了怎么办？</h3>
<p>无他，人肉暴力无限重试，直到记起来，否则只能重建云端。</p>
<p>在思源设置-关于中-重置数据仓库即可重新输入密码，通过不断录入新的、重置来试出自己的密码，记得一般是选密码生成密钥的选项。</p>
<h3 id=""6-提示内容块不存在-怎么办-"">6、提示内容块不存在，怎么办？</h3>
<p>可以通过新建 SQL 来找到哪些是空的，然后手动删除即可。</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">        </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">        </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">        </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">not</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">                </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">                </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">            </span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
<h3 id=""7-反链-闪卡-悬浮窗口等如何快速进入某文档-"">7、反链、闪卡、悬浮窗口等如何快速进入某文档？</h3>
<p>在思源里，只要是有导航、块图标的地方，都可以悬浮展示文档，或者 Ctrl 点击进入文档。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014143349-awbhxcg.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""8-如何让文档树和大纲同时显示-"">8、如何让文档树和大纲同时显示？</h3>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014143616-ufgtq1v.png?imageView2/2/interlace/1/format/webp""></p>
<h5 id=""侧边栏大纲和文档树同时显示"">侧边栏大纲和文档树同时显示</h5>
<p>思源的侧边栏是可以右键选择不同的位置，只要把大纲挪到右上、右下和左上的文档树区分即可。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014143754-xi5ygws.png?imageView2/2/interlace/1/format/webp""></p>
<h5 id=""文档内大纲"">文档内大纲</h5>
<p>侧边栏大纲是全局的，会跟随当前编辑器的焦点而变化，如果想保持某个文档大纲不变，可以直接点击文档图标打开其本身大纲，就会在侧边页签显示大纲列表了。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014143854-2dj8l70.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""9-如何实现页面内高亮搜索-"">9、如何实现页面内高亮搜索？</h3>
<p>目前思源本体是不支持的，在电脑端，可以通过集成编辑器插件进入到源码模式编辑。</p>
<p>集市中下载<kbd>集成编辑器插件</kbd>，通过点击文档图标的菜单进入编辑器视图，在源码界面使用原始的 Ctrl+F 搜索即可</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014144125-jujdhl9.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014144229-19dqzmx.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1630025891949/assets/image-20231014144341-xkpjyl6.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""10-如何跨块复制文本-"">10、如何跨块复制文本？</h3>
<p>思源是块编辑器，默认情况下跨块复制都是整个块一起，如何实现 notion 那种可以复制多个块中间部分的文本呢？</p>
<blockquote>
<p>选中对应文本开始的地方，然后按住 shift，鼠标右键选结束的文本即可选中，再 Ctrl+C 复制即可。</p>
</blockquote>
                

作者：mozhu
链接：https://ld246.com/article/1697266399195
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",mozhu,思源笔记,链滴优选
704,随手分享一下本人基于思源 + 滴答清单的阅读 (学习) 工作流 - 链滴,Wed Oct 04 2023 17:42:45 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""基本思路"">基本思路</h2>
<p>渐进式的阅读/学习工作流，关键在于分治法：首先把大任务分解成小任务，最后把小成果合并成大成果。具体的操作通过以下工具来完成。</p>
<ul>
<li>前期：主题块（对应学习目标或任务，可以是一个文档块，如果任务量比较小也可以是一个标题块） + 书签（方便快速引用）</li>
<li>中期：滴答清单（分解任务 + 提醒） + DailyNote (无压记录) + 双链引用主题块（链接直接从书签中复制）</li>
<li>后期：反链面板拖入整理</li>
</ul>
<h2 id=""流程"">流程</h2>
<div class=""language-mermaid"">graph LR
src[原始材料]

subgraph init
	src --&gt; X[在思源中新建块X] --&gt; A[将 X 放入书签当中]
	src --&gt; D[滴答中将完整的阅读划分为若干实际任务]
end

subgraph someday
	A --&gt; DN[Daily note 当中引用]
	DN --&gt; H[阅读并记录笔记]
	D --&gt;|具体阅读任务| H
end

subgraph 后期整理合并
	H --&gt;|全部完成后| Agre[汇总整理] --&gt; 删除书签
	Agre --&gt; ?[在X中使用\\n反链面板拖入] --&gt; K(归档)
end
</div>
                

作者：Frostime
链接：https://ld246.com/article/1696412565955
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
678,效率提升，万字的 chatgpt prompt 教程 - 链滴,Mon Oct 02 2023 19:29:29 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""写在前面的话"">写在前面的话</h2>
<p>这个是文字版教程，视频版正在录制，可以关注我的 B 站账号：QAyong。也欢迎大家来我们的 chatgpt 交流群交流：759925736</p>
<p>其实跟 GPT 交流你就可以当作是在跟人进行交流，方法大都通用，但有一点需要注意的是 GPT 没有长期记忆能力，所以我们每一次对话都是当作一个最开始接触的人进行交流。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/5-20231002122243-nj3cqg6.png?imageView2/2/interlace/1/format/webp""></p>
<p>从计算机诞生开始，人机交互的方式就开始演进，</p>
<p>最开始的为机器语言，只是单纯二进制 0 与 1。最早期的人们使用机器语言的方式是通过手动输入或使用穿孔卡来将指令和数据传输给计算机。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20230825232548-4nhtrry.png?imageView2/2/interlace/1/format/webp""></p>
<p>然后是可以用英文缩写或者助记符来代替二进制的汇编语言。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20230825232654-w4s3j2z.png?imageView2/2/interlace/1/format/webp""></p>
<p>到现在，大家最常编写程序的高级语言，一种独立于机器的算法语言，不依赖于具体计算机指令系统。我学过的 python 也是里面的一种。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20230907231648-tn5cgcl.png?imageView2/2/interlace/1/format/webp""></p>
<p>对于这些语言，好像跟我们学法是没多大关系的，这些应该是计算机专业有关。这些在 GPT 出来之前是这样的，人机交互方式限制学法的与计算机接触。但时代变了，ChatGPT 的出现意味着人机交互方式可以使用自然语言。面对 GPT，我们只需要告诉我们想要的，它能够理解我们的意思并进行操作，人机交互的效率得到提高。新的人机交互方式意味着新的范式、新的时代正在我们身上发生。</p>
<p>我是在去年 12 月份开始接触 AI（ChatGPT)，刚开始只是与大多数人一样只是尝鲜而已。在 23 年的 3 月，为了应对法考的主观题考试，我第一次尝试去使用 AI 解决问题——背书，效果让我很惊喜，我非常感谢 AI,它帮助我渡过那段备考的日子。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/1694100787146_edit_32434744672001-20230907233450-prze78x.jpg?imageView2/2/interlace/1/format/webp""></p>
<p>当然面对 AI，我除了开心也有 emo 的时候。法考过后，那段时间 GPT4 出来了，openai 宣称 GPT4 在法律能力上得到巨大的提升。当时我也很好奇，GPT4 能够应对美国的司法的考试，那么面对中国的呢？我自己充值了 PULS 服务，开始做这样的尝试。刚开始的效果非常不理想。这个问题在如今任务一个法律 AI 模型上都没有解决，GPT4 它在编法条，这对法律事务上处理是很灾难的。</p>
<p>初步尝试后，我的心情是又失望又小高兴的，失望的是这个 AI 模型也就应付下美国的法律，对中国的法律一窍不通，小高兴的是自己这个专业看来壁垒看来是很高的，不用那么担心被 AI 替代。不过后面我发觉会不会因为它是模型，模型很难具体生成法条导致生成法条的。因为发现这个盲点，我当时想，如果我给它提供正确的法条会不会能够正确处理？当然为了保证测试效果，我在给一些不相关的法条。后面我去做了，效果嘛，GPT4 是能够处理好这些内容的，当天晚上我就 emo 了。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/psc-20231002121257-oy2ajbb.jpg?imageView2/2/interlace/1/format/webp""></p>
<p>在使用 GPT 超过 6 个月这些时间里，我经历了惊讶、开心、焦虑、平常心。从最开始的好奇到现在的离不开。我也时常推荐身边的人去使用这个工具。在与别人交流时，我发现大家对于 GPT 有认知，但如何去使用这样的工具是没有认知。所以我想到自己写个教程，教程基于官方教程文档、 网络上好心人分享的相关文章、和我自己理解体会写作。教程分为两个部分，一个部分讲 prompt，体现在细节上的把握，另一个部分为项目处理，讲的是如何将 AI 融入到我们的工作流程当中去的方法论。而在开始学习前，对于开头的“<strong>其实跟 GPT 交流你就可以当作是在跟人进行交流，方法大都通用。</strong>”这句话将是整个教程的核心，需要切记。</p>
<h2 id=""prompt篇"">prompt 篇</h2>
<h2 id=""一-认识prompt"">一、认识 prompt</h2>
<p><strong>何为 prompt？——万物皆 prompt。</strong></p>
<p>prompt 的定义是用于引导模型生成文本的输入文本，将其放在用户使用场景当中就是用户在聊天窗口中输入中输入的内容。（注：仅针对于聊天窗口，代码中表现会有差别）</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/屏幕截图_2023-09-08_113110-20230908113205-enyz25r.png?imageView2/2/interlace/1/format/webp""></p>
<p>如果将 GPT 类比作人，那么我们人与人沟通之间信息就是 prompt。在我们的生活当中，我们需要去沟通信息，人与人之间存在个体思想上的差异，为了减少这样的差异，沟通是必不可少的环节，放在模型上同样如此，prompt 就是起到这个作用，让模型能够读懂人的意思。</p>
<p>那么 prompt 的构成是什么呢？——背景、指令、输入部分、输出部分。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/3-20231002120709-udiupfe.png?imageView2/2/interlace/1/format/webp""></p>
<p>为什么构成是这些构成？——解构人与人之间的交流模式而得。</p>
<p>“来小王，今天有个材料需要写给领导，你这周写好交给领导。”</p>
<p>以上是一个生活工作常见的需求场景，通过上面背景、指令、输入部分、输出部分我们可以得到下面这张图。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/场景构建-20230908160555-81q0v55.png?imageView2/2/interlace/1/format/webp""></p>
<p>我们可以看到这样的一个体系是能够很好地解析小王的任务需求的。换言之，把小王改成 GPT 也是同样成立的。读到这里，大家可以发现，GPT 其实就是我们每个人的所拥有的“小王”，而我们就是它的领导，如果我们不下达清楚命令，那么小王也不会正确的理解我们的意思并开始工作。接下来我按照这个体系来展开课程。</p>
<h2 id=""二-背景"">二、背景</h2>
<h3 id=""1--什么是背景prompt"">1. 什么是背景 prompt</h3>
<p>背景 prompt，顾名思义，就是为 AI 提供背景信息的指令。这些背景可以是人物角色背景，也可以是项目的相关背景。通过为 AI 设定这样的背景，我们实际上是给它提供了一个“背景设定”，使得它生成的答案更贴合我们的期望。</p>
<h3 id=""2--背景prompt的作用"">2. 背景 prompt 的作用</h3>
<p><strong>背景 Prompt 的作用：</strong></p>
<ol>
<li><strong>提供更多任务信息</strong>：这帮助 AI 更好地理解任务需求，生成更符合期望的答案。</li>
<li><strong>达到隐性要求</strong>：背景信息能够让 AI 根据特定语境给出答案，避免我们反复明确要求。</li>
<li><strong>生成定制内容</strong>：有了背景，AI 能够生成更符合特定用户群体的内容。</li>
</ol>
<p>例如，若我们想要一个减肥计划，但没设定背景，AI 可能给出的答案更偏向于饮食控制。但当我们为 AI 设定“健身教练”这样的背景时，它的答案可能更倾向于体育锻炼。（<strong>不同角色设定考虑的角度不一样</strong>）</p>
<p>无人设</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192505-x9yy4j4.png?imageView2/2/interlace/1/format/webp""></p>
<p>有人设</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192515-15cvo6k.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""3-怎么写好背景prompt-"">3.怎么写好背景 prompt?</h3>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192543-cgjrasp.png?imageView2/2/interlace/1/format/webp""></p>
<p>总结了一句话：<strong>“根据需求设计角色背景，尽可能地加入项目背景。”</strong> 这包括模型背景和用户背景。如果我们的问题是法律方面的，设定模型背景为律师自然是更合适的。</p>
<p>同时，用户背景也是同样重要，比如告诉 AI 自己是一个五岁的孩子，从而获取更通俗的答案。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192614-19tw929.png?imageView2/2/interlace/1/format/webp""></p>
<p>而在描述项目背景时，我建议使用 STRA 法则：情境、任务、行动和结果。这为 AI 提供了一个全景的任务信息，帮助它更好地完成任务。</p>
<p>情境（Situation）：描述 AI 或你所处的环境或背景，例如 AI 参与什么项目，面临什么挑战，为什么要做这件事等。</p>
<p>任务（Task）：描述你的目标或责任，例如 AI 在项目中承担什么角色，要完成什么任务，要达到什么标准等。</p>
<p>行动（Action）：描述 AI 为完成任务采取什么具体的行动，例如需要 AI 使用什么方法，做什么分析，解决什么问题等。</p>
<p>结果（Result）：描述你的行动想要带来什么效果或收获</p>
<p>值得一提的是，OpenAI 新推出的自定义功能允许我们设置自己的用户背景，使得 AI 能够根据用户的背景生成更加个性化的答案。（不需要一直在 prompt 中加入）</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002120233-7y99osj.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""三-指令prompt"">三、指令 prompt</h2>
<h3 id=""1-什么是指令prompt"">1.什么是指令 prompt</h3>
<p>指令 prompt，简而言之，就是告诉 AI 我们的需求：我们希望 AI 做什么，以及怎样去完成这个任务。就像当我们对 AI 说：“请为我解释 STAR 法则”时，我们真正的意图是让 AI 解释这个法则，那么解释这个动作就是指令 prompt。</p>
<h3 id=""2-指令prompt的作用"">2.指令 prompt 的作用</h3>
<p>同一个任务，不同的指令会有不同的作用，通过为 AI 提供更加明确的指导，我们可以得到更加理想的答案。</p>
<p>以一个借款合同文本为例，如果我们只是简单地告诉 AI：“请审查这个文本”，那么它可能只会做一些基础的审核。但如果我们给出更详细的指示，例如指出要关注的具体条款，或者是特定的风险点，那么 AI 返回的结果会更加深入、细致。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/7-20231002124153-o80v6py.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""3-制作指令Prompt的技巧"">3.<strong>制作指令 Prompt 的技巧</strong></h3>
<p>以下制作指令 Prompt 的技巧后续一一讲解：</p>
<ol>
<li>使用提示样本</li>
<li>提交步骤给 AI</li>
<li>使用思维链</li>
<li>使用权重</li>
<li>使用正向指令与反向指令</li>
</ol>
<h3 id=""4-使用提示样本"">4.使用提示样本</h3>
<p>什么是“提示样本”吗？简单来说，样本就是一个典型的例子。</p>
<p>举个简单的例子，想象一下，你要求 AI 模仿鲁迅的风格来写一篇文章。如果没有给任何提示，那可能只是一个简单的命令：“模仿鲁迅风格写一篇文章”。</p>
<p>这样的命令，有点像甲方说：“给我画一个五彩斑斓的黑”。啥叫五彩斑斓的黑？你见过吗？这不难为人吗？想不想骂人？</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/白眼-20231002161615-lcy0pwd.jpg?imageView2/2/interlace/1/format/webp""></p>
<p>这时，提示样本就显得尤为重要。它的存在就好比是在说：“给你一个样本，你能模仿它吗？”例如，如果我们要求 AI：“模仿下面这段话的风格写”，那么这段话就是一个很好的样本。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002161728-4vllon9.png?imageView2/2/interlace/1/format/webp""></p>
<p>所以，当我们在使用 AI 工具做一些模仿时候，不妨多给一些具体的样本。</p>
<h3 id=""5-提交步骤给AI"">5.提交步骤给 AI</h3>
<p>除了前面提到的样本，一个同样重要的环节就是“步骤”。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002172630-frwt8ie.png?imageView2/2/interlace/1/format/webp""></p>
<p>想想看，我们在做事情的时候，不是都有一个清晰的步骤吗？不管什么事，只要有了明确的步骤，事情就会变得容易许多。这点，对于 AI 也是如此。特别是当我们希望模型按照特定的逻辑来完成任务时，写出步骤能更好地指导模型。</p>
<p>那么，如何为 AI 制定步骤？最直接的办法当然是依靠我们自己的经验和知识来写。有人说 AI 技术让很多事情变得简单，我对此持保留意见。从为 AI 指定步骤的过程中，我们不难发现：要想充分发挥 AI 的潜力，其实门槛并不低。这正如所谓的“马太效应”，AI 时代下，资源和能力更趋向于那些已经拥有的人，正所谓<strong>强的要强得离谱</strong>。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/时代变了大人_的图像结果-20231002162332-c6dm8iq.jpg?imageView2/2/interlace/1/format/webp""></p>
<p>不过，如果不确定如何制定步骤，或者觉得自己没有这个时间和精力，AI 同样可以帮助你。我们可以提问：“请模仿鲁迅风格写一篇文章，在开始写之前，先为我列出完成这篇文章的步骤。”这样，你就可以在确认步骤后再让 AI 开始创作。</p>
<h3 id=""6-使用思维链"">6.使用思维链</h3>
<p>“思维链”是一种独特的提示工程技巧，专门用于指导 ChatGPT 如何进行精确的逻辑推理和问题解决。这种技巧的核心思想是通过问答的形式，先给出一个问题及其答案示例，并在答案中明确描述推理过程。这种方法旨在教导 ChatGPT 如何分析问题、搜寻证据，并最终产生合理的答案。</p>
<p>听起来似乎有点复杂？其实，如果你还记得之前提到的“样本”与“步骤”概念，那么“思维链”可以被简单地理解为这两者的完美结合。</p>
<p>例如，如果我们的目标是让 ChatGPT 回答关于某部电影的问题，我们可以创建一个特定的提示。这个提示包含两部分：一部分是模拟用户的问题与模型的输出，另一部分则是明确的答案路径。换言之，这两部分正好对应了“样本”和“步骤”，它们共同构成了所谓的“思维链”。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002163238-3xh28na.png?imageView2/2/interlace/1/format/webp""></p>
<p>值得注意的是，这种方法在某种程度上与模型的微调非常相似。模型微调中需要很多的思维链，但在 prompt 工程当中仅需要一个即可。</p>
<h3 id=""7-使用权重"">7.使用权重</h3>
<p>现在，我们要涉及的领域是 AI 绘画。可能你会疑问：AI 绘画与 GPT 模型存在明显的差异，难道它们的经验与方法可以互通吗？答案是肯定的。关键在于人机交互方式，无论是文本生成还是 AI 绘画，核心的交互方向现在都聚焦于自然语言处理。</p>
<p>**权重，简单来说，就是某一因素在整体中的重要程度。**例如，观察某幅 AI 绘画网站图示，我们可以看到标识为“权重 2”的区域，这表示该部分的重要性被加倍。那么，为何权重在 AI 绘画中如此关键呢？</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002164122-8mcsc56.png?imageView2/2/interlace/1/format/webp""></p>
<p>在 AI 绘画领域，每个关键词或模型都配有权重参数。通过调整这些参数，我们可以使模型更加重视某个特定的生成效果。如果希望 AI 绘制一位有红色头发的角色，那么你只需在关键词中增加“红色头发”的权重。这与我们在日常生活中强调某个要点，告诉别人：“这是关键，请重点注意！”是一样的。</p>
<p>那么如何正确使用权重呢？其实很简单：</p>
<ul>
<li>在初次与 AI 交互时，明确您的要求并为关键指令加上权重程度词（例如：打括号，做特定标注）。</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002164404-32wq220.png?imageView2/2/interlace/1/format/webp""></p>
<ul>
<li>基于 AI 的第一次反馈，进一步调整权重，确保 AI 能更精准地捕捉到您的需求，特别是那些 AI 之前可能忽略的部分。</li>
</ul>
<h3 id=""8-使用正向指令与反向指令"">8.使用正向指令与反向指令</h3>
<p>继续 AI 绘画的内容，讲述使用正向指令与反向指令，首先，我们来明确这两个概念。</p>
<p><strong>正向指令</strong>：这是指导 AI 执行某一特定操作或任务的指令，简单来说，就是告诉 AI“请这样做”。</p>
<p><strong>反向指令</strong>：与正向指令相反，这是告诉 AI 避免执行某一操作或任务的指令，即“请不要这样做”。</p>
<p>用一个更贴近日常的比喻，当我们教导他人，除了告诉他们应该怎样做之外，往往还要明确哪些是不应该做的。<br><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002165500-z7n32p3.png?imageView2/2/interlace/1/format/webp""></p>
<p>那么，如何在实际操作中应用这两种指令呢？</p>
<ul>
<li>当与 AI 交互生成内容时，我们首先给出的是正向指令，明确指导 AI 所需执行的任务。</li>
<li>在 AI 完成输出后，我们评估其结果。如果输出存在错误或不符合预期，此时我们可以利用反向指令提醒 AI，指出其错误并要求调整。</li>
</ul>
<p>与前文中提及的“权重”作用相似，这也是确保 AI 更精确、高效完成任务的重要手段。</p>
<h2 id=""四-输入prompt"">四、输入 prompt</h2>
<h3 id=""1-什么是输入prompt"">1.什么是输入 prompt</h3>
<p>前面中，我们已经详细解析了背景 prompt 和指令 prompt 的核心概念和应用方法。这部分内容为输入 prompt。</p>
<p>请想象以下场景：您希望 AI 审查一份房屋租赁合同。显然，如果没有提供合同文本，AI 如何进行审查呢？所以这份合同文本就是我们所说的“输入 prompt”。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192647-9lu7v6w.png?imageView2/2/interlace/1/format/webp""></p>
<p>为了有效地创建输入 prompt，我为大家总结了以下使用技巧：</p>
<ol>
<li><strong>明确区分指令与输入内容</strong>：将输入数据放在前面，并为其进行命名，然后在指令中使用这个命名来调用数据。</li>
<li><strong>使用分割符确保清晰</strong>：为了使数据与指令之间保持清晰的界限，使用分割符可以有效地帮助我们区分两者。</li>
<li><strong>要求 AI 基于提供的数据进行回答</strong>：这确保了 AI 的输出是基于我们提供的实际数据，而不是基于其先前的知识或任意推测。</li>
</ol>
<h3 id=""2-明确区分指令与输入内容"">2.<strong>明确区分指令与输入内容</strong></h3>
<p>这个操作需要先上传数据，再基于这些数据给出指令。比如，我们要审查一份房屋租赁合同。首先，我们上传合同文本，并告知 AI 这是“合同文本”。接着，我们可以基于此进行其他操作或提问。</p>
<p>那么，为什么不能简化这一流程，将数据与指令放在一起呢？</p>
<p>主要数据命名与指令分离的技巧有以下作用：</p>
<ol>
<li>
<p><strong>提高指令的复用性</strong>：通过这种方法，数据部分可以轻松地被替换。今天你处理的是房屋租赁合同，明天可能是其他类型的文件。只需简单地替换数据，而指令部分可以继续使用，极大提高了工作效率。（编写代码中有函数定义与传参，指令就类似于函数）</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/面向对象编程表情包_-20231002172301-2mxe2s8.jpg?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p><strong>降低 AI 混淆的概率</strong>：将数据与指令明确分开，有助于 AI 更加清晰地理解任务，从而更精确地执行。就像在人与人的交流中，如果信息组织得清晰有序，交流的效果自然更佳。</p>
</li>
</ol>
<h3 id=""3-使用分割符确保清晰"">3.<strong>使用分割符确保清晰</strong></h3>
<p>使用分割符，实际上就是利用特定的符号来区分输入文本与其他指令，从而为 AI 提供一个清晰的指导框架，你可以使用“#”、“---”“这些符号来分割。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002172630-frwt8ie.png?imageView2/2/interlace/1/format/webp""></p>
<p>不过，既然已有数据命名的技巧，为何还要使用分割符呢？</p>
<p>这主要是因为 chatGPT 输入框单次输入存在最大字符限制，通常为 2000 中文字符。当我们的数据内容超过 1500 字时，建议将数据上传并进行命名。而在数据量较小的情况下，使用分割符与指令进行整合更为便捷。</p>
<h3 id=""4-要求AI基于提供的数据进行回答"">4.<strong>要求 AI 基于提供的数据进行回答</strong></h3>
<p>什么叫做“基于数据进行回答”？</p>
<p>例如，当我们给 AI 提供了一篇文章，随后的所有问题都期望 AI 基于这篇文章的内容进行解答。如果文章中没有相关答案，AI 应当回应“找不到答案”。简而言之，我们要确保 AI 的回答是严格基于所给数据的。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192704-82yff4q.png?imageView2/2/interlace/1/format/webp""></p>
<p>采取这样的技巧有以下作用：</p>
<ol>
<li><strong>降低模型幻觉</strong>：这可以提高生成内容的准确性。事实上，降低模型幻觉是当前 AI 大模型领域中的热门话题。我将在未来的分享中进一步探讨这一主题。</li>
<li><strong>广泛的应用场景</strong>：无论是用作阅读助手还是企业的问答助手，确保 AI 的回答与提供的数据紧密相关都是至关重要的。这样可以确保信息的真实性和可靠性。</li>
</ol>
<h2 id=""五-输出prompt"">五、输出 prompt</h2>
<h3 id=""1-什么是输出prompt"">1.什么是输出 prompt</h3>
<p>什么是“输出 prompt”？简而言之，输出 prompt 就是指导 AI 模型如何形成其输出的指令。既然有了输入，那么输出也是必不可少的。当我们向 AI 提交任务，我们期待它为我们提供相应的结果。而输出 prompt 就是来指定这些结果应该如何展现的。</p>
<p>举个例子来说，如果我们要求 AI 对某篇文章进行总结，而希望这个总结的长度不超过 50 字，那么“生成文字不超 50 字”就是这个任务的输出 prompt。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192722-qrxkkgh.png?imageView2/2/interlace/1/format/webp""></p>
<p>对于输出 prompt， 有以下技巧：</p>
<ol>
<li>要求模型输出时，对自己的意思进行阐述</li>
<li>无步骤指令，要求模型输出时包含自己的步骤</li>
<li>要求模型模型格式化输出</li>
</ol>
<h3 id=""2-要求模型输出时-对自己的意思进行阐述"">2.要求模型输出时，对自己的意思进行阐述</h3>
<p>为何要求 AI 模型复述任务内容呢？</p>
<p>回想一下，你是否曾经与他人沟通某件事情，但对方的理解却与你的初衷大相径庭？这种情况在实际生活中的甲方与乙方之间的合同沟通中尤为常见。沟通的核心问题在于：每个人的理解都有其独特性，这导致了大量的误解。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/3_封私信_29_条消息_有没有动漫表情包呀？_-_知乎-20231002175203-1wv5r4k.gif""></p>
<p>当这种情境应用到 AI 时，问题同样存在。AI 的“理解”和我们的意图可能存在偏差。要解决这个问题，最简单直接的方法是让 AI 在执行任务之前，先复述我们的要求。这样，我们可以明确知道 AI 如何解读我们的指示，并据此进行相应的调整。</p>
<p>如何操作？</p>
<p>非常简单。在提交任务时，可以添加一句指示：“在你开始我的要求前，请先复述一遍我的要求。”此外，为了更为便捷，还可以在 OpenAI 的官方设置中添加这样一个指令：“<strong>如果我对你下达任务，你生成内容中需要包含对我任务的复述。</strong>”</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002175109-n9dlp2c.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""3-无步骤指令-要求模型输出时包含自己的步骤"">3.无步骤指令，要求模型输出时包含自己的步骤</h3>
<p>求模型输出其操作步骤，有以下好处：</p>
<ol>
<li>提高输出正确性：当我们没有给出具体步骤时，AI 会依赖于其默认机制，迅速地执行任务。这种情况下，虽然执行快速，但可能牺牲了结果的质量。这与我们之前讨论的要求 AI 自主定义步骤是相似的。</li>
<li>更好地理解 AI 操作：了解 AI 如何执行任务不仅帮助我们更准确地获得预期结果，而且在出现问题时，我们可以更容易地定位并解决。</li>
</ol>
<p>具体实施这一技巧有两种方法：</p>
<ul>
<li>直接在任务指令中要求：例如，“在执行我的要求时，请先思考步骤，并在完成后列出你的操作步骤。”</li>
<li>在 OpenAI 的官方设置中进行设定：添加这样一条指令：“如果我对你下达了要求，但下达的要求中未给你相应的步骤，请你自己先思考步骤是什么，然后依照自己的步骤完成要求，最后生成内容中需要包含你的步骤”。</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002185133-xor2nu6.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""4-要求模型模型格式化输出"">4.要求模型模型格式化输出</h3>
<p>什么是格式化输出？</p>
<p>简单来说，就如同我们在写文章时，遵循特定的格式和规范。AI 在生成内容时，同样可以按照特定的格式进行输出。</p>
<p>如何实施格式化输出？</p>
<ol>
<li>内容字数限制：例如，我们可以指定输出内容的字数上限，如“生成的总结不超过 50 字”。</li>
<li>文件格式设置：当我们需要 AI 生成特定格式的内容，如代码、大纲等，我们可以明确地告诉 AI 所需的格式。</li>
<li>使用小样本方法：之前我们已经探讨过此方法。当我们给 AI 提供一个完整的示例文本，AI 可以参照该示例来生成输出。</li>
</ol>
<h2 id=""项目篇"">项目篇</h2>
<h2 id=""一-通用方法--迭代开发思路"">一、通用方法——迭代开发思路</h2>
<h3 id=""1-什么是迭代开发思路"">1.什么是迭代开发思路</h3>
<p>我们在前文中探讨了如何制作高效的 Prompt，但仅有这些显然不够。真正的目的是将学到的知识应用到实际项目中。如果项目规划不得当，无论 Prompt 如何出色，其效果仍然会大打折扣。</p>
<p>为了更好地实践，我推荐遵循程序开发中的迭代开发思路。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192735-8llw6qu.png?imageView2/2/interlace/1/format/webp""></p>
<p>迭代开发思路是什么？</p>
<p>迭代开发是计算机科学中的一种开发策略，将整个开发过程划分为多个小周期，每个周期都包含需求分析、设计、开发、测试和交付等环节。应用到 Prompt 的制作中，这一过程可以概括为：梳理 Prompt 思路、书写 Prompt、查看 GPT 的输出和最终交付。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192751-zgt2fat.png?imageView2/2/interlace/1/format/webp""></p>
<p>迭代开发的优势</p>
<ol>
<li>适应性强：在需求不完全明确的情况下开始开发，将需求细化为每个迭代周期，从而逐步完善。</li>
<li>效率提升：通过固定的流程和周期来设定 Prompt，确保项目进度的持续推进。</li>
<li>需求的灵活性：后续的需求可以在已有基础上轻松加入。</li>
</ol>
<p>迭代开发的技巧</p>
<ul>
<li>应用日志：在整个开发过程中，利用日志记录每一个阶段的需求、变更和进展。</li>
<li>使用思维导图工具：在需求分析和 Prompt 设计阶段，思维导图可以帮助我们更清晰地拆解和组织任务。</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192800-a3drzpb.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""2--如何制作应用日志"">2. 如何制作应用日志</h3>
<p>如何高效地制作和管理应用日志是每个开发者的日常挑战。不管你是资深的开发者还是刚入门的学员，希望本文能为你提供一些实用的建议。</p>
<p>什么是应用日志？</p>
<p>简而言之，应用日志是记录开发过程中各个环节信息的文本文件。它可以是简单的.txt 或 Word 文件，或者更高级的软件如我个人偏好的“思源笔记”。</p>
<p>为什么需要应用日志？</p>
<ul>
<li>有效追踪进度：通过记录每一步的成果，可以清晰地看到项目的发展轨迹。</li>
<li>准确捕获需求：结果分析是下一周期需求分析的关键基础，避免了在开发过程中的盲目和重复。</li>
<li>提高工作效率：有了明确的记录，团队成员之间的沟通更为高效，新加入的成员也能快速上手。</li>
</ul>
<p>应用日志的构成主要包括以下四个部分，制作遵循就好了：</p>
<ul>
<li>需求分析：记录项目的初衷、目标和期望输出。</li>
<li>Prompt 设计思路：详细描述 Prompt 的制作策略、关键点及考虑的细节。</li>
<li>测试结果：包括制定的 Prompt 和 AI 生成的具体输出。</li>
<li>结果分析：基于测试结果，分析其优点和不足，为下一轮的迭代提供方向。</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002190556-ftn87wx.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""3-思维导图项目拆解"">3.思维导图项目拆解</h3>
<p>面对一个复杂的项目，直接上手可能会显得无从下手。此时，思维导图能够帮助我们对项目进行结构化的拆解，清晰地展示任务的层级和关系。</p>
<p>想象下 ChatGPT 是一个工作伙伴。对于需求分析，首先要思考，如果 ChatGPT 是人，那它能为项目做哪些贡献？然后根据 prompt 的构成进行 prompt 设计，最后开始书写。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002190934-gfc1431.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h2 id=""二-项目操作"">二、项目操作</h2>
<h3 id=""1-0-1的项目处理"">1.0-1 的项目处理</h3>
<p>每当我们踏入一个全新的项目领域，面对的往往是海量信息、未知的领域知识和种种困惑。这时，我们如何高效地从 0 起步，逐步深入到 1 的深度呢？答案可能就在我们手边的 AI 工具。</p>
<p>0-1 的项目是什么？在这里，我们定义它为对某一领域几乎毫无了解，没有明确的执行策略或体系化知识的项目。此时，如同一个初学者，我们需要从最基础的开始，逐步探索和深入。</p>
<p>对于 0-1 的项目处理，我推荐以下的方法：</p>
<ul>
<li>开放心态：对于 0-1 的项目，首先要有一个开放的心态，勇于探索 AI 的各种可能性。因为你尚未对这个项目有深入的了解，所以没有固定的模式和框架限制你，这正是释放 AI 潜能的好时机。</li>
<li>多利用询问：对于新的领域，最直接的方法就是提问。尝试向 AI 提出各种与项目相关的问题，从而快速获取关键信息。</li>
<li>利用搜索工具：工具如 newbing 可以为你提供丰富的领域资料，帮助你快速了解新领域的核心知识。</li>
<li>模拟外行人的用户人设背景：通过创建一个外行人的用户背景，比如：“我是一个刚入门的新手，对这个领域几乎一无所知。”，这样可以更有针对性地从基础开始探索。</li>
<li>记录关键问题：在应用日志中，务必记录你在探索过程中遇到的所有关键问题。这不仅可以帮助你跟踪学习进度，还可以为后续的研究提供线索。</li>
</ul>
<h3 id=""2-1-100的项目处理"">2.1-100 的项目处理</h3>
<p>前面是 0-1 的项目，相对应的 1-100 项目代表了你已经对这个领域或项目有了深入的了解和体系化的认识，用 AI 的目标是将项目做到极致。此时，你需要的是高效、精确和有策略地执行。</p>
<p>以下对于 1-100 的项目处理，我推荐以下的方法：</p>
<ul>
<li>保持开放心态：虽然你对项目已经很熟悉，但利用 AI 可以帮助你提升效率和看到不同的角度。初期可能存在摸索期，但长远看，你的投入会得到回报。</li>
<li>工作流程拆解：利用思维导图等工具将你的工作流程进行拆解，明确每一个步骤，并考虑在哪些环节可以利用 AI 来提升效率或质量。</li>
<li>最小化 AI 介入：不要期待 AI 一步到位完成复杂任务，而是要细分任务，将其精简化，逐步将 AI 融入。</li>
<li>指令的优化：确保你的指令明确、简洁，数据与指令需要分开处理。通过不断的迭代，使得指令更为优化，使得未来的使用更为便捷。</li>
</ul>
<p>在深化项目的过程中，AI 可以被看作是你的得力助手，帮助你更快地达到项目的极致。只需要调整心态，合理利用并不断优化，你会发现，AI 不仅仅是工具，更是你的得力伙伴。</p>
<h2 id=""写在最后"">写在最后</h2>
<p>这篇文章是我使用 GPT 将我做视频的字幕稿转换而成，中间有我自己修改。</p>
<p>我跟很多人讨论过 GPT,最后我只有一个结论：少说多做，先做了在说。</p>
<p>使用 GPT，最重要的是克服心中的墙，实力决定意图，工具决定价值。</p>
<p>一只鳄鱼，它早已习惯了解决所有问题的普适方法: 狠狠地咬 。在过去一亿年里屡试不爽，它的大脑模型里没有别的概念和方法，终于，它遇到了一个陌生的对手：人类创造的钢铁机器，怎么咬也咬不动。这只鳄鱼还不够勤奋努力吗? 作为有着悠久的一亿年历史的物种，和只有二十万年历史的智人相比，它难道不是早早地赢在起跑线上了吗？</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/image-20231002192815-1nm0bwt.png?imageView2/2/interlace/1/format/webp""></p>
<p>这样的事情也会发生在 AI 时代下，原先的经验在现在不一定有用了，大家能做的就是积极拥抱变化，对于 AI，用起来，学起来，教起来。这里我是把用起来排在最前面。理由很简单，只有用了，才会了解，才会有需求，纸上谈兵永远不行。</p>
<p>非常感谢你的阅读，更多内容可以关注我的 B 站账号：QAyong</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1613490253632/assets/8ffaa0fb67264f1b5a1e7ac84f7d839-20231002192300-mn6fxki.jpg?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
                

作者：teacherQ
链接：https://ld246.com/article/1696246170187
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",teacherQ,"ChatGPT,思源笔记",链滴优选
705,思源笔记关系图优化意见 - 链滴,Mon Oct 02 2023 17:58:46 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""1--颜色问题"">1. 颜色问题</h2>
<p>关系图中不同的颜色对应了不同的类型，但是用户并不能很直观的建立「颜色-》块类型」的对应印象。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1646569891270/assets/image-20231002174246-fxn8l10.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p><strong>个人建议</strong>：为过滤条件的项目增加色块，以便和图中的颜色快速的对应起来。比如标题块对应紫色，前面就增加一个紫色的色块（或者使用紫色的字体）</p>
</blockquote>
<h2 id=""2--冗余显示问题"">2. 冗余显示问题</h2>
<p>当允许显示更加细粒度的块类型的时候， refId 所在的块和对应的 root 文档可能会同时显示在图中——意味着图中的显示是存在冗余的。</p>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1646569891270/assets/image-20231002174553-oij2j1c.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p><strong>个人建议</strong>：可以尝试合并显示，如果显示了 refId 所在的块，就不要再显示他所在的文档块了</p>
</blockquote>
<h2 id=""3--没有引用关系的块没有必要显示在关系图中"">3. 没有引用关系的块没有必要显示在关系图中</h2>
<p>关系图最大的意义在于显示块的引用关系——所以显示哪些没有引用关系的块没有意义反而还会降低有效的信息密度。</p>
<p>当时目前思源中当我们增加允许显示的块的类型的时候，也同时也会把文档下属的块显示出来——这本来没什么，但是某些没有引用关系的块也会显示出来——这就不行了。</p>
<p>我个人认为，如果文档下属的块没有引用关系，那么就没有必要显示在图中。</p>
<blockquote>
<p><strong>个人建议</strong>：如果一个节点，它本身没有引用关系，那就不要显示它。</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/10/siyuan/1646569891270/assets/image-20231002173035-hs55mn3.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""4--优化手动拖拉节点的操作体验"">4. 优化手动拖拉节点的操作体验</h2>
<p>目前手动拖拉节点我个人觉得最难受的地方是，有时候好不容易把节点拖到一个更好的位置，然后一松鼠标，节点又弹回去了。</p>
<blockquote>
<p><strong>个人意见</strong>：手动的调节的优先级应该远大于设定的斥力引力关系</p>
</blockquote>
<p>　　‍</p>
                

作者：Frostime
链接：https://ld246.com/article/1696240726777
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
706,用 SQL 回忆一下自己使用思源的历程 - 链滴,Mon Sep 11 2023 01:12:29 GMT+0000 (Coordinated Universal Time),"
                    <p>突然心血来潮，想回忆一下我是什么时候开始用思源的。</p>
<h2 id=""找到最开始的那个笔记"">找到最开始的那个笔记</h2>
<p>这个很简单，首先做一个嵌入块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">order</span><span class=""highlight-w""> </span><span class=""highlight-k"">by</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">created</span><span class=""highlight-o"">`</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">limit</span><span class=""highlight-w""> </span><span class=""highlight-mi"">1</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>惊讶地发现自己的第一篇文章居然是在考虑到底要用哪个笔记软件。。。</p>
<p><img src=""https://b3logfile.com/file/2023/09/640a03a820342bdcf930d193d7b79c50-JIAFcJA.png?imageView2/2/interlace/1/format/webp""></p>
<p>看了一下块时间，是去年 3 月，这也就是我第一次使用思源的时间了。</p>
<p><img src=""https://b3logfile.com/file/2023/09/image-vtBCRtE.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""看一下历史新建块的数量"">看一下历史新建块的数量</h2>
<p>但是我记得比较清楚是 2022 年有相当一段时间我是没有怎么使用思源的。我还想要确定是从什么时候开始主力用上思源的。</p>
<p>同样可以用 SQL ，新建一个 query 块。键入如下代码</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">SELECT</span><span class=""highlight-w""> </span><span class=""highlight-k"">SUBSTRING</span><span class=""highlight-p"">(</span><span class=""highlight-n"">created</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-mi"">1</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-mi"">6</span><span class=""highlight-p"">)</span><span class=""highlight-w""> </span><span class=""highlight-k"">AS</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'month\'</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-k"">COUNT</span><span class=""highlight-p"">(</span><span class=""highlight-o"">*</span><span class=""highlight-p"">)</span><span class=""highlight-w""> </span><span class=""highlight-k"">AS</span><span class=""highlight-w""> </span><span class=""highlight-n"">BlockCnt</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">FROM</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">WHERE</span><span class=""highlight-w""> </span><span class=""highlight-n"">created</span><span class=""highlight-w""> </span><span class=""highlight-k"">BETWEEN</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'202203%\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'202309%\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">GROUP</span><span class=""highlight-w""> </span><span class=""highlight-k"">BY</span><span class=""highlight-w""> </span><span class=""highlight-k"">month</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">ORDER</span><span class=""highlight-w""> </span><span class=""highlight-k"">BY</span><span class=""highlight-w""> </span><span class=""highlight-k"">month</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>我是 2023 年 3 月之后才开始用的，所以范围选定 <code>\'202203%\' AND \'202309%\'</code> 就行了。</p>
<p><img src=""https://b3logfile.com/file/2023/09/1389fbe8e616af54f4bf948eab7dddb9-mXnEXc2.png?imageView2/2/interlace/1/format/webp""></p>
<p>这张表就很明显了，3 月份刚刚用的时候一阵新鲜，但是后面很长时间就没怎么碰了（应该是当时在倒腾别的东西）。</p>
<p>后来 2022 年 10 月开始确定主力用思源了，之后每个月都写下大几千的块。</p>
                

作者：Frostime
链接：https://ld246.com/article/1694365950369
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
708,插件 Time logger 简介 - 链滴,Sun Sep 10 2023 11:21:52 GMT+0000 (Coordinated Universal Time),"
                    <p>这里是思源的新插件「时间日志」的简介，发到论坛里的主要原因是介绍文档里面图很多，而集市加载图片又非常不稳定。。。</p>
<h2 id=""基本功能"">基本功能</h2>
<p>　　插件的基本功能是帮助你记录当前的活动。点开插件注册的侧边栏 dock 面板。可以展示若干的活动。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908221241-4d01rmv.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""活动记录"">活动记录</h3>
<ul>
<li>
<p>活动记录：当我们点击活动的时候，就会出现一个计时器，记录当前正在进行的活动。你可以一次性开启多个活动</p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908221441-cmbhk0s.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>暂停</p>
<p>点击「暂停」，计时器将会停止</p>
</li>
<li>
<p>停止</p>
<p>点击「停止」，计时器就会停止，同时退出该活动并保存活动的记录日志</p>
</li>
<li>
<p>删除</p>
<p>点击右上角的「x」，可以删除当前计时器，退出活动，且不保留活动的记录日志</p>
</li>
<li>
<p>备注</p>
<p>点击正在进行中的活动中间的计时器，可以输入对这个活动的备注</p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908222418-fly3b8a.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ul>
<h3 id=""群组"">群组</h3>
<p>　　右上角带有数字标号的是「群组」，点开后可以展示里面的子活动项目。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908222852-hvb5v4z.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""查看过去的记录"">查看过去的记录</h2>
<p>　　点击右上角的「记录」按钮，可以查看过去所有保存的活动记录。</p>
<p>　　可以按照年月日星期不同粒度查看特定区间范围内的日志记录。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908222521-t1sp1oh.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230909190220-otexs1e.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""配置"">配置</h2>
<p>　　你可以自由地配置自己想要的活动和群组。点击右上角的「设置」按钮</p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908222935-8nnz9iz.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908223402-gylb3hj.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""点击活动更改相关信息"">点击活动更改相关信息</h3>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908223451-fnon53r.png?imageView2/2/interlace/1/format/webp""></p>
<ul>
<li>
<p>更改标题</p>
</li>
<li>
<p>点击图标更改图标</p>
<ul>
<li>custom 部分是用户自己的图标，所以如果你想要使用自定义图标，可以自己去下载 svg 文件，然后放在 <code>工作空间/data/emojis/</code> 目录下。</li>
<li>建议在集市里面下载 emoji 插件替换原生的表情，否则这里排版会很难看</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908223531-ufd9i0s.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>删除活动</p>
</li>
<li>
<p>移动到其他群组中</p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908223623-h9qevqk.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>记得点击「保存」按钮</p>
</li>
</ul>
<h3 id=""进入群组"">进入群组</h3>
<p>　　点击群组后，可以进入群组配置里面的活动。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908224040-ywxnsdx.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""点击右下角图标添加新的项目"">点击右下角图标添加新的项目</h3>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908223725-1mpdzee.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>注意：一个新建的项目可以设置为「群组」，且一旦设置为群组后续不能更改。</p>
</blockquote>
<p>　　如果你在某个群组下新建项目，那么这个项目默认归属于这个群组。</p>
<h3 id=""拖动图标更改排布顺序"">拖动图标更改排布顺序</h3>
<p>　　<img src=""https://b3logfile.com/file/2023/09/siyuan/1646569891270/assets/image-20230908223830-xqz28s4.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
                

作者：Frostime
链接：https://ld246.com/article/1694316113225
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
681,分享常用的思源笔记插件 - 链滴,Sat Sep 09 2023 08:39:54 GMT+0000 (Coordinated Universal Time),"
                    <p>思源笔记本体已经足够好用，现在支持了插件系统，体验被进一步增强，下面我分享一下我常用的插件，有几款还是被名字耽误的。</p>
<p>‍</p>
<h3 id=""一-日历热力图-Calendar-heatmap-"">一、日历热力图（Calendar-heatmap)</h3>
<p>这个不多说，下载启用后直接在顶栏直观展示自己的编辑情况，可以说是插件系统发布后呼声最高的插件。</p>
<blockquote>
<p>关键词：顶栏热力图</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909073024-izm978r.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909073437-c7wsrxh.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""二-目录插件-siyuan-plugins-index-"">二、目录插件（siyuan-plugins-index)</h3>
<p>下载排名第一的插件，可以一键在文档中插入子文档，解决思源默认不在父文档生成子文档的问题，自由控制。</p>
<blockquote>
<p>关键词：父文档生成子文档目录</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909073609-t9oua8z.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909073803-1d7ovvr.png?imageView2/2/interlace/1/format/webp""></p>
<p>同类型的还有一款挂件，叫列出子文档，我本人以前主要还是使用它，因为它借助挂件的特性，可以有不同的展示模式，比如预览、按日期分组等。</p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909073831-je01faz.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909074144-dhng44p.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""三-自定义块样式-custom-block-"">三、自定义块样式（custom-block）</h3>
<p>这是一个被名字耽误的插件，它直接实现了幕布笔记的一键转导图这一许多人心心念念的功能。当然它同样也支持调整为其他视图、表格自动换行，极大增强块体验。</p>
<blockquote>
<p>关键词：一键转导图、表格自动换行</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909074238-5oc64uu.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/列表转导图示例-20230909074742-3sied9f.gif""></p>
<p>‍</p>
<h3 id=""四-网页视图-webview-"">四、网页视图（webview)</h3>
<p>一开始我用它的时候，以为只是可以在思源里打开网络链接的页面，但它还有一个非常好用的多窗口功能，鼠标中键点击任意一个块标，就可以让这个块变成一个小窗口在那，非常方便同时查看、复制粘贴。</p>
<blockquote>
<p>关键词：打开网页、小窗打开笔记</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909075105-6jxq8fs.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909075345-s57e8yx.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/多窗口示例-20230909075545-iaop2w7.gif""></p>
<p>同类型的还有刚上架的小窗插件，也能实现任意块的小窗打开，也可以试试。</p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909075527-n6y0i3x.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""五-headingIndex"">五、headingIndex</h3>
<p>这也是被名字耽误的插件之一，没有个中文名属实让人摸不着头脑，它可以让思源的文章按自己设置的标题序号样式自动在标题前加上一、（一）、（1）这样的序号，满足部分写正式文档的需求。</p>
<blockquote>
<p>关键词：自动生成标题序号</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909075648-pzutzjv.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/生成序号示例-20230909080246-x3zyum5.gif""></p>
<p>‍</p>
<h3 id=""六-文档层级导航-syplugin-hierarchyNavigate-"">六、文档层级导航（syplugin-hierarchyNavigate)</h3>
<p>这个插件能在文档页面展示上下级文档，同时还有上一篇、下一篇的按钮操作，对于习惯日记流写法的人来讲，可以快速跳转前后的日记。</p>
<blockquote>
<p>关键词：显示上下级文档、跳转前后日记</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909080312-jrg4arx.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909080655-zvcbgq0.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""七-替换背景图片-siyuan-plugin-background-cover-"">七、替换背景图片（siyuan-plugin-background-cover)</h3>
<p>只需插入一张你喜欢的背景图片，调整一下透明度，主题就好看了起来。当然，什么绿色护眼、磨砂纸张都可以。</p>
<blockquote>
<p>关键词：笔记加背景</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909080810-jbbiue7.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909081225-8r55gsc.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""八-随机题头图-more-cover-"">八、随机题头图（more-cover)</h3>
<p>不用羡慕 notion、wolai 的在线题头图了，使用这个插件也可以在线选择好看的图片了。</p>
<blockquote>
<p>关键词：在线题头图</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909081354-zsynzvp.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909081923-lko4shk.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""九-Web工具集成-siyuan-plugin-webapp-"">九、Web 工具集成（siyuan-plugin-webapp)</h3>
<p>把思源变成 edge 侧边栏的重要插件，支持添加自己想要查看的网页链接并加到侧边栏，实现 all in siyuan 查看。重要的是，它支持 flomo 内容直接拖动到思源编辑器，二者联动，解决思源移动端快速记录不方便，flomo 单独整理不方便的问题。</p>
<blockquote>
<p>关键词：添加网页到侧栏、flomo、网页设置为首页</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909082031-6tyjnbz.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/flomo拖动演示-20230909082551-hvgrt8j.gif""></p>
<p>‍</p>
<h3 id=""十-集成编辑环境-monaco-editor-"">十、集成编辑环境（monaco-editor)</h3>
<p>重要的总是最后的，这个插件能让思源进行源码编辑，是的，类似 vscode、obsidian 那样的源码编辑！还支持 json、css 等代码块的格式化，甚至在思源里写思源主题。</p>
<blockquote>
<p>关键词：markdown 源码编辑</p>
</blockquote>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909082620-n0ix7ki.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/源码编辑演示-20230909083448-9ksz9fb.gif""></p>
<p><img src=""https://b3logfile.com/file/2023/09/siyuan/1630025891949/assets/image-20230909083603-9fzoe6p.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
<h3 id=""最后"">最后</h3>
<p>以上是本人常用的插件，因为篇幅问题，还有许多非常好的插件没有写上。同时，上面仅简单介绍了插件的主要功能，具体的使用还得靠大家上手体验。</p>
                

作者：mozhu
链接：https://ld246.com/article/1694219995629
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",mozhu,思源笔记,链滴优选
727,高级子弹 \\ 聚焦打开 - 链滴,Wed Aug 16 2023 18:41:00 GMT+0000 (Coordinated Universal Time),"
                    <p>让下面的部分</p>
<ul>
<li>
<p>111</p>
<ul>
<li>222</li>
<li>333</li>
</ul>
</li>
</ul>
<p>聚焦后看起来像：</p>
<p><img src=""https://b3logfile.com/file/2023/08/siyuan/1654576506442/assets/image-20230816183712-aqk0de9.png?imageView2/2/interlace/1/format/webp"">css 见下。</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">]))</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span> <span class=""highlight-o"">+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">1</span><span class=""highlight-o"">)</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*默认隐藏子弹头*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span> <span class=""highlight-o"">+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">1</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">transparent</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span> <span class=""highlight-o"">+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">1</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span> <span class=""highlight-o"">+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">1</span><span class=""highlight-o"">)&gt;</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">2</span><span class=""highlight-o"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">font-size</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">1.75</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">font-weight</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">bold</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span> <span class=""highlight-o"">+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">1</span><span class=""highlight-o"">)</span> <span class=""highlight-o"">&gt;</span> <span class=""highlight-nt"">div</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>这个 css 很久之前写的，在思源能够点击圆点聚焦后实用了不少。</p>
<p>要是思源能聚焦后回车自动缩进就更好了，现在这个就差这个就跟那些大纲笔记差不多了。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1692182461117
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
684,想省大钱？思源笔记第三方同步 S3 手把手教程（使用七牛云对象存储 Kodo）（2024.4.25） - 链滴,Tue Aug 15 2023 16:54:38 GMT+0000 (Coordinated Universal Time),"
                    <details>
<summary>青云 QingCloud 用户注意事项（点击展开）</summary>
<h4 id=""从-2024-4-24-开始-青云-QingCloud-对象存储-OSS-不再向个人用户提供服务""><strong>从 2024.4.24 开始，青云 QingCloud 对象存储 OSS 不再向个人用户提供服务</strong></h4>
<p><a href=""https://ld246.com/article/1713982854866?r=JeffreyChen"">青云 S3 已无法同步，推荐使用七牛云</a></p>
<p>本教程自 2024.4.25 开始，从青云改用七牛云。</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425010328-g8n2w5z.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>用青云的用户请抓紧时间迁移，可以先关闭同步，然后直接从本教程的「2. 注册七牛云」部分开始看。</p>
<p><img src=""https://b3logfile.com/file/2024/04/image-7T3qAJ8.png?imageView2/2/interlace/1/format/webp""></p>
</details>
<h2 id=""一-前言"">一、前言</h2>
<p>我自己折腾了很久才搞明白，写下这篇教程既是避免自己忘记操作，也是为了帮助后来者节省时间。</p>
<p>所以，请你在有以下需求的前提下阅读本教程，否则更应该把折腾工具的时间花在多写一些笔记上。</p>
<ul>
<li>多设备同步的需求</li>
<li>省钱的需求（仍然需要花钱）</li>
</ul>
<p>如果你绝大多数时候只在一台设备上使用思源笔记，更简单的做法是不必执着于同步笔记，更应该定期手动导出 Data 文件备份。其他时候记笔记可以使用 <strong>​<code>微信文件传输助手</code>​</strong>​ 、 <strong>​<code>手机备忘录</code>​</strong>​ 等应急 ，过后再整理到思源笔记。</p>
<p>如果比起省一些钱，你更在意少花点时间折腾，请直接 ​<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2Fpricing.html%3Fr%3DJeffreyChen"" target=""_blank"" rel=""nofollow ugc"">年付订阅</a>​ ，使用官方云同步服务。</p>
<h2 id=""二-省钱-但无法免费"">二、省钱，但无法免费</h2>
<ol>
<li>
<p>思源笔记第三方存储功能（功能特性）<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2Fpricing.html%3Fr%3DJeffreyChen"" target=""_blank"" rel=""nofollow ugc"">（点此进入定价页面）</a></p>
<ul>
<li>可接入第三方云端存储（S3/WebDAV）的 <strong>功能特性已经收费</strong>（从 2024 年 1 月，v2.12.0 版本开始），<strong>一次付费后终身可用</strong>（订阅会员包含了功能特性，在会员有效期内不需要为此单独付费）</li>
<li>目前打折价 64 元：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2Fpricing.html%3Fr%3DJeffreyChen"" target=""_blank"" rel=""nofollow ugc"">https://b3log.org/siyuan/pricing.html</a></li>
</ul>
</li>
<li>
<p>七牛云 Kodo 对象存储（<strong>很便宜</strong>的，不用担心）</p>
<ul>
<li>
<p><strong>免费额度</strong></p>
<table>
<thead>
<tr>
<th>标准存储每月免费空间</th>
<th>标准存储每月免费 CDN 回源流量</th>
<th>标准存储每月免费写请求 PUT/DELETE</th>
<th>标准存储每月免费读请求 GET</th>
<th>每月免费上传流量</th>
</tr>
</thead>
<tbody>
<tr>
<td>10GB</td>
<td>10GB</td>
<td>10 万次</td>
<td>100 万次</td>
<td>无上限</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>按量计费，具体看价格文档：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.qiniu.com%2Fprices%2Fkodo"" target=""_blank"" rel=""nofollow ugc"">https://www.qiniu.com/prices/kodo</a></p>
</li>
</ul>
</li>
</ol>
<h2 id=""三-以下是详细教程-但碰到意外情况需要自己想办法"">三、以下是详细教程，但碰到意外情况需要自己想办法</h2>
<h2 id=""1--确保你可以使用思源笔记的第三方存储功能"">1. 确保你可以使用思源笔记的第三方存储功能</h2>
<p>如果你还没有付费，可以先免费试用订阅，也可以直接升级 <code>功能特性</code>​ 或 <code>年付订阅</code>​ ：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fb3log.org%2Fsiyuan%2Fpricing.html%3Fr%3DJeffreyChen"" target=""_blank"" rel=""nofollow ugc"">https://b3log.org/siyuan/pricing.html</a></p>
<p>当然，如果你已升级 <strong>​<code>年付订阅</code>​</strong>​ ，在官方云存储剩余容量足够的前提下，不妨直接使用思源官方云同步服务。</p>
<p>页面如下：</p>
<ol>
<li>打开 SiYuan <strong>​<code>设置</code>​</strong>​ 页面，点击 <strong>​<code>云端</code>​</strong>​</li>
<li><strong>云端存储服务提供商</strong> 选择 <strong>​<code>S3</code>​</strong>​</li>
</ol>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425011008-4v1labd.png?imageView2/2/interlace/1/format/webp"">​</p>
<h2 id=""2--注册七牛云"">2. 注册七牛云</h2>
<h4 id=""注意-帖子最初写于-2024-年-如果注册流程在之后有变化-请随机应变-"">注意，帖子最初写于 2024 年，如果注册流程在之后有变化，请随机应变。</h4>
<p><strong>​点击打开七牛云官网</strong>​ ：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fs.qiniu.com%2FeuIjyi"" target=""_blank"" rel=""nofollow ugc"">https://www.qiniu.com/</a></p>
<p>点击页面右上角「立即注册」，按流程注册：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240424235441-twdizwd.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>注册成功后，账号类型选择「个人用户」：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240424235737-34j69u6.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>前往 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fportal.qiniu.com%2Fdeveloper%2Fuser%2Fsecurity"" target=""_blank"" rel=""nofollow ugc"">https://portal.qiniu.com/developer/user/security</a> 绑定微信，然后可能会退出登录，此时重新登录即可</p>
<p>前往 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fportal.qiniu.com%2Fdeveloper%2Fuser%2Fidentity"" target=""_blank"" rel=""nofollow ugc"">https://portal.qiniu.com/developer/user/identity</a> 完成实名认证：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000418-1lcqoh7.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000443-639j9su.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>用手机微信扫码，输入姓名和身份证号，再扫脸验证（扫码之后如果页面打不开，请点击二维码下方的「刷新」后重新扫码）：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000528-pab75o4.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425000824-y0t5emr.png?imageView2/2/interlace/1/format/webp"">​</p>
<h2 id=""3--创建存储桶-Bucket-并设置"">3. 创建存储桶（Bucket）并设置</h2>
<p>打开 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.qiniu.com%2Fproducts%2Fkodo"" target=""_blank"" rel=""nofollow ugc"">https://www.qiniu.com/products/kodo</a> ，点击「立即使用」：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001014-n6qlxik.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>新建空间（也就是 Bucket ）（空间名复制备用）：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001212-uc2i1le.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001352-fg984ve.png?imageView2/2/interlace/1/format/webp"">​</p>
<h2 id=""4--配置-SiYuan-云端设置"">4. 配置 SiYuan 云端设置</h2>
<ol>
<li>
<p>打开 SiYuan <strong>​<code>设置</code>​</strong>​ 页面，点击 <strong>​<code>云端</code>​</strong>​ ，<strong>云端存储服务提供商</strong> 选择 <strong>​<code>S3</code>​</strong>​</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425011008-4v1labd.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p><strong>Endpoint</strong> 输入访问地址（格式大致为： <code>http://s3.【【这里填区域简称 Region ID】】.qiniucs.com/</code>​ ，注意： http 后面没有 s ）</p>
<p>获取方法如下：</p>
<p>打开 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdeveloper.qiniu.com%2Fkodo%2F4088%2Fs3-access-domainname"" target=""_blank"" rel=""nofollow ugc"">https://developer.qiniu.com/kodo/4088/s3-access-domainname</a> ，按照页面说明复制刚刚创建的空间对应的区域 Region ID 字符串，组合成一个链接： <code>http://s3.【【这里填区域简称 Region ID】】.qiniucs.com/</code>​ ：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425003547-5j93cxl.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>输入 <strong>Acess Key</strong> 和 <strong>Secret Key</strong></p>
<p>获取方法如下：</p>
<p>前往 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fportal.qiniu.com%2Fdeveloper%2Fuser%2Fkey"" target=""_blank"" rel=""nofollow ugc"">https://portal.qiniu.com/developer/user/key</a> 复制 AccessKey (AK) 和 SecretKey (SK) ：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425004602-h7zo52g.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p><strong>Bucket</strong> 输入你的存储桶名称，也就是你创建的空间的名称</p>
</li>
<li>
<p><strong>Region</strong> 输入区域简称 Region ID ，之前在 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdeveloper.qiniu.com%2Fkodo%2F4088%2Fs3-access-domainname"" target=""_blank"" rel=""nofollow ugc"">https://developer.qiniu.com/kodo/4088/s3-access-domainname</a> 中查找过</p>
</li>
<li>
<p><strong>Timeout (s)</strong>  默认为 30 。这个是超时时间，在数据量大或者网速慢的情况下需要改大一些</p>
</li>
<li>
<p><strong>Addressing</strong> 改为 <strong>​<code>Path-style</code>​</strong>​</p>
</li>
<li>
<p><strong>TLS Verify</strong> 默认为 <strong>​<code>Verify</code>​</strong>​</p>
</li>
<li>
<p><strong>启用云端同步</strong> 在看完教程之后再开启，不着急</p>
</li>
<li>
<p><strong>同步冲突时生成冲突文档</strong> 按需开启</p>
</li>
<li>
<p><strong>云端同步模式</strong> 按照需求设置：</p>
<ul>
<li>自动同步（数据不再变动后 30 秒进行一次同步）</li>
<li>手动同步（仅启动和关闭软件时自动同步一次，其他时候需要手动触发同步）</li>
<li>完全手动同步（启动和关闭时均不同步，完全手动控制同步时机和同步方向）</li>
</ul>
</li>
<li>
<p>点击 <strong>云端同步目录</strong> 右侧 <strong>​<code>设置</code>​</strong>​ ，应该可见账户下所有 S3 存储桶，点击目标存储桶即可</p>
</li>
</ol>
<h2 id=""5-尝试同步"">5.尝试同步</h2>
<h3 id=""--注意-在使用同步功能前请认真了解-思源笔记同步指南-中的内容-这关乎你的笔记数据安全"">※ 注意，在使用同步功能前请认真了解<a href=""https://ld246.com/article/1683395267749?r=JeffreyChen"">《思源笔记同步指南》</a>中的内容，这关乎你的笔记数据安全</h3>
<h3 id=""--注意-在使用同步功能前请认真了解-思源笔记同步指南-中的内容-这关乎你的笔记数据安全-"">※ 注意，在使用同步功能前请认真了解<a href=""https://ld246.com/article/1683395267749?r=JeffreyChen"">《思源笔记同步指南》</a>中的内容，这关乎你的笔记数据安全</h3>
<h3 id=""--注意-在使用同步功能前请认真了解-思源笔记同步指南-中的内容-这关乎你的笔记数据安全--"">※ 注意，在使用同步功能前请认真了解<a href=""https://ld246.com/article/1683395267749?r=JeffreyChen"">《思源笔记同步指南》</a>中的内容，这关乎你的笔记数据安全</h3>
<ol>
<li>
<p>导出 Data 备份好</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013005-8splqdm.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>打开 <strong>启用云端同步</strong> 开关，手动点击一次顶栏的同步图标进行同步，如果报错，请自行定位问题。</p>
<p><em>你可以对照教程看看哪一步做错了，也可以在 <em>​</em><a href=""https://ld246.com/"">链滴</a><em>​</em> 上提问…</em></p>
</li>
<li>
<p>点击进入空间，查看存储量，判断是否上传成功：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425001520-sse6xfa.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013320-d6qwpn5.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>在配置好的设备上导出配置文件的压缩包，然后在其他需要同步的设备中导入：</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20240425013644-ii494sp.png?imageView2/2/interlace/1/format/webp"">​</p>
</li>
<li>
<p>在其他设备上调整其他选项（不同设备，选项可以不同）：</p>
<ul>
<li>
<p><strong>启用云端同步</strong> 在确认无误之后再开启，不着急</p>
</li>
<li>
<p><strong>同步冲突时生成冲突文档</strong> 按需开启</p>
</li>
<li>
<p><strong>云端同步模式</strong> 按照需求设置：</p>
<ul>
<li>自动同步（数据不再变动后 30 秒进行一次同步）</li>
<li>手动同步（仅启动和关闭软件时自动同步一次，其他时候需要手动触发同步）</li>
<li>完全手动同步（启动和关闭时均不同步，完全手动控制同步时机和同步方向）</li>
</ul>
</li>
<li>
<p>建议在使用频次较低的设备上使用 <strong>​<code>完全手动同步模式</code>​</strong>​ 并关闭 <strong>​<code>同步冲突时生成冲突文档</code>​</strong>​ ，每一次使用时通过 <strong>​<code>下载云端数据快照</code>​</strong>​ 同步从另一台设备上传的云端数据，避免数据冲突。需要注意的是：这样做并不代表你可以在多台设备上同时修改笔记，更好的方法是养成习惯：在切换设备前手动点击同步图标，等待数据完全同步至云端后关闭软件，之后再切换设备下载云端数据。</p>
</li>
<li>
<p>建议在第一次尝试使用第三方同步功能时，在所有的设备上都使用 <strong>​<code>完全手动同步模式</code>​</strong>​ ，能有效避免误操作覆盖数据，之后再把常用设备改为 <strong>​<code>自动同步</code>​</strong>​</p>
</li>
<li>
<p>点击 <strong>云端同步目录</strong> 右侧 <strong>​<code>设置</code>​</strong>​ ，应该可见账户下所有 S3 存储桶，点击目标存储桶即可</p>
</li>
</ul>
</li>
</ol>
<h2 id=""6--按需充值"">6. 按需充值</h2>
<p>可以在财务中心查看费用与充值：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fportal.qiniu.com%2Ffinancial%2Foverview"" target=""_blank"" rel=""nofollow ugc"">https://portal.qiniu.com/financial/overview</a></p>
<p><img src=""https://b3logfile.com/file/2024/04/image-Tp71B0v.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""END""><strong>END</strong></h2>
<p>p.s.</p>
<ul>
<li>除了七牛云，你也可以选择其他的服务商。关于服务商的选择可以参考这篇文章：<a href=""https://ld246.com/article/1668672970787?r=JeffreyChen"">《第三方同步选择 - S3 服务商对比推荐》</a> ，不过<strong>具体的数据很可能已经过时</strong>，需要留意；各个厂商的配置方法大同小异。</li>
<li>使用 S3 同步只会同步工作空间下的 <em><strong>repo</strong></em> 文件夹（里面是经过加密的文件分块，不包含整个工作空间），如需单独同步工作空间目录下的某些文件或文件夹，请在关闭思源笔记后手动复制到其他设备。</li>
</ul>
<p>如果本篇教程对你有帮助，能否请你点击本帖右下角，给我一个大大的感谢以及一个免费的赞同，还可以分享给需要的朋友。你的鼓励与支持就是我创作的最大动力。</p>
<p>​<img src=""https://b3logfile.com/file/2024/04/siyuan/1672108273034/assets/image-20230815150538-rjykz20.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍「友情链接」：<a href=""https://ld246.com/article/1700551933609?r=JeffreyChen"">【代码片段分享】思源笔记用到现在积累的所有代码片段</a></p>
                

作者：JeffreyChen
链接：https://ld246.com/article/1692089679062
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",JeffreyChen,"S3,同步,思源笔记,教程",链滴优选
728,思源大纲笔记模式的性能测试 - 链滴,Sat Aug 05 2023 18:42:14 GMT+0000 (Coordinated Universal Time),"
                    <ul>
<li>简单节点
<ul>
<li>节点示例</li>
<li>
<pre><code class=""highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">* 111111111111111111111111111111111111111111
</span></span></code></pre>
</li>
<li>单节点 400 个子节点不会卡顿。（简单节点）</li>
<li>每个节点 200 个子节点、总共 20000 个节点，在使用折叠和聚焦的情况下不会卡顿</li>
</ul>
</li>
<li>复杂数学节点
<ul>
<li>节点示例</li>
<li>
<div class=""language-math"">\\begin{aligned}\\lim_{x\\to0}\\frac{1-\\cos(x)}{x}&amp;=\\lim_{x\\to0}\\frac{1-\\cos(x)}{x}\\times\\frac{1+\\cos(x)}{1+\\cos(x)}.\\\\&amp;=\\lim_{x\\to0}\\frac{1-\\cos^2(x)}{x}\\times\\frac{1}{1+\\cos(x)}=\\lim_{x\\to0}\\frac{\\sin^2(x)}{x}\\times\\frac{1}{1+\\cos(x)}.\\end{aligned}</div>
</li>
<li>单节点 13 个复杂数学节点不会卡顿。（logseq 为 52 个）</li>
<li>每个节点 13 个复杂数学节点、总共 117 个复杂数学节点，在使用折叠和聚焦的情况下不会卡顿（logseq 折叠不会渲染，近乎等同于纯文本节点）</li>
</ul>
</li>
<li>结论：思源在只包含纯文本节点、也就是无需渲染的节点的情况下表现良好，完全可以替代大纲笔记。但是如果使用了复杂的、需要渲染的节点，如数学块，那么性能急剧下降，无法与真正的大纲笔记竞争。</li>
</ul>
                

作者：zxhd86
链接：https://ld246.com/article/1691232134520
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
710,在 2.9.5 版本更新后，主题悬浮提示条出现异常的看这里 - 链滴,Sun Jul 09 2023 22:45:39 GMT+0000 (Coordinated Universal Time),"
                    <p>根据 dev 版本来看，思源 2.9.5 版本更新后 css 变量发生变化，几乎所有主题的悬浮提示条都会出现异常。</p>
<p><img src=""https://b3logfile.com/file/2023/07/f3f807c534c0dd8c80b77b1e9a312e8f-jfcmY6Q.jpeg?imageView2/2/interlace/1/format/webp"">  <img src=""https://b3logfile.com/file/2023/07/image-4TKLv8q.png?imageView2/2/interlace/1/format/webp"">  <img src=""https://b3logfile.com/file/2023/07/image-MtJ71DC.png?imageView2/2/interlace/1/format/webp""></p>
<p>目前来看，只有等主题上线并修复这些兼容性问题。不过如果主题不做版本隔离的话，那么低版本的思源误更新了主题后可能反而也会出现不兼容问题。</p>
<p>对于出现不兼容问题的用户，可以使用以下的代码片段来暂时过渡：</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">after</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__s</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__se</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__sw</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-bottom-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__n</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__ne</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span><span class=""highlight-o"">,</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__nw</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-top-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__e</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-right-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-tooltips__w</span><span class=""highlight-p"">::</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-left-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">#</span><span class=""highlight-nn"">tooltip</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   <span class=""highlight-k"">color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-kc"">on</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/07/image-ccXTuHA.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>这只是一个替代方案，等你常用的主题更新适配后记得关闭这个代码片段哦</p>
</blockquote>
                

作者：Frostime
链接：https://ld246.com/article/1688913940387
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
729,聚焦式文档树 - 链滴,Sun Jul 09 2023 11:26:05 GMT+0000 (Coordinated Universal Time),"
                    <p><img src=""https://b3logfile.com/file/2023/07/QQ图片20230709112506-PV4sWLU.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/07/QQ图片20230709112456-LLvPPsm.png?imageView2/2/interlace/1/format/webp""></p>
<p>文档树变一下显示效果，不会有任何性能的提升</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 隐藏非聚焦的文档树 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(+</span><span class=""highlight-nt"">ul</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*显示聚焦的直接子文档*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">+</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">&gt;</span><span class=""highlight-nt"">li</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">flex</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 显示聚焦本身 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">flex</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 显示聚焦但不打开的同级文档 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(~</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(~</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">+</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">flex</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">li</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(+</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">))~</span><span class=""highlight-nt"">li</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">flex</span><span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*显示聚焦块下方的提示条*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">+</span><span class=""highlight-nt"">ul</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">content</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">100</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/*显示聚焦但不打开上方的提示条*/</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">ul</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(&gt;</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">)</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">(</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(&gt;</span><span class=""highlight-nt"">li</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">b3-list-item--focus</span><span class=""highlight-o"">+</span><span class=""highlight-nt"">ul</span><span class=""highlight-o"">))</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">content</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">background</span><span class=""highlight-o"">-</span><span class=""highlight-n"">light</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">width</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">100</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">top</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">2</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c"">/* 极大缩小缩进 */</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">file-tree</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">ul</span> <span class=""highlight-nt"">ul</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">-1.2</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
                

作者：zxhd86
链接：https://ld246.com/article/1688873165983
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
680,转移引用功能使用详解 - 链滴,Fri Jun 30 2023 00:59:30 GMT+0000 (Coordinated Universal Time),"
                    <p>思源在 v2.7.3 版本<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F4025"">支持了转移引用</a>，本文将带您了解转移引用的使用场景和发展脉络。</p>
<h2 id=""什么是转移引用-"">什么是转移引用？</h2>
<ul>
<li>转移引用是将一个块的所有引用关系转移到目标块上（也就是转移反链），它是思源的特色功能，也是思源社区和开发者对 Roam 式双链的进一步发展。</li>
</ul>
<h2 id=""为什么要在思源里使用转移引用-"">为什么要在思源里使用转移引用？</h2>
<ul>
<li>转移引用是对前期输入时认知负荷的分担，能让你更轻松地进行输入，不用担心精确命名某些内容，即使在输入时你引用到错误的块上，也能在后期通过这个功能将引用关系合并。</li>
</ul>
<h2 id=""如何在思源中使用转移引用-"">如何在思源中使用转移引用？</h2>
<ol>
<li>在目标块的块菜单里复制块 ID</li>
<li>点击想要转移引用的内容块块菜单，选中 <code>转移引用</code>（这个内容块必须被引用才会有此选项）</li>
<li>粘贴目标块的块 ID 后点击确定进行转移</li>
</ol>
<p><img src=""https://b3logfile.com/siyuan/1601282840876/assets/转移引用1-20230322121228-9bca61s.gif""></p>
<h2 id=""转移引用在思源中的使用场景"">转移引用在思源中的使用场景</h2>
<h2 id=""防止反链丢失"">防止反链丢失</h2>
<ul>
<li>
<p>思源的块分容器块和叶子块，在重构笔记时，如果将内容块在容器块和叶子块之间转换会出现块 ID 变动的情况，这样就造成了引用关系的丢失，而转移引用可以解决这个问题，在转换块类型前将引用关系转移出去即可避免丢失反链，就可以大胆的记。FLY 老哥的评论：</p>
</li>
<li>
<blockquote>
<p><a href=""https://ld246.com/article/1659360717624/comment/1659366925041?r=dammy#comments#comments"">列表块段落块的困惑之一：对列表项块中的一段文本，不加区分段落块和列表块地引用，累积日久，会不会产生系统性风险？ - fangly&nbsp;的回帖</a></p>
<p>我靠自己规定的笔记规范来解决，我绝大多数文档内都是纯列表或者标题 + 列表，在引用时，只引用三种类型的块：文档块、标题块、列表项块。在笔记规范之下，这三种块是非常稳定的，引用这三种块，在重构笔记时，不会出现 id 变化的问题。剩下还有小部分文档是标题 + 段落块，这类文档一般是输出文章之类的，不适合使用大纲笔记那种方式编写，因此这种文档的块类型也非常稳定，不会出现问题。</p>
<ul>
<li>此外关于你的担忧，还可以考虑通过“反链转移”功能解决，参考我在这个 issue 中的回帖：<a href=""https://ld246.com/forward?goto=https%3A%2F%2Flink.ld246.com%2Fforward%3Fgoto%3Dhttps%253A%252F%252Fgithub.com%252Fsiyuan-note%252Fsiyuan%252Fissues%252F4025%2523issuecomment-1113005689"" target=""_blank"" rel=""nofollow ugc"">link</a>，目前思源还没有这个功能，其他双链软件也还没有，不过有的软件通过“合并文档”功能对文档块间接实现了这个功能，但对于更细粒度的块我目前还没看到有软件实现了的。如果引用关系因为块类型的转换而破坏了，只需要通过“反链转移”功能就能很快修复。</li>
<li>因此，通过笔记规范，基本规避了风险，如果不喜欢这种笔记规范，偶尔会有块类型转换的情况，那也不用担心，放心写，有“反链转移”功能来兜底，平时记笔记时大胆记、放心记，有了“反链转移”功能，风险是可控的。</li>
</ul>
</blockquote>
</li>
<li>
<p>思源的块引用锚文本分为动态锚文本和静态锚文本，当你设定为动态锚文本时，转移引用后锚文本会跟着目标块内容改变</p>
</li>
</ul>
<h2 id=""整理反链内容"">整理反链内容</h2>
<ul>
<li>
<p>当我们利用双链进行面对主题或者面对概念记录时，在后期会遇到整理反链的情况：</p>
<ul>
<li>需要将反链拆分，转移到更细粒度的主题上（多出现于理解产生了精进，大主题生长出了细致的小主题）</li>
<li>需要将多个主题的反链合并，转移到同一个主题上（多出现于写了多个相同语义的主题词，需要将反链进行合并）</li>
</ul>
</li>
</ul>
<h2 id=""插件强化-细粒度的转移引用"">插件强化：细粒度的转移引用</h2>
<p>思源本体的转移引用只能转移全部的引用关系， @<a href=""https://ld246.com/member/Frostime"" class=""tooltipped__user"" target=""_blank"">Frostime</a> 老铁的转移引用插件能自行选择需要的引用源去转移。</p>
<ul>
<li>
<p>如何使用？</p>
<ul>
<li>
<p>下载</p>
<ul>
<li>
<p>打开设置-集市-插件，找到转移引用，点击下载即可</p>
<ul>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/image-20230630003346-kod161o.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用</p>
<ol>
<li>点击文档块或者内容块的图标按钮，在插件图标中激活转移面板</li>
<li>在面板中，左侧列举了所有块的引用，右侧则是引用转移的目标块</li>
<li>点击表格中的复选框选择哪些引用需要被转移</li>
<li>填写目标块的 ID，或者选择下方的候选项（他们都是当前块所在文档的子文裆）</li>
<li>按下「转移到」按钮</li>
<li><img src=""https://b3logfile.com/siyuan/1601282840876/assets/net-img-preview-20230630002937-8qbues1.png?imageView2/2/interlace/1/format/webp""></li>
</ol>
</li>
</ul>
</li>
<li>
<p>PS：喜欢这个插件的老铁们可以去给作者点个赞，或者进行捐赠。</p>
</li>
</ul>
<h2 id=""转移引用的改进历史"">转移引用的改进历史</h2>
<h2 id=""-页面合并-是前期输入的兜底"">“页面合并”是前期输入的兜底</h2>
<ul>
<li>页面合并一直是个高频需求，在 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fdeerain%2Fgannbs%2Fffqk2e%23cbd1cf8b"" target=""_blank"" rel=""nofollow ugc"">双向链接时代的快速无压记录 </a>里 @<a href=""https://ld246.com/member/deerain"" class=""tooltipped__user"" target=""_blank"">deerain</a> 老师分析了双链笔记软件在使用上无压的技术原理，认为“页面合并”功能是为前期随意输入进行的兜底：只要有这个功能，就算前期输入时建立了多个类似的页面导致反链分流，也能在后期通过页面合并很方便地进行调整</li>
</ul>
<h2 id=""从-页面合并-到-转移引用-"">从“页面合并”到“转移引用”</h2>
<ul>
<li>
<p>@<a href=""https://ld246.com/member/fangly"" class=""tooltipped__user"" target=""_blank"">fangly</a> 老哥在<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F4025%3Futm_source%3Dld246.com%23issuecomment-1113005689"" target=""_blank"" rel=""nofollow ugc"">这条评论里</a>点破了“页面合并”的本质需求是“反链转移”，也就是“引用关系转移”。</p>
<ul>
<li>
<blockquote>
<p>写一点我关于这个功能的看法：</p>
<p>这个功能的核心并不是把两个文档的正文进行合并，因为这个完全可以手动完成，而且也不算麻烦，核心在于把一个文档块的反链转移到另一个文档块上，这个是在思源软件本体中目前做不到的，而且在思源的架构之下，完全不用局限在文档块，任何类型的块的反链都可以转移，因此我认为这个功能更准确的叫法应该是“<strong>反链转移</strong>”，可以在两个文档块之间转移，可以在文档块和非文档块之间转移，可以在两个非文档块之间转移，在思源里实现这个功能可以比 roam 更加灵活。</p>
<p>目前可以直接操作底层文件来实现这个功能，比如我想把块 A 的反链转移到块 B 上，只需全局搜索块 A 的 id，然后替换除了定义块 A 之外的搜索结果为块 B 的 id。但操作底层文件有风险，而且必须要关掉软件后操作，还要等待很长时间的从零开始的重建索引，因此需要思源软件本体给出这个功能。roam 里面实现合并文档时其实也是类似的做法，不过它们合并 page 时没有 id 的概念，直接全局替换[[page1]]为[[page2]]即可，和全局替换 id 是类似的。</p>
<p>我认为这个功能最终实现起来是这样的：首先用户给出两个块：块 A 与块 B，用户想要把块 A 的反链转移到块 B 上，然后软件自动将所有引用块 A 的地方改成引用块 B，最后，如果引用处是静态锚文本则锚文本不变，如果是动态锚文本则锚文本随之改变。</p>
<p>反链转移之后，如果识别到是文档块和文档块之间的转移，可以考虑再多一步，也就是把文档块 A 的正文移动到文档块 B 中，此时可以给出弹窗，例如“识别到是文档块之间的反链转移，是否要移动正文？”，如果用户点击确定，则转移，否则不转移。roam 里面必须转移其实是因为 roam 里面不能有同名文档，而思源里面可以存在同名文档，且思源里面还可以直接实现非同名文档之间的反链转移，没有必要一定要转移正文。</p>
<p>其实之前实现的标题块和文档块互转、列表项块转化为文档块，是“反链转移”功能的应用，可以视为“反链转移”对于特定场景下转移时的便捷交互形式。例如，我想把标题块“ABC”变成文档块《ABC》，我可以先创建文档块《ABC》，然后把标题块“ABC”下的内容移动到文档块《ABC》中，然后把标题块“ABC”的反链转移到文档块《ABC》中，之前实现的“标题块转文档块”是把上面这个步骤打包成一个拖拽动作（当然，本质上反链转移是改变引用块处的 id，而标题转文档改变的是定义块处的 id，但最终效果是一样的，毕竟 id 对用户来说是透明的）</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>他根据思源的架构提出了所有块都可以进行反链转移（PS：在思源里，所有块是平等的，但是文档块要比其他块更平等），认为标题块和文档块互转、列表项块转化为文档块在使用上是“反链转移”的一种便捷交互形式（<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F556"" target=""_blank"" rel=""nofollow ugc"">打通正文与文件树的壁障</a> 的最初目的也是为了解决组织内容时块 ID 失效的问题，提高内容块组织的灵活性）。</p>
</li>
<li>
<p>在 Roam 式双链里，引用关系是和上下文反链是灵魂，我们常说到<strong>引用关系实际上构成了“上下文语境”</strong>，它扩展了内容块的语义，一个内容块是什么、从哪里来、到哪里去、有什么用完全取决于内容块所在的语境和语义，而转移引用作为后期的一个兜底功能，能让您利用双链进行更好地思考。</p>
</li>
</ul>
                

作者：dammy
链接：https://ld246.com/article/1688057970884
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",dammy,思源笔记,链滴优选
730,css 改进的聚焦模式 - 链滴,Sun Jun 25 2023 18:00:08 GMT+0000 (Coordinated Universal Time),"
                    <p>通过 css 把聚焦的效果改了下：</p>
<p><img src=""https://b3logfile.com/file/2023/06/图片-wJr8bEE.png?imageView2/2/interlace/1/format/webp""></p>
<p>这是 css 代码：</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">has</span><span class=""highlight-o"">(+</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">]))</span><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span><span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">before</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-action</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg--attr</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-doc-type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'NodeDocument\'</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">nth-child</span><span class=""highlight-o"">(</span><span class=""highlight-nt"">2</span><span class=""highlight-o"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">font-size</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">1.75</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">font-weight</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">bold</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>不用太指望能像原生大纲笔记那样丝滑，这只是外观上的变动而已。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1687687209472
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
709,【新主题 - 紫夜】第一次做主题，来论坛里宣传一下 - 链滴,Thu Jun 22 2023 10:41:22 GMT+0000 (Coordinated Universal Time),"
                    <p>本人游手好闲，虽然做了好几个插件，但是还是第一次试着做主题，特此来宣传留念一下。</p>
<p>主题目前已经上架，中文名定为「紫夜」。</p>
<p><img src=""https://b3logfile.com/file/2023/06/image-NiDmByw.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：Frostime
链接：https://ld246.com/article/1687401682747
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
712,【思源新人指南】莫名其妙遇到锁定空间，提示「避免潜在的数据损坏」该怎么办 - 链滴,Sat May 20 2023 20:35:40 GMT+0000 (Coordinated Universal Time),"
                    <p>思源在若干个版本之前更新后，禁止了第三方同步盘的时候，目的是防止多个进程同时读写同样的文件目录，造成数据损坏。</p>
<blockquote>
<p>开发者根据接受到用户反馈出现的四个阶段：</p>
<ol>
<li>
<p>发现同步盘问题，尝试使用文件锁解决：“先说结论：第三方同步盘可能造成数据损坏，目前因为使用同步盘带来的数据损坏问题是无法彻底解决的” <a href=""https://ld246.com/article/1626537583158"">https://ld246.com/article/1626537583158</a></p>
</li>
<li>
<p>发现文件锁解决不了问题：“这个不是通过代码能解决的，而是操作系统本身就不支持两个不同的进程同时安全读写同一个文件。” 于是发公告不支持第三方网盘同步： <a href=""https://ld246.com/article/1664442401353"">https://ld246.com/article/1664442401353</a></p>
</li>
<li>
<p>开源云端服务同步，暂时免费开放端对端加密同步，数据同步支持第三方 S3 储存 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F6445"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/issues/6445</a></p>
</li>
<li>
<p>发现发了公告还是有用户使用同步盘丢数据，没办法就去做了限制 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsiyuan-note%2Fsiyuan%2Fissues%2F7683"" target=""_blank"" rel=""nofollow ugc"">https://github.com/siyuan-note/siyuan/issues/7683</a></p>
</li>
</ol>
</blockquote>
<blockquote>
<p>热知识 1：notion flowus 这类软件不会出现这种问题是因为他们是云笔记，根本不存在读写文件的问题。</p>
</blockquote>
<blockquote>
<p>热知识 2: obsidian logseq 这类软件同样有这个问题，但是他们不说</p>
<p><img src=""https://b3logfile.com/file/2023/10/image-XxRsRtv.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/10/image-qSp3rvc.png?imageView2/2/interlace/1/format/webp""></p>
</blockquote>
<p>但是读写文件往往不光光是同步盘的问题，有时候我们就算没有开启同步盘也可能出现这种让人心肺停止的问题：</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-hL4FAte.png?imageView2/2/interlace/1/format/webp""><img src=""https://b3logfile.com/file/2023/07/c80f0c11b57cbc4ca77d222ba3b01dcb-cdouVJ3.jpeg?imageView2/2/interlace/1/format/webp""></p>
<p>不要怕！这种情况下往往是有未知的进程在读写我们的思源数据。解决方法很简单：找到这个进程，把它关掉。</p>
<blockquote>
<p>热知识 2：其实不管是同步盘还是别的进程，他们造成思源文件系统读写错误的原因本质是一样的，都是这些的进程（程序）同时在和思源争抢数据文件的读写权限，造成了冲突。</p>
<p>同步盘会时时刻刻去监听麾下的文件系统，所以往往是导致思源文件系统冲突的罪魁祸首——但这<strong>并不代表着其他软件不会造成这种问题</strong>。只不过大部分软件不会闲着没事跑到你的数据目录下读写，既然他们都不会来淌这篇雷池，自然不会炸雷。</p>
<p>但是倘若就是有那么个别的进程闯了进来，嘿——那也确实有可能触发冲突的问题。</p>
</blockquote>
<blockquote>
<p>热知识 3：你可能会有些抱怨这种莫名其妙的设定。但是以前确实发生过别的同步盘进程和思源抢夺读写数据——最后<strong>导致用户数据损害</strong>的案例。这是 windows 设计的锅，没法避免。所以开发者只能采用这种比较保守的做法，一旦检测到有别的进程正在占用，就直接锁定发出警告，从而避免文件损害的可能。</p>
</blockquote>
<h2 id=""方法1-powertoy"">方法 1：powertoy</h2>
<ol>
<li>
<p>安装 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fwindows%2Fpowertoys%2F"" target=""_blank"" rel=""nofollow ugc"">powertoy</a> 软件，这是微软官方提供的一个 windows 工具软件</p>
</li>
<li>
<p>打开 powertoy，启用 File Locksmith</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-FpQKHyw.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>找到你工作目录的文件夹，右键点击「使用此文件的进程」</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-J30qjaz.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>原来是 utools 在使用我们的文件</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-QLDO31t.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p><strong>不建议直接点击「结束进程」</strong>，可能会存在意外的问题，最好是通过正常的方法关闭软件。</p>
<p>我正常关闭了 Utools 之后，现在只有一个文件管理器了，这回就没事了</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-hVEF5th.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<h2 id=""方法2-windows-资源管理器"">方法 2：windows 资源管理器</h2>
<p>如果你不想要下载一个额外的软件，还有一个更加原生的方案。</p>
<p>首先打开 windows 的资源管理器，然后打开「资源监视器」</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-geKg8zf.png?imageView2/2/interlace/1/format/webp""></p>
<p>点开之后，在 CPU 一页的下方，选择「搜索句柄」，并把<strong>疑似被工作空间的目录的路径填进去</strong></p>
<p><img src=""https://b3logfile.com/file/2023/05/image-2kKwK3H.png?imageView2/2/interlace/1/format/webp""></p>
<p>稍等片刻之后，就可以看到所有占用了这个目录的进程，找到那些不属于思源的进程，然后把对应的程序关掉。</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-fbjlfgb.png?imageView2/2/interlace/1/format/webp""></p>
<p>同样，<strong>非常不推荐直接在资源管理器里结束进程</strong>，更好的做法是</p>
<ol>
<li>记下进程对应的 PID</li>
<li>在资源管理器当中找到对应 PID 的程序，然后通过正常方式关掉</li>
</ol>
<p><img src=""https://b3logfile.com/file/2023/05/image-nZSOF7n.png?imageView2/2/interlace/1/format/webp""></p>
<p>注意，实测发现资源管理器有时候反而还不如 Powertoy 准确，如果你用方法 2 始终发现不了占用，但是思源一直提醒有文件读写 xowu，不妨使用方法 1 试一下。</p>
                

作者：Frostime
链接：https://ld246.com/article/1684586140917
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
731,思源 v2.8.8dev3 打开特定文档闪退 - 链滴,Mon May 15 2023 22:52:08 GMT+0000 (Coordinated Universal Time),"
                    <p>这是一个空文档，但是导入后可以复现闪退过程。</p>
<p><a href=""https://b3logfile.com/file/2023/05/comment-HeZ1ZQP.sy.zip"">comment.sy.zip</a></p>
                

作者：zxhd86
链接：https://ld246.com/article/1684162328867
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
738,配色插件发布！ - 链滴,Sun May 14 2023 20:03:37 GMT+0000 (Coordinated Universal Time),"
                    <h3 id=""开始"">开始</h3>
<p>这是一个思源字体的控制插件，它具有以下几个功能：</p>
<ul>
<li>随意更改思源中字体颜色</li>
<li>支持自定义显示的字体、大小、颜色和样式，你可以将自己喜欢的字体添加到思源中，享受更好的排版效果。</li>
<li>跨主题保持自定义的字体显示效果。</li>
<li>适配日夜模式切换，允许你在两种模式下拥有不同的配色方案。</li>
<li>能改变图片导出效果，经过一定操作能改变 pdf、html 导出效果。</li>
<li>导出、导入配色方案，在社区中分享配色方案</li>
</ul>
<h3 id=""功能介绍"">功能介绍</h3>
<h4 id=""更改思源中字体颜色"">更改思源中字体颜色</h4>
<p>​​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514181005-fx2s53e.png?imageView2/2/interlace/1/format/webp"">​​</p>
<p>打开字体的选择界面，选择你希望修改的字体，右键点击，可以见到出现了如下所示的菜单。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514180703-qc0vdsc.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>左边是调色块，右边是字体预览。点击左边的调色块进入调色模式：</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514180830-hzdwkxv.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>选中喜欢的颜色后点击 save，就能保存字体颜色。</p>
<h4 id=""自定义显示的字体-大小-颜色和样式"">自定义显示的字体、大小、颜色和样式</h4>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514181005-fx2s53e.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>打开字体的选择界面，选择你希望修改的字体，右键点击，可以见到出现了如下所示的菜单。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514180703-qc0vdsc.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>左边是调色块，右边是字体预览。点击左边的字体预览进入高级模式：</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514181129-3x4swfu.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>这是一个 css 语法的控制界面，你可以随意使用 css 语法来控制字体效果。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514181612-ik8ces8.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>编写完成后，点击 <strong>测试 ​</strong>可以在字体预览中查看字体设置的效果，此时字体的显示效果仅局限于预览中，不会改变思源正文中的显示。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514181722-df4igr7.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>测试效果满意后，就可以点击 <strong>保存 ​</strong>可以将字体的设置保存下来，并正式应用到思源中。</p>
<h4 id=""跨主题"">跨主题</h4>
<p>自定义后的字体在不同主题会保存相同显示，未自定义的字体则与主题设置一致。</p>
<h4 id=""日夜模式切换"">日夜模式切换</h4>
<p>插件设置的字体只会应用到当前模式下，这允许你在日夜两种模式下使用不同的字体。</p>
<h4 id=""改变导出效果"">改变导出效果</h4>
<p>不需要特意操作，就可以改变图片的导出效果</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514182310-a26jns7.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514182130-hogcnnh.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>但是对于 pdf 和 html 的导出，由于思源的限制，需要进行进一步操作才能导出字体效果。</p>
<p>首先，在思源的右上方找到插件的图标，点击，出现插件的菜单。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514182708-xi1xbrz.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>选中 <strong>导出当前 CSS</strong>，就会生成一个 CSS 文件，并在通知中告知导出位置。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514182817-p8n1wkw.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>在相应的位置找到 css，将内容复制到当前使用的主题的 theme.css 的末尾，就能把字体样式导出到 pdf 和 html 中了。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514183023-chdpyf6.png?imageView2/2/interlace/1/format/webp"">​</p>
<h4 id=""导出-导入配色方案"">导出、导入配色方案</h4>
<p>首先，在思源的右上方找到插件的图标，点击，出现插件的菜单。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514182708-xi1xbrz.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>选中 <strong>导出配色方案</strong>，就会生成一个 json 文件，并在通知中告知导出位置。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514183223-yn0ogt2.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>你可以把这个配色方案保存起来，或分享到社区，分享前，记得修改 json 文件中的 name。</p>
<p>选中<strong>打开设置</strong>，你就能进入到插件的设置界面。</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514190041-11mwf5i.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>使用上传配色方案上传的配色方案会出现在上方的选择框中，你可以自由选择。</p>
<p><strong>注意</strong>：选中配色方案后会清除当前的自定义配色方案，请务必记得保存！</p>
<h4 id=""恢复默认"">恢复默认</h4>
<p>你可以在菜单的<strong>恢复系统默认</strong>和设置界面中选中<strong>系统默认</strong>配色方案来恢复主题的配色方案。</p>
<h3 id=""感谢名单"">感谢名单</h3>
<ul>
<li><a href=""https://ld246.com/article/1682000853320"">思源笔记 自定义 可在多个主题间适用的 行内字色及底色 - 链滴</a></li>
<li><a href=""https://ld246.com/article/1682283088286"">思源笔记折腾记录 -html 块 - 主题 css 颜色选择器 - 链滴</a></li>
<li><a href=""https://ld246.com/member/zuoez02"">zuoez02</a> 的框架。</li>
<li>在这份 readme 中附带了一份配色方案，来自于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fchenshinshi%2FPinkX-room"" target=""_blank"" rel=""nofollow ugc"">PinkX-room </a>，万分感谢 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fchenshinshi"" target=""_blank"" rel=""nofollow ugc"">chenshinshi</a> 的分享。</li>
</ul>
<p>效果和 json 见下：</p>
<p>​<img src=""https://b3logfile.com/file/2023/05/siyuan/1654576506442/assets/image-20230514180451-n3e68ru.png?imageView2/2/interlace/1/format/webp"">​</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""export\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""light\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color1\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(255, 167, 172, 0.6)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(254, 207, 209)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(254, 207, 209)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(254, 207, 209)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(254, 207, 209)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""4px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""4px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color2\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""text-decoration-line\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""underline\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""text-decoration-thickness\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""text-decoration-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""wavy\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""text-decoration-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color3\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""font-family\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""\\\""Times New Roman\\\""\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color4\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""font-size\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""110%\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""font-family\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""楷体\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color5\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""font-family\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""Aa漫语手写体（简繁）\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color6\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""font-family\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""TH-Sung-TP2, TH-Sung-TP0\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color7\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-image\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""linear-gradient(104deg, rgba(255, 147, 166, 0) 0.9%, rgb(255, 147, 166) 2.4%, rgba(255, 147, 166, 0.5) 5.8%, rgba(255, 147, 166, 0.1) 93%, rgba(255, 147, 166, 0.7) 96%, rgba(255, 147, 166, 0) 98%), linear-gradient(183deg, rgba(255, 147, 166, 0) 0%, rgba(255, 147, 166, 0.3) 7.9%, rgba(255, 147, 166, 0) 15%)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.2em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.2em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""-webkit-box-decoration-break\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""clone\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""7.5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""7.5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""7.5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""7.5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""text-shadow\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(255, 147, 166, 0.7) -12px 12px 9.8px, rgb(255, 255, 255) 21px -18.1px 7.3px, rgb(255, 255, 255) -18.1px -27.3px 30px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-color8\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""3px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""dashed\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(235, 131, 131)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background7\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(255, 255, 255, 0)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-size\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""4px 3px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""box-shadow\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(0, 0, 0, 0.2) 15px 28px 25px -18px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""box-sizing\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""border-box\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inherit\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""cursor\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""pointer\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""display\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inline-block\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""transition-duration\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""235ms\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""transition-timing-function\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""ease-in-out\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""transition-delay\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0s\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""transition-property\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""all\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""15px 255px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""225px 15px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""255px 15px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""15px 225px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background6\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(255, 255, 255, 0)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-image-source\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-image-slice\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-image-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-image-outset\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-image-repeat\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""30px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""30px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""30px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""30px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""box-shadow\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""3px 3px 0px 0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""cursor\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""pointer\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""display\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inline-block\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background5\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(239, 222, 222)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(239, 222, 222)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(239, 222, 222)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(239, 222, 222)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background4\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""3px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""3px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""margin-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""6px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""6px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""6px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""box-shadow\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(182, 149, 151, 0.25) 0px 14px 28px, rgba(182, 149, 151, 0.22) 0px 10px 10px, rgba(182, 149, 151, 0.6) 1px 2px 2px 1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""font-size\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""90%\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-image\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-position-x\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-position-y\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-size\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-repeat-x\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-repeat-y\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-attachment\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-origin\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-clip\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""initial\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgba(228, 171, 175, 0.75)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background3\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(150, 0, 100)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(150, 0, 100)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(150, 0, 100)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(150, 0, 100)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(253, 238, 214)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background2\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-top\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-right\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-bottom\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""padding-left\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""0.3em\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inherit\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inherit\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inherit\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""inherit\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""2px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""dashed\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""dashed\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""dashed\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""dashed\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-nt"">\""font-background1\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-right-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-left-radius\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""5px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(237, 217, 210)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(237, 217, 210)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(237, 217, 210)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(237, 217, 210)\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-width\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""1px\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-top-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-right-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-bottom-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""border-left-style\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""solid\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">			<span class=""highlight-nt"">\""background-color\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""rgb(253, 213, 231)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">		<span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">	<span class=""highlight-nt"">\""dark\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
                

作者：zxhd86
链接：https://ld246.com/article/1684065818123
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
711,请问如何按照 DOM 中的顺序拿到一个标题块的子块？ - 链滴,Sat May 13 2023 17:43:43 GMT+0000 (Coordinated Universal Time),"
                    <p>@<a href=""https://ld246.com/member/88250"" class=""tooltipped__user"" target=""_blank"">88250</a> @<a href=""https://ld246.com/member/Vanessa"" class=""tooltipped__user"" target=""_blank"">Vanessa</a></p>
<p>背景：插件开发，使用后端提供的 API 接口。</p>
<h2 id=""问题描述"">问题描述</h2>
<blockquote>
<p>我现在正在迁移之前开发的插件，然后发现了插件中之前没发现的一个 bug。</p>
</blockquote>
<p>我在代码中<strong>需要按照顺序 DOM 的顺序获取一个标题块下的子块</strong>。</p>
<p>经过探索，我发现虽然一个标题块不是容器块，但是标题下的直接子块的 <code>parent_id</code> 是等于这个标题块的 <code>id</code> 的，所以用来查询的代码很自然就写成这样的：</p>
<pre><code class=""language-ts highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">queryChildren</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">parentId</span>: <span class=""highlight-kt"">string</span><span class=""highlight-p"">)</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">Promise</span><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">Array</span><span class=""highlight-err"">&lt;</span><span class=""highlight-na"">Block</span><span class=""highlight-p"">&gt;</span><span class=""highlight-o"">&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">sql</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`select * from blocks where parent_id = \'</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">parentId</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">\'`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">result</span>: <span class=""highlight-kt"">Array</span><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">Block</span><span class=""highlight-p"">&gt;</span> <span class=""highlight-o"">=</span> <span class=""highlight-k"">await</span> <span class=""highlight-nx"">serverApi</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">sql</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">sql</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-nx"">result</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span></code></pre>
<p>也就是根据 <code>parent_id</code> 直接执行一个 SQL 语句。我之前一致以为这个语句可以保证 blocks 按照 DOM 中的顺序排列，但是今天才他<strong>偶尔</strong>会不按照我期望的顺序来。（这个偶尔就很神奇，不稳定触发）</p>
<h2 id=""实验"">实验</h2>
<p>以下面一个实验为例，现在我需要按照顺序获取 <code># 测试</code> 大标题下的子块。</p>
<p><img src=""https://b3logfile.com/file/2023/05/image-ZOTFFUV.png?imageView2/2/interlace/1/format/webp""></p>
<p>然而实际查询到的顺序是不一样的。可以看到</p>
<ul>
<li>查询到的 0：<code>测试一</code> 实际是排在第二位的子块</li>
<li>查询到的 1: <code>测试二</code> 实际是排在第三位的子块</li>
<li>查询到的 2: <code>一 二</code> 实际是排在第一位的子块</li>
</ul>
<p><img src=""https://b3logfile.com/file/2023/05/image-mk4AeKI.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""总结"">总结</h2>
<ul>
<li>我<strong>需要按照顺序 DOM 的顺序获取一个标题块下的直接子块</strong></li>
<li>前端的 DOM 标题块没有层级关系，所以我只能使用后端 API</li>
<li>但是后端 SQL 查询无法保证维持和 DOM 一致的顺序</li>
</ul>
<p>所以要怎么解决这个问题呢？</p>
<p>有问题的源代码如下：</p>
<p></p>
                

作者：Frostime
链接：https://ld246.com/article/1683971024988
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,"Q&amp;A,思源笔记",链滴优选
682,思源编辑指南—①编辑元素篇 - 链滴,Sat May 13 2023 00:16:46 GMT+0000 (Coordinated Universal Time),"
                    <p>很多人都说思源笔记和 Obsidian 很像，其实除了界面都是以 IDE 风格为主以外，两款软件的内核可以说天差地别。思源是支持块编辑的笔记软件，在思源中，唯一重要的核心概念是内容块。思源内置了 20+ 种类型的块元素和 10+ 种行级元素且同时兼容标准的 Markdown 语法。通过排版格式即可形成内容块，这样我们就能在块级粒度上对思绪和知识进行整理，同时也能方便长文阅读和输出。下面编辑指南-基础篇将着重讲解一下行级元素和普通内容块在思源里的编辑方式，希望在阅读后能给大家的快速写作带来一定的便捷。</p>
<p><strong>本文基于官方帮助指南-编辑器-排版元素文档改写而来。</strong> 想在思源笔记内查看可直接导入.sy 源文件。</p>
<p><a href=""https://b3logfile.com/file/2023/05/思源编辑指南__编辑元素篇_思源内_-QUkyDOJ.sy.zip"">思源编辑指南编辑元素篇思源内.sy.zip</a></p>
<h2 id=""行级元素"">行级元素</h2>
<p>行级元素，简单理解就是我们每一段的内容本身能操作的元素，比如加粗、斜体等等，对应在思源中，就是我们选中文字后显现的工具栏能调整的部分。工具栏图标对应的意思如下：</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230511001959-rjhiejx.png?imageView2/2/interlace/1/format/webp""></p>
<p>如果不喜欢默认的图标包，可以在<strong>集市-图标</strong>中下载其他用户上传的图标:</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230511002326-v7fyy2d.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""使用方法及效果"">使用方法及效果</h3>
<p>行内元素一共有 3 种方法可以生成：</p>
<ol>
<li>选中文字后工具栏点击对应按钮；</li>
<li>按下对应按钮快捷键后再录入；</li>
<li>使用 Markdown 标记或快捷语法录入。</li>
</ol>
<p><strong>元素大全速记：</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>效果</th>
<th>快捷键</th>
<th>快捷语法</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>emoji 表情</td>
<td>?</td>
<td><kbd>:</kbd></td>
<td><kbd>Win+.</kbd></td>
<td>快捷语法需要 Win11</td>
</tr>
<tr>
<td>引用块</td>
<td>请从这里开始</td>
<td><kbd>Alt+[</kbd> / <kbd>⌥[</kbd></td>
<td><kbd>[[</kbd>或 <kbd>((</kbd></td>
<td>需选中内容</td>
</tr>
<tr>
<td>链接</td>
<td><a href=""https://ld246.com"">超级链接</a></td>
<td><kbd>Ctrl+K</kbd> / <kbd>⌘K</kbd></td>
<td><kbd>[网址名称](网址链接，带 http 或 https)</kbd></td>
<td>edge 浏览器复制过来直接是链接</td>
</tr>
<tr>
<td>字体及背景颜色</td>
<td><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230512230443-611z8i1.png?imageView2/2/interlace/1/format/webp""><br></td>
<td><kbd>Ctrl+Alt+X</kbd> / <kbd>⌥⌘X</kbd></td>
<td></td>
<td>不同主题的配色可能不同</td>
</tr>
<tr>
<td>粗体</td>
<td><strong>粗体</strong></td>
<td><kbd>Ctrl+B</kbd> / <kbd>⌘B</kbd></td>
<td><kbd>**文字**</kbd><br></td>
<td>如果只想打**需要在前面打转义符号\\</td>
</tr>
<tr>
<td>斜体</td>
<td><em>斜体</em></td>
<td><kbd>Ctrl+I</kbd> / <kbd>⌘I</kbd></td>
<td><kbd>*文字*</kbd></td>
<td>同上</td>
</tr>
<tr>
<td>下划线</td>
<td><u>下划线</u></td>
<td><kbd>Ctrl+U</kbd> / <kbd>⌘U</kbd></td>
<td></td>
<td></td>
</tr>
<tr>
<td>删除线</td>
<td><del>删除线</del></td>
<td><kbd>Ctrl+Shift+S</kbd> / <kbd>⇧⌘S</kbd></td>
<td><kbd>~~文字~~</kbd></td>
<td>左右两个波浪号</td>
</tr>
<tr>
<td>标记</td>
<td>==标记==</td>
<td><kbd>Alt+E</kbd> / <kbd>⌥E</kbd></td>
<td><kbd>==文字==</kbd></td>
<td>左右各两个等号，也有人叫高亮</td>
</tr>
<tr>
<td>标签</td>
<td>#标签#</td>
<td><kbd>Ctrl+T</kbd> / <kbd>⌘T</kbd></td>
<td><kbd>#文字#</kbd><br></td>
<td>如果只想打#， 在前面打转义符号\\</td>
</tr>
<tr>
<td>上标</td>
<td>^ 上标 ^</td>
<td><kbd>Ctrl+H</kbd> / <kbd>⌘H</kbd></td>
<td><kbd>^文字 ^</kbd><br></td>
<td>同上</td>
</tr>
<tr>
<td>下标</td>
<td><del>下标</del></td>
<td><kbd>Ctrl+J</kbd> / <kbd>⌘J</kbd></td>
<td><kbd>~文字~</kbd></td>
<td>同上</td>
</tr>
<tr>
<td>键盘</td>
<td><kbd>键盘</kbd><br></td>
<td><kbd>Ctrl+\'</kbd> / <kbd>⌘\'</kbd></td>
<td></td>
<td></td>
</tr>
<tr>
<td>行内代码</td>
<td><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230512000207-bypbfab.png?imageView2/2/interlace/1/format/webp""></td>
<td><kbd>Ctrl+G</kbd>/<kbd>⌘G</kbd></td>
<td></td>
<td></td>
</tr>
<tr>
<td>行级数学公式</td>
<td><span class=""language-math"">a^2 + b^2 = \\color{red}c^2</span></td>
<td><kbd>Ctrl+M</kbd> / <kbd>⌘M</kbd></td>
<td><kbd>$文字 $</kbd></td>
<td>同上</td>
</tr>
<tr>
<td>备注</td>
<td>备注 ^（备注）^</td>
<td><kbd>Ctrl+Alt+M</kbd><br></td>
<td></td>
<td></td>
</tr>
<tr>
<td>分割线</td>
<td><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230511235919-5k727ke.png?imageView2/2/interlace/1/format/webp""><br></td>
<td><kbd>---</kbd></td>
<td><kbd>---</kbd></td>
<td></td>
</tr>
<tr>
<td>引述块</td>
<td><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230511235935-8hckyus.png?imageView2/2/interlace/1/format/webp""></td>
<td><kbd>&gt;</kbd></td>
<td><kbd>&gt;</kbd></td>
<td></td>
</tr>
<tr>
<td>图片</td>
<td><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/siyuan-128-20210604092205-djd749a.png?imageView2/2/interlace/1/format/webp""></td>
<td></td>
<td></td>
<td>可通过复制粘贴或拖拽来上传图片；上传后的图片可通过拖拽进行大小调整。</td>
</tr>
</tbody>
</table>
<h2 id=""内容块"">内容块</h2>
<p>思源里最重要的内容块是什么？根据官方定义：</p>
<blockquote>
<p>“#内容块#”指的是一块内容，每块这样的内容通过一个全局唯一的 ID 进行标识。ID 是程序自动生成的，形如： <code>202008250000-a1b2c3d</code>，由时间和 7 位随机字符组成。</p>
</blockquote>
<p>最常见的内容块就是我们所熟悉的段落（Paragraph）。在中文传统排版中，段落通常是通过段首缩进（空两格）来表示，互联网的发展逐渐影响了段落的表示，现在使用较多的方式是增加段落之间的行距，或者使用空行来分隔段落。</p>
<p>实际使用时，仅仅靠段落排版是不够的，往往还需要用到标题（Heading）、列表（List）、表格（Table）、块引用（Blockquote）等来丰富我们的排版。这些排版样式除了视觉上的不同，更重要的是它们在一定程度上表达了内容的语义。比如在看到无序列表时，我们可以知道每个列表项是不分先后的平级关系，而在看到有序列表时则相反。</p>
<p>所以，内容块存在很多类型，不同的排版格式会形成不同的内容块。</p>
<h3 id=""内容块的类型"">内容块的类型</h3>
<p>通过鼠标悬浮在内容块上左侧可以知道该内容块对应的图标。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230512204700-ccy59ne.png?imageView2/2/interlace/1/format/webp""></p>
<p>图标对应的块名称如下：<strong>（标识会跟随图标包变化）</strong></p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001158-c42afz7.png?imageView2/2/interlace/1/format/webp""></p>
<p>内容块在逻辑上分为叶子块和容器块，叶子块不能包含其他块，比如你不能在表格中使用无序列表块，因为表格块是叶子块，容器块可以包含其他块：</p>
<ul>
<li>列表块：只能包含列表项块</li>
<li>列表项块：可以包含任意非文档块</li>
<li>引述块：可以包含任意非文档块</li>
<li>超级块：可以包含任意非文档块</li>
<li>文档块：可以包含任意非文档块</li>
</ul>
<p>不用去纠结某个块类型为什么是叶子为什么不是容器，也可能是技术原因，也可能是暂没时间优化，我们只需要记得它的概念以及使用方式即可。</p>
<p>‍</p>
<h3 id=""内容块的使用"">内容块的使用</h3>
<p>以下标识基于默认图标包 material，不同图标包会有略微区别，尤其是段落块。</p>
<p>‍</p>
<h4 id=""段落块"">段落块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001217-wly3033.png?imageView2/2/interlace/1/format/webp""></p>
<p>段落块是最基础的块，默认的空行也是一个段落块。</p>
<p>这里是一个示例段落，在一个段落后直接回车会形成新的段落。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>鼠标单击空白处就是创建一个段落块。</li>
<li>在其他列表块、标题块的块标点击转化为段落。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>按下 <kbd>Shift + Enter</kbd> 可以在段落块中换行，俗称软换行。按下 <kbd>Enter</kbd> 是正常的换行，会新建一个块。</li>
<li>别的地方复制过来的文字，如果想都在一个段落里，按 <kbd>Ctrl + Shift + V</kbd> 粘贴即可。如果复制过来不想在一个段落里，需要在复制前在合适的地方处理添加两个回车才行。</li>
</ul>
<p>‍</p>
<h4 id=""标题块"">标题块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001226-0eats05.png?imageView2/2/interlace/1/format/webp""></p>
<p>以上就是标题块，支持一级到六级。合理使用标题能创造可读性较好的大纲。</p>
<h5 id=""这是一个标题-5"">这是一个标题 5</h5>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择标题。或直接键入 <kbd>/1~6</kbd> 可直接创建一级到六级标题。</li>
<li>按下快捷键 <kbd>Ctrl + Alt +1~6</kbd> 直接创建一级到六级标题。</li>
<li>使用 Markdown 语法快速创建。键入 <kbd># + 空格</kbd> 可直接创建标题，<kbd>#</kbd> 的个数对应标题层级，如 <kbd>## 空格</kbd> 创建二级标题。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>使用快捷键 <kbd>Ctrl + Alt +1~6</kbd> 可以变更已有标题层级。</li>
<li>直接对标题添加 <kbd>#</kbd>，根据 <kbd>#</kbd> 的个数变更已有标题层级。</li>
<li>段落块点击块标可以直接转为标题。</li>
<li>把标题块拖到文档树中，可以直接转化为文档。同理，文档拖到编辑器中，可以转为标题块及子块。</li>
</ul>
<p>‍</p>
<h4 id=""数学公式块"">数学公式块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001236-c0drmhg.png?imageView2/2/interlace/1/format/webp""></p>
<p>思源支持 KaTeX 语法的数学公式，和 LaTeX 基本类似。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001245-3s8k7cd.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择公式块。或直接键入对应的拼音缩写 <kbd>/gs</kbd> 可直接过滤到公式块。</li>
<li>按下快捷键 <kbd>Ctrl + M</kbd> 直接创建一个行级公式（行级元素，上面示例是公式块，公式块没有快捷键）。</li>
<li>使用 Markdown 语法快速创建。键入两个 <kbd>$$</kbd> 可直接创建公式块。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>点击公式块出来的弹窗按钮可以直接导出公式图片。</li>
<li>可以在其他编辑器中编辑好后复制进思源 。</li>
</ul>
<p>‍</p>
<h4 id=""代码块"">代码块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001303-faqsjgu.png?imageView2/2/interlace/1/format/webp""></p>
<p>在页面中插入一块代码，支持不同的主题渲染。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001257-d650vk0.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择代码块。或直接键入对应的拼音缩写 <kbd>/dm</kbd> 可直接过滤到代码块。</li>
<li>按下快捷键 <kbd>Ctrl + G</kbd> 直接创建一个行级代码（行级元素，上面示例是代码块，代码块没有快捷键）。</li>
<li>使用 Markdown 语法快速创建。加上代码语言可以直接创建对应语言代码块，比如直接键入 <kbd>```sql + Enter</kbd> 创建 <kbd>Sql 语法高亮</kbd> 的代码块。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>代码块的菜单可以开启代码连字、代码行号等功能。（如果代码块过大，行号功能会影响性能）</li>
<li><strong>设置-编辑器-Tab 空格数</strong>可以控制代码块里 <kbd>Tab</kbd> 键的缩进格数 。</li>
<li><strong>设置-外观-代码块主题</strong>可以设置代码块的高亮颜色主题，使用的是 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fhighlightjs.org%2F"" target=""_blank"" rel=""nofollow ugc"">highlight.js (highlightjs.org)</a>，可以直接去它官网看对应的颜色，然后在思源里直接选择，因为在思源里查看比较麻烦。</li>
</ul>
<p>‍</p>
<h4 id=""表格块"">表格块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001310-rq3bv0y.png?imageView2/2/interlace/1/format/webp""></p>
<p>思源目前支持简单表格，比 Markdown 表格好点，支持合并单元格，但比不了富文本表格。</p>
<table>
<thead>
<tr>
<th>列一</th>
<th>列二</th>
</tr>
</thead>
<tbody>
<tr>
<td>行一列一</td>
<td>行一列二</td>
</tr>
<tr>
<td>行二列一</td>
<td>行二列二</td>
</tr>
</tbody>
</table>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择表格。或直接键入对应的拼音缩写 <kbd>/bg</kbd> 可直接过滤到表格块。</li>
<li>按下快捷键 <kbd>Ctrl + O（不是零）</kbd> 直接创建一个表格。</li>
<li>不支持使用 Markdown 语法创建表格。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>选中两个以上单元格可以合并单元格。</li>
<li>表格块是叶子块，不支持嵌套其他块，比如列表，只能手打 1. 2. 。</li>
<li><strong>直接复制外部有合并单元格的表格进思源的话，效果很差。</strong></li>
<li>表格中如需使用 <code>|</code> 请使用 <code>\\</code> 转义，即需要输入 <code>\\|</code>。</li>
</ul>
<p>‍</p>
<h4 id=""HTML-块"">HTML 块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001329-pv6fhrz.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001322-cnxyk4s.png?imageView2/2/interlace/1/format/webp""></p>
<p>#注意#：使用 HTML 块时不会对其中的代码进行安全过滤，请确认代码安全后再使用，以免遭遇跨站脚本攻击（XSS）。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择 HTML 块。或直接键入对应的拼音缩写 <kbd>/ht</kbd> 可直接过滤到 HTML 块。</li>
<li>输入 <kbd>&lt;div&gt;</kbd> 可直接新建一个 HTML 块。</li>
</ul>
<p><strong>小技巧：</strong></p>
<p>在页面中加入这个分页代码，可以在导出 HTML 时打印时自主控制分页位置。</p>
<pre><code class=""language-html highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">/* 自定义打印分页 */
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">div</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""page-break-after: always; \""</span><span class=""highlight-p"">&gt;</span> <span class=""highlight-p"">&lt;/</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">&gt;</span>
</span></span></code></pre>
<p>‍</p>
<h4 id=""无序列表块"">无序列表块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001337-legsha5.png?imageView2/2/interlace/1/format/webp""></p>
<ul>
<li>列表项一</li>
<li>列表项二</li>
</ul>
<p>无序列表块是一种容器块，它嵌套列表项块。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择无序列表。或直接键入对应的拼音缩写 <kbd>/wx</kbd> 可直接过滤到无序列表块。</li>
<li>键入 <kbd>* + 空格</kbd> 或 <kbd>- + 空格</kbd> 都可以直接生成无序列表块。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>按 <kbd>Tab</kbd> 缩进层级，<kbd>Shift + Tab</kbd> 反向缩进层级。<strong>设置-编辑器-列表大纲缩进</strong>可以设置反向缩进的结果位置。</li>
<li>按两下 <kbd>Enter</kbd> 可以退出列表。如果需要在列表项中进行换行，请使用 <kbd>Shift Enter</kbd>。</li>
<li>无序列表可以转为有序列表或任务列表、段落。</li>
</ul>
<p>‍</p>
<h4 id=""有序列表块"">有序列表块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001342-fvahv7j.png?imageView2/2/interlace/1/format/webp""></p>
<ol>
<li>列表项一</li>
<li>列表项二</li>
</ol>
<p>有序列表块是一种容器块。和无序列表一致。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择有序列表。或直接键入对应的拼音缩写 <kbd>/yx</kbd> 可直接过滤到无序列表块。</li>
<li>键入 <kbd>1. + 空格</kbd> 生成无序列表块。想从几开始就输入几。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>按 <kbd>Tab</kbd> 缩进层级，<kbd>Shift + Tab</kbd> 反向缩进层级。<strong>设置-编辑器-列表大纲缩进</strong>可以设置反向缩进的结果位置。</li>
<li>按两下 <kbd>Enter</kbd> 可以退出列表。如果需要在列表项中进行换行，请使用 <kbd>Shift Enter</kbd>。</li>
<li>有序列表可以转为无序列表或任务列表、段落。</li>
</ul>
<p>‍</p>
<h4 id=""任务列表块"">任务列表块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001346-tdyu7ah.png?imageView2/2/interlace/1/format/webp""></p>
<ul>
<li class=""vditor-task vditor-task--done"">  待办一</li>
<li class=""vditor-task"">  待办二</li>
</ul>
<p>任务列表块是一种容器块。也可以嵌套其他块，也可以缩进反应层级。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择任务列表。或直接键入对应的拼音缩写 <kbd>/rw</kbd> 可直接过滤到任务列表块。</li>
<li>键入 <kbd>[]</kbd> 半角或 <kbd>【】</kbd> 全角 生成任务列表块。中间如果直接加个<kbd>x</kbd>那就是已完成状态。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>按 <kbd>Tab</kbd> 缩进层级，<kbd>Shift + Tab</kbd> 反向缩进层级。</li>
<li>按两下 <kbd>Enter</kbd> 可以退出列表。如果需要在列表项中进行换行，请使用 <kbd>Shift Enter</kbd>。</li>
<li>任务列表可以转为无序列表、有序列表或段落。</li>
</ul>
<p>‍</p>
<h4 id=""列表项块"">列表项块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001351-gprthqa.png?imageView2/2/interlace/1/format/webp""></p>
<p>列表项块是一种容器块，它可以嵌套例如标题、代码块等其他块，通常它的形式和市面上其他大纲笔记一致，可以实现大纲式笔记的基本用法。</p>
<p>‍</p>
<h4 id=""引述块"">引述块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001357-y5blg95.png?imageView2/2/interlace/1/format/webp""></p>
<blockquote>
<p>注意不是内容块引用，而是引述块（Blockquote）。</p>
</blockquote>
<p>引述块可以理解为其他笔记的引用，引用别人的话的引用，是一种容器块，可以在里面打列表。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>按下 <kbd>/</kbd> 打开斜杆菜单，选择引述。或直接键入对应的拼音缩写 <kbd>/ys</kbd> 可直接过滤到引述块。</li>
<li>键入 <kbd>&gt;</kbd> 生成引述。</li>
</ul>
<p>‍</p>
<h4 id=""超级块"">超级块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001401-9rgs5i2.png?imageView2/2/interlace/1/format/webp""></p>
<p>超级块是一种容器块。可用于组合文档内连续的内容块，也用于支持横向排版。</p>
<p><strong>创建方法：</strong></p>
<ul>
<li>选中两个相邻的块后按鼠标右键可以操作超级块菜单，转化为横向或纵向的超级块。</li>
<li>非相邻的块可以直接拖动到对应块上下左右生成超级块。</li>
</ul>
<p><strong>小技巧：</strong></p>
<ul>
<li>单独点击组成超级块的原始块块标图标，选择宽度可以调节单个块的宽度，从而更好排版。</li>
<li>可使用超级块进行闪卡制作，当存在垂直超级块时，第一个块为问题，第二个为答案。</li>
</ul>
<p>‍</p>
<h4 id=""文档块"">文档块</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230513001410-zicyhvx.png?imageView2/2/interlace/1/format/webp""></p>
<p>整个文档是一个块，文档块是一种容器块。</p>
<p>直接拖动文档块到编辑器可以转化为标题块。</p>
<p>‍</p>
<p>‍</p>
                

作者：mozhu
链接：https://ld246.com/article/1683908207160
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",mozhu,思源笔记,链滴优选
685,思源笔记同步指南 ( 更新 2.10.5 版本适用） - 链滴,Sun May 07 2023 01:47:47 GMT+0000 (Coordinated Universal Time),"
                    <p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/思源笔记萌新上手指南_011-20230503141355-isfk8dd.png?imageView2/2/interlace/1/format/webp""></p>
<p>思源笔记是一款本地优先的个人知识管理系统，支持完全离线使用，充分保障了数据隐私，但这也意味着自己是数据的第一责任人，如果本地存储介质发生风险，数据丢失、损坏将不可避免。好在思源笔记同时也支持端到端加密同步，在保证隐私的同时兼顾了同步备份，为我们的数据安全多了一份保障。</p>
<p>思源笔记的加密同步自上线来并非一帆风顺，作为一个 21 年秋接触的用户，早期论坛上充斥着同步丢失、损坏、难用的贴子，有些甚至会骂的很过分。虽然我本人因为使用环境比较单一，主要是台式和笔记本的同步，未曾遇到上述问题，但在其他用户那就是不好的体验。好在两位开发者一直在听取用户意见，不断优化着数据同步的体验，甚至直接开放了唯一收费的第三方同步配置，目前出现同步问题的可能性已非常低。</p>
<p>在思源笔记 v2.8.6 版本，开发者上线了一个重要功能，即按需下载云端快照。**支持按需下载云端数据快照是一个非常重要的改进，它可以让用户下载任何设备、任何时间点的云端数据快照，为数据安全提供了更多保障。**在以前，数据快照除非自己标记，否则只存在本机中，在 2.8.6 版本后，每次的同步快照会存为云端快照并标记上设备名称，但本机数据发生问题，可按需恢复其他设备的快照保障数据安全。至此可以说，在思源笔记里，出现数据丢失的可能性已经非常低，更多的是不在预期中的数据同步冲突问题，而这个问题通过了解同步原理，良好的使用习惯可以有效规避。</p>
<p>‍</p>
<h2 id=""一-同步前要了解的内容"">一、同步前要了解的内容</h2>
<h3 id=""1-1-同步的内容"">1.1 同步的内容</h3>
<p>首先，需要明确思源笔记的同步是指的在多个设备上保持 <code>工作空间/data/</code> 文件夹数据一致，包括资源文件、模板、挂件以及笔记本数据，不包括主题、图标、设置快捷键等。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503155504-qsz1ptm.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503155136-644xfn9.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""1-2-同步的原理"">1.2 同步的原理</h3>
<p>其次，需要了解一下同步原理。作为本地优先的笔记软件，和云端优先的还是不太一样，根据官方的介绍，思源的同步原理如下：</p>
<p>思源通过对比云端数据快照和本地数据快照进行相应操作：</p>
<ul>
<li>
<p>如果快照相同则忽略本次同步</p>
</li>
<li>
<p>如果快照不同，则将本地距离上次同步的变更上传到云端，将云端最新的变更合并到本地</p>
<ul>
<li>如果两端的变更没有冲突则直接合并</li>
<li>如果存在文件冲突，则以本地为准覆盖云端，同时拉取到的云端冲突文件会归入到数据历史中</li>
</ul>
</li>
</ul>
<p>自动同步时间间隔算法描述如下：</p>
<ul>
<li>数据变动后 30 秒如果不再发生变动则进行一次对比，如果继续发生变动则顺延 30 秒</li>
<li>没有数据变动则按 5 分钟、8 分钟、16 分钟、32 分钟……递增间隔</li>
</ul>
<p>如果需要在创建快照时忽略一些文件，请在文件系统上创建或编辑文本文件工作空间/data/.siyuan/syncignore， 其中每一行使用 data 文件夹的相对路径进行配置，表示忽略文件或文件夹的路径，支持通配符。例如：</p>
<ul>
<li>20210808180117-6v0mkxr/**/*： 忽略 data/20210808180117-6v0mkxr 笔记本</li>
<li>assets/*.pdf：忽略 data/assets/ 下的 PDF 文件</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><strong>符号链接和隐藏文件不会被快照</strong></li>
<li><strong>如果忽略文件里设置了某个笔记本或笔记，那笔记本或笔记也不会生成数据快照。</strong></li>
</ul>
<p>如果不能理解，那只需要记住，<strong>思源笔记的同步是交替的，不能多个设备同时进行</strong>。用我常用的场景举例：</p>
<ol>
<li>在公司笔记本上编辑后执行同步（通过自动或者手动触发同步），此时云端数据会被笔记本数据覆盖，生成一个云端数据快照，既云端和笔记本保持数据一致</li>
<li>晚上回到家里在台式机上执行同步，此时台式机上的数据会被云端数据覆盖，即家里台式机和云端、公司笔记本保持数据一致</li>
<li>在家里台式机上编辑新内容后再次执行同步，此时云端数据会被台式机新数据覆盖，既云端和台式机新的数据一致</li>
<li>第二天上班在公司笔记本上执行同步，此时公司笔记本上数据会被云端数据覆盖，即笔记本和云端、家里台式机新的数据保持一致</li>
</ol>
<p>该场景下，使用同步的过程是在笔记本和台式机上交替进行的，这样能够保证数据同步符合预期正常完成。但以下场景就会有冲突：</p>
<ol>
<li>在公司笔记本上编辑 a 文件后同步，此时生成了云端快照 1</li>
<li>打开手机端（或其他设备）的思源笔记，在未完成同步的前提下编辑 a 文件后同步</li>
<li>此时思源发现云端快照 1 和手机端思源笔记的快照冲突，会以手机端的思源笔记的数据为准覆盖云端，生成带有 merge 字样的云端快照 2，同时在手机端上生成之前笔记本 a 的历史文件</li>
<li>此时，如果公司笔记本是自动同步的，在极短的间隔内，那它会以手机端生成的云端快照 2 为最新数据，同步覆盖本机，并把本机原先记录的内容作为冲突文档生成在本机，与原理不符，出现了不可预期的覆盖方向。</li>
<li>综上，不能同时，或短时间（几十秒内）两个设备同步。使用交替同步！！！</li>
</ol>
<p>这里附上开发者原话：</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503174900-1me91cx.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>注意事项：</strong></p>
<ul>
<li>睡眠或关机等突然断网的情况下不会触发同步，请手动点击同步按钮进行同步。</li>
<li>移动端在同步模式是自动、手动同步的情况下切换后台会执行同步（完全手动同步不会），但如果直接杀后台的情况同步无法完成，请在此之前先手动点击标题栏同步按钮进行同步。</li>
<li>符号链接和隐藏文件不会被同步。</li>
</ul>
<h3 id=""1-3-同步的方法"">1.3 同步的方法</h3>
<p>最后，请注意，本文所说同步仅包括使用官方同步或官方提供的支持 S3、WebDAV 协议的同步。简单来说，就是可以直接在思源笔记软件-设置-云端中设置的同步。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503171351-herr7n0.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>注意事项：</strong></p>
<ul>
<li>支持 S3、WebDAV 的第三方同步目前是免费公测，开发者表示 2024 年可能会收费。</li>
<li>不支持直接使用第三方同步盘（iCloud、Onedrive、WPS 云盘、百度云同步盘等）同步。</li>
</ul>
<h2 id=""二-官方同步"">二、官方同步</h2>
<p>目前阶段，使用官方同步是最为省心的，一开始有 7 天的体验，可以先体验再用。官方同步的价格是 148 元/年，有 8G 的空间，与本地功能的区别只有图上那么一点，比第三方同步多了微信提醒及微信收集箱。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503204950-ovx80yx.png?imageView2/2/interlace/1/format/webp""></p>
<p>如果觉得价格过高，有<a href=""https://ld246.com/subscribe/siyuan/batch"">团购优惠</a>及<a href=""https://ld246.com/article/1618844886264"">教育优惠</a>，可参考链接申请研究一下。有了官方会员后，就可以开始我们下面的步骤了。</p>
<p>‍</p>
<p>注意：以下步骤和第三方同步略微不同，第三方同步不需要前面的账号登录操作。在使用同步前一定要使用<strong>设置-导出-导出 data</strong> 功能备份一份数据到其他地方，避免出现问题丢失了数据。</p>
<ul>
<li><strong>请先做好数据备份!</strong></li>
<li><strong>请先做好数据备份!</strong></li>
<li><strong>请先做好数据备份!</strong></li>
</ul>
<h3 id=""2-1-顶栏点击云朵按钮"">2.1 顶栏点击云朵按钮</h3>
<p>在未开启同步的情况下，这个图标默认是关闭状态，点击后进入账号登录页面。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503213117-vuriuvz.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""2-2-注册-登录账号"">2.2 注册/登录账号</h3>
<p>如果没有过账号需要注册，会跳转到网页版的链滴论坛，相对割裂，这里我们是默认已经有了会员，输入自己的账号密码即可。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503213216-czkxsa4.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""2-3-设置同步密码"">2.3 设置同步密码</h3>
<p>登录后就会弹出要初始化同步密钥，因为思源笔记的同步是端对端加密，简单来讲就是本地明文数据要同步时，会先根据这个密钥进行加密然后上传云端，其他设备从云端下载，使用相同的密钥进行解密。密钥基于输入的密码生成，即输入 <strong>12345</strong>，对应根据算法可能会生成 <strong>dsds0329432232%&amp;#@￥。</strong></p>
<p>注意：<strong>我们只需要记住自己录入的那个 12345 密码即可。忘记这个密码，意味着云端数据丢失，需要根据本地数据重建云端数据。</strong></p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230503214549-fewuoqt.png?imageView2/2/interlace/1/format/webp""></p>
<p>注意：其他设备同步录入的密码也是原来的密码，否则会密码错误。如果需要设置新的密码，请删除云端目录重新设置（本地要有数据）</p>
<h3 id=""2-4-设置云端目录"">2.4 设置云端目录</h3>
<p>录入完密码后就会有一段生成索引仓库的动画，稍等片刻便会进入到设置云端目录的界面。</p>
<p>首次使用，云端目录默认生成一个 main 的目录，如果没有特殊要求可以直接使用。如果像我一样使用了多个空间，需要分别同步，就需要新建多个不同的目录，在不同的设备同步时选择不同的目录来相互隔离。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230504235732-jm4d2bc.png?imageView2/2/interlace/1/format/webp""></p>
<h3 id=""2-5-立即同步"">2.5 立即同步</h3>
<p>点击启动云端同步后即可立即同步。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230505000015-cm32yjn.png?imageView2/2/interlace/1/format/webp""></p>
<p>同步过程中顶栏及底栏会有对应的状态变化：</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/同步2-20230505001740-al7x0no.gif""></p>
<p>注意：手机端上的设置流程基本一致，参考即可。</p>
<h3 id=""2-6-开启同步感知"">2.6 开启同步感知</h3>
<p>2.9.2 版本特性，针对官方同步可以启用同步感知，主要功用是手机和 pc 两个设备同时在线时，若一方平台编辑并同步了，另外一方会感知到拉取同步，做到准实时的同步更新。</p>
<p>注意：此功能目前是试验阶段，同时并没有改变无法同时编辑两个设备的现状，依旧是交替同步，只是会比较快的感知同步。最后，非官方同步谨慎开启。</p>
<p><img src=""https://b3logfile.com/file/2023/06/image-K7qrXnI.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""三-第三方同步"">三、第三方同步</h2>
<p>再次说明：思源笔记里支持的第三方同步指的是官方提供的支持 S3、WebDAV 协议的同步，不支持直接使用第三方同步盘（iCloud、Onedrive、WPS 云盘、百度云同步盘等）同步。</p>
<p>这里推荐使用 S3 协议同步，性能比 WebDAV 强很多，更顺畅。S3 是指的亚马逊的 S3 协议，并非只能使用亚马逊的服务器，其他厂商一般都有兼容这个协议，比如阿里、腾讯、七牛、百度等等。</p>
<p>链滴论坛有专门的帖子对比了这些厂商的服务和价格，如果想要使用 S3 同步但还没有对应的服务商的小伙伴可以参考下选择合适的服务提供商。</p>
<ul>
<li>
<p><strong><a href=""https://ld246.com/article/1668672970787"">S3 服务商对比推荐 - 链滴 (ld246.com)</a></strong></p>
</li>
<li>
<p>当然，有 NAS 家庭存储的，也可以通过自建的方式完成 S3 协议的兼容，或选择 WebDAV 协议。</p>
<ul>
<li><a href=""https://ld246.com/article/1668250700857"">minio 群晖搭建及同步设置 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1668517633654"">【威联通】手把手傻瓜式同步设置 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1681024003244"">使用 minio s3 协议同步思源笔记 - 链滴 (ld246.com)</a></li>
<li><a href=""https://ld246.com/article/1684681568424"">思源七牛云 S3 同步设置 - 链滴 (ld246.com)</a></li>
</ul>
</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>在使用同步前一定要使用<strong>设置-导出-导出 data</strong> 功能备份一份数据到其他地方，避免出现问题丢失了数据。<strong>做好数据备份!做好数据备份!做好数据备份!</strong></li>
<li>第三方同步目前是免费公测，官网已经有了早鸟买断价格。</li>
</ul>
<h3 id=""3-1-配置同步信息"">3.1 配置同步信息</h3>
<p>使用第三方同步需要在思源笔记<strong>设置-云端</strong>中切换云存储服务提供商为 S3 或 WebDAV 并完成里面的设置。</p>
<p>各项内容对应如下，部分云存储的概念可能会不同，可以多加尝试。</p>
<h4 id=""3-1-1-S3-同步"">3.1.1 S3 同步</h4>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230506235327-puqn34k.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>主要厂商设置</strong></p>
<ul>
<li>
<p><strong>腾讯云 COS 设置</strong></p>
<ul>
<li>目前体验下来，腾讯云 cos 的设置是比较简单的，老用户还有 50g 的空间和 10g 的免费流量额度，可以说非常香了。</li>
<li>具体的设置教程可以参考这一篇文章。<a href=""https://ld246.com/article/1669132901145"">思源使用腾讯云 OSS 同步详细教程 - 链滴 (ld246.com)</a></li>
</ul>
</li>
<li>
<p><strong>阿里云 OSS 设置</strong></p>
<ul>
<li>阿里云作为国内云老大，实力还是有的，根据对比文章，阿里云的整体费用会相对低点，而且时不时有一些优惠打折活动，可以作为首选。</li>
<li>具体的设置教程可以参考这一篇文章。<a href=""https://ld246.com/article/1668749494228"">思源使用阿里云 OSS 同步详细教程 - 链滴 (ld246.com)</a></li>
</ul>
</li>
</ul>
<h4 id=""3-1-2-WebDAV-同步"">3.1.2 WebDAV 同步</h4>
<p>注意，虽然思源支持 WebDAV 同步，但因为频率频次的关系，坚果云本身的限制无法很好支持，故不支持使用坚果云同步，虽然它也是支持 WebDAV 。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230506233710-6a0u0zr.png?imageView2/2/interlace/1/format/webp""></p>
<p>使用 WebDAV 协议的大多是 NAS 和国外网盘，比如极空间、绿联等国内 NAS 都支持原生的 WebDAV，可以直接设置后使用，具体教程就没有了，希望有小伙伴可以贡献（没钱买）。</p>
<h3 id=""3-2-启动云端同步"">3.2 启动云端同步</h3>
<p>① 设置完初始信息后，我们勾选打开<strong>启动云端同步</strong>，并把<strong>同步冲突时生成冲突文档</strong>也一并启用，这样有冲突了会在文档树中生成冲突文件。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230506234554-69t8p05.png?imageView2/2/interlace/1/format/webp""></p>
<p>② 但首次使用时，一般会弹出来下面的提示：请先在[设置-关于-数据仓库密钥] 中初始化数据仓库密钥，这是因为我们直接进入到了云端设置流程，和官方同步的先设置密钥流程不太一致。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230506234420-tvylth6.png?imageView2/2/interlace/1/format/webp""></p>
<p>③ 看到这个提示（没看到也没关系），我们勾选它后回到主界面，可以看到顶栏的云朵图标会有一个感叹号（没有也没关系），提示说需要初始化，我们直接点击云朵即可开始初始化，根据引导完成同步。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/第三方同步-20230507000542-iz7sdyw.gif""></p>
<p>④ 同步完成后可以去对应的服务商的页面查看是否已经上传了加密的文件夹 repo，如下图。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507000538-gs2xlsa.png?imageView2/2/interlace/1/format/webp""></p>
<p><strong>注意：使用 S3 同步时，不需要设置云端目录，在思源笔记中也无法直接控制云端目录，默认以设置中的 Bucket 为准，否则会弹出阻断提示。</strong></p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507001108-ompnv16.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""四-同步常见问题及应对方案"">四、同步常见问题及应对方案</h2>
<p>虽然思源的同步已经有了相当大的进步且相对很稳定了，但使用环境的不同，还是会有一些问题，以下是我收集到的常见问题及应对方案，希望能给遇到问题的小伙伴一点帮助。</p>
<h3 id=""问题-1-锁定云端同步目录失败-请稍后再试""><strong>问题 1：锁定云端同步目录失败，请稍后再试</strong></h3>
<p>遇到这个问题，首先需要判断一下自身使用的思源版本，如果低于 2.8.6 的，升级后一般可以解决。如果本身高于 2.8.6 了，一般则是有多端在同时同步，关掉一端稍等片刻再使用即可。</p>
<p>如果版本低于 2.9.4 的，需要升级到 2.9.4。如果因为系统原因无法升级的（Win10 以下、Mac 10.15 以下），则需要使用自建同步了，官方同步最新的不支持上述系统。</p>
<h3 id=""问题-2-云端数据已损坏""><strong>问题 2：云端数据已损坏</strong></h3>
<p>遇到这个问题，说明之前同步过程中发生不可预期的快照损坏，当前云端上的数据已不可用。此时需要判断本地是否留存完整数据。</p>
<p>应对方案如下：</p>
<h4 id=""--有本地数据-"">① <strong>有本地数据：</strong></h4>
<p>重新设置云端目录即可。</p>
<ol>
<li>设置-导出-导出 data，先备份本地数据。</li>
<li>设置-云端-关闭云端同步；（所有设备都停止）</li>
<li>设置-云端-云端目录，删除出问题的云端目录<br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507002045-rqkhnh8.png?imageView2/2/interlace/1/format/webp""></li>
<li>新建一个云端目录（如果是 2.9.2 版本导致的云端损坏，删除云端目录后先去设置-关于-重置仓库，再去新新建云端目录）</li>
<li>启动云端同步（注意，这里没有重置数据仓库，依然使用原来的云端密码）</li>
</ol>
<h4 id=""--无本地数据-但其他设备同步过-"">② <strong>无本地数据，但其他设备同步过：</strong></h4>
<p>其他设备同步过的，可以导出后重新设置，以手机端同步过为例：</p>
<ol>
<li>
<p>手机里<strong>设置-关于-打开网络伺服。</strong></p>
<ul>
<li><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507002815-52txhqi.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
<li>
<p>手机和电脑在同一个网络（最简单就是手机共享个热点）。</p>
</li>
<li>
<p>电脑浏览器里输入手机网络伺服那显示的 ip 和端口登录网页思源。</p>
</li>
<li>
<p>打开左上角工作空间的<strong>设置-导出 导出 data。</strong>（不使用伺服直接手机端导出也可，只要能找到存放的目录）</p>
<ul>
<li><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/网络伺服导出data-20230507003042-sb415tw.gif""></li>
</ul>
</li>
<li>
<p>导出后，在本地新建个新的空间，然后再在<strong>设置-导出-导入 data</strong> 中恢复。</p>
</li>
<li>
<p>按照云端同步的设置重新设置同步。</p>
</li>
</ol>
<h4 id=""--无本地数据-无其他设备同步过""><strong>③ 无本地数据，无其他设备同步过</strong></h4>
<p>GG，这个没有办法了，一旦云端损坏，本地没有数据，相当于无法恢复。日常使用推荐 321 备份原则，多备份，放在不同地方。详情可了解<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fsspai.com%2Fpost%2F76130"" target=""_blank"" rel=""nofollow ugc"">永不消失的笔记！全自动的文档备份、加密与安全策略 - 少数派 (sspai.com)</a>。</p>
<h3 id=""问题-3-同步失败-无法解密数据-请确保多个设备上使用相同的密钥-然后创建新的云端目录进行同步"">问题 3：同步失败：无法解密数据。请确保多个设备上使用相同的密钥，然后创建新的云端目录进行同步</h3>
<p>遇到这个问题一般是在初始化同步密钥时录入了错误的密码，这个密码是原先设备同步时录入的密码，不是账号登录的密码，也不是设置-关于里那个长串的密钥，录入错误了就只能重置仓库重新输入。</p>
<p>应对方案：</p>
<h4 id=""--还记得正确的同步密码""><strong>① 还记得正确的同步密码</strong></h4>
<p>如果还记得原来的同步密码，那就非常好办：</p>
<ol>
<li>
<p>点击左上角工作空间进入-设置-关于-数据仓库密钥-重置</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507004754-gasx2eo.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>重置后，思源会闪烁一下回到主界面，再点击顶栏云朵按钮重新引导同步，录入正确的密码重新同步。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507004851-mp4l3ih.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<h4 id=""--不记得原来的密码-但备份过原来的密钥"">② 不记得原来的密码，但备份过原来的密钥</h4>
<p>这里备份过原来的密钥是指的曾经把设置-关于-数据仓库密钥复制到别的地方过，留存有密钥文本，那也非常好办：<br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507005044-4b4kkcm.png?imageView2/2/interlace/1/format/webp""></p>
<ol>
<li>
<p>点击左上角工作空间进入-设置-关于-数据仓库密钥-重置</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507004754-gasx2eo.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>重置后，思源会闪烁一下回到主界面，<strong>这时不能通过顶栏的云朵去设置密码，不能！<strong>而应回到刚才重置仓库的地方，通过</strong>导入密钥完成密钥的输入</strong>。<br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507005303-121vc6f.png?imageView2/2/interlace/1/format/webp""><br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507005315-dri7wwb.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<h4 id=""--不记得密码-也没有备份密钥"">③ 不记得密码，也没有备份密钥</h4>
<p>这个情况和云端数据已损坏步骤一致，参考上面方法解决。</p>
<p>‍</p>
<h3 id=""问题-4-数据冲突-已为你生成冲突文件"">问题 4：数据冲突，已为你生成冲突文件</h3>
<p>这个问题常见于同时打开多端同步，在极短时间(个人预估 10 秒内）两端都在同步导致，因各端与服务器的交互时间不一致，会发生不可预期的你覆盖我还是我覆盖你的行为。根据思源的同步原理，当发生冲突时，一般以本地为准，把云端的数据生成冲突文件在文档树中。</p>
<p>应对方案：</p>
<h4 id=""--本地的数据是以前的-新的没同步下来"">① 本地的数据是以前的，新的没同步下来</h4>
<p>这个也有两种情况：</p>
<ul>
<li>
<p>云端同步已启用<strong>同步时生成冲突文档</strong>选项</p>
<ul>
<li>如果启用了选项，那么在对应文档的文档树上方，会有一个同名文档，但有括号备注 conflict 的文件，里面则是云端的数据，可按需移动数据或增减文件。</li>
</ul>
</li>
<li>
<p>没有启用生成冲突文档选项</p>
<ul>
<li>如果没有启用，那么可以点击左上角工作空间进入<strong>数据历史（alt+h）</strong>，查看<strong>文件历史</strong>，找到对应时间的历史记录按需操作。<br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507010321-0wvsz8g.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
</li>
</ul>
<h4 id=""--冲突的文档太多-一个个恢复太困难"">② 冲突的文档太多，一个个恢复太困难</h4>
<p>在思源 2.8.6 版本，开发者实现了按需下载云端快照的功能，这个功能可以让我们非常方便的恢复其他端的数据到本机。</p>
<ul>
<li>点击左上角工作空间进入<strong>数据历史</strong>，点击第三个<strong>数据快照，选择云端快照，可以看到左边会列出各个设备名对应的同步产生的云端快照，根据时间判断一下需要恢复过去的快照，点击最右方的下载按钮下载到本地快照。</strong><br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507010652-8cgzdji.png?imageView2/2/interlace/1/format/webp""></li>
<li>点击回到本地快照，选中前面下载过来的云端快照（注意比对 7 位代码），点击右边的回滚即可恢复该快照<br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507010913-wvzm7gu.png?imageView2/2/interlace/1/format/webp""></li>
</ul>
<h3 id=""问题5-云端存储服务提供商网络连通性异常-请检查网络配置"">问题 5 云端存储服务提供商网络连通性异常，请检查网络配置</h3>
<p>几个方向可以排查：</p>
<p>① 建议先看一下电脑时间是不是和实际北京时间不一致。新版的同步会校验本地时间和云端时间，如果两个时间相差过大，会出现这个问题。</p>
<p>② 如果是用的第三方同步，建议检查配置，比如 http 和 https，如果是 s 需要服务器有证书。</p>
<p>③ 网管 ban 了对应服务提供商的地址。注意看思源日志文件里的云端地址是否正常，如果变成了 127 的 ip 可能是因为 ddns 出了问题。</p>
<p>④ 本机使用了代理，思源无法直接通过全局代理使用，要么关掉代理要么就是去设置-关于里设置一下。</p>
<p>⑤ 本机可能有多个网卡，思源走了另外的内网网卡。</p>
<h2 id=""我本人的云端同步使用建议"">我本人的云端同步使用建议</h2>
<p>我本人从 2021 年秋接触使用思源至今，真正发生同步问题的次数小于 2 次，也可能是我的网络环境较稳定，同步的设备较少，只有 PC、笔记本、手机三端同步，所以出现的问题少，但在这里还是想分享一点我个人的建议，希望大家都能顺畅的使用思源同步：</p>
<ol>
<li>
<p>不要多端同时使用思源进行同步。同时约等于 10 秒内。</p>
</li>
<li>
<p><del>手机端、平板端同步模式设置为手动同步（启动和关闭、切换后台时会同步）</del>。2.9 以后有了云端数据快照和同步感知，建议开启自动同步，避免遗忘同步。</p>
</li>
<li>
<p>立即同步的快捷键设置为 Ctrl+S，时不时的点一下，保证云端是新的。（本地是实时保存的）</p>
</li>
<li>
<p>找个地方存一下云端的密码，这个密码不要记在思源笔记内（笔记都打不开了怎么找密码），可以放到 Edge 浏览器的个人资料或者微信收藏去。</p>
</li>
<li>
<p>有重大笔记生产时，检查同步和备份数据，并在数据历史-数据快照中标记一份本地快照到云端，这样在其他端恢复时可以一眼看到标记的快照信息。<br>
<img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507012210-0uglazz.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1630025891949/assets/image-20230507012334-36apa1c.png?imageView2/2/interlace/1/format/webp""></p>
<p>云端标记快照类似云端备份，会占用云端空间，需要定期删除较旧的快照。</p>
</li>
<li>
<p>其他端的同步可以作为数据的备份，比如手机端时不时同步一下，留存数据，避免电脑密码丢失、硬盘格式化导致的丢失。</p>
</li>
</ol>
<p>‍</p>
                

作者：mozhu
链接：https://ld246.com/article/1683395267749
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",mozhu,思源笔记,链滴优选
686,思源 SQL 新人指南：SQL 语法 + Query + 模板 - 链滴,Sat May 06 2023 14:38:14 GMT+0000 (Coordinated Universal Time),"
                    <p>本文响应「思源需要更好的文档」的号召编写。并提供了完整的 markdown 源代码（思源导出的）。</p>
<p>如果有自行编写帮助文档意愿的朋友，可以在遵守开源精神的前提下自行取用。</p>
<p><a href=""https://b3logfile.com/file/2023/05/思源SQL新人指南_SQL语法___Query___模板-SxMFcK4.zip"">思源 SQL 新人指南 SQL 语法 Query 模板.zip</a></p>
<h2 id=""引言"">引言</h2>
<h3 id=""为啥有个--SQL"">为啥有个  SQL</h3>
<p>　　思源笔记里 SQL 起到了一个重要的数据汇总作用，但是对于不了解 SQL 的人来讲，这是一个非常拧巴的东西。纯新人不明白这东西的意义何在；而 logseq 等其他笔记软件迁移过来的用户不明白为什么一个查询语句为什么要定义的那么复杂。</p>
<p>　　其实思源之所以要内置一个 SQL 查询功能，道理十分简单：因为<strong>思源在运行时真的会维护一个 SQLite 数据库</strong>用来存储笔记的所有数据，而你提交的每一个 SQL 查询都会<strong>真的提交给这个数据库执行</strong>——既然有一个这么方便的查询语法了，还有什么必要找别的中间商来赚差价呢？</p>
<p>　　所以，思源的 SQL 查询，为用户提供了<strong>直通软件底层的数据访问能力</strong> —— 这种数据访问的<strong>自由度</strong>完全不是传统笔记软件扣扣搜搜的「查询文本」、「查看文档属性」这种东西可以碰瓷的，你可以任意使用各种合法的 SQL 语句来查询思源内部的数据——没有任何中间商赚插件，真正做到了灵活多变。「当然了，再自由也只支持 select 语法，delete, update 这种危险的语法肯定是不可能直接给用户开放的」</p>
<p>　　至此我们已经解答了开始的两个问题：</p>
<ul>
<li>为什么要有个 SQL? 为了提供一个直通软件底层的数据查询功能</li>
<li>为什么不额外定义一个简单的查询语法？因为没有必要，思源内部维护了一个运行时数据库，没有必要在 SQL 上再加一个赚差价的中间商</li>
</ul>
<h3 id=""基础概念"">基础概念</h3>
<p>　　以上的文字，对于不了解数据库、SQL 的概念和关系的思源用户来说，估计看了还是一脸蒙蔽，什么他娘的 SQLite 、数据库、查询语法、SQL，这都是啥啊？—— 这里，我用尽可能短的篇幅来告诉你们这是什么东西。</p>
<p>　　如果已经开始使用思源笔记，你会发现思源中每个块是一个非常独立的个体。他有自己的内容，有创建、更新时间，有命名别名，甚至可以创建自定义的属性。</p>
<p>　　我们把这样有明确的内部属性定义的对象，称为一个「实体」，思源中的块就是一个实体，他的名字叫「blocks」。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683346579811-20230506121621-bhcl5sh.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　「实体」不是数据，而是对「数据应该长什么样子」的定义。就好比一个块应该具有 ID、创建时间、内容等属性。而每一个具体的块，在这些属性上都会有相应的取值。</p>
<p>　　每一个具体的块，都可以用上面一行数据来表示。而所有块放在一起，就组成了数据表。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683347261668-20230506122742-f16usds.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　看起来像不像 excel？没错，你完全可以把数据库理解成一个 excel 文件。</p>
<ul>
<li>数据库就是：excel 文件</li>
<li>数据表就是：excel 里各个 sheet</li>
<li>实体就是：每个 sheet 里列的定义，代表了这个 sheet 记录了什么</li>
<li>数据就是：表格里每一行</li>
</ul>
<p>　　虽然数据库可以理解为 excel，但是他不是 excel。excel 可以用 office 软件打开，可视化的编辑，但是数据库不行，他的直接用户不是人，而是计算机程序。所以他没有提供原生的可视化软件用来查询编辑，而是提供了一个名为 SQL 的编程语言来访问内部的数据。</p>
<p>　　总结一下就是：</p>
<ul>
<li>思源运行的时候，会维持一个数据库</li>
<li>思源的块、属性、链接什么的，都是独立存储在数据库中表里面</li>
<li>为了访问这个表当中的数据，我们需要使用 SQL 语言来查询数据表</li>
</ul>
<p>　　只有块才是一个实体吗？非也，思源的抽象做的是很好的。双向链接也是一个实体——它有一数据表「refs」；块属性也是一个实体——它有一个数据表「attributes」。这些表都是可以放到 SQL 查询语句里的。</p>
<p>　　我把常用的三个表的定义放在附录里了，需要的可以自行翻阅。</p>
<h2 id=""1-给菜鸟的-SQL-基本指南"">1 给菜鸟的 SQL 基本指南</h2>
<p>　　SQL 的用法非常灵活，但是灵活往往等价于复杂。于是有的没有计算机背景，但是又希望尝试的萌新们试着搜索某些教程——结果，进去之后发现乱七八糟看不懂，瞬间劝退。</p>
<p>　　实际上，希望在思源里面使用 SQL 的新人们大可不必抱着一个「SQL 从入门到入土」从头读到尾，<strong>思源中实际上会用到的 SQL 查询的语法根本没有那么多</strong>。我下面列举的几个基本语法可以应对 95% 的场景。</p>
<ul>
<li>
<p>基本查询</p>
<ul>
<li>select 语句：所有场景都会用到</li>
<li>where 语句：绝大部分场景下都会用到</li>
</ul>
</li>
<li>
<p>嵌套查询：高级用法</p>
</li>
</ul>
<h3 id=""1-1-基本查询"">1.1 基本查询</h3>
<p>　　你在思源中用到的所有查询都属于 SQL 中的 <code>select</code> 查询，如果你去翻阅一个正规 SQL 教程，他们会告诉你 select 语法的定义如下。<br>
其中 column1, column2, ...是列名，table_name 是要查询的表名称，<code>&lt;condition&gt;</code> 在这里指代查询的条件。如果要查询所有列，则可以用 * 代替列名。</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">SELECT</span> <span class=""highlight-err"">column</span><span class=""highlight-mi"">1</span><span class=""highlight-err"">,</span> <span class=""highlight-err"">column</span><span class=""highlight-mi"">2</span><span class=""highlight-err"">,</span> <span class=""highlight-err"">...</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">FROM</span> <span class=""highlight-err"">table_name</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">where</span> <span class=""highlight-err"">&lt;condition&gt;;</span>
</span></span></code></pre>
<p>　　在思源里面，一般常用的表以及他们各自的字段的定义，我已经放在附录里面了。需要的可以自行查看。</p>
<p>　　==<strong>如果你是纯新人</strong>==，对什么「table」「column」完全不明白。你也可以先不用管上面这些复杂的讨论，需要做的很简单：**==照抄下面的语句==**，然后把 <code>&lt;condition&gt;</code> 改成**==自己需要的条件==**就行了。</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-o"">&lt;</span><span class=""highlight-n"">condition</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>　　思源中一个最简单的 SQL 查询如下图所示：</p>
<ol>
<li>中间靠右的表格就是思源运行时维护的数据库中 blocks 表，存储了一切块的信息</li>
<li>我们通过 <code>&lt;condition&gt;</code> 来匹配到我们希望的块</li>
<li>把这些匹配的块取出来，交给思源进行渲染（或其他处理）</li>
</ol>
<p>　　这就是 SQL 的基本流程，可见编写 SQL 最关键的就是要会编写 <code>&lt;condition&gt;</code></p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683307436970-20230506012406-w3dw1l9.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　那么 <code>&lt;condition&gt;</code> 是什么鬼？它在 SQL 里面被称为「查询条件」。具体语法我们一步一步来</p>
<ol>
<li>
<p>最基本的条件长这个样子</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<ul>
<li>
<p>左边的 <code>type</code> 我们把它称为 key</p>
<p>有时候你会看到 key 周围有 `` 包裹，这个是 SQL 语法的习惯，不用纠结</p>
</li>
<li>
<p>右边的 <code>\'d\'</code> 我们称为 value</p>
<p>value 周围包围有 \'\' 是因为这是一个字符串值，也不用纠结</p>
</li>
<li>
<p>中间的 <code>=</code> 被称为比较操作符，还有其他很多别的操作符：</p>
<ul>
<li><code>=</code> 代表了相等</li>
<li><code>&lt;</code> 代表了小于</li>
<li><code>&gt;</code> 代表了大于</li>
<li><code>!=</code> 代表了不相等</li>
<li><code>like</code> 代表了字符串模板匹配</li>
</ul>
</li>
</ul>
<p>所以，这个条件的含义是：要求块的 type 字段等于 \'d\'。</p>
<p>type 字段是思源 blocks 表中内置的一个字段，表示的含义是「块的类型」，决定了一个块到底是文档块还是列表块还是其他，而 \'d\' 表示为文档块。所以，如果我们写出来这么一个 SQL 语法。</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>那么得到的结果就是：选择所有 type 为 d（也就是类型为文档）的块。<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683307910543-20230506013152-ph195v3.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
</li>
<li>
<p>组合：使用 and</p>
<p>条件肯定不能只有一个就行，总归是需要组合才行的。比如我们不光想要查询所有的文档块，还想要查询「所有的创建日期在 2023 年 4 月之后的文档块」——显然这就需要 and 来组合了。</p>
<p>首先我们来看看，「2023 年 4 月之后」这个条件要怎么表述呢？思源中有一个属性 <code>created</code> ，表示一个块是什么时候创建的，他的值的格式为 <code>20210104091228</code>，我们依样画葫芦，「2023 年 4 月之后」就是应该写作：「<code>created</code> &gt; \'20230401000000\'」。</p>
<p>而为了把这两个条件组合起来，我们可以使用 <code>and</code> 语句： <code>&lt;cond1&gt; and &lt;cond2&gt;</code>，最后的 sql 查询写成这样：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">created</span><span class=""highlight-w""> </span><span class=""highlight-o"">&gt;</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'20230401000000\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506013450-g2mkp8l.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>组合：使用 or</p>
<p>and 组合意味着「条件 A 和 条件 B 必须同时满足」。再思源的实践中，and 查询在绝大部分情况下都够用了。但是偶尔，我们可能也希望做这样的查询「条件 A 或 条件 B 至少满足一个」。这种情况下，就要使用 or 组合了。</p>
<p>假设我们需要查询所有的二级和三级标题，显然这个条件可以写为「标题级别为二级 或者 标题基本为三级」，于是可以使用以下 SQL 语句：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h2\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h3\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>and 和 or 组合使用：注意优先级问题</p>
<p>当我们要做比较复杂的查询，需要同时使用 and or 的时候，就要注意符号优先级的问题了，比如下面这个例子</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-n"">cond1</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond2</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond3</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>请问是先查询 <code>cond1 or cond2</code> 然后和 <code>cond3</code> 求交集呢？还是 <code>cond1</code> 和 <code>cond2 and cond3</code> 求并集呢？</p>
<p>所以为了避免这种混淆情况，请为复杂的条件加上括号来区分优先级</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">(</span><span class=""highlight-n"">cond1</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond2</span><span class=""highlight-p"">)</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond3</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-n"">cond1</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-n"">cond2</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond3</span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>神奇的 <code>LIKE</code></p>
<p>在第一节的时候，我们提到了比较符号中有一个 <code>LIKE</code>，这个符号我们要额外讲一下。思源的数据库项目的数据类型基本都是字符串，因而字符串的比较是很重要的。我们在前面提到过的 <code>=</code> 代表的含义是「完全相等」。比如我们前面提到的：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h3\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>但是有时候，我们可能希望做一些部分匹配，这个时候就是 <code>LIKE</code> 的大显身手之处了。它用于匹配一种模式，用法和 <code>=</code> 类似也是：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">key</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-n"">value</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>但是同 LIKE 操作符匹配的 value 里，通常会使用通配符。通配符是一种特殊字符，可以匹配任意字符或一组字符。最常用的通配符有两个：</p>
<ul>
<li><code>%</code>：匹配零个或多个字符。</li>
<li><code>_</code>：匹配单个字符。</li>
</ul>
<p>举个例子：我们希望搜索创建日期在 2023 年 4 月 1 日的文档块，就可以这么做：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">created</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'20230401%\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>原本 created 字段的格式有很长一段，\'0401\' 后面还有时分秒之类的信息，但是使用通配符 <code>%</code> 就可以把这些无关紧要的信息全部省略，可以说很方便了。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683308450040-20230506014051-hx98xim.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<p>　　‍</p>
<h3 id=""1-2-嵌套查询"">1.2 嵌套查询</h3>
<p>　　基本的 select + where 的查询在大部分简单的查询场景下都是够用的了的。但是如果涉及到双链，那么就不得不使用嵌套查询了。</p>
<p>　　思源笔记对双向链接的支持非常好，那么这个支持是如何体现在数据结构里的呢？在思源笔记的数据库中维护了一个 refs 表专门用来表示链接关系，双向链接就是通过 refs 表中的 <code>def_block_id</code> 和 <code>block_id</code> 两个字段来表示的。这两个字段分别指向了被引用的块和引用该块的块的 id。这样，我们可以通过 refs 表来查询两个块之间的关系。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506010221-3i0tzgu.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　嵌套查询可以被看作是一个查询语句作为另一个查询语句的一部分。它的执行顺序是</p>
<ul>
<li>先执行内部的查询</li>
<li>然后将内部查询的结果作为外部查询的条件进行查询</li>
</ul>
<p>　　我们无需深入理解其中的设计逻辑，对于萌新用户而言，只需要记住下面这个模板就行了：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'特定笔记块的id\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">);</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>　　在这个查询语句中：</p>
<ul>
<li>(...) 内部的 select 查询的结果是所有引用特定笔记块的笔记块的 id，我们可以把它想象成一个集合</li>
<li>外部查询使用 IN 关键字将其作为外部查询的条件之一</li>
</ul>
<p>　　于是这个语句可以被直观理解为</p>
<ol>
<li>
<p>先查询所有引用特定笔记块的笔记块的 id</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'特定笔记块的id\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683306504726-20230506010826-v5j4z6a.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>然后根据这些 id 查询对应的笔记块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-o"">&lt;</span><span class=""highlight-err"">上一步查询的</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-err"">集合</span><span class=""highlight-o"">&gt;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506010938-7n266jt.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<p>　　需要注意的是，虽然我们这里给的例子中，被嵌套的是 refs 表，但是不代表只能嵌套 refs 表。blocks 和 blocks 表也是可以嵌套在一起的。</p>
<h3 id=""1-3-其他高级语法"">1.3 其他高级语法</h3>
<p>　　基本上对思源笔记的查询来说，有了基本查询 + 嵌套查询，可以应对绝大部分场景。不过还有一些可能会用到的高级语法，我在这里罗列一下，有兴趣的自行去学习：</p>
<ul>
<li><code>union</code> 查询：用于将多个查询结果合并为一个结果集。</li>
<li><code>order by</code>：用于对查询结果按照指定的列进行排序。</li>
<li><code>limit</code>：用于限制查询结果的数量。</li>
<li><code>group by</code>：用于将查询结果按照指定的列进行分组。</li>
<li><code>having</code>：用于在 <code>group by</code> 后筛选分组结果。</li>
<li><code>join</code>：用于将多个表的数据连接起来查询。</li>
</ul>
<h2 id=""2-常用-SQL-查询示例"">2 常用 SQL 查询示例</h2>
<ul>
<li>
<p>查询所有文档块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询所有二级标题块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h2\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个文档的子文裆</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">path</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'%/当前文档id/%\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>随机漫游某个文档树下所有标题块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">SELECT</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">FROM</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">WHERE</span><span class=""highlight-w""> </span><span class=""highlight-n"">root_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">LIKE</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'文档 id\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">ORDER</span><span class=""highlight-w""> </span><span class=""highlight-k"">BY</span><span class=""highlight-w""> </span><span class=""highlight-n"">random</span><span class=""highlight-p"">()</span><span class=""highlight-w""> </span><span class=""highlight-k"">LIMIT</span><span class=""highlight-w""> </span><span class=""highlight-mi"">1</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询含有关键词「唯物主义」的段落块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">markdown</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'%唯物主义%\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'p\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">ORDER</span><span class=""highlight-w""> </span><span class=""highlight-k"">BY</span><span class=""highlight-w""> </span><span class=""highlight-n"">updated</span><span class=""highlight-w""> </span><span class=""highlight-k"">desc</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询过去 7 天内没有完成的任务</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">SELECT</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">WHERE</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-k"">type</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""l\""</span><span class=""highlight-w""> </span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">subtype</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""t\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">created</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">&gt;</span><span class=""highlight-w""> </span><span class=""highlight-n"">strftime</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'%Y%m%d%H%M%S\'</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-n"">datetime</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'now\'</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'-7 day\'</span><span class=""highlight-p"">))</span><span class=""highlight-w""> 
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-n"">markdown</span><span class=""highlight-w""> </span><span class=""highlight-n"">REGEXP</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""\\* \\[ \\] \\S+\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">parent_id</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-k"">not</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">  </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">id</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">subtype</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""t\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个块所有的反链块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'当前块的id\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">);</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个文档下属的文档树内所有的反链</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">      </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">path</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""%当前文档块 id%\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个书签下所有的块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">attributes</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">name</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'bookmark\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">value</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'书签名\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">);</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询失效的块引用</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w""> </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">not</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w""> </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-p"">)</span><span class=""highlight-w""> </span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
</ul>
<h2 id=""3-使用-Query-挂件"">3 使用 Query 挂件</h2>
<p>　　Query 是思源元老级别的挂件，由热心用户 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2FZuoqiu-Yingyi"" title=""Creator"" target=""_blank"" rel=""nofollow ugc"">Zuoqiu-Yingyi</a>（Dark+ 主体作者）提供，让我们为他鼓掌 ???。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506012721-s3upahl.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　Query 挂件解决了两个很重要的问题：</p>
<ol>
<li>Query 为查询结果提供了嵌入块视图之外的表格视图</li>
<li>Qeury 让 SQL 查询目标不再只局限于 <code>select * from blocks</code></li>
</ol>
<h3 id=""3-1-Query-提供了表格视图"">3.1 Query 提供了表格视图</h3>
<p>　　首先来看看第一个问题，我在之前提到过「SQL 为用户提供了直通软件底层的访问能力」。这个说法其实是不严谨的，思源本体并没有给用户提供这么高的访问能力。原因在于，思源本体中，使用 SQL 查询的主要手段是使用嵌入块，而嵌入块虽然会执行 SQL 语句，但是他并不会把查询的结果（表格数据）返回给用户，而是会直接根据查询的结果把对应的块渲染到编辑器中。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683348866509-20230506125427-2nkvh9o.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　但是，如果使用 Query 挂件，就可以访问到原始的数据库信息。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683348961599-20230506125603-2rwtua2.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
<h3 id=""3-2-Query-让查询更加多样"">3.2 Query 让查询更加多样</h3>
<p>　　由于思源本体只提供了嵌入块 SQL 查询，就带来了另一个缺点：他不能查询那些无法被前端渲染出来的信息。</p>
<p>　　还记得，我在一开始介绍 SQL 语法的时候告诉大家，<code>select * from blocks</code> 这个语句不用管直接无脑套用就行了吗？原因在于嵌入块的查询最终的结果是要渲染成可以编辑的块的，所以：</p>
<ol>
<li>只能查询 blocks 表 <code>from blocks</code>，其他的表查询了也渲染不了</li>
<li>只能查询所有字段 <code>select *</code>，如果字段缺失，嵌入块没法渲染一个完整的块</li>
</ol>
<p>　　但是使用了 query 就不是问题，在这里，你可以自由发挥，你可以只查询某些字段：</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683349432106-20230506130353-ely2x5k.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　 也可以查询 blocks 以外的表：</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683349497039-20230506130458-cwex7ms.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　 可以说，有了 query 挂件的 SQL 查询，才是满血状态的。</p>
<p>　　当然目前思源正在开发的属性视图不知道会不会有额外的 SQL 支持，拭目以待吧。</p>
<p>　　‍</p>
<h2 id=""4-使用模板"">4 使用模板</h2>
<p>　　每次都要编写长长的 SQL 语句好麻烦呀！有没有方便一点的办法？</p>
<p>　　有——使用思源的模板。定义一个思源的模板非常简单，只需要在 <code>data/templates</code> 目录下创建若干 md 文件，这些 md 文件就可以作为模板导入思源。（当然为了方便管理，还是建议大家先创建一个文件夹，把自己的模板放到这个文件夹里面）。</p>
<h3 id=""4-1-在模板中预先定义-SQL"">4.1 在模板中预先定义 SQL</h3>
<p>　　如果你嫌弃每次敲击复杂的 SQL 语法很麻烦，完全可以预先把 SQL 语句写在模板当中，比如现在我在新建的模板 001.md 中写入如下文本。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{SELECT <span class=""highlight-ge"">* from blocks_esc_newline_WHERE `type` = \""l\"" AND `subtype` = \""t\""_esc_newline_AND `created` &gt; strftime(\'%Y%m%d%H%M%S\', datetime(\'now\', \'-7 day\')) _esc_newline_AND markdown REGEXP \""\\*</span> \\[ \\] \\S+\""_esc_newline_AND <span class=""highlight-sb"">`parent_id`</span> not in (_esc_newline_  select <span class=""highlight-sb"">`id`</span> from blocks where <span class=""highlight-sb"">`subtype`</span> = \""t\""_esc_newline_)_esc_newline_ORDER BY <span class=""highlight-sb"">`created`</span> DESC}}
</span></span></code></pre>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683353319436-20230506140840-uzobi39.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　上面的模板定义了一个嵌入块，嵌入块里的 SQL 是之前提到过的，查询过去七天内没有完成的任务。注意，嵌入块的代码必须写在一行内，不能换行。</p>
<p>　　现在在思源里面敲击 <code>/</code> 导入模板，立刻就可以把这个嵌入块快速导入进来：</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683353465253-20230506141106-st2rhvi.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
<h3 id=""4-2-在模板中定义-Query-模板"">4.2 在模板中定义 Query 模板</h3>
<p>　　模板的功能是很强大的，可以导入嵌入块，也可以导入 Query 挂件（前提是你要安装了这个挂件）。现在我们更改 001.md 的内容做一个挂件的模板。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where type = \'d\' and created &gt; \'20230501000000\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">iframe</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""widget\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">iframe</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-query-fields=\""[\""type\"", \""content\"", \""hpath\"", \""memo\"", \""box\""]\"" custom-type=\""query-widget\"" custom-query-limit=\""\""len\""\"" custom-query-maxrow=\""2\"" custom-query-maxlen=\""20\""}
</span></span></code></pre>
<p>　　现在再次导入，你就可以看到一个 Query 挂件了。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683353976752-20230506141938-rtzmlly.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　有些人可能会对上面给的 markdown 模板有些迷惑，觉得这似乎不是自己印象中的 markdown —— 你说的对，这其实是一种叫做 kramarkdown 的语法，他是对 markdown 的扩展。看到那个奇怪的 <code>{:  }</code> 语法了吗，它可以为近邻的 markdown 元素定义一些额外的属性，而思源会把这些属性作为块的属性一起导入。，举个例子，上面提到的 sql 代码块：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where type = \'d\' and created &gt; \'20230501000000\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span></code></pre>
<p>　　如果我们导入了模板后，尝试点击上面那个 SQL 代码块，就会发现这个自定义属性也导入进来了。（思源中以 <code>custom-</code> 开头的属性会被当作用户定义的自定义属性）</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683354238116-20230506142359-t9kbple.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
<p>　　‍</p>
<h3 id=""4-3-模板的高级用法"">4.3 模板的高级用法</h3>
<p>　　如果我们想要定义一个模板，可以查询当前文档的反向链接，也许可以这么编写：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where id in (
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    select block_id from refs where def_block_id = \'这里填写文档 ID\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">) order by <span class=""highlight-sb"">`updated`</span> desc
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">iframe</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""widget\""</span> <span class=""highlight-na"">border</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">frameborder</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""no\""</span> <span class=""highlight-na"">framespacing</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">allowfullscreen</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""true\""</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""width: 374px; height: 37px; border: none; background-color: transparent;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">iframe</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-query-fields=\""[\""type\"", \""content\"", \""hpath\"", \""memo\"", \""box\""]\"" custom-type=\""query-widget\"" custom-query-limit=\""\""len\""\"" custom-query-maxrow=\""2\"" custom-query-maxlen=\""20\""}
</span></span></code></pre>
<p>　　然后导入模板后，只需要更改正确的文档 ID 就行了。</p>
<p>　　但是实际上不用这么麻烦，思源的模板支持一些高级的编程特性，关于这一部分，思源内置的文档有详细的描述。如果你不在乎更高级的用法的话，那么记住一下两个语法就够了：</p>
<ul>
<li><code>.action{.id}</code>：它会被渲染为模板所在文档的 id</li>
<li><code>.action{.title}</code>：它会被渲染为模板所在文档的标题</li>
</ul>
<p>　　现在改写我们的模板如下，导入后，它可以直接查询本文档所有的反向链接。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where id in (
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    select block_id from refs where def_block_id = \'.action{.id}\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">) order by <span class=""highlight-sb"">`updated`</span> desc
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">iframe</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""widget\""</span> <span class=""highlight-na"">border</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">frameborder</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""no\""</span> <span class=""highlight-na"">framespacing</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">allowfullscreen</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""true\""</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""width: 374px; height: 37px; border: none; background-color: transparent;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">iframe</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-query-fields=\""[\""type\"", \""content\"", \""hpath\"", \""memo\"", \""box\""]\"" custom-type=\""query-widget\"" custom-query-limit=\""\""len\""\"" custom-query-maxrow=\""2\"" custom-query-maxlen=\""20\""}
</span></span></code></pre>
<p>　　‍</p>
<h2 id=""附录-思源的-SQL-表字段定义"">附录：思源的 SQL 表字段定义</h2>
<p>　　这里只列举了 blocks refs 和 attributes 表，主要是 SQL 查询我就没有遇到过需要用到别的表的情况。更何况其他的表知道的人没有必要看这个教程，看这个教程的人也没有必要知道。</p>
<p>　　如果你希望知道完整的数据库里所有表的定义，请查看社区自来水厂的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsiyuannote%2Fdocs%2Fgo7uom"" target=""_blank"" rel=""nofollow ugc"">语雀笔记</a>（我记得上面有）。</p>
<h3 id=""blocks-表"">blocks 表</h3>
<p>　　该表用于存储内容块数据。</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
<th>字段值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>内容块 ID</td>
<td><code>20210104091228-d0rzbmm</code></td>
</tr>
<tr>
<td><code>parent_id</code></td>
<td>双亲块 ID，如果内容块是文档块则该字段为空</td>
<td><code>20200825162036-4dx365o</code></td>
</tr>
<tr>
<td><code>root_id</code></td>
<td>文档块 ID</td>
<td><code>20200825162036-4dx365o</code></td>
</tr>
<tr>
<td><code>hash</code></td>
<td><code>content</code> 字段的 SHA256 校验和</td>
<td><code>a75d25c</code></td>
</tr>
<tr>
<td><code>box</code></td>
<td>笔记本 ID</td>
<td><code>20210808180117-czj9bvb</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>内容块所在文档路径</td>
<td><code>/20200812220555-lj3enxa/20210808180320-abz7w6k/20200825162036-4dx365o.sy</code></td>
</tr>
<tr>
<td><code>hpath</code></td>
<td>人类可读的内容块所在文档路径</td>
<td><code>/0 请从这里开始/编辑器/排版元素</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td>内容块名称</td>
<td><code>一级标题命名</code></td>
</tr>
<tr>
<td><code>alias</code></td>
<td>内容块别名</td>
<td><code>一级标题别名</code></td>
</tr>
<tr>
<td><code>memo</code></td>
<td>内容块备注</td>
<td><code>一级标题备注</code></td>
</tr>
<tr>
<td><code>tag</code></td>
<td>非文档块为块内包含的标签，文档块为文档的标签</td>
<td><code>#标签1 #标签2# #标签3#</code></td>
</tr>
<tr>
<td><code>content</code></td>
<td>去除了 Markdown 标记符的文本</td>
<td><code>一级标题</code></td>
</tr>
<tr>
<td><code>fcontent</code></td>
<td>存储容器块第一个子块的内容(1.9.9 添加)</td>
<td><code>第一个子块</code></td>
</tr>
<tr>
<td><code>markdown</code></td>
<td>包含完整 Markdown 标记符的文本</td>
<td><code># 一级标题</code></td>
</tr>
<tr>
<td><code>length</code></td>
<td><code>markdown</code> 字段文本长度</td>
<td><code>6</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>内容块类型，参考⸢类型字段⸥</td>
<td><code>h</code></td>
</tr>
<tr>
<td><code>subtype</code></td>
<td>内容块子类型，参考⸢子类型字段⸥</td>
<td><code>h1</code></td>
</tr>
<tr>
<td><code>ial</code></td>
<td>内联属性列表，形如 <code>{: name=\""value\""}</code></td>
<td><code>{: id=\""20210104091228-d0rzbmm\"" updated=\""20210604222535\""}</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td>排序权重，数值越小排序越靠前</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>created</code></td>
<td>创建时间</td>
<td><code>20210104091228</code></td>
</tr>
<tr>
<td><code>updated</code></td>
<td>更新时间</td>
<td><code>20210604222535</code></td>
</tr>
</tbody>
</table>
<h3 id=""refs-表"">refs 表</h3>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
<th>字段值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>引用 ID</td>
<td><code>20211127144458-idb32wk</code></td>
</tr>
<tr>
<td><code>def_block_id</code></td>
<td>被引用块的块 ID</td>
<td><code>20200925095848-aon4lem</code></td>
</tr>
<tr>
<td><code>def_block_parent_id</code></td>
<td>被引用块的双亲节点的块 ID</td>
<td><code>20200905090211-2vixtlf</code></td>
</tr>
<tr>
<td><code>def_block_root_id</code></td>
<td>被引用块所在文档的 ID</td>
<td><code>20200905090211-2vixtlf</code></td>
</tr>
<tr>
<td><code>def_block_path</code></td>
<td>被引用块所在文档的路径</td>
<td><code>/20200812220555-lj3enxa/20210808180320-fqgskfj/20200905090211-2vixtlf.sy</code></td>
</tr>
<tr>
<td><code>block_id</code></td>
<td>引用所在内容块 ID</td>
<td><code>20210104090624-c5bu25o</code></td>
</tr>
<tr>
<td><code>root_id</code></td>
<td>引用所在文档块 ID</td>
<td><code>20200905090211-2vixtlf</code></td>
</tr>
<tr>
<td><code>box</code></td>
<td>引用所在笔记本 ID</td>
<td><code>20210808180117-czj9bvb</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>引用所在文档块路径</td>
<td><code>/20200812220555-lj3enxa/20210808180320-fqgskfj/20200905090211-2vixtlf.sy</code></td>
</tr>
<tr>
<td><code>content</code></td>
<td>引用锚文本</td>
<td><code>元类型</code></td>
</tr>
<tr>
<td><code>markdown</code></td>
<td>包含完整 Markdown 标记符的文本</td>
<td><code>((20200925095848-aon4lem \""元类型\""))</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>引用类型</td>
<td><code>ref_id</code></td>
</tr>
</tbody>
</table>
<h3 id=""attributes-表app-translate-content-属性表"">attributes 表 app-translate-content 属性表</h3>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
<th>字段值示例 app-translate-content 字段值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>属性 IDapp-translate-content 属性 ID</td>
<td><code>20211127144458-h7y55zu</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td>属性名称 app-translate-content 属性名称</td>
<td><code>bookmark</code></td>
</tr>
<tr>
<td><code>value</code></td>
<td>属性值</td>
<td><code>✨</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>类型</td>
<td><code>b</code></td>
</tr>
<tr>
<td><code>block_id</code></td>
<td>块 IDapp-translate-content 块 ID</td>
<td><code>20210428212840-859h45j</code></td>
</tr>
<tr>
<td><code>root_id</code></td>
<td>文档 IDapp-translate-content 文档 ID</td>
<td><code>20200812220555-lj3enxa</code></td>
</tr>
<tr>
<td><code>box</code></td>
<td>笔记本 IDapp-translate-content 笔记本 ID</td>
<td><code>20210808180117-czj9bvb</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>文档文件路径 app-translate-content 文档文件路径</td>
<td><code>/20200812220555-lj3enxa.sy</code></td>
</tr>
</tbody>
</table>
<h3 id=""其他详细表结构"">其他详细表结构</h3>
<p>见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdocs.siyuan-note.club%2Fzh-Hans%2Freference%2Fdatabase%2Ftable.html"" target=""_blank"" rel=""nofollow ugc"">https://docs.siyuan-note.club/zh-Hans/reference/database/table.html</a></p>
                

作者：Frostime
链接：https://ld246.com/article/1683355095671
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
713,思源 SQL 新人指南：SQL 语法 + Query + 模板 - 链滴,Sat May 06 2023 14:38:14 GMT+0000 (Coordinated Universal Time),"
                    <p>本文响应「思源需要更好的文档」的号召编写。并提供了完整的 markdown 源代码（思源导出的）。</p>
<p>如果有自行编写帮助文档意愿的朋友，可以在遵守开源精神的前提下自行取用。</p>
<p><a href=""https://b3logfile.com/file/2023/05/思源SQL新人指南_SQL语法___Query___模板-SxMFcK4.zip"">思源 SQL 新人指南 SQL 语法 Query 模板.zip</a></p>
<h2 id=""引言"">引言</h2>
<h3 id=""为啥有个--SQL"">为啥有个  SQL</h3>
<p>　　思源笔记里 SQL 起到了一个重要的数据汇总作用，但是对于不了解 SQL 的人来讲，这是一个非常拧巴的东西。纯新人不明白这东西的意义何在；而 logseq 等其他笔记软件迁移过来的用户不明白为什么一个查询语句为什么要定义的那么复杂。</p>
<p>　　其实思源之所以要内置一个 SQL 查询功能，道理十分简单：因为<strong>思源在运行时真的会维护一个 SQLite 数据库</strong>用来存储笔记的所有数据，而你提交的每一个 SQL 查询都会<strong>真的提交给这个数据库执行</strong>——既然有一个这么方便的查询语法了，还有什么必要找别的中间商来赚差价呢？</p>
<p>　　所以，思源的 SQL 查询，为用户提供了<strong>直通软件底层的数据访问能力</strong> —— 这种数据访问的<strong>自由度</strong>完全不是传统笔记软件扣扣搜搜的「查询文本」、「查看文档属性」这种东西可以碰瓷的，你可以任意使用各种合法的 SQL 语句来查询思源内部的数据——没有任何中间商赚插件，真正做到了灵活多变。「当然了，再自由也只支持 select 语法，delete, update 这种危险的语法肯定是不可能直接给用户开放的」</p>
<p>　　至此我们已经解答了开始的两个问题：</p>
<ul>
<li>为什么要有个 SQL? 为了提供一个直通软件底层的数据查询功能</li>
<li>为什么不额外定义一个简单的查询语法？因为没有必要，思源内部维护了一个运行时数据库，没有必要在 SQL 上再加一个赚差价的中间商</li>
</ul>
<h3 id=""基础概念"">基础概念</h3>
<p>　　以上的文字，对于不了解数据库、SQL 的概念和关系的思源用户来说，估计看了还是一脸蒙蔽，什么他娘的 SQLite 、数据库、查询语法、SQL，这都是啥啊？—— 这里，我用尽可能短的篇幅来告诉你们这是什么东西。</p>
<p>　　如果已经开始使用思源笔记，你会发现思源中每个块是一个非常独立的个体。他有自己的内容，有创建、更新时间，有命名别名，甚至可以创建自定义的属性。</p>
<p>　　我们把这样有明确的内部属性定义的对象，称为一个「实体」，思源中的块就是一个实体，他的名字叫「blocks」。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683346579811-20230506121621-bhcl5sh.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　「实体」不是数据，而是对「数据应该长什么样子」的定义。就好比一个块应该具有 ID、创建时间、内容等属性。而每一个具体的块，在这些属性上都会有相应的取值。</p>
<p>　　每一个具体的块，都可以用上面一行数据来表示。而所有块放在一起，就组成了数据表。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683347261668-20230506122742-f16usds.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　看起来像不像 excel？没错，你完全可以把数据库理解成一个 excel 文件。</p>
<ul>
<li>数据库就是：excel 文件</li>
<li>数据表就是：excel 里各个 sheet</li>
<li>实体就是：每个 sheet 里列的定义，代表了这个 sheet 记录了什么</li>
<li>数据就是：表格里每一行</li>
</ul>
<p>　　虽然数据库可以理解为 excel，但是他不是 excel。excel 可以用 office 软件打开，可视化的编辑，但是数据库不行，他的直接用户不是人，而是计算机程序。所以他没有提供原生的可视化软件用来查询编辑，而是提供了一个名为 SQL 的编程语言来访问内部的数据。</p>
<p>　　总结一下就是：</p>
<ul>
<li>思源运行的时候，会维持一个数据库</li>
<li>思源的块、属性、链接什么的，都是独立存储在数据库中表里面</li>
<li>为了访问这个表当中的数据，我们需要使用 SQL 语言来查询数据表</li>
</ul>
<p>　　只有块才是一个实体吗？非也，思源的抽象做的是很好的。双向链接也是一个实体——它有一数据表「refs」；块属性也是一个实体——它有一个数据表「attributes」。这些表都是可以放到 SQL 查询语句里的。</p>
<p>　　我把常用的三个表的定义放在附录里了，需要的可以自行翻阅。</p>
<h2 id=""1-给菜鸟的-SQL-基本指南"">1 给菜鸟的 SQL 基本指南</h2>
<p>　　SQL 的用法非常灵活，但是灵活往往等价于复杂。于是有的没有计算机背景，但是又希望尝试的萌新们试着搜索某些教程——结果，进去之后发现乱七八糟看不懂，瞬间劝退。</p>
<p>　　实际上，希望在思源里面使用 SQL 的新人们大可不必抱着一个「SQL 从入门到入土」从头读到尾，<strong>思源中实际上会用到的 SQL 查询的语法根本没有那么多</strong>。我下面列举的几个基本语法可以应对 95% 的场景。</p>
<ul>
<li>
<p>基本查询</p>
<ul>
<li>select 语句：所有场景都会用到</li>
<li>where 语句：绝大部分场景下都会用到</li>
</ul>
</li>
<li>
<p>嵌套查询：高级用法</p>
</li>
</ul>
<h3 id=""1-1-基本查询"">1.1 基本查询</h3>
<p>　　你在思源中用到的所有查询都属于 SQL 中的 <code>select</code> 查询，如果你去翻阅一个正规 SQL 教程，他们会告诉你 select 语法的定义如下。<br>
其中 column1, column2, ...是列名，table_name 是要查询的表名称，<code>&lt;condition&gt;</code> 在这里指代查询的条件。如果要查询所有列，则可以用 * 代替列名。</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">SELECT</span> <span class=""highlight-err"">column</span><span class=""highlight-mi"">1</span><span class=""highlight-err"">,</span> <span class=""highlight-err"">column</span><span class=""highlight-mi"">2</span><span class=""highlight-err"">,</span> <span class=""highlight-err"">...</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">FROM</span> <span class=""highlight-err"">table_name</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-err"">where</span> <span class=""highlight-err"">&lt;condition&gt;;</span>
</span></span></code></pre>
<p>　　在思源里面，一般常用的表以及他们各自的字段的定义，我已经放在附录里面了。需要的可以自行查看。</p>
<p>　　==<strong>如果你是纯新人</strong>==，对什么「table」「column」完全不明白。你也可以先不用管上面这些复杂的讨论，需要做的很简单：**==照抄下面的语句==**，然后把 <code>&lt;condition&gt;</code> 改成**==自己需要的条件==**就行了。</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-o"">&lt;</span><span class=""highlight-n"">condition</span><span class=""highlight-o"">&gt;</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>　　思源中一个最简单的 SQL 查询如下图所示：</p>
<ol>
<li>中间靠右的表格就是思源运行时维护的数据库中 blocks 表，存储了一切块的信息</li>
<li>我们通过 <code>&lt;condition&gt;</code> 来匹配到我们希望的块</li>
<li>把这些匹配的块取出来，交给思源进行渲染（或其他处理）</li>
</ol>
<p>　　这就是 SQL 的基本流程，可见编写 SQL 最关键的就是要会编写 <code>&lt;condition&gt;</code></p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683307436970-20230506012406-w3dw1l9.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　那么 <code>&lt;condition&gt;</code> 是什么鬼？它在 SQL 里面被称为「查询条件」。具体语法我们一步一步来</p>
<ol>
<li>
<p>最基本的条件长这个样子</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<ul>
<li>
<p>左边的 <code>type</code> 我们把它称为 key</p>
<p>有时候你会看到 key 周围有 `` 包裹，这个是 SQL 语法的习惯，不用纠结</p>
</li>
<li>
<p>右边的 <code>\'d\'</code> 我们称为 value</p>
<p>value 周围包围有 \'\' 是因为这是一个字符串值，也不用纠结</p>
</li>
<li>
<p>中间的 <code>=</code> 被称为比较操作符，还有其他很多别的操作符：</p>
<ul>
<li><code>=</code> 代表了相等</li>
<li><code>&lt;</code> 代表了小于</li>
<li><code>&gt;</code> 代表了大于</li>
<li><code>!=</code> 代表了不相等</li>
<li><code>like</code> 代表了字符串模板匹配</li>
</ul>
</li>
</ul>
<p>所以，这个条件的含义是：要求块的 type 字段等于 \'d\'。</p>
<p>type 字段是思源 blocks 表中内置的一个字段，表示的含义是「块的类型」，决定了一个块到底是文档块还是列表块还是其他，而 \'d\' 表示为文档块。所以，如果我们写出来这么一个 SQL 语法。</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>那么得到的结果就是：选择所有 type 为 d（也就是类型为文档）的块。<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683307910543-20230506013152-ph195v3.png?imageView2/2/interlace/1/format/webp""></p>
<p>‍</p>
</li>
<li>
<p>组合：使用 and</p>
<p>条件肯定不能只有一个就行，总归是需要组合才行的。比如我们不光想要查询所有的文档块，还想要查询「所有的创建日期在 2023 年 4 月之后的文档块」——显然这就需要 and 来组合了。</p>
<p>首先我们来看看，「2023 年 4 月之后」这个条件要怎么表述呢？思源中有一个属性 <code>created</code> ，表示一个块是什么时候创建的，他的值的格式为 <code>20210104091228</code>，我们依样画葫芦，「2023 年 4 月之后」就是应该写作：「<code>created</code> &gt; \'20230401000000\'」。</p>
<p>而为了把这两个条件组合起来，我们可以使用 <code>and</code> 语句： <code>&lt;cond1&gt; and &lt;cond2&gt;</code>，最后的 sql 查询写成这样：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">created</span><span class=""highlight-w""> </span><span class=""highlight-o"">&gt;</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'20230401000000\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506013450-g2mkp8l.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>组合：使用 or</p>
<p>and 组合意味着「条件 A 和 条件 B 必须同时满足」。再思源的实践中，and 查询在绝大部分情况下都够用了。但是偶尔，我们可能也希望做这样的查询「条件 A 或 条件 B 至少满足一个」。这种情况下，就要使用 or 组合了。</p>
<p>假设我们需要查询所有的二级和三级标题，显然这个条件可以写为「标题级别为二级 或者 标题基本为三级」，于是可以使用以下 SQL 语句：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h2\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h3\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>and 和 or 组合使用：注意优先级问题</p>
<p>当我们要做比较复杂的查询，需要同时使用 and or 的时候，就要注意符号优先级的问题了，比如下面这个例子</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-n"">cond1</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond2</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond3</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>请问是先查询 <code>cond1 or cond2</code> 然后和 <code>cond3</code> 求交集呢？还是 <code>cond1</code> 和 <code>cond2 and cond3</code> 求并集呢？</p>
<p>所以为了避免这种混淆情况，请为复杂的条件加上括号来区分优先级</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">(</span><span class=""highlight-n"">cond1</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond2</span><span class=""highlight-p"">)</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond3</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-n"">cond1</span><span class=""highlight-w""> </span><span class=""highlight-k"">or</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-n"">cond2</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">cond3</span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>神奇的 <code>LIKE</code></p>
<p>在第一节的时候，我们提到了比较符号中有一个 <code>LIKE</code>，这个符号我们要额外讲一下。思源的数据库项目的数据类型基本都是字符串，因而字符串的比较是很重要的。我们在前面提到过的 <code>=</code> 代表的含义是「完全相等」。比如我们前面提到的：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h3\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>但是有时候，我们可能希望做一些部分匹配，这个时候就是 <code>LIKE</code> 的大显身手之处了。它用于匹配一种模式，用法和 <code>=</code> 类似也是：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">key</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-n"">value</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>但是同 LIKE 操作符匹配的 value 里，通常会使用通配符。通配符是一种特殊字符，可以匹配任意字符或一组字符。最常用的通配符有两个：</p>
<ul>
<li><code>%</code>：匹配零个或多个字符。</li>
<li><code>_</code>：匹配单个字符。</li>
</ul>
<p>举个例子：我们希望搜索创建日期在 2023 年 4 月 1 日的文档块，就可以这么做：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">created</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'20230401%\'</span><span class=""highlight-p"">;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>原本 created 字段的格式有很长一段，\'0401\' 后面还有时分秒之类的信息，但是使用通配符 <code>%</code> 就可以把这些无关紧要的信息全部省略，可以说很方便了。</p>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683308450040-20230506014051-hx98xim.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<p>　　‍</p>
<h3 id=""1-2-嵌套查询"">1.2 嵌套查询</h3>
<p>　　基本的 select + where 的查询在大部分简单的查询场景下都是够用的了的。但是如果涉及到双链，那么就不得不使用嵌套查询了。</p>
<p>　　思源笔记对双向链接的支持非常好，那么这个支持是如何体现在数据结构里的呢？在思源笔记的数据库中维护了一个 refs 表专门用来表示链接关系，双向链接就是通过 refs 表中的 <code>def_block_id</code> 和 <code>block_id</code> 两个字段来表示的。这两个字段分别指向了被引用的块和引用该块的块的 id。这样，我们可以通过 refs 表来查询两个块之间的关系。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506010221-3i0tzgu.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　嵌套查询可以被看作是一个查询语句作为另一个查询语句的一部分。它的执行顺序是</p>
<ul>
<li>先执行内部的查询</li>
<li>然后将内部查询的结果作为外部查询的条件进行查询</li>
</ul>
<p>　　我们无需深入理解其中的设计逻辑，对于萌新用户而言，只需要记住下面这个模板就行了：</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'特定笔记块的id\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">);</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p>　　在这个查询语句中：</p>
<ul>
<li>(...) 内部的 select 查询的结果是所有引用特定笔记块的笔记块的 id，我们可以把它想象成一个集合</li>
<li>外部查询使用 IN 关键字将其作为外部查询的条件之一</li>
</ul>
<p>　　于是这个语句可以被直观理解为</p>
<ol>
<li>
<p>先查询所有引用特定笔记块的笔记块的 id</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'特定笔记块的id\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683306504726-20230506010826-v5j4z6a.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>然后根据这些 id 查询对应的笔记块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-o"">&lt;</span><span class=""highlight-err"">上一步查询的</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-err"">集合</span><span class=""highlight-o"">&gt;</span><span class=""highlight-w"">
</span></span></span></code></pre>
<p><img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506010938-7n266jt.png?imageView2/2/interlace/1/format/webp""></p>
</li>
</ol>
<p>　　需要注意的是，虽然我们这里给的例子中，被嵌套的是 refs 表，但是不代表只能嵌套 refs 表。blocks 和 blocks 表也是可以嵌套在一起的。</p>
<h3 id=""1-3-其他高级语法"">1.3 其他高级语法</h3>
<p>　　基本上对思源笔记的查询来说，有了基本查询 + 嵌套查询，可以应对绝大部分场景。不过还有一些可能会用到的高级语法，我在这里罗列一下，有兴趣的自行去学习：</p>
<ul>
<li><code>union</code> 查询：用于将多个查询结果合并为一个结果集。</li>
<li><code>order by</code>：用于对查询结果按照指定的列进行排序。</li>
<li><code>limit</code>：用于限制查询结果的数量。</li>
<li><code>group by</code>：用于将查询结果按照指定的列进行分组。</li>
<li><code>having</code>：用于在 <code>group by</code> 后筛选分组结果。</li>
<li><code>join</code>：用于将多个表的数据连接起来查询。</li>
</ul>
<h2 id=""2-常用-SQL-查询示例"">2 常用 SQL 查询示例</h2>
<ul>
<li>
<p>查询所有文档块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询所有二级标题块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">subtype</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h2\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个文档的子文裆</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">path</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'%/当前文档id/%\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'d\'</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>随机漫游某个文档树下所有标题块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">SELECT</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">FROM</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">WHERE</span><span class=""highlight-w""> </span><span class=""highlight-n"">root_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">LIKE</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'文档 id\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'h\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">ORDER</span><span class=""highlight-w""> </span><span class=""highlight-k"">BY</span><span class=""highlight-w""> </span><span class=""highlight-n"">random</span><span class=""highlight-p"">()</span><span class=""highlight-w""> </span><span class=""highlight-k"">LIMIT</span><span class=""highlight-w""> </span><span class=""highlight-mi"">1</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询含有关键词「唯物主义」的段落块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">markdown</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'%唯物主义%\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-k"">type</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-s1"">\'p\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">ORDER</span><span class=""highlight-w""> </span><span class=""highlight-k"">BY</span><span class=""highlight-w""> </span><span class=""highlight-n"">updated</span><span class=""highlight-w""> </span><span class=""highlight-k"">desc</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询过去 7 天内没有完成的任务</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">SELECT</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">WHERE</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-k"">type</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""l\""</span><span class=""highlight-w""> </span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">subtype</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""t\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">created</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">&gt;</span><span class=""highlight-w""> </span><span class=""highlight-n"">strftime</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'%Y%m%d%H%M%S\'</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-n"">datetime</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'now\'</span><span class=""highlight-p"">,</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'-7 day\'</span><span class=""highlight-p"">))</span><span class=""highlight-w""> 
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-n"">markdown</span><span class=""highlight-w""> </span><span class=""highlight-n"">REGEXP</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""\\* \\[ \\] \\S+\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-k"">AND</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">parent_id</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-k"">not</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">  </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">id</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-o"">`</span><span class=""highlight-n"">subtype</span><span class=""highlight-o"">`</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""t\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个块所有的反链块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'当前块的id\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">);</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个文档下属的文档树内所有的反链</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">      </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">path</span><span class=""highlight-w""> </span><span class=""highlight-k"">like</span><span class=""highlight-w""> </span><span class=""highlight-s2"">\""%当前文档块 id%\""</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询某个书签下所有的块</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">attributes</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w"">    </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">name</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'bookmark\'</span><span class=""highlight-w""> </span><span class=""highlight-k"">and</span><span class=""highlight-w""> </span><span class=""highlight-n"">value</span><span class=""highlight-w""> </span><span class=""highlight-o"">=</span><span class=""highlight-w""> </span><span class=""highlight-s1"">\'书签名\'</span><span class=""highlight-w"">
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-w""></span><span class=""highlight-p"">);</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
<li>
<p>查询失效的块引用</p>
<pre><code class=""language-sql highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-o"">*</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w""> </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">refs</span><span class=""highlight-w""> </span><span class=""highlight-k"">where</span><span class=""highlight-w""> </span><span class=""highlight-k"">not</span><span class=""highlight-w""> </span><span class=""highlight-n"">def_block_id</span><span class=""highlight-w""> </span><span class=""highlight-k"">in</span><span class=""highlight-w""> </span><span class=""highlight-p"">(</span><span class=""highlight-w""> </span><span class=""highlight-k"">select</span><span class=""highlight-w""> </span><span class=""highlight-n"">id</span><span class=""highlight-w""> </span><span class=""highlight-k"">from</span><span class=""highlight-w""> </span><span class=""highlight-n"">blocks</span><span class=""highlight-w""> </span><span class=""highlight-p"">)</span><span class=""highlight-w""> </span><span class=""highlight-p"">)</span><span class=""highlight-w"">
</span></span></span></code></pre>
</li>
</ul>
<h2 id=""3-使用-Query-挂件"">3 使用 Query 挂件</h2>
<p>　　Query 是思源元老级别的挂件，由热心用户 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2FZuoqiu-Yingyi"" title=""Creator"" target=""_blank"" rel=""nofollow ugc"">Zuoqiu-Yingyi</a>（Dark+ 主体作者）提供，让我们为他鼓掌 ???。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/image-20230506012721-s3upahl.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　Query 挂件解决了两个很重要的问题：</p>
<ol>
<li>Query 为查询结果提供了嵌入块视图之外的表格视图</li>
<li>Qeury 让 SQL 查询目标不再只局限于 <code>select * from blocks</code></li>
</ol>
<h3 id=""3-1-Query-提供了表格视图"">3.1 Query 提供了表格视图</h3>
<p>　　首先来看看第一个问题，我在之前提到过「SQL 为用户提供了直通软件底层的访问能力」。这个说法其实是不严谨的，思源本体并没有给用户提供这么高的访问能力。原因在于，思源本体中，使用 SQL 查询的主要手段是使用嵌入块，而嵌入块虽然会执行 SQL 语句，但是他并不会把查询的结果（表格数据）返回给用户，而是会直接根据查询的结果把对应的块渲染到编辑器中。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683348866509-20230506125427-2nkvh9o.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　但是，如果使用 Query 挂件，就可以访问到原始的数据库信息。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683348961599-20230506125603-2rwtua2.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
<h3 id=""3-2-Query-让查询更加多样"">3.2 Query 让查询更加多样</h3>
<p>　　由于思源本体只提供了嵌入块 SQL 查询，就带来了另一个缺点：他不能查询那些无法被前端渲染出来的信息。</p>
<p>　　还记得，我在一开始介绍 SQL 语法的时候告诉大家，<code>select * from blocks</code> 这个语句不用管直接无脑套用就行了吗？原因在于嵌入块的查询最终的结果是要渲染成可以编辑的块的，所以：</p>
<ol>
<li>只能查询 blocks 表 <code>from blocks</code>，其他的表查询了也渲染不了</li>
<li>只能查询所有字段 <code>select *</code>，如果字段缺失，嵌入块没法渲染一个完整的块</li>
</ol>
<p>　　但是使用了 query 就不是问题，在这里，你可以自由发挥，你可以只查询某些字段：</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683349432106-20230506130353-ely2x5k.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　 也可以查询 blocks 以外的表：</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683349497039-20230506130458-cwex7ms.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　 可以说，有了 query 挂件的 SQL 查询，才是满血状态的。</p>
<p>　　当然目前思源正在开发的属性视图不知道会不会有额外的 SQL 支持，拭目以待吧。</p>
<p>　　‍</p>
<h2 id=""4-使用模板"">4 使用模板</h2>
<p>　　每次都要编写长长的 SQL 语句好麻烦呀！有没有方便一点的办法？</p>
<p>　　有——使用思源的模板。定义一个思源的模板非常简单，只需要在 <code>data/templates</code> 目录下创建若干 md 文件，这些 md 文件就可以作为模板导入思源。（当然为了方便管理，还是建议大家先创建一个文件夹，把自己的模板放到这个文件夹里面）。</p>
<h3 id=""4-1-在模板中预先定义-SQL"">4.1 在模板中预先定义 SQL</h3>
<p>　　如果你嫌弃每次敲击复杂的 SQL 语法很麻烦，完全可以预先把 SQL 语句写在模板当中，比如现在我在新建的模板 001.md 中写入如下文本。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">{{SELECT <span class=""highlight-ge"">* from blocks_esc_newline_WHERE `type` = \""l\"" AND `subtype` = \""t\""_esc_newline_AND `created` &gt; strftime(\'%Y%m%d%H%M%S\', datetime(\'now\', \'-7 day\')) _esc_newline_AND markdown REGEXP \""\\*</span> \\[ \\] \\S+\""_esc_newline_AND <span class=""highlight-sb"">`parent_id`</span> not in (_esc_newline_  select <span class=""highlight-sb"">`id`</span> from blocks where <span class=""highlight-sb"">`subtype`</span> = \""t\""_esc_newline_)_esc_newline_ORDER BY <span class=""highlight-sb"">`created`</span> DESC}}
</span></span></code></pre>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683353319436-20230506140840-uzobi39.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　上面的模板定义了一个嵌入块，嵌入块里的 SQL 是之前提到过的，查询过去七天内没有完成的任务。注意，嵌入块的代码必须写在一行内，不能换行。</p>
<p>　　现在在思源里面敲击 <code>/</code> 导入模板，立刻就可以把这个嵌入块快速导入进来：</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683353465253-20230506141106-st2rhvi.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
<h3 id=""4-2-在模板中定义-Query-模板"">4.2 在模板中定义 Query 模板</h3>
<p>　　模板的功能是很强大的，可以导入嵌入块，也可以导入 Query 挂件（前提是你要安装了这个挂件）。现在我们更改 001.md 的内容做一个挂件的模板。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where type = \'d\' and created &gt; \'20230501000000\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍‍‍‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">iframe</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""widget\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">iframe</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-query-fields=\""[\""type\"", \""content\"", \""hpath\"", \""memo\"", \""box\""]\"" custom-type=\""query-widget\"" custom-query-limit=\""\""len\""\"" custom-query-maxrow=\""2\"" custom-query-maxlen=\""20\""}
</span></span></code></pre>
<p>　　现在再次导入，你就可以看到一个 Query 挂件了。</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683353976752-20230506141938-rtzmlly.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　有些人可能会对上面给的 markdown 模板有些迷惑，觉得这似乎不是自己印象中的 markdown —— 你说的对，这其实是一种叫做 kramarkdown 的语法，他是对 markdown 的扩展。看到那个奇怪的 <code>{:  }</code> 语法了吗，它可以为近邻的 markdown 元素定义一些额外的属性，而思源会把这些属性作为块的属性一起导入。，举个例子，上面提到的 sql 代码块：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where type = \'d\' and created &gt; \'20230501000000\';
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span></code></pre>
<p>　　如果我们导入了模板后，尝试点击上面那个 SQL 代码块，就会发现这个自定义属性也导入进来了。（思源中以 <code>custom-</code> 开头的属性会被当作用户定义的自定义属性）</p>
<p>　　<img src=""https://b3logfile.com/file/2023/05/siyuan/1646569891270/assets/1683354238116-20230506142359-t9kbple.png?imageView2/2/interlace/1/format/webp""></p>
<p>　　‍</p>
<p>　　‍</p>
<h3 id=""4-3-模板的高级用法"">4.3 模板的高级用法</h3>
<p>　　如果我们想要定义一个模板，可以查询当前文档的反向链接，也许可以这么编写：</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where id in (
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    select block_id from refs where def_block_id = \'这里填写文档 ID\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">) order by <span class=""highlight-sb"">`updated`</span> desc
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">iframe</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""widget\""</span> <span class=""highlight-na"">border</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">frameborder</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""no\""</span> <span class=""highlight-na"">framespacing</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">allowfullscreen</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""true\""</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""width: 374px; height: 37px; border: none; background-color: transparent;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">iframe</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-query-fields=\""[\""type\"", \""content\"", \""hpath\"", \""memo\"", \""box\""]\"" custom-type=\""query-widget\"" custom-query-limit=\""\""len\""\"" custom-query-maxrow=\""2\"" custom-query-maxlen=\""20\""}
</span></span></code></pre>
<p>　　然后导入模板后，只需要更改正确的文档 ID 就行了。</p>
<p>　　但是实际上不用这么麻烦，思源的模板支持一些高级的编程特性，关于这一部分，思源内置的文档有详细的描述。如果你不在乎更高级的用法的话，那么记住一下两个语法就够了：</p>
<ul>
<li><code>.action{.id}</code>：它会被渲染为模板所在文档的 id</li>
<li><code>.action{.title}</code>：它会被渲染为模板所在文档的标题</li>
</ul>
<p>　　现在改写我们的模板如下，导入后，它可以直接查询本文档所有的反向链接。</p>
<pre><code class=""language-md highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl"">‍```sql
</span></span><span class=""highlight-line""><span class=""highlight-cl"">select * from blocks where id in (
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    select block_id from refs where def_block_id = \'.action{.id}\'
</span></span><span class=""highlight-line""><span class=""highlight-cl"">) order by <span class=""highlight-sb"">`updated`</span> desc
</span></span><span class=""highlight-line""><span class=""highlight-cl"">‍```
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-type=\""query-code\""}
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">&lt;</span><span class=""highlight-nt"">iframe</span> <span class=""highlight-na"">src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-src</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""/widgets/Query\""</span> <span class=""highlight-na"">data-subtype</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""widget\""</span> <span class=""highlight-na"">border</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">frameborder</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""no\""</span> <span class=""highlight-na"">framespacing</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""0\""</span> <span class=""highlight-na"">allowfullscreen</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""true\""</span> <span class=""highlight-na"">style</span><span class=""highlight-o"">=</span><span class=""highlight-s"">\""width: 374px; height: 37px; border: none; background-color: transparent;\""</span><span class=""highlight-p"">&gt;&lt;/</span><span class=""highlight-nt"">iframe</span><span class=""highlight-p"">&gt;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">{: custom-query-fields=\""[\""type\"", \""content\"", \""hpath\"", \""memo\"", \""box\""]\"" custom-type=\""query-widget\"" custom-query-limit=\""\""len\""\"" custom-query-maxrow=\""2\"" custom-query-maxlen=\""20\""}
</span></span></code></pre>
<p>　　‍</p>
<h2 id=""附录-思源的-SQL-表字段定义"">附录：思源的 SQL 表字段定义</h2>
<p>　　这里只列举了 blocks refs 和 attributes 表，主要是 SQL 查询我就没有遇到过需要用到别的表的情况。更何况其他的表知道的人没有必要看这个教程，看这个教程的人也没有必要知道。</p>
<p>　　如果你希望知道完整的数据库里所有表的定义，请查看社区自来水厂的<a href=""https://ld246.com/forward?goto=https%3A%2F%2Fwww.yuque.com%2Fsiyuannote%2Fdocs%2Fgo7uom"" target=""_blank"" rel=""nofollow ugc"">语雀笔记</a>（我记得上面有）。</p>
<h3 id=""blocks-表"">blocks 表</h3>
<p>　　该表用于存储内容块数据。</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
<th>字段值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>内容块 ID</td>
<td><code>20210104091228-d0rzbmm</code></td>
</tr>
<tr>
<td><code>parent_id</code></td>
<td>双亲块 ID，如果内容块是文档块则该字段为空</td>
<td><code>20200825162036-4dx365o</code></td>
</tr>
<tr>
<td><code>root_id</code></td>
<td>文档块 ID</td>
<td><code>20200825162036-4dx365o</code></td>
</tr>
<tr>
<td><code>hash</code></td>
<td><code>content</code> 字段的 SHA256 校验和</td>
<td><code>a75d25c</code></td>
</tr>
<tr>
<td><code>box</code></td>
<td>笔记本 ID</td>
<td><code>20210808180117-czj9bvb</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>内容块所在文档路径</td>
<td><code>/20200812220555-lj3enxa/20210808180320-abz7w6k/20200825162036-4dx365o.sy</code></td>
</tr>
<tr>
<td><code>hpath</code></td>
<td>人类可读的内容块所在文档路径</td>
<td><code>/0 请从这里开始/编辑器/排版元素</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td>内容块名称</td>
<td><code>一级标题命名</code></td>
</tr>
<tr>
<td><code>alias</code></td>
<td>内容块别名</td>
<td><code>一级标题别名</code></td>
</tr>
<tr>
<td><code>memo</code></td>
<td>内容块备注</td>
<td><code>一级标题备注</code></td>
</tr>
<tr>
<td><code>tag</code></td>
<td>非文档块为块内包含的标签，文档块为文档的标签</td>
<td><code>#标签1 #标签2# #标签3#</code></td>
</tr>
<tr>
<td><code>content</code></td>
<td>去除了 Markdown 标记符的文本</td>
<td><code>一级标题</code></td>
</tr>
<tr>
<td><code>fcontent</code></td>
<td>存储容器块第一个子块的内容(1.9.9 添加)</td>
<td><code>第一个子块</code></td>
</tr>
<tr>
<td><code>markdown</code></td>
<td>包含完整 Markdown 标记符的文本</td>
<td><code># 一级标题</code></td>
</tr>
<tr>
<td><code>length</code></td>
<td><code>markdown</code> 字段文本长度</td>
<td><code>6</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>内容块类型，参考⸢类型字段⸥</td>
<td><code>h</code></td>
</tr>
<tr>
<td><code>subtype</code></td>
<td>内容块子类型，参考⸢子类型字段⸥</td>
<td><code>h1</code></td>
</tr>
<tr>
<td><code>ial</code></td>
<td>内联属性列表，形如 <code>{: name=\""value\""}</code></td>
<td><code>{: id=\""20210104091228-d0rzbmm\"" updated=\""20210604222535\""}</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td>排序权重，数值越小排序越靠前</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>created</code></td>
<td>创建时间</td>
<td><code>20210104091228</code></td>
</tr>
<tr>
<td><code>updated</code></td>
<td>更新时间</td>
<td><code>20210604222535</code></td>
</tr>
</tbody>
</table>
<h3 id=""refs-表"">refs 表</h3>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
<th>字段值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>引用 ID</td>
<td><code>20211127144458-idb32wk</code></td>
</tr>
<tr>
<td><code>def_block_id</code></td>
<td>被引用块的块 ID</td>
<td><code>20200925095848-aon4lem</code></td>
</tr>
<tr>
<td><code>def_block_parent_id</code></td>
<td>被引用块的双亲节点的块 ID</td>
<td><code>20200905090211-2vixtlf</code></td>
</tr>
<tr>
<td><code>def_block_root_id</code></td>
<td>被引用块所在文档的 ID</td>
<td><code>20200905090211-2vixtlf</code></td>
</tr>
<tr>
<td><code>def_block_path</code></td>
<td>被引用块所在文档的路径</td>
<td><code>/20200812220555-lj3enxa/20210808180320-fqgskfj/20200905090211-2vixtlf.sy</code></td>
</tr>
<tr>
<td><code>block_id</code></td>
<td>引用所在内容块 ID</td>
<td><code>20210104090624-c5bu25o</code></td>
</tr>
<tr>
<td><code>root_id</code></td>
<td>引用所在文档块 ID</td>
<td><code>20200905090211-2vixtlf</code></td>
</tr>
<tr>
<td><code>box</code></td>
<td>引用所在笔记本 ID</td>
<td><code>20210808180117-czj9bvb</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>引用所在文档块路径</td>
<td><code>/20200812220555-lj3enxa/20210808180320-fqgskfj/20200905090211-2vixtlf.sy</code></td>
</tr>
<tr>
<td><code>content</code></td>
<td>引用锚文本</td>
<td><code>元类型</code></td>
</tr>
<tr>
<td><code>markdown</code></td>
<td>包含完整 Markdown 标记符的文本</td>
<td><code>((20200925095848-aon4lem \""元类型\""))</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>引用类型</td>
<td><code>ref_id</code></td>
</tr>
</tbody>
</table>
<h3 id=""attributes-表app-translate-content-属性表"">attributes 表 app-translate-content 属性表</h3>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
<th>字段值示例 app-translate-content 字段值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>属性 IDapp-translate-content 属性 ID</td>
<td><code>20211127144458-h7y55zu</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td>属性名称 app-translate-content 属性名称</td>
<td><code>bookmark</code></td>
</tr>
<tr>
<td><code>value</code></td>
<td>属性值</td>
<td><code>✨</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>类型</td>
<td><code>b</code></td>
</tr>
<tr>
<td><code>block_id</code></td>
<td>块 IDapp-translate-content 块 ID</td>
<td><code>20210428212840-859h45j</code></td>
</tr>
<tr>
<td><code>root_id</code></td>
<td>文档 IDapp-translate-content 文档 ID</td>
<td><code>20200812220555-lj3enxa</code></td>
</tr>
<tr>
<td><code>box</code></td>
<td>笔记本 IDapp-translate-content 笔记本 ID</td>
<td><code>20210808180117-czj9bvb</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>文档文件路径 app-translate-content 文档文件路径</td>
<td><code>/20200812220555-lj3enxa.sy</code></td>
</tr>
</tbody>
</table>
<h3 id=""其他详细表结构"">其他详细表结构</h3>
<p>见 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fdocs.siyuan-note.club%2Fzh-Hans%2Freference%2Fdatabase%2Ftable.html"" target=""_blank"" rel=""nofollow ugc"">https://docs.siyuan-note.club/zh-Hans/reference/database/table.html</a></p>
                

作者：Frostime
链接：https://ld246.com/article/1683355095671
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
732,2.8.6 云端快照回滚不能完全覆盖 - 链滴,Mon May 01 2023 13:01:49 GMT+0000 (Coordinated Universal Time),"
                    <p>在移动端上初始化同步，先手动上传 data，后导入移动端，后使用同样密钥初始化数据仓库。</p>
<p>进行同步后，有明显的同步时间。</p>
<p>同步成功后，进行检查，无数据冲突。</p>
<p>下载 pc 端同步时产生的数据快照，进行数据快照比对，发现产生约 400 个更新。</p>
<p>以 pc 端同步产生的数据快照为基准，进行数据快照回退。</p>
<p>回退后，少量编辑，手动产生新的数据快照，进行数据快照比对，依然存在约 400 个更新。由于少量编辑，更新数量略微增加。</p>
<p><img src=""https://b3logfile.com/file/2023/05/图片-nNHtNaf.png?imageView2/2/interlace/1/format/webp""></p>
<p>手动同步（非完全手动同步）同步到 pc 端，同样存在明显的同步时间，同步完成后，进行数据快照对比，发现也产生约 400 个更新。</p>
<p><img src=""https://b3logfile.com/file/2023/05/图片-TWnGVCx.png?imageView2/2/interlace/1/format/webp""></p>
<p>从少量抽样来看，无明显数据变化产生，使用 devtool 检查，其 updated 也是一致的。</p>
<p><img src=""https://b3logfile.com/file/2023/05/图片-MWg5sFR.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/05/图片-7zphdLU.png?imageView2/2/interlace/1/format/webp""></p>
<p>目前无法理解以下两个问题：</p>
<ul>
<li>数据快照产生更新的原因</li>
<li>在移动端回滚数据快照后，重新生成数据快照，依然有大量更新的原因。</li>
</ul>
<p>出于谨慎考虑，目前已经在 pc 端上回滚至未同步前的数据快照，并且关闭移动端的同步。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1682917310540
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
683,思源该怎么宣传？ - 链滴,Fri Apr 28 2023 21:32:59 GMT+0000 (Coordinated Universal Time),"
                    <p>这归根到底是一个软件的运营、销售问题，所以我们应该以产品的运营框架来考虑这个问题。</p>
<p>作为一个软件，思源的气质更接近于互联网产品，它们具有相同的气质：免费基本服务，付费增值服务，不太同的一点是，思源的基本服务太多了点，而付费增值服务并不具备独占性。</p>
<p>接下来，我将以互联网产品运营的框架分析一下思源的运营。</p>
<h4 id=""总论"">总论</h4>
<p>任何互联网产品运营的核心无非是两个：流量建设、用户运营。</p>
<p>流量建设，直白点说就是让尽可能多的人了解到思源，进而去使用思源。</p>
<p>流量的重要性其实已经不言而喻，就好像漏斗，假设每一个环节的转化是漏斗的一环，如果要累积到足够多的有价值用户，就需要足够大的流量，可转化的基础用户量就越大，那么当转化率到达瓶颈之后，持续的大量的流量就成为保证一个产品能够长久运营下去的关键因素之一。</p>
<p>虽然在移动互联网时代，我们可以靠获得更多的目标用户来提升转化率，但无论如何，有大量的持续基础流量都是有利无害的。考虑到思源是一个本地应用，非订阅用户使用时并不会占用运营资源，相比于云端应用，官方应该以更积极的态度鼓励用户使用思源。</p>
<p>用户运营，就是在持续有效地推动用户的活跃与留存，并从中发现有价值甚至高价值的用户，并让他们持续地为产品带来价值、产生收益，让产品可以存活下去，并且活得有质量。</p>
<p>在运营的具体工作，可以分层三个层面：产品运营、用户运营、活动运营。</p>
<p>因此，下面的内容分为 4 点，既<strong>产品运营</strong>、<strong>用户运营</strong>、<strong>活动运营和流量建设</strong>，外加一篇我觉得同样很重要的内容：<strong>用户教育</strong>。</p>
<h3 id=""-产品运营"">​产品运营</h3>
<p>思源的产品其实不只是思源本体软件这一个部分，宏观来看，还包括了思源的社区、思源的内容分享模块（主题、挂件、模板、图标还有未来的插件）</p>
<p>思源本体的功能我没办法做太多评价，因为我个人觉得功能已经足够好了，至于易用性方面的改进，我觉得放在用户教育模块更适合一点。</p>
<p>所以主要谈的是思源的社区和内容分享模块。</p>
<p>思源的社区和内容分享模块热度高吗？我认为是高的。</p>
<ul>
<li>思源的社区在单纯热度上足以与 obsidian 中文官方社区、logseq 英文官方社区相媲美，远超 logseq 的中文官方社区，只逊色于 obsidian 英文官方社区。至于那些国内笔记软件的社区，对思源来说完全是不值一提的。</li>
<li>思源的插件社区从第三方插件系统上线到现在不过一个多月，就已经积累了 23 个插件，其中算得上高质量的起码超过 10 个。obsidian 不好统计，但是 logseq 的插件系统是 2021 年 10 月左右就完工的，而且是官方的插件系统。到目前，logseq 插件市场总共积累了 229 个，其中还混杂了大量用于对接其他软件的插件。</li>
</ul>
<p>但是，在实际运作中，我能感受到其他软件的身影无处不在，而思源，仿佛消失在笔记软件的大海中，思源社区的热度像是假的一样。</p>
<p>这个原因在我看来分为两部分：</p>
<ul>
<li>一部分是因为思源之前确实没有走过主动运营推广的路线，在官方的声势上就弱了</li>
<li>另一部分则是思源社区和内容分享模块的资源从来没有被充分利用上，用户的自发宣传也接近于无</li>
</ul>
<p>对于第二点，我要先放暴论了：ld 社区是我所见到的、最不适合笔记经验分享、扩大用户自发宣传的设计。</p>
<p>这一个结论来自于我以下的观察：</p>
<ul>
<li>
<p>ld 社区对于思源的官方论坛模块没有什么特殊的对待，导致思源的内容之前要么在首页与其他内容混杂，要么在自己的模块里按发布时间排序。这导致永远你在思源的论坛里，看到最多的，都是对思源问题的抱怨、功能的要求和外观的不满。</p>
<p>客观而言，这些是任何一个笔记软件社区的常态，但是其他社区起码懂得把正经的笔记经验分享和这些负面反馈分开。因为除了同样遇到问题的其他用户和笔记软件的开发者，没有人会关注这些东西。</p>
<p>但是在思源，你不能够，你只能屎海捞金一样在这些东西里面找一些有用的东西。假如你是个新用户，你一进来就看到这么多的负面反馈，你还有用下去的信心吗？</p>
<p>当然，你可以说，思源的版块是有标签过滤的。但是这个东西，它一不是默认的，二是对于用户来说太不直观了。</p>
</li>
<li>
<p>ld 社区的搜索相当不好用，搜索结果与搜索内容关联性接近于无。这在之前使用站内搜索就是如此，换成百度搜索后，效果更差了，虽然关联性性提升了，但是内容缺失太严重，很多都搜不到。</p>
<p>这导致的一个严重后果就是：思源真正核心的用户，每天总是忙在回答新用户一些浅显、重复、但是用户手册里就是没有提到的内容。长期以往，思源核心用户的热情会消退，且也没有时间、精力对外宣传思源。</p>
</li>
<li>
<p>还有一个不如前两者重要，但也值得一说的点：ld 社区的编辑器、显示效果与思源内部编辑器、显示效果差异过大。</p>
<p>对于那些有便利分享功能的笔记软件来说，讨论社区的编辑器、显示效果不需要与软件本体一致，它们可以通过其他方式展示笔记的效果。但是思源不行，思源的超级块、模板、主题都只在思源内部可见，这严重阻碍了用户的宣传途径。</p>
</li>
</ul>
<p>对此，我认为思源的产品运作可以在以下三个方向进行改进。</p>
<h4 id=""独立思源社区"">独立思源社区</h4>
<p>将思源社区从 ld 社区独立出去，并且将思源社区里的标签改为领域。然后再把领域界面改为进入思源社区的默认界面。如果不愿意改动这么大，那起码需要在用户默认可见的地方隐藏掉问题反馈、功能请求，只需要让它们能找到即可。</p>
<p>思源社区的首页，必须留给对思源社区建设用处最大的经验分享、深度交流。而用户的反馈和功能要求只对思源本体的改进可能有所帮助，对于思源的社区建设益处并不大，不能让它们充斥社区用户的视野。</p>
<h4 id=""建立独立的-wiki-知识库"">建立独立的 wiki 知识库</h4>
<p>思源目前的搜索看来暂时是无法改进的，好在在开源界已经有大量成熟的开源方案可以利用。我个人是建议尝试一下 wiki.js，因为它的自动化程度看上去相对高一点。</p>
<p>思源社区内部目前已经沉积了大量的有价值的内容，只是受限于 ld 社区的搜索，无法获取。如果能够使用自动化的 api，将思源社区的深度文章转发到有着良好排版、阅读、检索体验更好的 wiki 知识库，那将对思源的分享、入门提供更好的途径。</p>
<p>于此同时，可以把思源上的问题与回答也作为 qa 板块放到 wiki 库上。由于数量庞大，先期可以暂时不做筛选处理，后期在慢慢汇总，保证大部分用户的问题和使用要求都能在思源 wiki 找到。</p>
<h4 id=""建立官方的思源-play"">建立官方的思源 play</h4>
<p>思源折腾群的群主已经尝试建立了一个 siyuanplay.com，目前我们感觉在允许新用户无负担尝试思源和分享思源的一些模板、代码片段上都非常好用。</p>
<p>虽然在国内的环境下允许新用户随意折腾可分享给其他人的网页可能有点太敏感，但是只取后一点对于思源目前的用户分享环境也有巨大的改善。</p>
<p>思源官方可以创建一个在网页端仅读的思源 docker 或类似的东西，允许通过审核的模板、主题、代码片段、插件在上面展示。</p>
<p>得益于思源打通了网页端和客户端，虽然主题没办法直接复制粘贴，但是可以直接把网页上的模板、代码片段原样复制粘贴下来，直接使用到用户的思源客户端上，甚至还可以直接下载打包成 sy。这对于分享思源的这些内容将有很大的改进。</p>
<h3 id=""用户运营"">用户运营</h3>
<p>用户运营的核心是开源、节流、促活跃。开源我准备放到<strong>活动运营和流量建设</strong>模块讨论，这里主要谈谈节流、促活跃。</p>
<p>节流，就是减少用户流失，这一行为在缺乏数据前是完全无法进行的。</p>
<p>据我观察，思源目前的分析工具仅有 Google Analytics 和 Sentry SDK。这些东西能否收集足够的信息以帮助挽回用户呢？我不清楚。所以我想问一下以下的问题：</p>
<ul>
<li>思源是否有办法检查客户端的哪些面板开启时间最长？</li>
<li>思源是否有办法获取客户端哪些功能频繁启用，却没有快捷键？</li>
<li>思源是否能收集被卸载的客户端之前的报错和功能使用轨迹？</li>
</ul>
<p>这些对于思源的节流都是有必要的。</p>
<p>但是，要是没办法获取到这种信息，那么思源起码也需要一个调查界面，在用户卸载程序的等待时间里做一点问卷调查。</p>
<p>促活跃，就是想办法让思源的非注册用户变为注册用户，让注册用户变为积极用户。</p>
<p>转化非注册用户到注册用户可以通过一些引导来改善转化率。但是这些措施可能会影响用户的观感，慎用。以下仅是举出一些我觉得可用的措施：</p>
<ul>
<li>在用户在官网下载思源开始后跳出注册界面。</li>
<li>在用户初次打开设置后跳转到登录、注册菜单。</li>
<li>在用户初次打开软件后打开思源社区（改善后）、思源 wiki、思源 play。（假如这些改善一个都没有，那自动打开全是负面反馈的 ld 社区还是算了吧）</li>
</ul>
<p>对于让注册用户变为积极用户，我认为可以通过改变积分规则来改善。</p>
<p>目前思源的积分规则有点过于一刀切了，原创经验分享扣积分，发表问题的解答扣积分，但是发一个问题，然后等到别人回答却能涨积分，这未免有点……</p>
<p>我认为虽然对于现存的、乐于经验分享的积极用户来说不是很在意分享会扣积分这一件事，但是如果想要吸引更多的用户踊跃分享，需要对他们进行一定奖励。</p>
<p>我个人觉得比较好的方法是综合原创指数、浏览量、还有其他的一些指标，动态地奖励一些积分。扣除积分的设置可以保留，但必须保，证除非是无意义的灌水，否则用户分享内容后所获得的积分，必须能覆盖扣除的值。</p>
<h3 id=""活动运营和流量建设"">活动运营和流量建设</h3>
<p>活动运营，顾名思义是通过组织活动在短期内快速提升相关指标的运营手段。在目前的要求下，就是思源的流量。</p>
<h4 id=""不建议团购"">不建议团购</h4>
<p>不管什么类型的运营，都逃不掉成本、预算这两个词。</p>
<p>在这种视角下，我不认为目前的团购活动是一个很有效的活动。这体现在它成本过高、效益太低。</p>
<p>第一，团购的实际成本并不低。思源并不是那种售卖本地许可证的软件，它的付费服务的云端成本是可能很高的。而且，与其他运营活动是投放人数越多、平均成本越低不同，思源激活码的团购活动是投放人数越多，平均成本越高的。</p>
<p>第二，团购的效益可能并不会很好。</p>
<p>首先，这个活动它不利于传播。对于一个新用户来说，说服一个朋友、同事去团购一款软件的付费服务，是一件非常艰难的事。更大概率是要么一人干脆买两人激活码，要么就算了。官方期待的团购行为比较可能出现在 qq 群、微信群拼团上车。但是这需要满足两个条件：有大量的免费用户，这些免费用户需要思源的付费功能、但是之前价格阻碍了他们的意愿。</p>
<p>两个条件中，最重要的是：<strong>有大量的免费用户存在了</strong>。也就是，拼团上车的团购活动只应该存在于已经获得大量流量、需要转化这些流量为付费用户的产品。对于目前在外界缺乏热度的思源来说，想通过团购活动获得大量新的用户，这可能有点不切实际。</p>
<p>第三，它不能激励到老用户协助传播，且这个活动的定向性并不好。老用户也可以通过注册新账号的方式来获取这个优惠，导致原本的订阅收入受影响。正常来说，一个良好的运营活动应该能调动老用户，且越多老用户参与对运营越有利。但是团购却会造成相反的情况，这对于一个运营活动来说，是比较失败的。</p>
<p>因此，在我看来，团购活动还是尽早下线为妙。当然，在下线之前最好在团购界面加一个不长的倒计时，用 deadline 看看能否改善效果。</p>
<h4 id=""思源的路线"">思源的路线</h4>
<p>在我看来，思源并没有足够的资金进行传统的广告投放，这也是事实。在这种情况下，思源还可以走的推广路线有社交平台和自媒体平台，在这些平台上，只要满足了一定的条件，很快就能做到裂变式传播。</p>
<p>而这两种传播途径，都有一个核心要素：主动传播思源的用户。</p>
<p>因此，核心问题就是：如何激励用户传播思源？又应该如何传播？</p>
<p>前一个问题还是比较好回答的，思源能给出的激励无非就是思源的增值服务、荣誉和返现。我个人是不喜欢返现这一种激励，因为说实话，太俗气了。因此，我建议思源官方主要考虑的激励方向可以是增值服务和荣誉。</p>
<p>增值服务分为两种维度：使用时长和使用空间。我建议统一使用积分来计量，这样子可以简便地由用户自由转换为使用空间。从积分转化为使用时长的门槛可以适当高一些，比如说 40,000/一年左右，这样子可以先不需要写转化机制，先手动操作试水。如果证明效果显著，再写一个专门的自动化机制。</p>
<p>荣誉的话可以给思源增加一些响应的头衔，并增加几个等级，比如说思源宣传大使、思源运营官、思源首席运营官之类的。虽然看上去有点搞笑，但是很多时候确实是有效的。</p>
<p>这些奖励措施可以与下面的传播机制结合起来，提升传播机制的效果。</p>
<p>关于思源如何传播，我认为需要结合三种机制：邀请链接、软文优惠、内容分享。</p>
<h4 id=""邀请链接"">邀请链接</h4>
<p>相比起团购，我认为还是邀请链接更好一点。原因在于便于传播、能调动老用户、成本可控。</p>
<ul>
<li>首先是便于传播。对于用户来说，你只需要粘贴一条邀请链接就可以，比起说服一个陌生人或熟悉的人去一起订阅一个服务，这样的心理负担和难度无无疑是低了很多。而且，这是一种链式传播的途径：任何一个新用户都可以拥有自己的邀请链接，然后通过自己的渠道再次传播。如此一传二，二传四，四传八……能在极短时间里积累用户量。</li>
<li>能调用老用户。对于目前的思源订阅用户来说，价格已经付了，不构成考虑因素了，但是空间容量成了新的问题。在社区里，确实广泛存在希望有扩容方案的用户，但是目前与扩容方案绑定的积分获取途径有限，签到慢、获得量少，使用赞助获取则略显昂贵。如果能使用邀请链接的方法获得积分，那么一定能激发这些用户的热情。</li>
<li>成本可控。与团购不同，邀请链接方式的成本是较低的。只要控制好奖励的积分，虽然在极少数宣传效果极好的用户身上可能出现折扣、空间过大的现象，但总体而言成本上升比例并不会太多，就类似于各种转发抽奖的活动一样。</li>
</ul>
<p>邀请链接的积分奖励我认为需要分阶段给出，对于新用户下载思源、新用户注册账号、新用户订阅思源服务都给出一定的奖励，以下的阶段积分可以作为参考：</p>
<ul>
<li>新用户下载思源：50</li>
<li>新用户注册思源：500</li>
<li>新用户订阅思源：3500</li>
</ul>
<p>另外，这个积分奖励最好是双向的，减少新用户使用邀请链接注册的抵触心理。</p>
<h4 id=""软文优惠"">软文优惠</h4>
<p>对于使用思源、想要订阅的用户，我们要积极鼓励他们分享思源到各个平台上，并给予一定的奖励。这一过程中，不需要他们使用邀请链接，只需要他们的分享内容是有助于推广思源的，并且阅读数、点赞数、观看数达到一定标准，就要给出奖励。</p>
<p>奖励可以是分阶段、也分用户的。</p>
<p>分阶段是指，不同的传播效果应该有不同等级的奖励措施。</p>
<p>分用户是指，对于新用户和订阅用户应该分开处理。</p>
<p>新用户应该以奖励订阅折扣、订阅时长为主。从 75 折到一年订阅都可以。如果宣传效果特别好（b 站 10 万播放、知乎 3000 赞之类的），也可以考虑奖励永 v。</p>
<p>订阅用户以奖励空间容量、荣誉为主，也就是奖励目前社区的通用货币——积分还有头衔。如果真的有需要将积分转化为订阅时长的，也可以先手动操作，人多了在想办法实现自动化机制。</p>
<h4 id=""内容分享"">内容分享</h4>
<p>思源的导出必须要利用上。据我所见，思源的导出是目前最为好看、格式最为丰富的。最妙的是，思源支持导出图片。因此，我认为必须为思源的病毒式传播提供方案，那一个基础就是利用思源的导出。这可以与思源的邀请注册奖励方案结合。</p>
<p>思源的图片可以在右下角添加思源的邀请注册二维码，思源的网页、pdf 导出也可以添加思源的图标、广告语和跳转链接。思源的知乎、微信导出都可以添加跳转邀请链接。这些都是一个简单的开关，允许用户选择是否开启。但是开启后，任何一个通过导出的邀请链接注册的用户都会给分享的用户带来一定的奖励。</p>
<h3 id=""用户教育"">用户教育</h3>
<p>本来这篇也想写一点东西的，但是看了看群里，感觉讨论的也挺完善了，所以就在讲一点就算了。</p>
<p>用户教育，本质上就是教育用户怎么用你的软件，你需要把用户想象得越无知越好。但是思源目前很多设置并不能体现这一点。其他老生常谈的东西我就不说了，我就想再说一个：统一设计语言。</p>
<p>这个概念的意思是，任何交互的元件，比如说开关，就要做出一模一样的开关的样子，让用户一看就知道这是一个开关。按钮也是这样。但是在思源的一些设计中，你不挪上去，你都不知道这居然是一个按钮，比如说下面这个：</p>
<p>​<img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230428212922-llmlfxq.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>如果开发者不想为这种功能也专门写一个解释的话，我建议最好还是设计回这样的样式：</p>
<p>​<img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230428213028-c8j6mu8.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍</p>
                

作者：zxhd86
链接：https://ld246.com/article/1682688779751
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
734,思源该怎么宣传？ - 链滴,Fri Apr 28 2023 21:32:59 GMT+0000 (Coordinated Universal Time),"
                    <p>这归根到底是一个软件的运营、销售问题，所以我们应该以产品的运营框架来考虑这个问题。</p>
<p>作为一个软件，思源的气质更接近于互联网产品，它们具有相同的气质：免费基本服务，付费增值服务，不太同的一点是，思源的基本服务太多了点，而付费增值服务并不具备独占性。</p>
<p>接下来，我将以互联网产品运营的框架分析一下思源的运营。</p>
<h4 id=""总论"">总论</h4>
<p>任何互联网产品运营的核心无非是两个：流量建设、用户运营。</p>
<p>流量建设，直白点说就是让尽可能多的人了解到思源，进而去使用思源。</p>
<p>流量的重要性其实已经不言而喻，就好像漏斗，假设每一个环节的转化是漏斗的一环，如果要累积到足够多的有价值用户，就需要足够大的流量，可转化的基础用户量就越大，那么当转化率到达瓶颈之后，持续的大量的流量就成为保证一个产品能够长久运营下去的关键因素之一。</p>
<p>虽然在移动互联网时代，我们可以靠获得更多的目标用户来提升转化率，但无论如何，有大量的持续基础流量都是有利无害的。考虑到思源是一个本地应用，非订阅用户使用时并不会占用运营资源，相比于云端应用，官方应该以更积极的态度鼓励用户使用思源。</p>
<p>用户运营，就是在持续有效地推动用户的活跃与留存，并从中发现有价值甚至高价值的用户，并让他们持续地为产品带来价值、产生收益，让产品可以存活下去，并且活得有质量。</p>
<p>在运营的具体工作，可以分层三个层面：产品运营、用户运营、活动运营。</p>
<p>因此，下面的内容分为 4 点，既<strong>产品运营</strong>、<strong>用户运营</strong>、<strong>活动运营和流量建设</strong>，外加一篇我觉得同样很重要的内容：<strong>用户教育</strong>。</p>
<h3 id=""-产品运营"">​产品运营</h3>
<p>思源的产品其实不只是思源本体软件这一个部分，宏观来看，还包括了思源的社区、思源的内容分享模块（主题、挂件、模板、图标还有未来的插件）</p>
<p>思源本体的功能我没办法做太多评价，因为我个人觉得功能已经足够好了，至于易用性方面的改进，我觉得放在用户教育模块更适合一点。</p>
<p>所以主要谈的是思源的社区和内容分享模块。</p>
<p>思源的社区和内容分享模块热度高吗？我认为是高的。</p>
<ul>
<li>思源的社区在单纯热度上足以与 obsidian 中文官方社区、logseq 英文官方社区相媲美，远超 logseq 的中文官方社区，只逊色于 obsidian 英文官方社区。至于那些国内笔记软件的社区，对思源来说完全是不值一提的。</li>
<li>思源的插件社区从第三方插件系统上线到现在不过一个多月，就已经积累了 23 个插件，其中算得上高质量的起码超过 10 个。obsidian 不好统计，但是 logseq 的插件系统是 2021 年 10 月左右就完工的，而且是官方的插件系统。到目前，logseq 插件市场总共积累了 229 个，其中还混杂了大量用于对接其他软件的插件。</li>
</ul>
<p>但是，在实际运作中，我能感受到其他软件的身影无处不在，而思源，仿佛消失在笔记软件的大海中，思源社区的热度像是假的一样。</p>
<p>这个原因在我看来分为两部分：</p>
<ul>
<li>一部分是因为思源之前确实没有走过主动运营推广的路线，在官方的声势上就弱了</li>
<li>另一部分则是思源社区和内容分享模块的资源从来没有被充分利用上，用户的自发宣传也接近于无</li>
</ul>
<p>对于第二点，我要先放暴论了：ld 社区是我所见到的、最不适合笔记经验分享、扩大用户自发宣传的设计。</p>
<p>这一个结论来自于我以下的观察：</p>
<ul>
<li>
<p>ld 社区对于思源的官方论坛模块没有什么特殊的对待，导致思源的内容之前要么在首页与其他内容混杂，要么在自己的模块里按发布时间排序。这导致永远你在思源的论坛里，看到最多的，都是对思源问题的抱怨、功能的要求和外观的不满。</p>
<p>客观而言，这些是任何一个笔记软件社区的常态，但是其他社区起码懂得把正经的笔记经验分享和这些负面反馈分开。因为除了同样遇到问题的其他用户和笔记软件的开发者，没有人会关注这些东西。</p>
<p>但是在思源，你不能够，你只能屎海捞金一样在这些东西里面找一些有用的东西。假如你是个新用户，你一进来就看到这么多的负面反馈，你还有用下去的信心吗？</p>
<p>当然，你可以说，思源的版块是有标签过滤的。但是这个东西，它一不是默认的，二是对于用户来说太不直观了。</p>
</li>
<li>
<p>ld 社区的搜索相当不好用，搜索结果与搜索内容关联性接近于无。这在之前使用站内搜索就是如此，换成百度搜索后，效果更差了，虽然关联性性提升了，但是内容缺失太严重，很多都搜不到。</p>
<p>这导致的一个严重后果就是：思源真正核心的用户，每天总是忙在回答新用户一些浅显、重复、但是用户手册里就是没有提到的内容。长期以往，思源核心用户的热情会消退，且也没有时间、精力对外宣传思源。</p>
</li>
<li>
<p>还有一个不如前两者重要，但也值得一说的点：ld 社区的编辑器、显示效果与思源内部编辑器、显示效果差异过大。</p>
<p>对于那些有便利分享功能的笔记软件来说，讨论社区的编辑器、显示效果不需要与软件本体一致，它们可以通过其他方式展示笔记的效果。但是思源不行，思源的超级块、模板、主题都只在思源内部可见，这严重阻碍了用户的宣传途径。</p>
</li>
</ul>
<p>对此，我认为思源的产品运作可以在以下三个方向进行改进。</p>
<h4 id=""独立思源社区"">独立思源社区</h4>
<p>将思源社区从 ld 社区独立出去，并且将思源社区里的标签改为领域。然后再把领域界面改为进入思源社区的默认界面。如果不愿意改动这么大，那起码需要在用户默认可见的地方隐藏掉问题反馈、功能请求，只需要让它们能找到即可。</p>
<p>思源社区的首页，必须留给对思源社区建设用处最大的经验分享、深度交流。而用户的反馈和功能要求只对思源本体的改进可能有所帮助，对于思源的社区建设益处并不大，不能让它们充斥社区用户的视野。</p>
<h4 id=""建立独立的-wiki-知识库"">建立独立的 wiki 知识库</h4>
<p>思源目前的搜索看来暂时是无法改进的，好在在开源界已经有大量成熟的开源方案可以利用。我个人是建议尝试一下 wiki.js，因为它的自动化程度看上去相对高一点。</p>
<p>思源社区内部目前已经沉积了大量的有价值的内容，只是受限于 ld 社区的搜索，无法获取。如果能够使用自动化的 api，将思源社区的深度文章转发到有着良好排版、阅读、检索体验更好的 wiki 知识库，那将对思源的分享、入门提供更好的途径。</p>
<p>于此同时，可以把思源上的问题与回答也作为 qa 板块放到 wiki 库上。由于数量庞大，先期可以暂时不做筛选处理，后期在慢慢汇总，保证大部分用户的问题和使用要求都能在思源 wiki 找到。</p>
<h4 id=""建立官方的思源-play"">建立官方的思源 play</h4>
<p>思源折腾群的群主已经尝试建立了一个 siyuanplay.com，目前我们感觉在允许新用户无负担尝试思源和分享思源的一些模板、代码片段上都非常好用。</p>
<p>虽然在国内的环境下允许新用户随意折腾可分享给其他人的网页可能有点太敏感，但是只取后一点对于思源目前的用户分享环境也有巨大的改善。</p>
<p>思源官方可以创建一个在网页端仅读的思源 docker 或类似的东西，允许通过审核的模板、主题、代码片段、插件在上面展示。</p>
<p>得益于思源打通了网页端和客户端，虽然主题没办法直接复制粘贴，但是可以直接把网页上的模板、代码片段原样复制粘贴下来，直接使用到用户的思源客户端上，甚至还可以直接下载打包成 sy。这对于分享思源的这些内容将有很大的改进。</p>
<h3 id=""用户运营"">用户运营</h3>
<p>用户运营的核心是开源、节流、促活跃。开源我准备放到<strong>活动运营和流量建设</strong>模块讨论，这里主要谈谈节流、促活跃。</p>
<p>节流，就是减少用户流失，这一行为在缺乏数据前是完全无法进行的。</p>
<p>据我观察，思源目前的分析工具仅有 Google Analytics 和 Sentry SDK。这些东西能否收集足够的信息以帮助挽回用户呢？我不清楚。所以我想问一下以下的问题：</p>
<ul>
<li>思源是否有办法检查客户端的哪些面板开启时间最长？</li>
<li>思源是否有办法获取客户端哪些功能频繁启用，却没有快捷键？</li>
<li>思源是否能收集被卸载的客户端之前的报错和功能使用轨迹？</li>
</ul>
<p>这些对于思源的节流都是有必要的。</p>
<p>但是，要是没办法获取到这种信息，那么思源起码也需要一个调查界面，在用户卸载程序的等待时间里做一点问卷调查。</p>
<p>促活跃，就是想办法让思源的非注册用户变为注册用户，让注册用户变为积极用户。</p>
<p>转化非注册用户到注册用户可以通过一些引导来改善转化率。但是这些措施可能会影响用户的观感，慎用。以下仅是举出一些我觉得可用的措施：</p>
<ul>
<li>在用户在官网下载思源开始后跳出注册界面。</li>
<li>在用户初次打开设置后跳转到登录、注册菜单。</li>
<li>在用户初次打开软件后打开思源社区（改善后）、思源 wiki、思源 play。（假如这些改善一个都没有，那自动打开全是负面反馈的 ld 社区还是算了吧）</li>
</ul>
<p>对于让注册用户变为积极用户，我认为可以通过改变积分规则来改善。</p>
<p>目前思源的积分规则有点过于一刀切了，原创经验分享扣积分，发表问题的解答扣积分，但是发一个问题，然后等到别人回答却能涨积分，这未免有点……</p>
<p>我认为虽然对于现存的、乐于经验分享的积极用户来说不是很在意分享会扣积分这一件事，但是如果想要吸引更多的用户踊跃分享，需要对他们进行一定奖励。</p>
<p>我个人觉得比较好的方法是综合原创指数、浏览量、还有其他的一些指标，动态地奖励一些积分。扣除积分的设置可以保留，但必须保，证除非是无意义的灌水，否则用户分享内容后所获得的积分，必须能覆盖扣除的值。</p>
<h3 id=""活动运营和流量建设"">活动运营和流量建设</h3>
<p>活动运营，顾名思义是通过组织活动在短期内快速提升相关指标的运营手段。在目前的要求下，就是思源的流量。</p>
<h4 id=""不建议团购"">不建议团购</h4>
<p>不管什么类型的运营，都逃不掉成本、预算这两个词。</p>
<p>在这种视角下，我不认为目前的团购活动是一个很有效的活动。这体现在它成本过高、效益太低。</p>
<p>第一，团购的实际成本并不低。思源并不是那种售卖本地许可证的软件，它的付费服务的云端成本是可能很高的。而且，与其他运营活动是投放人数越多、平均成本越低不同，思源激活码的团购活动是投放人数越多，平均成本越高的。</p>
<p>第二，团购的效益可能并不会很好。</p>
<p>首先，这个活动它不利于传播。对于一个新用户来说，说服一个朋友、同事去团购一款软件的付费服务，是一件非常艰难的事。更大概率是要么一人干脆买两人激活码，要么就算了。官方期待的团购行为比较可能出现在 qq 群、微信群拼团上车。但是这需要满足两个条件：有大量的免费用户，这些免费用户需要思源的付费功能、但是之前价格阻碍了他们的意愿。</p>
<p>两个条件中，最重要的是：<strong>有大量的免费用户存在了</strong>。也就是，拼团上车的团购活动只应该存在于已经获得大量流量、需要转化这些流量为付费用户的产品。对于目前在外界缺乏热度的思源来说，想通过团购活动获得大量新的用户，这可能有点不切实际。</p>
<p>第三，它不能激励到老用户协助传播，且这个活动的定向性并不好。老用户也可以通过注册新账号的方式来获取这个优惠，导致原本的订阅收入受影响。正常来说，一个良好的运营活动应该能调动老用户，且越多老用户参与对运营越有利。但是团购却会造成相反的情况，这对于一个运营活动来说，是比较失败的。</p>
<p>因此，在我看来，团购活动还是尽早下线为妙。当然，在下线之前最好在团购界面加一个不长的倒计时，用 deadline 看看能否改善效果。</p>
<h4 id=""思源的路线"">思源的路线</h4>
<p>在我看来，思源并没有足够的资金进行传统的广告投放，这也是事实。在这种情况下，思源还可以走的推广路线有社交平台和自媒体平台，在这些平台上，只要满足了一定的条件，很快就能做到裂变式传播。</p>
<p>而这两种传播途径，都有一个核心要素：主动传播思源的用户。</p>
<p>因此，核心问题就是：如何激励用户传播思源？又应该如何传播？</p>
<p>前一个问题还是比较好回答的，思源能给出的激励无非就是思源的增值服务、荣誉和返现。我个人是不喜欢返现这一种激励，因为说实话，太俗气了。因此，我建议思源官方主要考虑的激励方向可以是增值服务和荣誉。</p>
<p>增值服务分为两种维度：使用时长和使用空间。我建议统一使用积分来计量，这样子可以简便地由用户自由转换为使用空间。从积分转化为使用时长的门槛可以适当高一些，比如说 40,000/一年左右，这样子可以先不需要写转化机制，先手动操作试水。如果证明效果显著，再写一个专门的自动化机制。</p>
<p>荣誉的话可以给思源增加一些响应的头衔，并增加几个等级，比如说思源宣传大使、思源运营官、思源首席运营官之类的。虽然看上去有点搞笑，但是很多时候确实是有效的。</p>
<p>这些奖励措施可以与下面的传播机制结合起来，提升传播机制的效果。</p>
<p>关于思源如何传播，我认为需要结合三种机制：邀请链接、软文优惠、内容分享。</p>
<h4 id=""邀请链接"">邀请链接</h4>
<p>相比起团购，我认为还是邀请链接更好一点。原因在于便于传播、能调动老用户、成本可控。</p>
<ul>
<li>首先是便于传播。对于用户来说，你只需要粘贴一条邀请链接就可以，比起说服一个陌生人或熟悉的人去一起订阅一个服务，这样的心理负担和难度无无疑是低了很多。而且，这是一种链式传播的途径：任何一个新用户都可以拥有自己的邀请链接，然后通过自己的渠道再次传播。如此一传二，二传四，四传八……能在极短时间里积累用户量。</li>
<li>能调用老用户。对于目前的思源订阅用户来说，价格已经付了，不构成考虑因素了，但是空间容量成了新的问题。在社区里，确实广泛存在希望有扩容方案的用户，但是目前与扩容方案绑定的积分获取途径有限，签到慢、获得量少，使用赞助获取则略显昂贵。如果能使用邀请链接的方法获得积分，那么一定能激发这些用户的热情。</li>
<li>成本可控。与团购不同，邀请链接方式的成本是较低的。只要控制好奖励的积分，虽然在极少数宣传效果极好的用户身上可能出现折扣、空间过大的现象，但总体而言成本上升比例并不会太多，就类似于各种转发抽奖的活动一样。</li>
</ul>
<p>邀请链接的积分奖励我认为需要分阶段给出，对于新用户下载思源、新用户注册账号、新用户订阅思源服务都给出一定的奖励，以下的阶段积分可以作为参考：</p>
<ul>
<li>新用户下载思源：50</li>
<li>新用户注册思源：500</li>
<li>新用户订阅思源：3500</li>
</ul>
<p>另外，这个积分奖励最好是双向的，减少新用户使用邀请链接注册的抵触心理。</p>
<h4 id=""软文优惠"">软文优惠</h4>
<p>对于使用思源、想要订阅的用户，我们要积极鼓励他们分享思源到各个平台上，并给予一定的奖励。这一过程中，不需要他们使用邀请链接，只需要他们的分享内容是有助于推广思源的，并且阅读数、点赞数、观看数达到一定标准，就要给出奖励。</p>
<p>奖励可以是分阶段、也分用户的。</p>
<p>分阶段是指，不同的传播效果应该有不同等级的奖励措施。</p>
<p>分用户是指，对于新用户和订阅用户应该分开处理。</p>
<p>新用户应该以奖励订阅折扣、订阅时长为主。从 75 折到一年订阅都可以。如果宣传效果特别好（b 站 10 万播放、知乎 3000 赞之类的），也可以考虑奖励永 v。</p>
<p>订阅用户以奖励空间容量、荣誉为主，也就是奖励目前社区的通用货币——积分还有头衔。如果真的有需要将积分转化为订阅时长的，也可以先手动操作，人多了在想办法实现自动化机制。</p>
<h4 id=""内容分享"">内容分享</h4>
<p>思源的导出必须要利用上。据我所见，思源的导出是目前最为好看、格式最为丰富的。最妙的是，思源支持导出图片。因此，我认为必须为思源的病毒式传播提供方案，那一个基础就是利用思源的导出。这可以与思源的邀请注册奖励方案结合。</p>
<p>思源的图片可以在右下角添加思源的邀请注册二维码，思源的网页、pdf 导出也可以添加思源的图标、广告语和跳转链接。思源的知乎、微信导出都可以添加跳转邀请链接。这些都是一个简单的开关，允许用户选择是否开启。但是开启后，任何一个通过导出的邀请链接注册的用户都会给分享的用户带来一定的奖励。</p>
<h3 id=""用户教育"">用户教育</h3>
<p>本来这篇也想写一点东西的，但是看了看群里，感觉讨论的也挺完善了，所以就在讲一点就算了。</p>
<p>用户教育，本质上就是教育用户怎么用你的软件，你需要把用户想象得越无知越好。但是思源目前很多设置并不能体现这一点。其他老生常谈的东西我就不说了，我就想再说一个：统一设计语言。</p>
<p>这个概念的意思是，任何交互的元件，比如说开关，就要做出一模一样的开关的样子，让用户一看就知道这是一个开关。按钮也是这样。但是在思源的一些设计中，你不挪上去，你都不知道这居然是一个按钮，比如说下面这个：</p>
<p>​<img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230428212922-llmlfxq.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>如果开发者不想为这种功能也专门写一个解释的话，我建议最好还是设计回这样的样式：</p>
<p>​<img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230428213028-c8j6mu8.png?imageView2/2/interlace/1/format/webp"">​</p>
<p>‍</p>
                

作者：zxhd86
链接：https://ld246.com/article/1682688779751
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
733,题头图链接带空格会出错 - 链滴,Tue Apr 25 2023 23:24:58 GMT+0000 (Coordinated Universal Time),"
                    <p>在插入 assets 下的图片是发现的，应该是链接空格未作转义处理，把空格改成 %20 就正常了。</p>
<p><img src=""https://b3logfile.com/file/2023/04/图片-HhafJ9C.png?imageView2/2/interlace/1/format/webp""></p>
<p>假如链接只来自网络的话是适用的，但是很多用户会使用 assets 下的图片作为题头图，而且是经常直接从菜单的图片链接里面复制，不可避免地有时候会带上空格。</p>
<p>这个应该不难处理，希望尽早修复。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1682436299194
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
736,花里胡哨的第四步，思源笔记美化超进化！字体自定义配色插件发布！ - 链滴,Tue Apr 25 2023 17:42:33 GMT+0000 (Coordinated Universal Time),"
                    <p>为啥是第四步呢？因为这个插件是缝合了 <a href=""https://ld246.com/member/StarDustSheep"">StarDustSheep</a>、<a href=""https://ld246.com/member/leolee"">leolee </a>、<a href=""https://ld246.com/member/zuoez02"">zuoez02</a> 三位大佬的成品，</p>
<p><a href=""https://ld246.com/article/1682000853320"">思源笔记 自定义 可在多个主题间适用的 行内字色及底色 - 链滴</a></p>
<p><a href=""https://ld246.com/article/1682283088286"">思源笔记折腾记录 -html 块 - 主题 css 颜色选择器 - 链滴</a></p>
<p><a href=""https://ld246.com/member/zuoez02"">zuoez02</a> 大佬的直接在插件列表里。</p>
<p>已经是缝合怪中的极品了，所以是第四步……</p>
<p>具体功能就是这两个：</p>
<ol>
<li>跨主题保持字体配色方案</li>
</ol>
<p><img src=""https://b3logfile.com/file/2023/04/图片-wGuWGOJ.png?imageView2/2/interlace/1/format/webp""></p>
<ol start=""2"">
<li>自定义当前配色方案</li>
</ol>
<p>打开字体选项，右键想要修改的字体颜色，出现相同颜色的色块后点击色块，就能自由修改颜色了。记得点击 save 保存。</p>
<p><img src=""https://b3logfile.com/file/2023/04/图片-6FehKyJ.png?imageView2/2/interlace/1/format/webp""></p>
<p>当然，你们见到的应该是思源默认的配色：</p>
<p><img src=""https://b3logfile.com/file/2023/04/图片-CbvaY2m.png?imageView2/2/interlace/1/format/webp""></p>
<p>我用的是 <a href=""https://ld246.com/member/StarDustSheep"">StarDustSheep</a> 分享的配色方案啦，具体见下：</p>
<pre><code class=""language-json highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nt"">\""name\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""starSheep\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nt"">\""schemes\""</span><span class=""highlight-p"">:</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nt"">\""light\""</span><span class=""highlight-p"">:{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color1\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#403d3e\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color2\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#828282\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color3\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#776a58\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color4\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#aa6632\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color5\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#f19040\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color6\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#73a227\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color7\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#68aeca\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color8\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#2a9578\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color9\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#006ec2\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color10\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#825eb2\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color11\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#9a51b8\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color12\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#d55e1b\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color13\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#ee0000\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background1\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#bcbcbc\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background2\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#dcd9da\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background3\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#d3dadc\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background4\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#e8e4d9\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background5\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#ecdbb4\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background6\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#ede0c0\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background7\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#f6f0cf\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background8\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#d8eed7\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background9\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#cfece1\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background10\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#c8dfefb8\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background11\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#dfd6ed\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background12\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#f2d1dc\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background13\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#eecfcf\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nt"">\""dark\""</span><span class=""highlight-p"">:{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color1\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#dedede\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color2\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#999999\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color3\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#b5a287\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color4\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#d79f75\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color5\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#e47011\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color6\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#f4e367\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color7\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#92ca68\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color8\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#20c598\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color9\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#53a9ea\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color10\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#c2a2ee\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color11\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#cf87ec\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color12\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#e37f48\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""color13\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#e26868\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background1\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#6d6d6d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background2\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#8d8d8d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background3\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#a0a0a0\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background4\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#9c9789\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background5\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#9f814d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background6\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#a9935d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background7\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#8e7d20\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background8\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#649862\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background9\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#6ba89d\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background10\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#7399b4\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background11\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#836ba8\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background12\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#a86c80\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">           <span class=""highlight-nt"">\""background13\""</span><span class=""highlight-p"">:</span> <span class=""highlight-s2"">\""#ae7575\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>复制保存到本地，在插件设置面板导入就行了。</p>
<p>玩的开心！</p>
<p>如果能留言和分享你的配色，那更好！</p>
                

作者：zxhd86
链接：https://ld246.com/article/1682415753690
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
735,2.8.6 dev2 云端快照不可见 - 链滴,Sun Apr 23 2023 09:59:57 GMT+0000 (Coordinated Universal Time),"
                    <p>如题，见图</p>
<p><img src=""https://b3logfile.com/file/2023/04/图片-jg4jlUV.png?imageView2/2/interlace/1/format/webp""></p>
<p>尝试了几次同步都没有出现内容。</p>
<p>这个难道不应该在同步的时候自动创建吗？</p>
                

作者：zxhd86
链接：https://ld246.com/article/1682215197714
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
715,Github 上这个老外好热情啊，一己之力包下了大部分用户的 Issue - 链滴,Wed Apr 19 2023 11:14:43 GMT+0000 (Coordinated Universal Time),"
                    <p>自从开发了国际化之后，感觉这位老兄出现的次数尤为频繁。</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-bDO4aHP.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/04/image-iykmbKy.png?imageView2/2/interlace/1/format/webp""></p>
<p>我草草看了一下</p>
                

作者：Frostime
链接：https://ld246.com/article/1681874084190
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
737,在思源中实现流式日记布局 - 链滴,Tue Apr 18 2023 23:33:14 GMT+0000 (Coordinated Universal Time),"
                    <p>前提：本文为纯个人意见的东西，可以说充斥私货、不公平比较、个人臆断。如有观众有不同意见，请您务必在评论区告诉我，也避免其他人误入歧途。?</p>
<p>对于<a href=""https://ld246.com/member/dammy"">大米同学</a>在<a href=""https://ld246.com/article/1681801981651""> 一次漫游：学习中的快乐与束缚</a>中提到：</p>
<blockquote>
<p>Roam research、logseq、Remnote、RoamEdit、葫芦笔记、合桃笔记这些软件打开后会让用户在每日的 daily  notes 里记录，作为非正式输入的内容池，同时它也是最后的保障——如果用户其它所有组织笔记的结构失败了，也会有这个 <strong>汇总所有的 daily  notes</strong> 功能来兜底。</p>
</blockquote>
<p>我非常的认同，但对于：</p>
<blockquote>
<p>思源本身不支持这个结构，需要我们自己配置一下，不得不说这也是种认知开销：</p>
</blockquote>
<p>还有大米同学使用挂件和修改 daily  notes 实现的类似其他软件的效果，我并不是很认同。</p>
<p>因为在我看来，思源本身就提供极为强大的流式布局，但不知为何不是很多人使用——那就是反链面板。</p>
<p><img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230418211748-i17y1jo.png?imageView2/2/interlace/1/format/webp""></p>
<p>要实现这一点，你只需要建立一个日记模板，然后在日记模板中加入一个引用链接就可以了。</p>
<p><img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230418231410-ru46oz0.png?imageView2/2/interlace/1/format/webp""></p>
<p>只要把笔记内容写在这个引用链接下，你就能享受到媲美、甚至超越其他软件的流式 daily note 体验。</p>
<p>思源的反链面板我认为应该是目前最强的那一档，富文本格式显示、支持直接编辑、独立窗口展示，这使得它本身就能充当其他大纲笔记软件中的流式布局。这一点，甚至 ob 的反链面板在装了插件的情况下，也不如思源的反链面板丝滑。</p>
<p>思源基于文档的 daily note 还有一个优点，那就是不会污染笔记。我在个人实践中实际上会在 daily note 中记录很多不是笔记的东西，比如说跟笔记没啥关系的心情日志啊、每日重复必做的事项啊、todo 列表啊。这些东西对我而言是必要的。</p>
<p><img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230418222509-cal7qyj.png?imageView2/2/interlace/1/format/webp""></p>
<p>但是，假如我在 logseq、Remnote 中想实现类似的效果，那就势必会造成 daily note 的污染，在流式布局的笔记浏览中，你不得不看很多与笔记无关的内容。</p>
<p>Logseq 得益于它有着相对完善的 TODO 任务系统，可以较为合适的完成 TODO 和每日必做在 daily note 的任务安排，但是依然会污染笔记内容，让你在浏览笔记的时候不得不看到实际上与笔记无关的内容。而要是你打算放一点心情日记、每日天气之类日记该有的要素，那一点笔记内容更是需要大海捞针一样在流式布局里寻找了。</p>
<p><img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230418224518-c18xdo7.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/04/siyuan/1654576506442/assets/image-20230418224733-0ks4p4v.png?imageView2/2/interlace/1/format/webp""></p>
<p>那能否用类似思源的方案来过滤掉你写在 daily note 里无关内容？答案是可以，但是不如思源流畅。原因很简单，它们的反链面板在这一件事上并不如思源。思源的反链面板可以脱离文档单独存在，思源的反链面板可以定义排序规则，思源的反链面板可以结合使用 ctrl、shift、alt 加拖动产生不同的效果……这些都是喜欢把反链焊死在文档下端的其他传统大纲笔记还没有实现的。如果说其他的大纲笔记的反链主要用途是查看，那思源的反链就是整理。</p>
<p>从这个角度来看，<strong>其他软件的 daily note 总是迫使你只在上面记笔记，但是思源的 daily note 允许你记录你的一天。</strong></p>
<p>不过，个人原因，我只能评测 Logseq、RemNote，不清楚其他笔记是怎么实现的，所以在反链面板上，说不准强中更有强中手。</p>
<p>但是，综上所述：</p>
<ul>
<li>哪怕在最基础的角度考虑，思源也可以实现不输于其他软件的流式 daily note 显示；</li>
<li>如果考虑到思源可以在日记模板中插入多个反链，实现每日日记、每日笔记等等一切你觉得可以塞到 daily note 里面的流式布局展示，那思源可以说是实现 daily note 功能的第一梯队；</li>
<li>如果考虑到思源在超级块的支持下，允许你像排布你的纸笔日记一样排版你的 daily note，那我认为思源应该是 daily note 的 top 5 等级选手。</li>
</ul>
<p>‍</p>
                

作者：zxhd86
链接：https://ld246.com/article/1681831994948
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
716,【喜报】恭喜插件系统即将招安 - 链滴,Thu Apr 13 2023 20:01:18 GMT+0000 (Coordinated Universal Time),"
                    <p>插件系统出来那会我就猜测估计是要招安的，现在终于验证了。可喜可贺可喜可贺。</p>
<p>目前 D 大已经更新了插件系统的 Roadmap，并且明确表示了会将现有的社区插件系统集成到本体内部。可以看到这个规划直接空降到了「Short Term」中，估计会在可预见的几个版本内集成完成。</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-dKPR1Yd.png?imageView2/2/interlace/1/format/webp""></p>
<p><img src=""https://b3logfile.com/file/2023/04/image-pyqSs3f.png?imageView2/2/interlace/1/format/webp""></p>
<p>目前社区贡献的大部分代码都集中在了主题里面，让本来应该专注于样式的主题承担了大量功能性任务，耦合程度高到突破天际。而有了官方插件系统后，主题的重量就可以大大降低。</p>
<p>对于未来的插件系统的发展我个人有很多期待。</p>
<ul>
<li>插件系统招安后能否开放更多前端的 API，毕竟现在大家都在抢顶栏的那点位置，说实话挺局促的。</li>
<li>统一清洗的开发文档。目前插件的开发基本处于脚手架状态，需要自己去翻阅 <code>siyuan.d.ts</code> 的接口代码声明，说实话挺繁琐的。</li>
<li>开发者论坛</li>
<li>其他</li>
</ul>
<p>总之，相信这是整个思源社区重要的一步。</p>
                

作者：Frostime
链接：https://ld246.com/article/1681387279008
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
741,史诗级更新，slide mode 插件 v0.0.2 发布！ - 链滴,Wed Apr 12 2023 21:30:55 GMT+0000 (Coordinated Universal Time),"
                    <p>前情提要：<a href=""https://ld246.com/article/1681144020939"">演示模式（ppt 放映）插件 v0.0.1 发布 - 链滴</a></p>
<p>更新详情：</p>
<ol>
<li>修复了大量样式冲突</li>
<li>增加了命令面板入口</li>
<li>迁移到 dialog</li>
<li>增加了图标</li>
<li>修复了退出全屏</li>
<li>增加命令面板切换渐进动画</li>
</ol>
<p>使用说明：</p>
<p>ctrl+shift+o 打开命令面板选中或点击左上方按钮启动演示模式</p>
<h2 id=""思源的演示模式"">思源的演示模式</h2>
<p>这是一个能把你的当前思源文档以幻灯片形式放映的东西。</p>
<p>支持插件系统命令面板入口。</p>
<p>支持列表渐进模式动画</p>
<h3 id=""使用示例-"">使用示例：</h3>
<p><img src=""https://b3logfile.com/file/2023/04/演示模式改进-vjsIEpt.gif""></p>
<p>左上角还有一个按钮入口。</p>
<p><img src=""https://b3logfile.com/file/2023/04/按钮-crgQeDR.png?imageView2/2/interlace/1/format/webp""></p>
<p>打开列表渐进动画</p>
<p><img src=""https://b3logfile.com/file/2023/04/切换渐进动画-JzupSqy.gif""></p>
<h3 id=""感谢名单-"">感谢名单：</h3>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02%2Fsiyuan-plugin-system"" target=""_blank"" rel=""nofollow ugc"">zuoez02/siyuan-plugin-system: siyuan-plugin-system</a> 提供了插件系统加载框架和 api ，万分感谢</p>
<p><a href=""https://ld246.com/member/ciwoyipang"">ciwoyipang - 链滴</a> 提供了图标，我很喜欢，万分感谢。</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmarp-team%2Fmarp-core"" target=""_blank"" rel=""nofollow ugc"">marp-team/marp-core: The core of Marp converter</a> 将 markdown 转换成幻灯片形式的 html</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fbespokejs%2Fbespoke"" target=""_blank"" rel=""nofollow ugc"">bespokejs/bespoke: DIY Presentation Micro-Framework</a> 提供了 ppt 的转场效果。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1681306255811
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
740,演示模式（ppt 放映）插件 v0.0.1 发布 - 链滴,Tue Apr 11 2023 00:27:00 GMT+0000 (Coordinated Universal Time),"
                    <h2 id=""思源的演示模式"">思源的演示模式</h2>
<p>项目地址 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzxhd863943427%2Fsiyuan-slide-mode"" target=""_blank"" rel=""nofollow ugc"">zxhd863943427/siyuan-slide-mode</a>，欢迎 star 和 pr。</p>
<p>这是一个能把你的当前思源文档以幻灯片形式放映的东西，实力有限，可以抄的不多，故 bug 很多，比如说每次使用都会污染你的 css，要重载才能恢复，凑合着用吧。</p>
<p>另外，有啥图标推荐？写的头昏了，先用之前的闪卡图标应付一下吧。</p>
<p>代码没有写多少，主要是在改 bug……</p>
<p>总之，万分希望有人 pr 改进。</p>
<h3 id=""使用示例-"">使用示例：</h3>
<p><img src=""https://b3logfile.com/file/2023/04/演示模式-hgtxBYL.gif""></p>
<h3 id=""高级"">高级</h3>
<p>要是愿意破坏 markdown 的纯洁，显示效果还能高级一点……</p>
<p><img src=""https://b3logfile.com/file/2023/04/演示模式-hT6IQhq.gif""></p>
<p>建议搭配 metadata 挂件使用，具体语法参考 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmarp-team%2Fmarp-core"" target=""_blank"" rel=""nofollow ugc"">marp-team/marp-core: The core of Marp converter</a> 内的说明。</p>
<h3 id=""缺陷"">缺陷</h3>
<ul>
<li class=""vditor-task"">  会污染你的 css</li>
<li class=""vditor-task"">  退出后大小没有恢复变小</li>
<li class=""vditor-task"">  没有设置界面，只能靠类似 yaml 的方式控制排版</li>
</ul>
<h3 id=""感谢名单-"">感谢名单：</h3>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02%2Fsiyuan-plugin-system"" target=""_blank"" rel=""nofollow ugc"">zuoez02/siyuan-plugin-system: siyuan-plugin-system</a> 提供了插件系统加载框架和 api ，万分感谢</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmarp-team%2Fmarp-core"" target=""_blank"" rel=""nofollow ugc"">marp-team/marp-core: The core of Marp converter</a> 将 markdown 转换成幻灯片形式的 html</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fbespokejs%2Fbespoke"" target=""_blank"" rel=""nofollow ugc"">bespokejs/bespoke: DIY Presentation Micro-Framework</a> 提供了 ppt 的转场效果。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1681144020939
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
714,「CSS 代码片段」鼠标悬浮则显示块，移开则隐藏 - 链滴,Mon Apr 10 2023 00:31:02 GMT+0000 (Coordinated Universal Time),"
                    <p>功能上实现了：</p>
<ol>
<li>对于一个希望隐藏的块，当鼠标移出的时候自动隐藏，但是会保留一个外边框如果不希望有 border，把和 border 相关的 css 删掉就行</li>
<li>鼠标移入的时候，自动显示，正常编辑即可</li>
<li>需要注意的是，对于容器块当然可以一起隐藏；但是标题块不是容器，所以只设置标题块的隐藏是无济于事的</li>
</ol>
<h2 id=""用法"">用法</h2>
<h3 id=""1--添加-CSS-代码片段"">1. 添加 CSS 代码片段</h3>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">custom-hidden</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-style</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">dashed</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-width</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">px</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-color</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">b3</span><span class=""highlight-o"">-</span><span class=""highlight-n"">theme</span><span class=""highlight-o"">-</span><span class=""highlight-n"">primary</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">custom-hidden</span><span class=""highlight-o"">]</span> <span class=""highlight-o"">*</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">visibility</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">hidden</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">custom-hidden</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-style</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">custom-hidden</span><span class=""highlight-o"">]</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">hover</span> <span class=""highlight-o"">*</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">visibility</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">initial</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<h3 id=""2--为希望自动隐藏的-block-添加一个--属性"">2. 为希望自动隐藏的 block 添加一个 <code>hidden</code> 属性</h3>
<p><img src=""https://b3logfile.com/file/2023/04/image-LCvuU0V.png?imageView2/2/interlace/1/format/webp""></p>
<h2 id=""效果"">效果</h2>
<p>光标移出</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-pVof0dX.png?imageView2/2/interlace/1/format/webp""></p>
<p>光标移入</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-sgvyTYF.png?imageView2/2/interlace/1/format/webp""></p>
<p>由于边框的颜色用的是 css 变量，所以会随着主题自动适配</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-GgxoWbA.png?imageView2/2/interlace/1/format/webp""></p>
                

作者：Frostime
链接：https://ld246.com/article/1681057863289
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
717,「代码片段」思源笔记如何任意调整编辑器宽度 - 链滴,Sun Apr 09 2023 19:58:39 GMT+0000 (Coordinated Universal Time),"
                    <p>我不知道有多少人对于思源笔记的默认编辑区域宽度是有意见的，反正我一直都觉得默认的宽度实在太窄了。</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-mBANHQq.png?imageView2/2/interlace/1/format/webp""></p>
<p>虽然软件提供了一个「自适应宽度」，但是这个开启之后软件就变成了全宽模式，又太宽了。所以我摸索了一下，找出了一个可以任意调节编辑器宽度的方案。</p>
<ol>
<li>
<p>打开「外观——代码片段」</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-P1wAasf.png?imageView2/2/interlace/1/format/webp""></p>
</li>
<li>
<p>在 CSS 当中新建以下样式</p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">:</span><span class=""highlight-nd"">root</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-nv"">--centerWidth</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">70</span><span class=""highlight-kt"">%</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""> <span class=""highlight-nv"">--lrwidth</span><span class=""highlight-p"">:</span> <span class=""highlight-nb"">calc</span><span class=""highlight-p"">((</span><span class=""highlight-mi"">100</span><span class=""highlight-kt"">%</span> <span class=""highlight-o"">-</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">centerWidth</span><span class=""highlight-p"">))</span> <span class=""highlight-o"">/</span> <span class=""highlight-mi"">2</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-content</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-fullwidth</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""true\""</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-title</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">margin-left</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">lrwidth</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">margin-right</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">lrwidth</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-content</span><span class=""highlight-p"">:</span><span class=""highlight-nd"">not</span><span class=""highlight-o"">([</span><span class=""highlight-nt"">data-fullwidth</span><span class=""highlight-o"">=</span><span class=""highlight-s2"">\""true\""</span><span class=""highlight-o"">])&gt;</span><span class=""highlight-nt"">div</span><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">padding-left</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">lrwidth</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">  <span class=""highlight-k"">padding-right</span><span class=""highlight-p"">:</span> <span class=""highlight-nf"">var</span><span class=""highlight-p"">(</span><span class=""highlight-o"">--</span><span class=""highlight-n"">lrwidth</span><span class=""highlight-p"">)</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span></code></pre>
</li>
<li>
<p>然后启用样式，并关闭自适应宽度即可。</p>
<p><img src=""https://b3logfile.com/file/2023/04/image-789Hzzl.png?imageView2/2/interlace/1/format/webp""></p>
<p>这个代码里面，可以根据自己的需要更改 <code>--centerWidth</code>，这一项用于控制中央编辑器的宽度，这里设置编辑器的宽度可以占到页面的 70%。</p>
</li>
</ol>
                

作者：Frostime
链接：https://ld246.com/article/1681041519565
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",frostime,思源笔记,链滴优选
739,数学增强插件 0.0.6 更新，修复键盘布局，修复上下键移动 - 链滴,Sun Apr 02 2023 12:01:52 GMT+0000 (Coordinated Universal Time),"
                    <h4 id=""版本说明"">版本说明</h4>
<p>当前版本主要有三个更新点：</p>
<ol>
<li>在群里 <a href=""https://ld246.com/member/leolee"">leolee</a> 大佬提供的帮助，现在能捕获创建事件了，可以创建数学块后直接启动插件，不需要点击一下了。</li>
<li>在群里群友的提示下，发现键盘的一些按键显示、功能异常，同时布局也看上去有点奇怪，已经修复</li>
<li>得益于上游依赖 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Farnog%2Fmathlive"" target=""_blank"" rel=""nofollow ugc"">arnog/mathlive</a> 的更新，目前可以直接使用方向键在公式中上下移动了</li>
</ol>
<p>ps：mathlive 的更新可谓是修复一些 bug，引入了全新的 bug，这一次居然连虚拟键盘都用不了了！找了好久才发现是 node 打包环境和 electron 运行环境外部变量的不同，顺便给作者发了个 issue……</p>
<h4 id=""感谢名单"">感谢名单</h4>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02"" target=""_blank"" rel=""nofollow ugc"">zuoez02</a> 大佬创建的 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02%2Fsiyuan-plugin-system"" target=""_blank"" rel=""nofollow ugc"">社区插件系统</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsvchord"" target=""_blank"" rel=""nofollow ugc"">svchord</a> 大佬 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsvchord%2Fsiyuan-arco-calendar"" target=""_blank"" rel=""nofollow ugc"">日历插件项目</a> 的参考</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fcortexjs.io%2Fmathlive%2F"" target=""_blank"" rel=""nofollow ugc"">CortexJS</a> 提供了主要功能实现，我只是完成了功能包装。</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fleolee9086"" target=""_blank"" rel=""nofollow ugc"">leolee9086</a> 大佬提供了更好的事件捕获代码，让插件能捕获数学块创建事件了</p>
                

作者：zxhd86
链接：https://ld246.com/article/1680408113019
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
743,数学增强插件发布，思源数学输入史诗级增强！ - 链滴,Fri Mar 31 2023 12:34:39 GMT+0000 (Coordinated Universal Time),"
                    <p>一个增强思源数学编辑体验体验的插件</p>
<p>项目主页位于 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzxhd863943427%2Fsiyuan-math-enhance"" target=""_blank"" rel=""nofollow ugc"">github</a>，欢迎大家 star！</p>
<h3 id=""主要功能"">主要功能</h3>
<p>交互式数学输入</p>
<p><img src=""https://b3logfile.com/file/2023/03/交互式数学输入-5kefErv.gif""></p>
<p>数学虚拟键盘</p>
<p><img src=""https://b3logfile.com/file/2023/03/数学虚拟键盘-iYxyMun.gif""></p>
<p>制卡插件数学制卡联动</p>
<p><img src=""https://b3logfile.com/file/2023/03/闪卡插件集成-YlvzSWK.gif""></p>
<h3 id=""下载方式"">下载方式</h3>
<p>在社区插件系统集市中下载</p>
<h3 id=""感谢名单"">感谢名单</h3>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02"" target=""_blank"" rel=""nofollow ugc"">zuoez02</a> 大佬创建的 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02%2Fsiyuan-plugin-system"" target=""_blank"" rel=""nofollow ugc"">社区插件系统</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsvchord"" target=""_blank"" rel=""nofollow ugc"">svchord</a> 大佬 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsvchord%2Fsiyuan-arco-calendar"" target=""_blank"" rel=""nofollow ugc"">日历插件项目</a> 的参考</p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fcortexjs.io%2Fmathlive%2F"" target=""_blank"" rel=""nofollow ugc"">CortexJS</a> 提供了主要功能实现，我只是完成了功能包装。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1680237279686
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
742,闪卡增强插件 v0.0.2 发布 支持设置持久化 - 链滴,Sat Mar 18 2023 18:45:56 GMT+0000 (Coordinated Universal Time),"
                    <p>设置持久化基于插件系统最新的 api，再次感谢 <a href=""https://ld246.com/member/zuoez02"">zuoez02</a></p>
<p>前情提要：<a href=""https://ld246.com/article/1679063666565"">闪卡增强插件 v0.0.1 发布 基于社区插件系统 - 链滴</a></p>
<p>同时完成两个改进：</p>
<ol>
<li>沉浸式制卡稳定性增强（但删除卡片会有一定延迟）</li>
<li>数学制卡支持较复制公式（参见 <a href=""https://ld246.com/article/1679063666565/comment/1679132227392?r=zxhd86#comments"">issue</a>)</li>
</ol>
<p>沉浸式制卡展示：</p>
<p><img src=""https://b3logfile.com/file/2023/03/沉浸式制卡-AqqgPku.gif""></p>
                

作者：zxhd86
链接：https://ld246.com/article/1679136356613
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
745,闪卡增强插件 v0.0.1 发布 基于社区插件系统 - 链滴,Fri Mar 17 2023 22:34:25 GMT+0000 (Coordinated Universal Time),"
                    <p>一个增强思源闪卡体验的插件</p>
<h3 id=""主要功能"">主要功能</h3>
<p>左键一键制卡，右键打卡菜单</p>
<h4 id=""一键制卡"">一键制卡</h4>
<p><img src=""https://b3logfile.com/file/2023/03/一键制卡-mPU33Je.gif""></p>
<p>一键制卡类型：</p>
<p><strong>标记块</strong></p>
<p><strong>列表块</strong></p>
<ul>
<li>测试 ？
<ul>
<li>111</li>
</ul>
</li>
<li>导入?
<ul>
<li>222</li>
</ul>
</li>
<li>导入》》
<ul>
<li>内容</li>
</ul>
</li>
<li>导 入 &gt;&gt;
<ul>
<li>111</li>
</ul>
</li>
<li>导入 ||
<ul>
<li>444</li>
</ul>
</li>
<li>不导入 &gt;&gt; 1
<ul>
<li>11</li>
</ul>
</li>
</ul>
<p><strong>超级块</strong></p>
<p>超级块垂直、超级块水平</p>
<h3 id=""右键菜单内容"">右键菜单内容</h3>
<p>提供了一些增强功能</p>
<h4 id=""清除当前页面闪卡"">清除当前页面闪卡</h4>
<p><img src=""https://b3logfile.com/file/2023/03/一键清除-TMMeKZv.gif""></p>
<h4 id=""闪卡样式加强"">闪卡样式加强</h4>
<p><img src=""https://b3logfile.com/file/2023/03/闪卡样式增强-50SX2Wd.gif""></p>
<h4 id=""挖空增强"">挖空增强</h4>
<p><img src=""https://b3logfile.com/file/2023/03/挖空增强-UYSkqbc.gif""></p>
<h4 id=""类remnote界面"">类 remnote 界面</h4>
<p><img src=""https://b3logfile.com/file/2023/03/类remnote界面-McJsIqO.gif""></p>
<h4 id=""层级闪卡"">层级闪卡</h4>
<p><img src=""https://b3logfile.com/file/2023/03/层级闪卡-NhZlNuG.gif""></p>
<h4 id=""自定义卡包制卡"">自定义卡包制卡</h4>
<p><img src=""https://b3logfile.com/file/2023/03/自定义卡包制卡-Ix0DJv6.gif""></p>
<h4 id=""数学块制卡"">数学块制卡</h4>
<p><img src=""https://b3logfile.com/file/2023/03/数学块制卡-jKgcOeO.gif""></p>
<h4 id=""沉浸式制卡-不稳定-"">沉浸式制卡（不稳定）</h4>
<p><img src=""https://b3logfile.com/file/2023/03/沉浸式制卡-UxdkbXB.gif""></p>
<h3 id=""缺陷"">缺陷</h3>
<p>目前没有实现设置保存</p>
<p>沉浸制卡不够稳定，原因不明，虽然确实已经从卡组中移除了。</p>
<h3 id=""感谢名单"">感谢名单</h3>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02"" target=""_blank"" rel=""nofollow ugc"">zuoez02</a> 大佬创建的 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fzuoez02%2Fsiyuan-plugin-system"" target=""_blank"" rel=""nofollow ugc"">社区插件系统</a></p>
<p><a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsvchord"" target=""_blank"" rel=""nofollow ugc"">svchord</a> 大佬 <a href=""https://ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fsvchord%2Fsiyuan-arco-calendar"" target=""_blank"" rel=""nofollow ugc"">日历插件项目</a> 的参考</p>
<p>社区 <a href=""https://ld246.com/member/BryceAndJuly"">BryceAndJuly</a> 大佬实现的原型 <a href=""https://ld246.com/article/1674135504898"">【分享】使用当前文档的二级标题快速制作闪卡</a></p>
                

作者：zxhd86
链接：https://ld246.com/article/1679063666565
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
744,投票：是否支持思源移动端统一块菜单、块标菜单、文档菜单为半屏显示 - 链滴,Tue Mar 07 2023 18:39:07 GMT+0000 (Coordinated Universal Time),"
                    <p>目前添加块的菜单是以半屏方式展示：</p>
<p><img src=""https://b3logfile.com/file/2023/03/图片-BvQO7Ve.png?imageView2/2/interlace/1/format/webp""></p>
<p>这很好，我很喜欢</p>
<p>但是，为什么块标菜单、文档菜单就是这种全屏的方式显示？感觉相比之下很不好。</p>
<p><img src=""https://b3logfile.com/file/2023/03/图片-lqBEly4.png?imageView2/2/interlace/1/format/webp""></p>
<p>能否统一成半屏的显示方式？</p>
<p><div class=""articlePoll"">
    <h3>支持思源移动端统一块菜单、块标菜单、文档菜单为半屏显示</h3>
    <div class=""fn__flex ft__fade ft__smaller"">
        <span class=""fn__flex-1"">
            单选
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
            公开
            <span class=""fn__space5""></span>•<span class=""fn__space5""></span>
        永不结束
        </span>
        <span>
            37 票
        </span>
    </div>
    <div class=""ft__gray"">
        <div class=""poll poll--open"" data-id=""1678187031323"">
            <div class=""poll__percent"" style=""width: 83%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    是
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    83%
                    <span class=""ft__fade"">•</span>
                    31 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1678187031373"">
            <div class=""poll__percent"" style=""width: 0%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    否
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    0%
                    <span class=""ft__fade"">•</span>
                    0 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
        <div class=""poll poll--open"" data-id=""1678187031424"">
            <div class=""poll__percent"" style=""width: 16%""></div>
            <div class=""fn__flex poll__opts"">
                    
                    <div class=""fn__space5""></div>
                <div class=""fn__flex-1 fn__shrink"">
                    随意
                </div>
                <div class=""fn__space5""></div>
                <div class=""fn__flex-center"">
                    16%
                    <span class=""ft__fade"">•</span>
                    6 票
                </div>
            </div>
        </div>
        <div class=""fn__clear"">
        </div>
    </div>
</div>
</p>
                

作者：zxhd86
链接：https://ld246.com/article/1678185548080
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
749,8.1 层功力 remnote 制卡，支持内置卡包制卡和移除 - 链滴,Tue Feb 28 2023 22:28:16 GMT+0000 (Coordinated Universal Time),"
                    <p>2023.4.5 这些代码片段还能用，但假如不是你不愿意使用插件系统、或插件系统不能正常运行的话，我还是建议是使用插件版本的<a href=""https://ld246.com/article/1679063666565"">闪卡增强插件 v0.0.1 发布 基于社区插件系统 - 链滴</a></p>
<hr>
<p>前情提要：<a href=""https://ld246.com/article/1677506141805"">8 层功力的 remnote 制卡 并多多一键制卡更新，支持列表项制卡，增加一键移除</a></p>
<p>在尝试了 v2.7.7 最新版本的文档树制卡后，我不得不真香了，我必须承认：</p>
<p>从文档树打开闪卡界面真是太酷了，很符合我对思源未来的想象，科技并带着趣味。</p>
<p>故紧急更新了一版，支持直接制卡到文档树的内置卡包。</p>
<p>不过，制卡到文档树的内置卡包和制卡到之前的自定义卡包是一个二选一的选项，因为这会造成重复制卡，也就是说一张卡片你会在复习的时候重复见两遍 :(</p>
<p>所以暂时只能做成开关了。默认为之前的自定义卡包制卡方式，想要使用新版本的文档树内置卡包，那就划到代码的最下方，把 false 改成 true 即可。</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 一键制卡 v0.7
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 使用匿名函数，防止污染空间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 支持使用内建卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-p"">((</span><span class=""highlight-nx"">useBulitIn</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">false</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 请求函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">method</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Promise</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">resolve</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">reject</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">method</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">toUpperCase</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span> <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">resolve</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            <span class=""highlight-nx"">reject</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""请求失败:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 弹出提示信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/notification/pushMsg\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">msg</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">timeout</span><span class=""highlight-o"">:</span> <span class=""highlight-mi"">3000</span> <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 获取当前文档id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getFileID</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前页面id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-s2"">\""span.protyle-breadcrumb__item--active\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">).</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPageID</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">try</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">//获取当前屏幕
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">currentScreen</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".layout__wnd--active\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">catch</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到页面焦点！`</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">throw</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""未能获取到页面焦点！\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//传入 node节点列表 arr和数据抽取函数 fliter。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// fliter 传入一个节点，返回一个字典
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// 字典格式：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// {status,data}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// status 为 ok，则代表为抽取成功，将data压入返回列表anwer，并最后返回。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-o"">!</span><span class=""highlight-nx"">arr</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&lt;=</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">length</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">anwer</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-kd"">let</span> <span class=""highlight-nx"">node</span> <span class=""highlight-k"">of</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""status\""</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">===</span> <span class=""highlight-s2"">\""ok\""</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">])</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">]);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 传入列表下的段落，返回被标记段落的父节点：列表项的id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterListCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">re</span> <span class=""highlight-o"">=</span> <span class=""highlight-sr"">/(&gt;&gt;|(》》))\\s?\\u200b?$/</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">re</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">test</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerText</span><span class=""highlight-p"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""no\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-kc"">null</span> <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterMarkCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterSuperBlockCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 获取当前文档路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getHpath</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getFileID</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""id\""</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/filetree/getHPathByID\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//检测返回值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">currentPagePath</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPagePath</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 添加多个卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取全部deck
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/getRiffDecks\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前打开文档的路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">getHpath</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">===</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能当前文档读取路径`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">customDeckIdArr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 导入默认卡包
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">useBulitIn</span> <span class=""highlight-o"">===</span> <span class=""highlight-kc"">true</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-s1"">\'20230218211946-2kw8jgx\'</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">else</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">//获取deck.id, 其deck.name 包含在 focusItemPath 中
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">name</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">search</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">!=</span> <span class=""highlight-o"">-</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 的卡包`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 获取需要被制成卡片的块的ID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//标记块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">markList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""span[data-type=\'mark\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//超级块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">superBlockList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""div[class=\'sb\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//列表块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">listList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""div[class=\'li\']:has(div[class=\'li\'])  &gt; div[class = \'p\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">markCardList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterMarkCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">superBlockCardList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">superBlockList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterSuperBlockCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">listCardList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">listList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterListCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">concat</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markCardList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">superBlockCardList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">listCardList</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 页面的卡片`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 去重
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[...</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Set</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">)];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">deckIndex</span> <span class=""highlight-k"">in</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">// 把标记所在块全部制成卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">deckID</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">deckIndex</span><span class=""highlight-p"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">blockIDs</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/addRiffCards\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">卡包的总卡片数：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">size</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 添加一个按钮
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">barMode</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""barMode\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">barMode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""beforebegin\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s1"">\'&lt;div id=\""addCards\"" class=\""toolbar__item b3-tooltips b3-tooltips__se\"" aria-label=\""制作卡片\"" &gt;&lt;/div&gt;\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtn</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""addCards\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">width</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""auto\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtnIcon</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`&lt;svg class=\""icon\"" viewBox=\""0 0 1024 1024\"" version=\""1.1\"" xmlns=\""http://www.w3.org/2000/svg\"" p-id=\""4526\"" width=\""200\"" height=\""200\""&gt;&lt;path d=\""M928 160H96a32 32 0 0 0-32 32v672a32 32 0 0 0 32 32h832a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32z m-32 672H128V224h768v608z\"" p-id=\""4527\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;path d=\""M230.592 448.096H544a32 32 0 1 0 0-64H230.592a32 32 0 0 0 0 64zM230.592 640.096H544a32 32 0 1 0 0-64H230.592a32 32 0 1 0 0 64zM768 704a32 32 0 0 0 32-32V350.016a32 32 0 1 0-64 0V672a32 32 0 0 0 32 32z\"" p-id=\""4528\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;/svg&gt;`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">addCardsBtnIcon</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""click\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stopPropagation</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kc"">true</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})(</span><span class=""highlight-kc"">false</span><span class=""highlight-p"">);</span>
</span></span></code></pre>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 一键移除卡片 v0.2
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 使用匿名函数，防止污染空间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-p"">(()</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 请求函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">method</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Promise</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">resolve</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">reject</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">method</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">toUpperCase</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span> <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">resolve</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            <span class=""highlight-nx"">reject</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""请求失败:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 弹出提示信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/notification/pushMsg\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">msg</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">timeout</span><span class=""highlight-o"">:</span> <span class=""highlight-mi"">3000</span> <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">try</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">//获取当前屏幕
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">currentScreen</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".layout__wnd--active\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">catch</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到页面焦点！`</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">throw</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""未能获取到页面焦点！\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//传入 node节点列表 arr和数据抽取函数 fliter。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// fliter 传入一个节点，返回一个字典
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// 字典格式：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// {status,data}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// status 为 ok，则代表为抽取成功，将data压入返回列表anwer，并最后返回。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-o"">!</span><span class=""highlight-nx"">arr</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&lt;=</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">length</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">anwer</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-kd"">let</span> <span class=""highlight-nx"">node</span> <span class=""highlight-k"">of</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""status\""</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">===</span> <span class=""highlight-s2"">\""ok\""</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">])</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">]);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterBlockCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">removeCards</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 获取需要被制成卡片的块的ID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//已制卡块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">cardedBlockList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".protyle-wysiwyg [data-node-id][custom-riff-decks]\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">cardedBlockIdList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">cardedBlockList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterBlockCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">concat</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">cardedBlockIdList</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到页面的卡片`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 去重
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[...</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Set</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">)];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">deckID</span><span class=""highlight-o"">:</span> <span class=""highlight-s1"">\'\'</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">blockIDs</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/removeRiffCards\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`All卡包的移除卡片数：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">barMode</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""barMode\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">barMode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""beforebegin\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s1"">\'&lt;div id=\""removeCards\"" class=\""toolbar__item b3-tooltips b3-tooltips__se\"" aria-label=\""移除卡片\"" &gt;&lt;/div&gt;\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">removeCardsBtn</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""removeCards\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">removeCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">width</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""auto\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">removeCardsBtnIcon</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`&lt;svg xmlns=\""http://www.w3.org/2000/svg\"" height=\""48\"" viewBox=\""0 96 960 960\"" width=\""48\""&gt;&lt;path d=\""M600 826v-60h145v60H600Zm0-368v-60h280v60H600Zm0 184v-60h235v60H600ZM125 381H80v-60h170v-45h135v45h170v60h-45v415q0 24-18 42t-42 18H185q-24 0-42-18t-18-42V381Zm60 0v415h265V381H185Zm0 0v415-415Z\""/&gt;&lt;/svg&gt;`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">removeCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">removeCardsBtnIcon</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">removeCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""click\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">removeCards</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stopPropagation</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kc"">true</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})();</span>
</span></span></code></pre>
<p>如果喜欢，请给我留言吧。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1677594496636
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
746,8 层功力的 remnote 制卡 并多多一键制卡更新，支持列表项制卡，增加一键移除 - 链滴,Mon Feb 27 2023 21:55:41 GMT+0000 (Coordinated Universal Time),"
                    <p>需要了解是什么参见<a href=""https://ld246.com/article/1675844040873"">并夕夕版 文档树制卡 v0.5 支持直接获取路径和分屏</a>，演示见下：</p>
<p><img src=""https://b3logfile.com/file/2023/02/一键添加和移除-Dwe0fF0.gif""></p>
<p>列表项制卡的符号参考了 remnote，也就是》》和 &gt;&gt;。要是有什么容易打出来也不大可能有其他用途、而且好看的符号也可以提，当然更欢迎自行添加。</p>
<p>另外，由于接口的限制，暂时没办法移除使用快捷键添加的卡片——因为获取不到 ALL 卡包。</p>
<p>喜欢的话留个言，也让我知道除我以外还有人用。</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 一键移除卡片 v0.1
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 请求函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 使用匿名函数，防止污染空间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-p"">(()</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">method</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Promise</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">resolve</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">reject</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">method</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">toUpperCase</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span> <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">resolve</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            <span class=""highlight-nx"">reject</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""请求失败:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 弹出提示信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/notification/pushMsg\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">msg</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">timeout</span><span class=""highlight-o"">:</span> <span class=""highlight-mi"">3000</span> <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前屏幕
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentScreen</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".layout__wnd--active\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//传入 node节点列表 arr和数据抽取函数 fliter。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// fliter 传入一个节点，返回一个字典
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// 字典格式：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// {status,data}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// status 为 ok，则代表为抽取成功，将data压入返回列表anwer，并最后返回。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-o"">!</span><span class=""highlight-nx"">arr</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&lt;=</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">length</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">anwer</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-kd"">let</span> <span class=""highlight-nx"">node</span> <span class=""highlight-k"">of</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""status\""</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">===</span> <span class=""highlight-s2"">\""ok\""</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">])</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">]);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterBlockCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">removeCards</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取全部deck
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/getRiffDecks\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取deck.id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">customDeckIdArr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到卡包`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 获取需要被制成卡片的块的ID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//已制卡块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">cardedBlockList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".protyle-wysiwyg [data-node-id][custom-riff-decks]\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">cardedBlockIdList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">cardedBlockList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterBlockCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">concat</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">cardedBlockIdList</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到页面的卡片`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 去重
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[...</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Set</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">)];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">deckIndex</span> <span class=""highlight-k"">in</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">// 把标记所在块全部制成卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">deckID</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">deckIndex</span><span class=""highlight-p"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">blockIDs</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/removeRiffCards\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">卡包的总卡片数：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">size</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">barMode</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""barMode\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">barMode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""beforebegin\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s1"">\'&lt;div id=\""removeCards\"" class=\""toolbar__item b3-tooltips b3-tooltips__se\"" aria-label=\""移除卡片\"" &gt;&lt;/div&gt;\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">removeCardsBtn</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""removeCards\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">removeCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">width</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""auto\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">removeCardsBtnIcon</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`&lt;svg xmlns=\""http://www.w3.org/2000/svg\"" height=\""48\"" viewBox=\""0 96 960 960\"" width=\""48\""&gt;&lt;path d=\""M600 826v-60h145v60H600Zm0-368v-60h280v60H600Zm0 184v-60h235v60H600ZM125 381H80v-60h170v-45h135v45h170v60h-45v415q0 24-18 42t-42 18H185q-24 0-42-18t-18-42V381Zm60 0v415h265V381H185Zm0 0v415-415Z\""/&gt;&lt;/svg&gt;`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">removeCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">removeCardsBtnIcon</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">removeCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""click\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">removeCards</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stopPropagation</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kc"">true</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})();</span>
</span></span></code></pre>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 一键制卡 v0.6
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 请求函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 使用匿名函数，防止污染空间
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-p"">(()</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">method</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Promise</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">resolve</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">reject</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">method</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">toUpperCase</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span> <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">resolve</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                            <span class=""highlight-nx"">reject</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""请求失败:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 弹出提示信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/notification/pushMsg\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">msg</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">timeout</span><span class=""highlight-o"">:</span> <span class=""highlight-mi"">3000</span> <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 获取当前文档id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getFileID</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前页面id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-s2"">\""span.protyle-breadcrumb__item--active\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">).</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPageID</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前屏幕
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentScreen</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".layout__wnd--active\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//传入 node节点列表 arr和数据抽取函数 fliter。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// fliter 传入一个节点，返回一个字典
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// 字典格式：
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// {status,data}
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-c1"">// status 为 ok，则代表为抽取成功，将data压入返回列表anwer，并最后返回。
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-o"">!</span><span class=""highlight-nx"">arr</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&lt;=</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">length</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">anwer</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-kd"">let</span> <span class=""highlight-nx"">node</span> <span class=""highlight-k"">of</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">fliter</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""status\""</span><span class=""highlight-p"">]</span> <span class=""highlight-o"">===</span> <span class=""highlight-s2"">\""ok\""</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">])</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">[</span><span class=""highlight-s2"">\""data\""</span><span class=""highlight-p"">]);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">anwer</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 传入列表下的段落，返回被标记段落的父节点：列表项的id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterListCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">re</span> <span class=""highlight-o"">=</span> <span class=""highlight-sr"">/(&gt;&gt;|(》》))\\s?\\u200b?$/</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">re</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">test</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerText</span><span class=""highlight-p"">))</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""no\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-kc"">null</span> <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterMarkCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">fliterSuperBlockCard</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">node</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">status</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""ok\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">data</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">node</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 获取当前文档路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getHpath</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getFileID</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""id\""</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/filetree/getHPathByID\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//检测返回值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">currentPagePath</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPagePath</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 添加多个卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取全部deck
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/getRiffDecks\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取当前打开文档的路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">getHpath</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">===</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能当前文档读取路径`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//获取deck.id, 其deck.name 包含在 focusItemPath 中
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">customDeckIdArr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">name</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">search</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">!=</span> <span class=""highlight-o"">-</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 的卡包`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 获取需要被制成卡片的块的ID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getCurrentPage</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//标记块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">markList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""span[data-type=\'mark\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//超级块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">superBlockList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""div[class=\'sb\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">//列表块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">listList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""div[class=\'li\']:has(div[class=\'li\'])  &gt; div[class = \'p\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">markCardList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterMarkCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">superBlockCardList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">superBlockList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterSuperBlockCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">var</span> <span class=""highlight-nx"">listCardList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">iterArr</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">listList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">fliterListCard</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">concat</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markCardList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">superBlockCardList</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">listCardList</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 页面的卡片`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 去重
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[...</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Set</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">)];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">deckIndex</span> <span class=""highlight-k"">in</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-c1"">// 把标记所在块全部制成卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">deckID</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">deckIndex</span><span class=""highlight-p"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">blockIDs</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/addRiffCards\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">卡包的总卡片数：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">size</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 添加一个按钮
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">barMode</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""barMode\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">barMode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""beforebegin\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s1"">\'&lt;div id=\""addCards\"" class=\""toolbar__item b3-tooltips b3-tooltips__se\"" aria-label=\""制作卡片\"" &gt;&lt;/div&gt;\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtn</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""addCards\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">width</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""auto\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtnIcon</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`&lt;svg t=\""1674130669751\"" class=\""icon\"" viewBox=\""0 0 1024 1024\"" version=\""1.1\"" xmlns=\""http://www.w3.org/2000/svg\"" p-id=\""4526\"" width=\""200\"" height=\""200\""&gt;&lt;path d=\""M928 160H96a32 32 0 0 0-32 32v672a32 32 0 0 0 32 32h832a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32z m-32 672H128V224h768v608z\"" p-id=\""4527\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;path d=\""M230.592 448.096H544a32 32 0 1 0 0-64H230.592a32 32 0 0 0 0 64zM230.592 640.096H544a32 32 0 1 0 0-64H230.592a32 32 0 1 0 0 64zM768 704a32 32 0 0 0 32-32V350.016a32 32 0 1 0-64 0V672a32 32 0 0 0 32 32z\"" p-id=\""4528\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;/svg&gt;`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">addCardsBtnIcon</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""click\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stopPropagation</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kc"">true</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">})();</span>
</span></span></code></pre>
                

作者：zxhd86
链接：https://ld246.com/article/1677506141805
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
748,闪卡样式的改进样式分享（个人认为） - 链滴,Mon Feb 27 2023 12:38:09 GMT+0000 (Coordinated Universal Time),"
                    <p>不是建议，只是把我基于之前发的<a href=""https://ld246.com/article/1656411680763"">纯粹使用模板和属性制作的 admonition 提示条 - 链滴</a>和借鉴了部分 logseq 的闪卡样式分享一下。感觉目前容器块内重复制卡的标识确实不怎么明确，所有做了一个更有标识度的样式。</p>
<p>我并不讨厌官方的样式，甚至默认日常就是用这个的，因为标识度的提高是靠对于正常内容的侵犯性换来的，在渐进阅读的时候太突兀了，感觉反而不如官方样式。</p>
<p>样式效果见下：</p>
<p><img src=""https://b3logfile.com/file/2023/02/图片-c4ZNVio.png?imageView2/2/interlace/1/format/webp""></p>
<p>在复习界面的话，右边的红条还在，阴影消失：</p>
<p><img src=""https://b3logfile.com/file/2023/02/图片-Jd4oaYR.png?imageView2/2/interlace/1/format/webp""></p>
<p>----2023.2.23 14:36 更新</p>
<p>经过自己的实际使用，我觉得三种制卡块还是分开吧，感觉列表块的上下距离并不适用于段落和超级块。</p>
<p>效果见下：</p>
<p><img src=""https://b3logfile.com/file/2023/02/图片-vyvIaFn.png?imageView2/2/interlace/1/format/webp""></p>
<pre><code class=""language-css highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">li</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">][</span><span class=""highlight-nt"">custom-riff-decks</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.15</span><span class=""highlight-kt"">em</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-mh"">#ff6a6a</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.01</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.2</span><span class=""highlight-kt"">em</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.2</span><span class=""highlight-kt"">em</span> <span class=""highlight-mh"">#aaaaaa</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-image</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">p</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">][</span><span class=""highlight-nt"">custom-riff-decks</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">display</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">block</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.15</span><span class=""highlight-kt"">em</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-mh"">#00c853</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.2</span><span class=""highlight-kt"">em</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.2</span><span class=""highlight-kt"">em</span> <span class=""highlight-mh"">#aaaaaa</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-image</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">em</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">em</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">.</span><span class=""highlight-nc"">protyle-wysiwyg</span> <span class=""highlight-p"">.</span><span class=""highlight-nc"">sb</span><span class=""highlight-o"">[</span><span class=""highlight-nt"">data-node-id</span><span class=""highlight-o"">][</span><span class=""highlight-nt"">custom-riff-decks</span><span class=""highlight-o"">]</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">position</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">relative</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">border-left</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.15</span><span class=""highlight-kt"">em</span> <span class=""highlight-kc"">solid</span> <span class=""highlight-mh"">#7c4dff</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">padding</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.01</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.2</span><span class=""highlight-kt"">em</span> <span class=""highlight-cp"">!important</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">box-shadow</span><span class=""highlight-p"">:</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mf"">0.2</span><span class=""highlight-kt"">em</span> <span class=""highlight-mh"">#aaaaaa</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">background-image</span><span class=""highlight-p"">:</span> <span class=""highlight-kc"">none</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">margin</span><span class=""highlight-p"">:</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">em</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">em</span> <span class=""highlight-mi"">1</span><span class=""highlight-kt"">em</span> <span class=""highlight-mi"">0</span><span class=""highlight-kt"">em</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span></code></pre>
<p>觉得不错留个言吧，起码让我知道有人在用。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1677472690224
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
747,markdown 导入时不支持文档的任何链接吗？ - 链滴,Mon Feb 13 2023 19:06:04 GMT+0000 (Coordinated Universal Time),"
                    <p>我之前了解到 siyuan 在导入时不支持 obsidian 的 wiki 样式双链，但是我最近发现好像连 markdown 样式的文档链接也不支持。</p>
<p>所以有导入思源并且保留链接关系的方法吗？</p>
                

作者：zxhd86
链接：https://ld246.com/article/1676286364699
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
751,并夕夕版 文档树制卡 v0.5 支持直接获取路径和分屏 - 链滴,Wed Feb 08 2023 16:14:00 GMT+0000 (Coordinated Universal Time),"
                    <p>前情提要：<a href=""https://ld246.com/article/1675512601965"">pdd 版文档树制卡 v0.3，支持超级块和标记块制卡 - 链滴</a></p>
<p>目前的版本没什么好说的，点了等一下就完了。</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 一键制卡 v0.5
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 请求函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">method</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Promise</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">resolve</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">reject</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">method</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">toUpperCase</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span> <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">resolve</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">reject</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""请求失败:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 弹出提示信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/notification/pushMsg\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">msg</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">timeout</span><span class=""highlight-o"">:</span> <span class=""highlight-mi"">3000</span> <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 获取当前文档id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getFileID</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取当前屏幕
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentScreen</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\"".layout__wnd--active\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取当前页面
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentScreen</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取当前页面id
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\""span.protyle-breadcrumb__item--active\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">).</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">   
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPageID</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 获取当前文档路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">getHpath</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">getFileID</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""id\""</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">currentPageID</span> <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/filetree/getHPathByID\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//检测返回值
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">currentPagePath</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span> <span class=""highlight-nx"">currentPagePath</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 添加多个卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取全部deck
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/getRiffDecks\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取当前打开文档的路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">getHpath</span><span class=""highlight-p"">()</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">===</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能当前文档读取路径`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取deck.id, 其deck.name 包含在 focusItemPath 中
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">customDeckIdArr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">name</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">search</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">!=</span> <span class=""highlight-o"">-</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 的卡包`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 获取需要被制成卡片的块的ID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//标记块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">markList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""span[data-type=\'mark\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//超级块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">superBlockList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""div[class=\'sb\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">markList</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">markList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&gt;</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markList</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">id</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">superBlockList</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">superBlockList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&gt;</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">superBlockList</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">id</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 页面的卡片`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 去重
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[...</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Set</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">)];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">deckIndex</span> <span class=""highlight-k"">in</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 把标记所在块全部制成卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">deckID</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">deckIndex</span><span class=""highlight-p"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">blockIDs</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/addRiffCards\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">卡包的总卡片数：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">size</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 添加一个按钮
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">barMode</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""barMode\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">barMode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s2"">\""beforebegin\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s1"">\'&lt;div id=\""addCards\"" class=\""toolbar__item b3-tooltips b3-tooltips__se\"" aria-label=\""制作卡片\"" &gt;&lt;/div&gt;\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtn</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""addCards\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">width</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""auto\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtnIcon</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`&lt;svg t=\""1674130669751\"" class=\""icon\"" viewBox=\""0 0 1024 1024\"" version=\""1.1\"" xmlns=\""http://www.w3.org/2000/svg\"" p-id=\""4526\"" width=\""200\"" height=\""200\""&gt;&lt;path d=\""M928 160H96a32 32 0 0 0-32 32v672a32 32 0 0 0 32 32h832a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32z m-32 672H128V224h768v608z\"" p-id=\""4527\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;path d=\""M230.592 448.096H544a32 32 0 1 0 0-64H230.592a32 32 0 0 0 0 64zM230.592 640.096H544a32 32 0 1 0 0-64H230.592a32 32 0 1 0 0 64zM768 704a32 32 0 0 0 32-32V350.016a32 32 0 1 0-64 0V672a32 32 0 0 0 32 32z\"" p-id=\""4528\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;/svg&gt;`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">addCardsBtnIcon</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s2"">\""click\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stopPropagation</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kc"">true</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">);</span>
</span></span></code></pre>
                

作者：zxhd86
链接：https://ld246.com/article/1675844040873
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
750,pdd 版文档树制卡 v0.3，支持超级块和标记块制卡 - 链滴,Sat Feb 04 2023 20:10:01 GMT+0000 (Coordinated Universal Time),"
                    <p>前情提要：<a href=""https://ld246.com/article/1675252131170"">pdd 版文档树制卡</a></p>
<p>现在支持超级块了。</p>
<p>代码见下：</p>
<pre><code class=""language-js highlight-chroma""><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 一键制卡 v0.3
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 请求函数
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kd"">function</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">data</span> <span class=""highlight-o"">=</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">method</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">return</span> <span class=""highlight-k"">new</span> <span class=""highlight-nb"">Promise</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">resolve</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">reject</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">method</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">toUpperCase</span><span class=""highlight-p"">()</span> <span class=""highlight-o"">==</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">fetch</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">url</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">method</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""POST\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">headers</span><span class=""highlight-o"">:</span> <span class=""highlight-p"">{</span> <span class=""highlight-s2"">\""Content-Type\""</span><span class=""highlight-o"">:</span> <span class=""highlight-s2"">\""application/json\""</span> <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">body</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">JSON</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stringify</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">.</span><span class=""highlight-nx"">then</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-nx"">resolve</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">json</span><span class=""highlight-p"">()),</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                        <span class=""highlight-nx"">reject</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">.</span><span class=""highlight-k"">catch</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">err</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                    <span class=""highlight-nx"">console</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">error</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""请求失败:\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">err</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 弹出提示信息
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">msg</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/notification/pushMsg\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{</span> <span class=""highlight-nx"">msg</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">timeout</span><span class=""highlight-o"">:</span> <span class=""highlight-mi"">3000</span> <span class=""highlight-p"">});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 添加多个卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">async</span> <span class=""highlight-kd"">function</span> <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">()</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取全部deck
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/getRiffDecks\""</span><span class=""highlight-p"">,</span> <span class=""highlight-p"">{});</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取当前打开文档的路径
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">focusItem</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""li[class=\'item item\\\\-\\\\-focus\']\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">focusItem</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""aria-label\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span> <span class=""highlight-o"">===</span> <span class=""highlight-kc"">null</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能当前文档读取路径`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//获取deck.id, 其deck.name 包含在 focusItemPath 中
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">customDeckIdArr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">name</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">search</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">name</span><span class=""highlight-p"">)</span> <span class=""highlight-o"">!=</span> <span class=""highlight-o"">-</span><span class=""highlight-mi"">1</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 的卡包`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 获取需要被制成卡片的块的ID
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">currentPage</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelector</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-s2"">\"".fn__flex-1.protyle:not(.fn__none)\""</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//标记块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">markList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""span[data-type=\'mark\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">//超级块
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-kr"">const</span> <span class=""highlight-nx"">superBlockList</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">currentPage</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">querySelectorAll</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""div[class=\'sb\']\""</span><span class=""highlight-p"">)</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">markList</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">markList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&gt;</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">markList</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">id</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">parentElement</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">superBlockList</span> <span class=""highlight-o"">&amp;&amp;</span> <span class=""highlight-nx"">superBlockList</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">&gt;</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nb"">Array</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">from</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">superBlockList</span><span class=""highlight-p"">).</span><span class=""highlight-nx"">forEach</span><span class=""highlight-p"">((</span><span class=""highlight-nx"">item</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">id</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">item</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getAttribute</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""data-node-id\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">                <span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">push</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">id</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">})</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">length</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`未能获取到：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">focusItemPath</span><span class=""highlight-si"">}</span><span class=""highlight-sb""> 页面的卡片`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">return</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-c1"">// 去重
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>    <span class=""highlight-nx"">arr</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">[...</span> <span class=""highlight-k"">new</span> <span class=""highlight-nx"">Set</span><span class=""highlight-p"">(</span><span class=""highlight-nx"">arr</span><span class=""highlight-p"">)];</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-k"">for</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">deckIndex</span> <span class=""highlight-k"">in</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-c1"">// 把标记所在块全部制成卡片
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span>        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">body</span> <span class=""highlight-o"">=</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">deckID</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">customDeckIdArr</span><span class=""highlight-p"">[</span><span class=""highlight-nx"">deckIndex</span><span class=""highlight-p"">],</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">blockIDs</span><span class=""highlight-o"">:</span> <span class=""highlight-nx"">arr</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">};</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-kd"">let</span> <span class=""highlight-nx"">res</span> <span class=""highlight-o"">=</span> <span class=""highlight-kr"">await</span> <span class=""highlight-nx"">request</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""/api/riff/addRiffCards\""</span><span class=""highlight-p"">,</span> <span class=""highlight-nx"">body</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-k"">if</span> <span class=""highlight-p"">(</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">code</span> <span class=""highlight-o"">===</span> <span class=""highlight-mi"">0</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">            <span class=""highlight-nx"">showMessage</span><span class=""highlight-p"">(</span><span class=""highlight-sb"">`</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">name</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">卡包的总卡片数：</span><span class=""highlight-si"">${</span><span class=""highlight-nx"">res</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">data</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">size</span><span class=""highlight-si"">}</span><span class=""highlight-sb"">`</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">}</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1"">// 添加一个按钮
</span></span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-c1""></span><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">barMode</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""barMode\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">barMode</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">insertAdjacentHTML</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s2"">\""beforebegin\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s1"">\'&lt;div id=\""addCards\"" class=\""toolbar__item b3-tooltips b3-tooltips__se\"" aria-label=\""制作卡片\"" &gt;&lt;/div&gt;\'</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtn</span> <span class=""highlight-o"">=</span> <span class=""highlight-nb"">document</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">getElementById</span><span class=""highlight-p"">(</span><span class=""highlight-s2"">\""addCards\""</span><span class=""highlight-p"">);</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">style</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">width</span> <span class=""highlight-o"">=</span> <span class=""highlight-s2"">\""auto\""</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-kr"">const</span> <span class=""highlight-nx"">addCardsBtnIcon</span> <span class=""highlight-o"">=</span> <span class=""highlight-sb"">`&lt;svg t=\""1674130669751\"" class=\""icon\"" viewBox=\""0 0 1024 1024\"" version=\""1.1\"" xmlns=\""http://www.w3.org/2000/svg\"" p-id=\""4526\"" width=\""200\"" height=\""200\""&gt;&lt;path d=\""M928 160H96a32 32 0 0 0-32 32v672a32 32 0 0 0 32 32h832a32 32 0 0 0 32-32V192a32 32 0 0 0-32-32z m-32 672H128V224h768v608z\"" p-id=\""4527\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;path d=\""M230.592 448.096H544a32 32 0 1 0 0-64H230.592a32 32 0 0 0 0 64zM230.592 640.096H544a32 32 0 1 0 0-64H230.592a32 32 0 1 0 0 64zM768 704a32 32 0 0 0 32-32V350.016a32 32 0 1 0-64 0V672a32 32 0 0 0 32 32z\"" p-id=\""4528\"" fill=\""#9aa0a6\""&gt;&lt;/path&gt;&lt;/svg&gt;`</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">innerHTML</span> <span class=""highlight-o"">=</span> <span class=""highlight-nx"">addCardsBtnIcon</span><span class=""highlight-p"">;</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-nx"">addCardsBtn</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">addEventListener</span><span class=""highlight-p"">(</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-s2"">\""click\""</span><span class=""highlight-p"">,</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">(</span><span class=""highlight-nx"">e</span><span class=""highlight-p"">)</span> <span class=""highlight-p"">=&gt;</span> <span class=""highlight-p"">{</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">addCards</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">stopPropagation</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">        <span class=""highlight-nx"">e</span><span class=""highlight-p"">.</span><span class=""highlight-nx"">preventDefault</span><span class=""highlight-p"">();</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-p"">},</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl"">    <span class=""highlight-kc"">true</span>
</span></span><span class=""highlight-line""><span class=""highlight-cl""><span class=""highlight-p"">);</span>
</span></span></code></pre>
<p>使用方式和注意事项参见 <a href=""https://ld246.com/article/1675252131170"">pdd 版文档树制卡</a>，再次感谢 @<a href=""https://ld246.com/member/BryceAndJuly"">BryceAndJuly</a> 大佬提供的框架。</p>
<p>欢迎留言。</p>
                

作者：zxhd86
链接：https://ld246.com/article/1675512601965
来源：链滴
协议：CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/",zxhd86,思源笔记,链滴优选
